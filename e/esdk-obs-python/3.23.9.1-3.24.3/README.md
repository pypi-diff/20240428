# Comparing `tmp/esdk-obs-python-3.23.9.1.tar.gz` & `tmp/esdk-obs-python-3.24.3.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "esdk-obs-python-3.23.9.1.tar", last modified: Thu Sep 21 13:17:40 2023, max compression
+gzip compressed data, was "esdk-obs-python-3.24.3.tar", last modified: Sun Apr 28 07:36:41 2024, max compression
```

## Comparing `esdk-obs-python-3.23.9.1.tar` & `esdk-obs-python-3.24.3.tar`

### file list

```diff
@@ -1,34 +1,34 @@
-drwxr-xr-x   0 obs        (501) staff       (20)        0 2023-09-21 13:17:40.352309 esdk-obs-python-3.23.9.1/
--rw-r--r--   0 obs        (501) staff       (20)      177 2023-09-21 13:17:40.351941 esdk-obs-python-3.23.9.1/PKG-INFO
-drwxr-xr-x   0 obs        (501) staff       (20)        0 2023-09-21 13:17:40.338793 esdk-obs-python-3.23.9.1/esdk_obs_python.egg-info/
--rw-r--r--   0 obs        (501) staff       (20)      177 2023-09-21 13:17:40.000000 esdk-obs-python-3.23.9.1/esdk_obs_python.egg-info/PKG-INFO
--rw-r--r--   0 obs        (501) staff       (20)      588 2023-09-21 13:17:40.000000 esdk-obs-python-3.23.9.1/esdk_obs_python.egg-info/SOURCES.txt
--rw-r--r--   0 obs        (501) staff       (20)        1 2023-09-21 13:17:40.000000 esdk-obs-python-3.23.9.1/esdk_obs_python.egg-info/dependency_links.txt
--rw-r--r--   0 obs        (501) staff       (20)        1 2023-09-21 13:17:40.000000 esdk-obs-python-3.23.9.1/esdk_obs_python.egg-info/not-zip-safe
--rw-r--r--   0 obs        (501) staff       (20)       21 2023-09-21 13:17:40.000000 esdk-obs-python-3.23.9.1/esdk_obs_python.egg-info/requires.txt
--rw-r--r--   0 obs        (501) staff       (20)        4 2023-09-21 13:17:40.000000 esdk-obs-python-3.23.9.1/esdk_obs_python.egg-info/top_level.txt
-drwxr-xr-x   0 obs        (501) staff       (20)        0 2023-09-21 13:17:40.351215 esdk-obs-python-3.23.9.1/obs/
--rw-r--r--   0 obs        (501) staff       (20)     3423 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/__init__.py
--rw-r--r--   0 obs        (501) staff       (20)    11070 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/auth.py
--rw-r--r--   0 obs        (501) staff       (20)     3620 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/bucket.py
--rw-r--r--   0 obs        (501) staff       (20)     6476 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/bulktasks.py
--rw-r--r--   0 obs        (501) staff       (20)     1347 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/cache.py
--rw-r--r--   0 obs        (501) staff       (20)   128748 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/client.py
--rw-r--r--   0 obs        (501) staff       (20)     9825 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/const.py
--rw-r--r--   0 obs        (501) staff       (20)   118786 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/convertor.py
--rw-r--r--   0 obs        (501) staff       (20)    16746 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/crypto_client.py
--rw-r--r--   0 obs        (501) staff       (20)     6781 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/extension.py
--rw-r--r--   0 obs        (501) staff       (20)     5912 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/http2.py
--rw-r--r--   0 obs        (501) staff       (20)     5780 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/ilog.py
--rw-r--r--   0 obs        (501) staff       (20)     6321 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/loadtoken.py
--rw-r--r--   0 obs        (501) staff       (20)      894 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/locks.py
--rw-r--r--   0 obs        (501) staff       (20)    64679 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/model.py
--rw-r--r--   0 obs        (501) staff       (20)    16231 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/obs_cipher_suite.py
--rw-r--r--   0 obs        (501) staff       (20)     3206 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/posix_transfer.py
--rw-r--r--   0 obs        (501) staff       (20)     2522 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/progress.py
--rw-r--r--   0 obs        (501) staff       (20)     1647 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/searchmethod.py
--rw-r--r--   0 obs        (501) staff       (20)    37148 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/transfer.py
--rw-r--r--   0 obs        (501) staff       (20)    13364 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/util.py
--rw-r--r--   0 obs        (501) staff       (20)    15539 2023-09-20 12:31:03.000000 esdk-obs-python-3.23.9.1/obs/workflow.py
--rw-r--r--   0 obs        (501) staff       (20)       38 2023-09-21 13:17:40.352594 esdk-obs-python-3.23.9.1/setup.cfg
--rw-r--r--   0 obs        (501) staff       (20)     1229 2023-09-21 13:17:03.000000 esdk-obs-python-3.23.9.1/setup.py
+drwxrwxrwx   0        0        0        0 2024-04-28 07:36:41.391351 esdk-obs-python-3.24.3/
+-rw-rw-rw-   0        0        0      194 2024-04-28 07:36:41.389862 esdk-obs-python-3.24.3/PKG-INFO
+drwxrwxrwx   0        0        0        0 2024-04-28 07:36:41.270971 esdk-obs-python-3.24.3/esdk_obs_python.egg-info/
+-rw-rw-rw-   0        0        0      194 2024-04-28 07:36:41.000000 esdk-obs-python-3.24.3/esdk_obs_python.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0      588 2024-04-28 07:36:41.000000 esdk-obs-python-3.24.3/esdk_obs_python.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2024-04-28 07:36:41.000000 esdk-obs-python-3.24.3/esdk_obs_python.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0        2 2024-04-28 07:36:41.000000 esdk-obs-python-3.24.3/esdk_obs_python.egg-info/not-zip-safe
+-rw-rw-rw-   0        0        0       21 2024-04-28 07:36:41.000000 esdk-obs-python-3.24.3/esdk_obs_python.egg-info/requires.txt
+-rw-rw-rw-   0        0        0        4 2024-04-28 07:36:41.000000 esdk-obs-python-3.24.3/esdk_obs_python.egg-info/top_level.txt
+drwxrwxrwx   0        0        0        0 2024-04-28 07:36:41.387377 esdk-obs-python-3.24.3/obs/
+-rw-rw-rw-   0        0        0     3541 2024-04-28 07:19:31.000000 esdk-obs-python-3.24.3/obs/__init__.py
+-rw-rw-rw-   0        0        0    11348 2024-04-28 07:19:35.000000 esdk-obs-python-3.24.3/obs/auth.py
+-rw-rw-rw-   0        0        0     3730 2024-04-28 07:19:39.000000 esdk-obs-python-3.24.3/obs/bucket.py
+-rw-rw-rw-   0        0        0     6694 2024-04-28 07:19:42.000000 esdk-obs-python-3.24.3/obs/bulktasks.py
+-rw-rw-rw-   0        0        0     1391 2024-04-28 07:19:48.000000 esdk-obs-python-3.24.3/obs/cache.py
+-rw-rw-rw-   0        0        0   129893 2024-04-11 02:15:22.000000 esdk-obs-python-3.24.3/obs/client.py
+-rw-rw-rw-   0        0        0     9838 2024-04-28 07:20:19.000000 esdk-obs-python-3.24.3/obs/const.py
+-rw-rw-rw-   0        0        0   118939 2024-04-11 02:15:22.000000 esdk-obs-python-3.24.3/obs/convertor.py
+-rw-rw-rw-   0        0        0    17635 2024-04-28 07:20:32.000000 esdk-obs-python-3.24.3/obs/crypto_client.py
+-rw-rw-rw-   0        0        0     6933 2024-04-28 07:20:35.000000 esdk-obs-python-3.24.3/obs/extension.py
+-rw-rw-rw-   0        0        0     6081 2024-04-28 07:20:38.000000 esdk-obs-python-3.24.3/obs/http2.py
+-rw-rw-rw-   0        0        0     5927 2024-04-28 07:20:40.000000 esdk-obs-python-3.24.3/obs/ilog.py
+-rw-rw-rw-   0        0        0     6505 2024-04-28 07:20:42.000000 esdk-obs-python-3.24.3/obs/loadtoken.py
+-rw-rw-rw-   0        0        0      922 2024-04-28 07:20:44.000000 esdk-obs-python-3.24.3/obs/locks.py
+-rw-rw-rw-   0        0        0    66369 2024-04-28 07:20:47.000000 esdk-obs-python-3.24.3/obs/model.py
+-rw-rw-rw-   0        0        0    17200 2024-04-28 07:20:50.000000 esdk-obs-python-3.24.3/obs/obs_cipher_suite.py
+-rw-rw-rw-   0        0        0     3873 2024-04-28 07:20:53.000000 esdk-obs-python-3.24.3/obs/posix_transfer.py
+-rw-rw-rw-   0        0        0     2605 2024-04-28 07:20:55.000000 esdk-obs-python-3.24.3/obs/progress.py
+-rw-rw-rw-   0        0        0     1688 2024-04-28 07:20:59.000000 esdk-obs-python-3.24.3/obs/searchmethod.py
+-rw-rw-rw-   0        0        0    37949 2024-04-28 07:21:02.000000 esdk-obs-python-3.24.3/obs/transfer.py
+-rw-rw-rw-   0        0        0    13796 2024-04-28 07:21:04.000000 esdk-obs-python-3.24.3/obs/util.py
+-rw-rw-rw-   0        0        0    15981 2024-04-28 07:21:07.000000 esdk-obs-python-3.24.3/obs/workflow.py
+-rw-rw-rw-   0        0        0       42 2024-04-28 07:36:41.391351 esdk-obs-python-3.24.3/setup.cfg
+-rw-rw-rw-   0        0        0     1247 2024-04-28 07:19:16.000000 esdk-obs-python-3.24.3/setup.py
```

### Comparing `esdk-obs-python-3.23.9.1/esdk_obs_python.egg-info/SOURCES.txt` & `esdk-obs-python-3.24.3/esdk_obs_python.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `esdk-obs-python-3.23.9.1/obs/auth.py` & `esdk-obs-python-3.24.3/obs/auth.py`

 * *Ordering differences only*

 * *Files 11% similar despite different names*

```diff
@@ -1,278 +1,278 @@
-#!/usr/bin/python
-# -*- coding:utf-8 -*-
-# Copyright 2019 Huawei Technologies Co.,Ltd.
-# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
-# this file except in compliance with the License.  You may obtain a copy of the
-# License at
-
-# http://www.apache.org/licenses/LICENSE-2.0
-
-# Unless required by applicable law or agreed to in writing, software distributed
-# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
-# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
-# specific language governing permissions and limitations under the License.
-
-import hashlib
-import hmac
-import binascii
-from obs import util
-from obs import const
-
-
-class Authentication(object):
-
-    def __init__(self, ak, sk, path_style, ha, server, is_cname):
-        self.ak = ak
-        self.sk = sk
-        self.path_style = path_style
-        self.ha = ha
-        self.server = server
-        self.is_cname = is_cname
-
-    def doAuth(self, method, bucket, key, path_args, headers, expires=None):
-        ret = self.getSignature(method, bucket, key, path_args, headers, expires)
-        return {
-            const.AUTHORIZATION_HEADER: '%s %s:%s' % (self.ha.auth_prefix(), self.ak, ret['Signature']),
-            const.CANONICAL_STRING: ret[const.CANONICAL_STRING]
-        }
-
-    def getSignature(self, method, bucket, key, path_args, headers, expires=None):
-        canonical_string = self.__make_canonical_string(method, bucket, key, path_args, headers, expires)
-        return {
-            'Signature': self.hmacSha128(canonical_string),
-            const.CANONICAL_STRING: canonical_string
-        }
-
-    def hmacSha128(self, canonical_string):
-        if const.IS_PYTHON2:
-            hashed = hmac.new(self.sk, canonical_string, hashlib.sha1)
-            encode_canonical = binascii.b2a_base64(hashed.digest())[:-1]
-        else:
-            hashed = hmac.new(self.sk.encode('UTF-8'), canonical_string.encode('UTF-8'), hashlib.sha1)
-            encode_canonical = binascii.b2a_base64(hashed.digest())[:-1].decode('UTF-8')
-
-        return encode_canonical
-
-    def __make_canonical_string(self, method, bucket_name, key, path_args, headers, expires=None):
-        interesting_headers = self.__make_canonicalstring_interesting_headers(headers, expires)
-        key_list = sorted(interesting_headers.keys())
-        str_list = self.__make_canonicalstring_str_list(key_list, method, interesting_headers)
-        URI = ''
-        _bucket_name = self.server if self.is_cname else bucket_name
-        if _bucket_name:
-            URI += '/'
-            URI += _bucket_name
-            if not self.path_style or self.is_cname:
-                URI += '/'
-
-        if key:
-            if not URI.endswith('/'):
-                URI += '/'
-            URI += util.encode_object_key(key)
-
-        if URI:
-            str_list.append(URI)
-        else:
-            str_list.append('/')
-
-        if path_args:
-            e = '?'
-            cannoList = sorted(path_args.items(), key=lambda d: d[0])
-            for path_key, path_value in cannoList:
-                if path_key.lower() in const.ALLOWED_RESOURCE_PARAMTER_NAMES or path_key.lower().startswith(
-                        self.ha._get_header_prefix()):
-                    path_key = util.encode_item(path_key, '/')
-                    if path_value is None:
-                        e += path_key + '&'
-                        continue
-                    e += path_key + '=' + util.to_string(path_value) + '&'
-
-            e = e[:-1]
-            str_list.append(e)
-        return ''.join(str_list)
-
-    def __make_canonicalstring_interesting_headers(self, headers, expires):
-        interesting_headers = {}
-        if isinstance(headers, dict):
-            for hash_key in headers.keys():
-                lk = hash_key.lower()
-                if lk in const.CONTENT_LIST or lk.startswith(self.ha._get_header_prefix()):
-                    s = headers.get(hash_key)
-                    interesting_headers[lk] = ''.join(s)
-
-        key_list = interesting_headers.keys()
-
-        if self.ha.date_header() in key_list:
-            interesting_headers[const.DATE_HEADER.lower()] = ''
-
-        if expires:
-            interesting_headers[const.DATE_HEADER.lower()] = expires
-
-        if const.CONTENT_TYPE_HEADER.lower() not in key_list:
-            interesting_headers[const.CONTENT_TYPE_HEADER.lower()] = ''
-
-        if const.CONTENT_MD5_HEADER.lower() not in key_list:
-            interesting_headers[const.CONTENT_MD5_HEADER.lower()] = ''
-
-        return interesting_headers
-
-    def __make_canonicalstring_str_list(self, keylist, method, interesting_headers):
-        str_list = [method + '\n']
-        for k in keylist:
-            header_key = util.to_string(k)
-            val = '' if interesting_headers[header_key] is None else interesting_headers[header_key]
-            if header_key.startswith(self.ha._get_meta_header_prefix()):
-                str_list.append(header_key + ':' + util.to_string(val).strip())
-            elif header_key.startswith(self.ha._get_header_prefix()):
-                str_list.append(header_key + ':' + val)
-            else:
-                str_list.append(val)
-            str_list.append('\n')
-        return str_list
-
-
-class V4Authentication(object):
-    CONTENT_SHA256 = 'UNSIGNED-PAYLOAD'
-
-    def __init__(self, ak, sk, region, shortDate, longDate, path_style, ha):
-        self.ak = ak
-        self.sk = sk
-        self.region = region
-        self.shortDate = shortDate
-        self.longDate = longDate
-        self.path_style = path_style
-        self.ha = ha
-
-    def doAuth(self, method, bucket, key, args_path, headers):
-        args_path = args_path if isinstance(args_path, dict) else {}
-        headers = headers if isinstance(headers, dict) else {}
-        headers[self.ha.content_sha256_header()] = self.CONTENT_SHA256
-
-        credential = self.getCredential()
-        headMap = self.setMapKeyLower(headers)
-        signedHeaders = self.getSignedHeaders(headMap)
-        ret = self.getSignature(method, bucket, key, args_path, headMap, signedHeaders)
-        auth = 'AWS4-HMAC-SHA256 Credential=%s,SignedHeaders=%s,Signature=%s' % (
-            credential, signedHeaders, ret['Signature'])
-        return {
-            const.AUTHORIZATION_HEADER: auth,
-            const.CANONICAL_REQUEST: ret[const.CANONICAL_REQUEST]
-        }
-
-    def getCredential(self):
-        return '%s/%s/%s/s3/aws4_request' % (self.ak, self.shortDate, self.region)
-
-    def getScope(self):
-        return '%s/%s/s3/aws4_request' % (self.shortDate, self.region)
-
-    @staticmethod
-    def getSignedHeaders(headMap):
-        headList = sorted(headMap.items(), key=lambda d: d[0])
-        signedHeaders = ''
-        i = 0
-        for val in headList:
-            if i != 0:
-                signedHeaders += ';'
-            signedHeaders += val[0]
-            i = 1
-        return signedHeaders
-
-    def getSignature(self, method, bucket, key, args_path, headMap, signedHeaders, payload=None):
-        outPut = 'AWS4-HMAC-SHA256' + '\n'
-        outPut += self.longDate + '\n'
-        outPut += self.getScope() + '\n'
-        cannonicalRequest = self.getCanonicalRequest(method, bucket, key, args_path, headMap, signedHeaders, payload)
-
-        if const.IS_PYTHON2:
-            stringToSign = outPut + self.__shaCannonicalRequest_python2(cannonicalRequest)
-            signingKey = self.getSigningKey_python2()
-        else:
-            stringToSign = outPut + self.__shaCannonicalRequest_python3(cannonicalRequest)
-            stringToSign = stringToSign.encode('UTF-8')
-            signingKey = self.getSigningKey_python3()
-        return {
-            'Signature': self.hmacSha256(signingKey, stringToSign),
-            const.CANONICAL_REQUEST: cannonicalRequest
-        }
-
-    @staticmethod
-    def hmacSha256(signingKey, stringToSign):
-        return hmac.new(signingKey, stringToSign, hashlib.sha256).hexdigest()
-
-    def getSigningKey_python2(self):
-        key = 'AWS4' + self.sk
-        dateKey = hmac.new(key, self.shortDate, hashlib.sha256).digest()
-        dateRegionKey = hmac.new(dateKey, self.region, hashlib.sha256).digest()
-        dateRegionServiceKey = hmac.new(dateRegionKey, 's3', hashlib.sha256).digest()
-        signingKey = hmac.new(dateRegionServiceKey, 'aws4_request', hashlib.sha256).digest()
-        return signingKey
-
-    def getSigningKey_python3(self):
-        key = 'AWS4' + self.sk
-        dateKey = hmac.new(key.encode('UTF-8'), self.shortDate.encode('UTF-8'), hashlib.sha256).digest()
-        dateRegionKey = hmac.new(dateKey, self.region.encode('UTF-8'), hashlib.sha256).digest()
-        dateRegionServiceKey = hmac.new(dateRegionKey, 's3'.encode('UTF-8'), hashlib.sha256).digest()
-        signingKey = hmac.new(dateRegionServiceKey, 'aws4_request'.encode('UTF-8'), hashlib.sha256).digest()
-        return signingKey
-
-    def getCanonicalRequest(self, method, bucket, key, args_path, headMap, signedHeaders, payload=None):
-        output = [method]
-        output.append(self.getCanonicalURI(bucket, key))
-        output.append(self.getCanonicalQueryString(args_path))
-        output.append(self.getCanonicalHeaders(headMap))
-        output.append(signedHeaders)
-        output.append(self.CONTENT_SHA256 if payload is None else payload)
-        return '\n'.join(output)
-
-    @staticmethod
-    def __shaCannonicalRequest_python2(cannonicalRequest):
-        return hashlib.sha256(cannonicalRequest).hexdigest()
-
-    @staticmethod
-    def __shaCannonicalRequest_python3(cannonicalRequest):
-        return hashlib.sha256(cannonicalRequest.encode('UTF-8')).hexdigest()
-
-    def getCanonicalURI(self, bucket=None, key=None):
-        URI = ''
-        if self.path_style and bucket:
-            URI += '/' + bucket
-        if key:
-            URI += '/' + key
-        if not URI:
-            URI = '/'
-        return util.encode_object_key(URI)
-
-    @staticmethod
-    def getCanonicalQueryString(args_path):
-        canonMap = {}
-        for key, value in args_path.items():
-            canonMap[key] = value
-        cannoList = sorted(canonMap.items(), key=lambda d: d[0])
-        queryStr = ''
-        i = 0
-        for val in cannoList:
-            if i != 0:
-                queryStr += '&'
-            queryStr += '%s=%s' % (util.encode_item(val[0], '/'), util.encode_item(val[1], ''))
-            i = 1
-        return queryStr
-
-    @staticmethod
-    def getCanonicalHeaders(headMap):
-        headList = sorted(headMap.items(), key=lambda d: d[0])
-        canonicalHeaderStr = ''
-        for val in headList:
-            if isinstance(val[1], list):
-                tlist = sorted(val[1])
-                for v in tlist:
-                    canonicalHeaderStr += val[0] + ':' + v + '\n'
-            else:
-                canonicalHeaderStr += val[0] + ':' + str(val[1]) + '\n'
-        return canonicalHeaderStr
-
-    @staticmethod
-    def setMapKeyLower(inputMap):
-        outputMap = {}
-        for key in inputMap.keys():
-            outputMap[key.lower()] = inputMap[key]
-        return outputMap
+#!/usr/bin/python
+# -*- coding:utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+import hashlib
+import hmac
+import binascii
+from obs import util
+from obs import const
+
+
+class Authentication(object):
+
+    def __init__(self, ak, sk, path_style, ha, server, is_cname):
+        self.ak = ak
+        self.sk = sk
+        self.path_style = path_style
+        self.ha = ha
+        self.server = server
+        self.is_cname = is_cname
+
+    def doAuth(self, method, bucket, key, path_args, headers, expires=None):
+        ret = self.getSignature(method, bucket, key, path_args, headers, expires)
+        return {
+            const.AUTHORIZATION_HEADER: '%s %s:%s' % (self.ha.auth_prefix(), self.ak, ret['Signature']),
+            const.CANONICAL_STRING: ret[const.CANONICAL_STRING]
+        }
+
+    def getSignature(self, method, bucket, key, path_args, headers, expires=None):
+        canonical_string = self.__make_canonical_string(method, bucket, key, path_args, headers, expires)
+        return {
+            'Signature': self.hmacSha128(canonical_string),
+            const.CANONICAL_STRING: canonical_string
+        }
+
+    def hmacSha128(self, canonical_string):
+        if const.IS_PYTHON2:
+            hashed = hmac.new(self.sk, canonical_string, hashlib.sha1)
+            encode_canonical = binascii.b2a_base64(hashed.digest())[:-1]
+        else:
+            hashed = hmac.new(self.sk.encode('UTF-8'), canonical_string.encode('UTF-8'), hashlib.sha1)
+            encode_canonical = binascii.b2a_base64(hashed.digest())[:-1].decode('UTF-8')
+
+        return encode_canonical
+
+    def __make_canonical_string(self, method, bucket_name, key, path_args, headers, expires=None):
+        interesting_headers = self.__make_canonicalstring_interesting_headers(headers, expires)
+        key_list = sorted(interesting_headers.keys())
+        str_list = self.__make_canonicalstring_str_list(key_list, method, interesting_headers)
+        URI = ''
+        _bucket_name = self.server if self.is_cname else bucket_name
+        if _bucket_name:
+            URI += '/'
+            URI += _bucket_name
+            if not self.path_style or self.is_cname:
+                URI += '/'
+
+        if key:
+            if not URI.endswith('/'):
+                URI += '/'
+            URI += util.encode_object_key(key)
+
+        if URI:
+            str_list.append(URI)
+        else:
+            str_list.append('/')
+
+        if path_args:
+            e = '?'
+            cannoList = sorted(path_args.items(), key=lambda d: d[0])
+            for path_key, path_value in cannoList:
+                if path_key.lower() in const.ALLOWED_RESOURCE_PARAMTER_NAMES or path_key.lower().startswith(
+                        self.ha._get_header_prefix()):
+                    path_key = util.encode_item(path_key, '/')
+                    if path_value is None:
+                        e += path_key + '&'
+                        continue
+                    e += path_key + '=' + util.to_string(path_value) + '&'
+
+            e = e[:-1]
+            str_list.append(e)
+        return ''.join(str_list)
+
+    def __make_canonicalstring_interesting_headers(self, headers, expires):
+        interesting_headers = {}
+        if isinstance(headers, dict):
+            for hash_key in headers.keys():
+                lk = hash_key.lower()
+                if lk in const.CONTENT_LIST or lk.startswith(self.ha._get_header_prefix()):
+                    s = headers.get(hash_key)
+                    interesting_headers[lk] = ''.join(s)
+
+        key_list = interesting_headers.keys()
+
+        if self.ha.date_header() in key_list:
+            interesting_headers[const.DATE_HEADER.lower()] = ''
+
+        if expires:
+            interesting_headers[const.DATE_HEADER.lower()] = expires
+
+        if const.CONTENT_TYPE_HEADER.lower() not in key_list:
+            interesting_headers[const.CONTENT_TYPE_HEADER.lower()] = ''
+
+        if const.CONTENT_MD5_HEADER.lower() not in key_list:
+            interesting_headers[const.CONTENT_MD5_HEADER.lower()] = ''
+
+        return interesting_headers
+
+    def __make_canonicalstring_str_list(self, keylist, method, interesting_headers):
+        str_list = [method + '\n']
+        for k in keylist:
+            header_key = util.to_string(k)
+            val = '' if interesting_headers[header_key] is None else interesting_headers[header_key]
+            if header_key.startswith(self.ha._get_meta_header_prefix()):
+                str_list.append(header_key + ':' + util.to_string(val).strip())
+            elif header_key.startswith(self.ha._get_header_prefix()):
+                str_list.append(header_key + ':' + val)
+            else:
+                str_list.append(val)
+            str_list.append('\n')
+        return str_list
+
+
+class V4Authentication(object):
+    CONTENT_SHA256 = 'UNSIGNED-PAYLOAD'
+
+    def __init__(self, ak, sk, region, shortDate, longDate, path_style, ha):
+        self.ak = ak
+        self.sk = sk
+        self.region = region
+        self.shortDate = shortDate
+        self.longDate = longDate
+        self.path_style = path_style
+        self.ha = ha
+
+    def doAuth(self, method, bucket, key, args_path, headers):
+        args_path = args_path if isinstance(args_path, dict) else {}
+        headers = headers if isinstance(headers, dict) else {}
+        headers[self.ha.content_sha256_header()] = self.CONTENT_SHA256
+
+        credential = self.getCredential()
+        headMap = self.setMapKeyLower(headers)
+        signedHeaders = self.getSignedHeaders(headMap)
+        ret = self.getSignature(method, bucket, key, args_path, headMap, signedHeaders)
+        auth = 'AWS4-HMAC-SHA256 Credential=%s,SignedHeaders=%s,Signature=%s' % (
+            credential, signedHeaders, ret['Signature'])
+        return {
+            const.AUTHORIZATION_HEADER: auth,
+            const.CANONICAL_REQUEST: ret[const.CANONICAL_REQUEST]
+        }
+
+    def getCredential(self):
+        return '%s/%s/%s/s3/aws4_request' % (self.ak, self.shortDate, self.region)
+
+    def getScope(self):
+        return '%s/%s/s3/aws4_request' % (self.shortDate, self.region)
+
+    @staticmethod
+    def getSignedHeaders(headMap):
+        headList = sorted(headMap.items(), key=lambda d: d[0])
+        signedHeaders = ''
+        i = 0
+        for val in headList:
+            if i != 0:
+                signedHeaders += ';'
+            signedHeaders += val[0]
+            i = 1
+        return signedHeaders
+
+    def getSignature(self, method, bucket, key, args_path, headMap, signedHeaders, payload=None):
+        outPut = 'AWS4-HMAC-SHA256' + '\n'
+        outPut += self.longDate + '\n'
+        outPut += self.getScope() + '\n'
+        cannonicalRequest = self.getCanonicalRequest(method, bucket, key, args_path, headMap, signedHeaders, payload)
+
+        if const.IS_PYTHON2:
+            stringToSign = outPut + self.__shaCannonicalRequest_python2(cannonicalRequest)
+            signingKey = self.getSigningKey_python2()
+        else:
+            stringToSign = outPut + self.__shaCannonicalRequest_python3(cannonicalRequest)
+            stringToSign = stringToSign.encode('UTF-8')
+            signingKey = self.getSigningKey_python3()
+        return {
+            'Signature': self.hmacSha256(signingKey, stringToSign),
+            const.CANONICAL_REQUEST: cannonicalRequest
+        }
+
+    @staticmethod
+    def hmacSha256(signingKey, stringToSign):
+        return hmac.new(signingKey, stringToSign, hashlib.sha256).hexdigest()
+
+    def getSigningKey_python2(self):
+        key = 'AWS4' + self.sk
+        dateKey = hmac.new(key, self.shortDate, hashlib.sha256).digest()
+        dateRegionKey = hmac.new(dateKey, self.region, hashlib.sha256).digest()
+        dateRegionServiceKey = hmac.new(dateRegionKey, 's3', hashlib.sha256).digest()
+        signingKey = hmac.new(dateRegionServiceKey, 'aws4_request', hashlib.sha256).digest()
+        return signingKey
+
+    def getSigningKey_python3(self):
+        key = 'AWS4' + self.sk
+        dateKey = hmac.new(key.encode('UTF-8'), self.shortDate.encode('UTF-8'), hashlib.sha256).digest()
+        dateRegionKey = hmac.new(dateKey, self.region.encode('UTF-8'), hashlib.sha256).digest()
+        dateRegionServiceKey = hmac.new(dateRegionKey, 's3'.encode('UTF-8'), hashlib.sha256).digest()
+        signingKey = hmac.new(dateRegionServiceKey, 'aws4_request'.encode('UTF-8'), hashlib.sha256).digest()
+        return signingKey
+
+    def getCanonicalRequest(self, method, bucket, key, args_path, headMap, signedHeaders, payload=None):
+        output = [method]
+        output.append(self.getCanonicalURI(bucket, key))
+        output.append(self.getCanonicalQueryString(args_path))
+        output.append(self.getCanonicalHeaders(headMap))
+        output.append(signedHeaders)
+        output.append(self.CONTENT_SHA256 if payload is None else payload)
+        return '\n'.join(output)
+
+    @staticmethod
+    def __shaCannonicalRequest_python2(cannonicalRequest):
+        return hashlib.sha256(cannonicalRequest).hexdigest()
+
+    @staticmethod
+    def __shaCannonicalRequest_python3(cannonicalRequest):
+        return hashlib.sha256(cannonicalRequest.encode('UTF-8')).hexdigest()
+
+    def getCanonicalURI(self, bucket=None, key=None):
+        URI = ''
+        if self.path_style and bucket:
+            URI += '/' + bucket
+        if key:
+            URI += '/' + key
+        if not URI:
+            URI = '/'
+        return util.encode_object_key(URI)
+
+    @staticmethod
+    def getCanonicalQueryString(args_path):
+        canonMap = {}
+        for key, value in args_path.items():
+            canonMap[key] = value
+        cannoList = sorted(canonMap.items(), key=lambda d: d[0])
+        queryStr = ''
+        i = 0
+        for val in cannoList:
+            if i != 0:
+                queryStr += '&'
+            queryStr += '%s=%s' % (util.encode_item(val[0], '/'), util.encode_item(val[1], ''))
+            i = 1
+        return queryStr
+
+    @staticmethod
+    def getCanonicalHeaders(headMap):
+        headList = sorted(headMap.items(), key=lambda d: d[0])
+        canonicalHeaderStr = ''
+        for val in headList:
+            if isinstance(val[1], list):
+                tlist = sorted(val[1])
+                for v in tlist:
+                    canonicalHeaderStr += val[0] + ':' + v + '\n'
+            else:
+                canonicalHeaderStr += val[0] + ':' + str(val[1]) + '\n'
+        return canonicalHeaderStr
+
+    @staticmethod
+    def setMapKeyLower(inputMap):
+        outputMap = {}
+        for key in inputMap.keys():
+            outputMap[key.lower()] = inputMap[key]
+        return outputMap
```

### Comparing `esdk-obs-python-3.23.9.1/obs/bucket.py` & `esdk-obs-python-3.24.3/obs/bucket.py`

 * *Ordering differences only*

 * *Files 21% similar despite different names*

```diff
@@ -1,110 +1,110 @@
-#!/usr/bin/python
-# -*- coding:utf-8 -*-
-# Copyright 2019 Huawei Technologies Co.,Ltd.
-# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
-# this file except in compliance with the License.  You may obtain a copy of the
-# License at
-
-# http://www.apache.org/licenses/LICENSE-2.0
-
-# Unless required by applicable law or agreed to in writing, software distributed
-# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
-# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
-# specific language governing permissions and limitations under the License.
-
-
-class BucketClient(object):
-    allowedMethod = [
-        'createBucket',
-        'deleteBucket',
-        'headBucket',
-        'getBucketMetadata',
-        'setBucketQuota',
-        'getBucketQuota',
-        'getBucketStorageInfo',
-        'setBucketAcl',
-        'getBucketAcl',
-        'setBucketPolicy',
-        'getBucketPolicy',
-        'deleteBucketPolicy',
-        'setBucketVersioning',
-        'getBucketVersioning',
-        'listVersions',
-        'listObjects',
-        'listMultipartUploads',
-        'deleteBucketLifecycle',
-        'setBucketLifecycle',
-        'getBucketLifecycle',
-        'deleteBucketWebsite',
-        'setBucketWebsite',
-        'getBucketWebsite',
-        'setBucketLogging',
-        'getBucketLogging',
-        'getBucketLocation',
-        'getBucketTagging',
-        'setBucketTagging',
-        'deleteBucketTagging',
-        'setBucketCors',
-        'deleteBucketCors',
-        'getBucketCors',
-        'setBucketNotification',
-        'getBucketNotification',
-        'getObjectMetadata',
-        'setObjectMetadata',
-        'getObject',
-        'putContent',
-        'putObject',
-        'appendObject',
-        'putFile',
-        'uploadPart',
-        'copyObject',
-        'setObjectAcl',
-        'getObjectAcl',
-        'deleteObject',
-        'deleteObjects',
-        'restoreObject',
-        'initiateMultipartUpload',
-        'copyPart',
-        'completeMultipartUpload',
-        'abortMultipartUpload',
-        'listParts',
-        'getBucketStoragePolicy',
-        'setBucketStoragePolicy',
-        'optionsBucket',
-        'optionsObject',
-        'setBucketEncryption',
-        'getBucketEncryption',
-        'deleteBucketEncryption',
-        'headObject',
-        'setBucketRequestPayment',
-        'getBucketRequestPayment',
-        'setBucketFetchPolicy',
-        'getBucketFetchPolicy',
-        'deleteBucketFetchPolicy',
-        'setBucketFetchJob',
-        'getBucketFetchJob'
-    ]
-
-    def __init__(self, obsClient, bucketName):
-        self.__obsClient = obsClient
-        self.__bucketName = bucketName
-
-    def __getattr__(self, key):
-        if key in self.allowedMethod and hasattr(self.__obsClient, key):
-            original_method = getattr(self.__obsClient, key)
-            if callable(original_method):
-                def delegate(*args, **kwargs):
-                    _args = list(args)
-                    if key == 'copyObject':
-                        if 'destBucketName' not in kwargs:
-                            if len(_args) >= 2:
-                                _args.insert(2, self.__bucketName)
-                            else:
-                                kwargs['destBucketName'] = self.__bucketName
-                    else:
-                        if 'bucketName' not in kwargs:
-                            _args.insert(0, self.__bucketName)
-                    return original_method(*_args, **kwargs)
-
-                return delegate
-        return super(BucketClient, self).__getattribute__(key)
+#!/usr/bin/python
+# -*- coding:utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+
+class BucketClient(object):
+    allowedMethod = [
+        'createBucket',
+        'deleteBucket',
+        'headBucket',
+        'getBucketMetadata',
+        'setBucketQuota',
+        'getBucketQuota',
+        'getBucketStorageInfo',
+        'setBucketAcl',
+        'getBucketAcl',
+        'setBucketPolicy',
+        'getBucketPolicy',
+        'deleteBucketPolicy',
+        'setBucketVersioning',
+        'getBucketVersioning',
+        'listVersions',
+        'listObjects',
+        'listMultipartUploads',
+        'deleteBucketLifecycle',
+        'setBucketLifecycle',
+        'getBucketLifecycle',
+        'deleteBucketWebsite',
+        'setBucketWebsite',
+        'getBucketWebsite',
+        'setBucketLogging',
+        'getBucketLogging',
+        'getBucketLocation',
+        'getBucketTagging',
+        'setBucketTagging',
+        'deleteBucketTagging',
+        'setBucketCors',
+        'deleteBucketCors',
+        'getBucketCors',
+        'setBucketNotification',
+        'getBucketNotification',
+        'getObjectMetadata',
+        'setObjectMetadata',
+        'getObject',
+        'putContent',
+        'putObject',
+        'appendObject',
+        'putFile',
+        'uploadPart',
+        'copyObject',
+        'setObjectAcl',
+        'getObjectAcl',
+        'deleteObject',
+        'deleteObjects',
+        'restoreObject',
+        'initiateMultipartUpload',
+        'copyPart',
+        'completeMultipartUpload',
+        'abortMultipartUpload',
+        'listParts',
+        'getBucketStoragePolicy',
+        'setBucketStoragePolicy',
+        'optionsBucket',
+        'optionsObject',
+        'setBucketEncryption',
+        'getBucketEncryption',
+        'deleteBucketEncryption',
+        'headObject',
+        'setBucketRequestPayment',
+        'getBucketRequestPayment',
+        'setBucketFetchPolicy',
+        'getBucketFetchPolicy',
+        'deleteBucketFetchPolicy',
+        'setBucketFetchJob',
+        'getBucketFetchJob'
+    ]
+
+    def __init__(self, obsClient, bucketName):
+        self.__obsClient = obsClient
+        self.__bucketName = bucketName
+
+    def __getattr__(self, key):
+        if key in self.allowedMethod and hasattr(self.__obsClient, key):
+            original_method = getattr(self.__obsClient, key)
+            if callable(original_method):
+                def delegate(*args, **kwargs):
+                    _args = list(args)
+                    if key == 'copyObject':
+                        if 'destBucketName' not in kwargs:
+                            if len(_args) >= 2:
+                                _args.insert(2, self.__bucketName)
+                            else:
+                                kwargs['destBucketName'] = self.__bucketName
+                    else:
+                        if 'bucketName' not in kwargs:
+                            _args.insert(0, self.__bucketName)
+                    return original_method(*_args, **kwargs)
+
+                return delegate
+        return super(BucketClient, self).__getattribute__(key)
```

### Comparing `esdk-obs-python-3.23.9.1/obs/client.py` & `esdk-obs-python-3.24.3/obs/client.py`

 * *Files 1% similar despite different names*

```diff
@@ -1925,6123 +1925,6195 @@
 00007840: 2020 2020 2020 2020 2020 2020 2020 2063                 c
 00007850: 6f6e 6e20 3d20 6874 7470 6c69 622e 4854  onn = httplib.HT
 00007860: 5450 5343 6f6e 6e65 6374 696f 6e28 7365  TPSConnection(se
 00007870: 7276 6572 2c20 706f 7274 3d70 6f72 742c  rver, port=port,
 00007880: 2074 696d 656f 7574 3d73 656c 662e 7469   timeout=self.ti
 00007890: 6d65 6f75 7429 0a20 2020 2020 2020 2020  meout).         
 000078a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000078b0: 2020 2020 2020 2020 2063 6f6e 6e20 3d20           conn = 
-000078c0: 6874 7470 6c69 622e 4854 5450 5343 6f6e  httplib.HTTPSCon
-000078d0: 6e65 6374 696f 6e28 7365 7276 6572 2c20  nection(server, 
-000078e0: 706f 7274 3d70 6f72 742c 2074 696d 656f  port=port, timeo
-000078f0: 7574 3d73 656c 662e 7469 6d65 6f75 742c  ut=self.timeout,
-00007900: 2063 6f6e 7465 7874 3d73 656c 662e 636f   context=self.co
-00007910: 6e74 6578 742c 0a20 2020 2020 2020 2020  ntext,.         
-00007920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000078b0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+000078c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000078d0: 2020 636f 6e6e 203d 2068 7474 706c 6962    conn = httplib
+000078e0: 2e48 5454 5053 436f 6e6e 6563 7469 6f6e  .HTTPSConnection
+000078f0: 2873 6572 7665 722c 2070 6f72 743d 706f  (server, port=po
+00007900: 7274 2c20 7469 6d65 6f75 743d 7365 6c66  rt, timeout=self
+00007910: 2e74 696d 656f 7574 2c20 636f 6e74 6578  .timeout, contex
+00007920: 743d 7365 6c66 2e63 6f6e 7465 7874 2c0a  t=self.context,.
 00007930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007940: 2020 2020 2020 6368 6563 6b5f 686f 7374        check_host
-00007950: 6e61 6d65 3d4e 6f6e 6529 0a20 2020 2020  name=None).     
-00007960: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00007970: 2020 2020 2063 6f6e 6e20 3d20 6874 7470       conn = http
-00007980: 6c69 622e 4854 5450 436f 6e6e 6563 7469  lib.HTTPConnecti
-00007990: 6f6e 2873 6572 7665 722c 2070 6f72 743d  on(server, port=
-000079a0: 706f 7274 2c20 7469 6d65 6f75 743d 7365  port, timeout=se
-000079b0: 6c66 2e74 696d 656f 7574 290a 0a20 2020  lf.timeout)..   
-000079c0: 2020 2020 2072 6574 7572 6e20 636f 6e6e       return conn
-000079d0: 0a0a 2020 2020 6465 6620 5f73 656e 645f  ..    def _send_
-000079e0: 7265 7175 6573 7428 7365 6c66 2c20 7365  request(self, se
-000079f0: 7276 6572 2c20 6d65 7468 6f64 2c20 7061  rver, method, pa
-00007a00: 7468 2c20 6865 6164 6572 2c20 656e 7469  th, header, enti
-00007a10: 7479 3d4e 6f6e 652c 2070 6f72 743d 4e6f  ty=None, port=No
-00007a20: 6e65 2c20 7363 6865 6d65 3d4e 6f6e 652c  ne, scheme=None,
-00007a30: 2072 6564 6972 6563 743d 4661 6c73 652c   redirect=False,
-00007a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007a50: 2020 2020 2020 2063 6875 6e6b 6564 4d6f         chunkedMo
-00007a60: 6465 3d46 616c 7365 293a 0a20 2020 2020  de=False):.     
-00007a70: 2020 2063 6f6e 6e20 3d20 4e6f 6e65 0a20     conn = None. 
-00007a80: 2020 2020 2020 2068 6561 6465 7220 3d20         header = 
-00007a90: 6865 6164 6572 206f 7220 7b7d 0a20 2020  header or {}.   
-00007aa0: 2020 2020 2063 6f6e 6e65 6374 696f 6e5f       connection_
-00007ab0: 6b65 7920 3d20 636f 6e73 742e 434f 4e4e  key = const.CONN
-00007ac0: 4543 5449 4f4e 5f48 4541 4445 520a 2020  ECTION_HEADER.  
-00007ad0: 2020 2020 2020 636f 6e6e 2c20 6865 6164        conn, head
-00007ae0: 6572 203d 2073 656c 662e 5f70 6172 7365  er = self._parse
-00007af0: 5f72 6571 7565 7374 5f63 6f6e 6e65 6374  _request_connect
-00007b00: 696f 6e28 7365 7276 6572 2c20 706f 7274  ion(server, port
-00007b10: 2c20 7363 6865 6d65 2c20 636f 6e6e 6563  , scheme, connec
-00007b20: 7469 6f6e 5f6b 6579 2c20 7265 6469 7265  tion_key, redire
-00007b30: 6374 2c20 6865 6164 6572 290a 0a20 2020  ct, header)..   
-00007b40: 2020 2020 2068 6561 6465 725b 636f 6e73       header[cons
-00007b50: 742e 5553 4552 5f41 4745 4e54 5f48 4541  t.USER_AGENT_HEA
-00007b60: 4445 525d 203d 2027 6f62 732d 7364 6b2d  DER] = 'obs-sdk-
-00007b70: 7079 7468 6f6e 2f27 202b 2063 6f6e 7374  python/' + const
-00007b80: 2e4f 4253 5f53 444b 5f56 4552 5349 4f4e  .OBS_SDK_VERSION
-00007b90: 0a0a 2020 2020 2020 2020 6966 206d 6574  ..        if met
-00007ba0: 686f 6420 3d3d 2063 6f6e 7374 2e48 5454  hod == const.HTT
-00007bb0: 505f 4d45 5448 4f44 5f4f 5054 494f 4e53  P_METHOD_OPTIONS
-00007bc0: 2061 6e64 206e 6f74 2073 656c 662e 7573   and not self.us
-00007bd0: 655f 6874 7470 323a 0a20 2020 2020 2020  e_http2:.       
-00007be0: 2020 2020 2063 6f6e 6e2e 7075 7472 6571       conn.putreq
-00007bf0: 7565 7374 286d 6574 686f 642c 2070 6174  uest(method, pat
-00007c00: 682c 2073 6b69 705f 686f 7374 3d31 290a  h, skip_host=1).
-00007c10: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00007c20: 6b2c 2076 2069 6e20 6865 6164 6572 2e69  k, v in header.i
-00007c30: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-00007c40: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00007c50: 7461 6e63 6528 762c 206c 6973 7429 3a0a  tance(v, list):.
-00007c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c70: 2020 2020 666f 7220 6974 656d 2069 6e20      for item in 
-00007c80: 763a 0a20 2020 2020 2020 2020 2020 2020  v:.             
-00007c90: 2020 2020 2020 2020 2020 2063 6f6e 6e2e             conn.
-00007ca0: 7075 7468 6561 6465 7228 6b2c 2069 7465  putheader(k, ite
-00007cb0: 6d29 0a20 2020 2020 2020 2020 2020 2020  m).             
-00007cc0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00007cd0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00007ce0: 6e2e 7075 7468 6561 6465 7228 6b2c 2076  n.putheader(k, v
-00007cf0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-00007d00: 6e6e 2e65 6e64 6865 6164 6572 7328 290a  nn.endheaders().
-00007d10: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00007d20: 2020 2020 2020 2020 2020 6966 2063 6875            if chu
-00007d30: 6e6b 6564 4d6f 6465 3a0a 2020 2020 2020  nkedMode:.      
-00007d40: 2020 2020 2020 2020 2020 6865 6164 6572            header
-00007d50: 5b63 6f6e 7374 2e54 5241 4e53 4645 525f  [const.TRANSFER_
-00007d60: 454e 434f 4449 4e47 5f48 4541 4445 525d  ENCODING_HEADER]
-00007d70: 203d 2063 6f6e 7374 2e54 5241 4e53 4645   = const.TRANSFE
-00007d80: 525f 454e 434f 4449 4e47 5f56 414c 5545  R_ENCODING_VALUE
-00007d90: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00007da0: 2073 656c 662e 7573 655f 6874 7470 323a   self.use_http2:
-00007db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007dc0: 2063 6f6e 6e2e 7265 7175 6573 7428 6d65   conn.request(me
-00007dd0: 7468 6f64 2c20 7061 7468 2c20 626f 6479  thod, path, body
-00007de0: 3d65 6e74 6974 792c 2068 6561 6465 7273  =entity, headers
-00007df0: 3d68 6561 6465 7229 0a20 2020 2020 2020  =header).       
-00007e00: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00007e10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007e20: 5f70 6172 7365 5f63 6f6e 6e65 6374 696f  _parse_connectio
-00007e30: 6e5f 6368 756e 6b65 645f 6d6f 6465 2863  n_chunked_mode(c
-00007e40: 6f6e 6e2c 2063 6875 6e6b 6564 4d6f 6465  onn, chunkedMode
-00007e50: 2c20 6d65 7468 6f64 2c20 7061 7468 2c20  , method, path, 
-00007e60: 6865 6164 6572 290a 2020 2020 2020 2020  header).        
-00007e70: 2020 2020 2020 2020 6966 2065 6e74 6974          if entit
-00007e80: 7920 6973 206e 6f74 204e 6f6e 653a 0a20  y is not None:. 
-00007e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ea0: 2020 2069 6620 6361 6c6c 6162 6c65 2865     if callable(e
-00007eb0: 6e74 6974 7929 3a0a 2020 2020 2020 2020  ntity):.        
-00007ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ed0: 656e 7469 7479 2875 7469 6c2e 636f 6e6e  entity(util.conn
-00007ee0: 5f64 656c 6567 6174 6528 636f 6e6e 2929  _delegate(conn))
-00007ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007f00: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00007f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007f20: 2020 2063 6f6e 6e2e 7365 6e64 2865 6e74     conn.send(ent
-00007f30: 6974 7929 0a20 2020 2020 2020 2020 2020  ity).           
-00007f40: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00007f50: 662e 6c6f 675f 636c 6965 6e74 2e6c 6f67  f.log_client.log
-00007f60: 2844 4542 5547 2c20 2772 6571 7565 7374  (DEBUG, 'request
-00007f70: 2063 6f6e 7465 6e74 3a25 7327 2c20 7574   content:%s', ut
-00007f80: 696c 2e74 6f5f 7374 7269 6e67 2865 6e74  il.to_string(ent
-00007f90: 6974 7929 290a 2020 2020 2020 2020 7265  ity)).        re
-00007fa0: 7475 726e 2063 6f6e 6e0a 0a20 2020 2064  turn conn..    d
-00007fb0: 6566 205f 7061 7273 655f 7265 7175 6573  ef _parse_reques
-00007fc0: 745f 636f 6e6e 6563 7469 6f6e 2873 656c  t_connection(sel
-00007fd0: 662c 2073 6572 7665 722c 2070 6f72 742c  f, server, port,
-00007fe0: 2073 6368 656d 652c 2063 6f6e 6e65 6374   scheme, connect
-00007ff0: 696f 6e5f 6b65 792c 2072 6564 6972 6563  ion_key, redirec
-00008000: 742c 2068 6561 6465 7229 3a0a 2020 2020  t, header):.    
-00008010: 2020 2020 6966 2073 656c 662e 7072 6f78      if self.prox
-00008020: 795f 686f 7374 2069 7320 6e6f 7420 4e6f  y_host is not No
-00008030: 6e65 2061 6e64 2073 656c 662e 7072 6f78  ne and self.prox
-00008040: 795f 706f 7274 2069 7320 6e6f 7420 4e6f  y_port is not No
-00008050: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00008060: 636f 6e6e 203d 2073 656c 662e 5f67 6574  conn = self._get
-00008070: 5f73 6572 7665 725f 636f 6e6e 6563 7469  _server_connecti
-00008080: 6f6e 2873 6572 7665 722c 2070 6f72 742c  on(server, port,
-00008090: 2073 6368 656d 652c 2072 6564 6972 6563   scheme, redirec
-000080a0: 742c 2075 7469 6c2e 746f 5f73 7472 696e  t, util.to_strin
-000080b0: 6728 7365 6c66 2e70 726f 7879 5f68 6f73  g(self.proxy_hos
-000080c0: 7429 2c0a 2020 2020 2020 2020 2020 2020  t),.            
-000080d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000080e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000080f0: 2020 2075 7469 6c2e 746f 5f69 6e74 2873     util.to_int(s
-00008100: 656c 662e 7072 6f78 795f 706f 7274 2929  elf.proxy_port))
-00008110: 0a20 2020 2020 2020 2020 2020 205f 6865  .            _he
-00008120: 6164 6572 203d 207b 7d0a 2020 2020 2020  ader = {}.      
-00008130: 2020 2020 2020 6966 2073 656c 662e 7072        if self.pr
-00008140: 6f78 795f 7573 6572 6e61 6d65 2069 7320  oxy_username is 
-00008150: 6e6f 7420 4e6f 6e65 2061 6e64 2073 656c  not None and sel
-00008160: 662e 7072 6f78 795f 7061 7373 776f 7264  f.proxy_password
-00008170: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00008180: 2020 2020 2020 2020 2020 2020 2020 5f68                _h
-00008190: 6561 6465 725b 636f 6e73 742e 5052 4f58  eader[const.PROX
-000081a0: 595f 4155 5448 4f52 495a 4154 494f 4e5f  Y_AUTHORIZATION_
-000081b0: 4845 4144 4552 5d20 3d20 2742 6173 6963  HEADER] = 'Basic
-000081c0: 2027 205c 0a20 2020 2020 2020 2020 2020   ' \.           
-000081d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000081e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000081f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008200: 2027 2573 2720 2520 280a 2020 2020 2020   '%s' % (.      
-00008210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007960: 2020 2063 6865 636b 5f68 6f73 746e 616d     check_hostnam
+00007970: 653d 4e6f 6e65 290a 2020 2020 2020 2020  e=None).        
+00007980: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+00007990: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
+000079a0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000079b0: 6e6e 203d 2068 7474 706c 6962 2e48 5454  nn = httplib.HTT
+000079c0: 5053 436f 6e6e 6563 7469 6f6e 2873 6572  PSConnection(ser
+000079d0: 7665 722c 2070 6f72 743d 706f 7274 2c20  ver, port=port, 
+000079e0: 7469 6d65 6f75 743d 7365 6c66 2e74 696d  timeout=self.tim
+000079f0: 656f 7574 2c20 636f 6e74 6578 743d 7365  eout, context=se
+00007a00: 6c66 2e63 6f6e 7465 7874 290a 0a20 2020  lf.context)..   
+00007a10: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00007a20: 2020 2020 2020 2063 6f6e 6e20 3d20 6874         conn = ht
+00007a30: 7470 6c69 622e 4854 5450 436f 6e6e 6563  tplib.HTTPConnec
+00007a40: 7469 6f6e 2873 6572 7665 722c 2070 6f72  tion(server, por
+00007a50: 743d 706f 7274 2c20 7469 6d65 6f75 743d  t=port, timeout=
+00007a60: 7365 6c66 2e74 696d 656f 7574 290a 0a20  self.timeout).. 
+00007a70: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
+00007a80: 6e6e 0a0a 2020 2020 6465 6620 5f73 656e  nn..    def _sen
+00007a90: 645f 7265 7175 6573 7428 7365 6c66 2c20  d_request(self, 
+00007aa0: 7365 7276 6572 2c20 6d65 7468 6f64 2c20  server, method, 
+00007ab0: 7061 7468 2c20 6865 6164 6572 2c20 656e  path, header, en
+00007ac0: 7469 7479 3d4e 6f6e 652c 2070 6f72 743d  tity=None, port=
+00007ad0: 4e6f 6e65 2c20 7363 6865 6d65 3d4e 6f6e  None, scheme=Non
+00007ae0: 652c 2072 6564 6972 6563 743d 4661 6c73  e, redirect=Fals
+00007af0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00007b00: 2020 2020 2020 2020 2063 6875 6e6b 6564           chunked
+00007b10: 4d6f 6465 3d46 616c 7365 293a 0a20 2020  Mode=False):.   
+00007b20: 2020 2020 2063 6f6e 6e20 3d20 4e6f 6e65       conn = None
+00007b30: 0a20 2020 2020 2020 2068 6561 6465 7220  .        header 
+00007b40: 3d20 6865 6164 6572 206f 7220 7b7d 0a20  = header or {}. 
+00007b50: 2020 2020 2020 2063 6f6e 6e65 6374 696f         connectio
+00007b60: 6e5f 6b65 7920 3d20 636f 6e73 742e 434f  n_key = const.CO
+00007b70: 4e4e 4543 5449 4f4e 5f48 4541 4445 520a  NNECTION_HEADER.
+00007b80: 2020 2020 2020 2020 636f 6e6e 2c20 6865          conn, he
+00007b90: 6164 6572 203d 2073 656c 662e 5f70 6172  ader = self._par
+00007ba0: 7365 5f72 6571 7565 7374 5f63 6f6e 6e65  se_request_conne
+00007bb0: 6374 696f 6e28 7365 7276 6572 2c20 706f  ction(server, po
+00007bc0: 7274 2c20 7363 6865 6d65 2c20 636f 6e6e  rt, scheme, conn
+00007bd0: 6563 7469 6f6e 5f6b 6579 2c20 7265 6469  ection_key, redi
+00007be0: 7265 6374 2c20 6865 6164 6572 290a 0a20  rect, header).. 
+00007bf0: 2020 2020 2020 2068 6561 6465 725b 636f         header[co
+00007c00: 6e73 742e 5553 4552 5f41 4745 4e54 5f48  nst.USER_AGENT_H
+00007c10: 4541 4445 525d 203d 2027 6f62 732d 7364  EADER] = 'obs-sd
+00007c20: 6b2d 7079 7468 6f6e 2f27 202b 2063 6f6e  k-python/' + con
+00007c30: 7374 2e4f 4253 5f53 444b 5f56 4552 5349  st.OBS_SDK_VERSI
+00007c40: 4f4e 0a0a 2020 2020 2020 2020 6966 206d  ON..        if m
+00007c50: 6574 686f 6420 3d3d 2063 6f6e 7374 2e48  ethod == const.H
+00007c60: 5454 505f 4d45 5448 4f44 5f4f 5054 494f  TTP_METHOD_OPTIO
+00007c70: 4e53 2061 6e64 206e 6f74 2073 656c 662e  NS and not self.
+00007c80: 7573 655f 6874 7470 323a 0a20 2020 2020  use_http2:.     
+00007c90: 2020 2020 2020 2063 6f6e 6e2e 7075 7472         conn.putr
+00007ca0: 6571 7565 7374 286d 6574 686f 642c 2070  equest(method, p
+00007cb0: 6174 682c 2073 6b69 705f 686f 7374 3d31  ath, skip_host=1
+00007cc0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+00007cd0: 7220 6b2c 2076 2069 6e20 6865 6164 6572  r k, v in header
+00007ce0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+00007cf0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+00007d00: 6e73 7461 6e63 6528 762c 206c 6973 7429  nstance(v, list)
+00007d10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007d20: 2020 2020 2020 666f 7220 6974 656d 2069        for item i
+00007d30: 6e20 763a 0a20 2020 2020 2020 2020 2020  n v:.           
+00007d40: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00007d50: 6e2e 7075 7468 6561 6465 7228 6b2c 2069  n.putheader(k, i
+00007d60: 7465 6d29 0a20 2020 2020 2020 2020 2020  tem).           
+00007d70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00007d80: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00007d90: 6f6e 6e2e 7075 7468 6561 6465 7228 6b2c  onn.putheader(k,
+00007da0: 2076 290a 2020 2020 2020 2020 2020 2020   v).            
+00007db0: 636f 6e6e 2e65 6e64 6865 6164 6572 7328  conn.endheaders(
+00007dc0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00007dd0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00007de0: 6875 6e6b 6564 4d6f 6465 3a0a 2020 2020  hunkedMode:.    
+00007df0: 2020 2020 2020 2020 2020 2020 6865 6164              head
+00007e00: 6572 5b63 6f6e 7374 2e54 5241 4e53 4645  er[const.TRANSFE
+00007e10: 525f 454e 434f 4449 4e47 5f48 4541 4445  R_ENCODING_HEADE
+00007e20: 525d 203d 2063 6f6e 7374 2e54 5241 4e53  R] = const.TRANS
+00007e30: 4645 525f 454e 434f 4449 4e47 5f56 414c  FER_ENCODING_VAL
+00007e40: 5545 0a0a 2020 2020 2020 2020 2020 2020  UE..            
+00007e50: 6966 2073 656c 662e 7573 655f 6874 7470  if self.use_http
+00007e60: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
+00007e70: 2020 2063 6f6e 6e2e 7265 7175 6573 7428     conn.request(
+00007e80: 6d65 7468 6f64 2c20 7061 7468 2c20 626f  method, path, bo
+00007e90: 6479 3d65 6e74 6974 792c 2068 6561 6465  dy=entity, heade
+00007ea0: 7273 3d68 6561 6465 7229 0a20 2020 2020  rs=header).     
+00007eb0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00007ec0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00007ed0: 662e 5f70 6172 7365 5f63 6f6e 6e65 6374  f._parse_connect
+00007ee0: 696f 6e5f 6368 756e 6b65 645f 6d6f 6465  ion_chunked_mode
+00007ef0: 2863 6f6e 6e2c 2063 6875 6e6b 6564 4d6f  (conn, chunkedMo
+00007f00: 6465 2c20 6d65 7468 6f64 2c20 7061 7468  de, method, path
+00007f10: 2c20 6865 6164 6572 290a 2020 2020 2020  , header).      
+00007f20: 2020 2020 2020 2020 2020 6966 2065 6e74            if ent
+00007f30: 6974 7920 6973 206e 6f74 204e 6f6e 653a  ity is not None:
+00007f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007f50: 2020 2020 2069 6620 6361 6c6c 6162 6c65       if callable
+00007f60: 2865 6e74 6974 7929 3a0a 2020 2020 2020  (entity):.      
+00007f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007f80: 2020 656e 7469 7479 2875 7469 6c2e 636f    entity(util.co
+00007f90: 6e6e 5f64 656c 6567 6174 6528 636f 6e6e  nn_delegate(conn
+00007fa0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00007fb0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00007fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007fd0: 2020 2020 2063 6f6e 6e2e 7365 6e64 2865       conn.send(e
+00007fe0: 6e74 6974 7929 0a20 2020 2020 2020 2020  ntity).         
+00007ff0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00008000: 656c 662e 6c6f 675f 636c 6965 6e74 2e6c  elf.log_client.l
+00008010: 6f67 2844 4542 5547 2c20 2772 6571 7565  og(DEBUG, 'reque
+00008020: 7374 2063 6f6e 7465 6e74 3a25 7327 2c20  st content:%s', 
+00008030: 7574 696c 2e74 6f5f 7374 7269 6e67 2865  util.to_string(e
+00008040: 6e74 6974 7929 290a 2020 2020 2020 2020  ntity)).        
+00008050: 7265 7475 726e 2063 6f6e 6e0a 0a20 2020  return conn..   
+00008060: 2064 6566 205f 7061 7273 655f 7265 7175   def _parse_requ
+00008070: 6573 745f 636f 6e6e 6563 7469 6f6e 2873  est_connection(s
+00008080: 656c 662c 2073 6572 7665 722c 2070 6f72  elf, server, por
+00008090: 742c 2073 6368 656d 652c 2063 6f6e 6e65  t, scheme, conne
+000080a0: 6374 696f 6e5f 6b65 792c 2072 6564 6972  ction_key, redir
+000080b0: 6563 742c 2068 6561 6465 7229 3a0a 2020  ect, header):.  
+000080c0: 2020 2020 2020 6966 2073 656c 662e 7072        if self.pr
+000080d0: 6f78 795f 686f 7374 2069 7320 6e6f 7420  oxy_host is not 
+000080e0: 4e6f 6e65 2061 6e64 2073 656c 662e 7072  None and self.pr
+000080f0: 6f78 795f 706f 7274 2069 7320 6e6f 7420  oxy_port is not 
+00008100: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00008110: 2020 636f 6e6e 203d 2073 656c 662e 5f67    conn = self._g
+00008120: 6574 5f73 6572 7665 725f 636f 6e6e 6563  et_server_connec
+00008130: 7469 6f6e 2873 6572 7665 722c 2070 6f72  tion(server, por
+00008140: 742c 2073 6368 656d 652c 2072 6564 6972  t, scheme, redir
+00008150: 6563 742c 2075 7469 6c2e 746f 5f73 7472  ect, util.to_str
+00008160: 696e 6728 7365 6c66 2e70 726f 7879 5f68  ing(self.proxy_h
+00008170: 6f73 7429 2c0a 2020 2020 2020 2020 2020  ost),.          
+00008180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000081a0: 2020 2020 2075 7469 6c2e 746f 5f69 6e74       util.to_int
+000081b0: 2873 656c 662e 7072 6f78 795f 706f 7274  (self.proxy_port
+000081c0: 2929 0a20 2020 2020 2020 2020 2020 205f  )).            _
+000081d0: 6865 6164 6572 203d 207b 7d0a 2020 2020  header = {}.    
+000081e0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000081f0: 7072 6f78 795f 7573 6572 6e61 6d65 2069  proxy_username i
+00008200: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2073  s not None and s
+00008210: 656c 662e 7072 6f78 795f 7061 7373 776f  elf.proxy_passwo
+00008220: 7264 2069 7320 6e6f 7420 4e6f 6e65 3a0a  rd is not None:.
 00008230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008240: 2020 2020 2020 2020 2020 7574 696c 2e62            util.b
-00008250: 6173 6536 345f 656e 636f 6465 2875 7469  ase64_encode(uti
-00008260: 6c2e 746f 5f73 7472 696e 6728 0a20 2020  l.to_string(.   
-00008270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008240: 5f68 6561 6465 725b 636f 6e73 742e 5052  _header[const.PR
+00008250: 4f58 595f 4155 5448 4f52 495a 4154 494f  OXY_AUTHORIZATIO
+00008260: 4e5f 4845 4144 4552 5d20 3d20 2742 6173  N_HEADER] = 'Bas
+00008270: 6963 2027 205c 0a20 2020 2020 2020 2020  ic ' \.         
 00008280: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00008290: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000082a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000082b0: 2073 656c 662e 7072 6f78 795f 7573 6572   self.proxy_user
-000082c0: 6e61 6d65 2920 2b20 273a 2720 2b20 7574  name) + ':' + ut
-000082d0: 696c 2e74 6f5f 7374 7269 6e67 280a 2020  il.to_string(.  
+000082b0: 2020 2027 2573 2720 2520 280a 2020 2020     '%s' % (.    
+000082c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000082d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000082e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000082f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008320: 2020 7365 6c66 2e70 726f 7879 5f70 6173    self.proxy_pas
-00008330: 7377 6f72 6429 290a 2020 2020 2020 2020  sword)).        
+000082f0: 2020 2020 2020 2020 2020 2020 7574 696c              util
+00008300: 2e62 6173 6536 345f 656e 636f 6465 2875  .base64_encode(u
+00008310: 7469 6c2e 746f 5f73 7472 696e 6728 0a20  til.to_string(. 
+00008320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008330: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00008340: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00008350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008370: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00008380: 2020 6966 206e 6f74 2073 656c 662e 7573    if not self.us
-00008390: 655f 6874 7470 323a 0a20 2020 2020 2020  e_http2:.       
-000083a0: 2020 2020 2020 2020 2063 6f6e 6e2e 7365           conn.se
-000083b0: 745f 7475 6e6e 656c 2873 6572 7665 722c  t_tunnel(server,
-000083c0: 2070 6f72 742c 205f 6865 6164 6572 290a   port, _header).
-000083d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000083e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000083f0: 2020 6865 6164 6572 5b63 6f6e 7374 2e50    header[const.P
-00008400: 524f 5859 5f41 5554 484f 5249 5a41 5449  ROXY_AUTHORIZATI
-00008410: 4f4e 5f48 4541 4445 525d 203d 205f 6865  ON_HEADER] = _he
-00008420: 6164 6572 5b63 6f6e 7374 2e50 524f 5859  ader[const.PROXY
-00008430: 5f41 5554 484f 5249 5a41 5449 4f4e 5f48  _AUTHORIZATION_H
-00008440: 4541 4445 525d 0a20 2020 2020 2020 2020  EADER].         
-00008450: 2020 2063 6f6e 6e65 6374 696f 6e5f 6b65     connection_ke
-00008460: 7920 3d20 636f 6e73 742e 5052 4f58 595f  y = const.PROXY_
-00008470: 434f 4e4e 4543 5449 4f4e 5f48 4541 4445  CONNECTION_HEADE
-00008480: 520a 2020 2020 2020 2020 656c 7365 3a0a  R.        else:.
-00008490: 2020 2020 2020 2020 2020 2020 636f 6e6e              conn
-000084a0: 203d 2073 656c 662e 5f67 6574 5f73 6572   = self._get_ser
-000084b0: 7665 725f 636f 6e6e 6563 7469 6f6e 2873  ver_connection(s
-000084c0: 6572 7665 722c 2070 6f72 742c 2073 6368  erver, port, sch
-000084d0: 656d 652c 2072 6564 6972 6563 7429 0a20  eme, redirect). 
-000084e0: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
-000084f0: 6f6e 675f 636f 6e6e 5f6d 6f64 653a 0a20  ong_conn_mode:. 
-00008500: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-00008510: 725b 636f 6e6e 6563 7469 6f6e 5f6b 6579  r[connection_key
-00008520: 5d20 3d20 636f 6e73 742e 434f 4e4e 4543  ] = const.CONNEC
-00008530: 5449 4f4e 5f4b 4545 505f 414c 4956 455f  TION_KEEP_ALIVE_
-00008540: 5641 4c55 450a 2020 2020 2020 2020 656c  VALUE.        el
-00008550: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00008560: 6865 6164 6572 5b63 6f6e 7374 2e43 4f4e  header[const.CON
-00008570: 4e45 4354 494f 4e5f 4845 4144 4552 5d20  NECTION_HEADER] 
-00008580: 3d20 636f 6e73 742e 434f 4e4e 4543 5449  = const.CONNECTI
-00008590: 4f4e 5f43 4c4f 5345 5f56 414c 5545 0a20  ON_CLOSE_VALUE. 
-000085a0: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
-000085b0: 6e6e 2c20 6865 6164 6572 0a0a 2020 2020  nn, header..    
-000085c0: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
-000085d0: 2020 6465 6620 5f70 6172 7365 5f63 6f6e    def _parse_con
-000085e0: 6e65 6374 696f 6e5f 6368 756e 6b65 645f  nection_chunked_
-000085f0: 6d6f 6465 2863 6f6e 6e2c 2063 6875 6e6b  mode(conn, chunk
-00008600: 6564 4d6f 6465 2c20 6d65 7468 6f64 2c20  edMode, method, 
-00008610: 7061 7468 2c20 6865 6164 6572 293a 0a20  path, header):. 
-00008620: 2020 2020 2020 2069 6620 6368 756e 6b65         if chunke
-00008630: 644d 6f64 653a 0a20 2020 2020 2020 2020  dMode:.         
-00008640: 2020 2063 6f6e 6e2e 7075 7472 6571 7565     conn.putreque
-00008650: 7374 286d 6574 686f 642c 2070 6174 682c  st(method, path,
-00008660: 2073 6b69 705f 686f 7374 3d31 290a 2020   skip_host=1).  
-00008670: 2020 2020 2020 2020 2020 666f 7220 6b2c            for k,
-00008680: 2076 2069 6e20 6865 6164 6572 2e69 7465   v in header.ite
-00008690: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-000086a0: 2020 2020 2020 636f 6e6e 2e70 7574 6865        conn.puthe
-000086b0: 6164 6572 286b 2c20 7629 0a20 2020 2020  ader(k, v).     
-000086c0: 2020 2020 2020 2063 6f6e 6e2e 656e 6468         conn.endh
-000086d0: 6561 6465 7273 2829 0a20 2020 2020 2020  eaders().       
-000086e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000086f0: 2020 2063 6f6e 6e2e 7265 7175 6573 7428     conn.request(
-00008700: 6d65 7468 6f64 2c20 7061 7468 2c20 6865  method, path, he
-00008710: 6164 6572 733d 6865 6164 6572 290a 0a20  aders=header).. 
-00008720: 2020 2064 6566 205f 6765 744e 6f6e 6552     def _getNoneR
-00008730: 6573 756c 7428 7365 6c66 2c20 6d65 7373  esult(self, mess
-00008740: 6167 653d 274e 6f6e 6520 5265 7375 6c74  age='None Result
-00008750: 2729 3a0a 2020 2020 2020 2020 7261 6973  '):.        rais
-00008760: 6520 4578 6365 7074 696f 6e28 6d65 7373  e Exception(mess
-00008770: 6167 6529 0a0a 2020 2020 6465 6620 5f70  age)..    def _p
-00008780: 6172 7365 5f78 6d6c 2873 656c 662c 2063  arse_xml(self, c
-00008790: 6f6e 6e2c 206d 6574 686f 644e 616d 653d  onn, methodName=
-000087a0: 4e6f 6e65 2c20 7265 6164 6162 6c65 3d46  None, readable=F
-000087b0: 616c 7365 293a 0a20 2020 2020 2020 2069  alse):.        i
-000087c0: 6620 6e6f 7420 636f 6e6e 3a0a 2020 2020  f not conn:.    
-000087d0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000087e0: 656c 662e 5f67 6574 4e6f 6e65 5265 7375  elf._getNoneResu
-000087f0: 6c74 2827 636f 6e6e 6563 7469 6f6e 2069  lt('connection i
-00008800: 7320 6e6f 6e65 2729 0a20 2020 2020 2020  s none').       
-00008810: 2072 6573 756c 7420 3d20 4e6f 6e65 0a20   result = None. 
-00008820: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00008830: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00008840: 2063 6f6e 6e2e 6765 7472 6573 706f 6e73   conn.getrespons
-00008850: 6528 5472 7565 2920 6966 2063 6f6e 7374  e(True) if const
-00008860: 2e49 535f 5059 5448 4f4e 3220 656c 7365  .IS_PYTHON2 else
-00008870: 2063 6f6e 6e2e 6765 7472 6573 706f 6e73   conn.getrespons
-00008880: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-00008890: 6966 206e 6f74 2072 6573 756c 743a 0a20  if not result:. 
-000088a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000088b0: 6574 7572 6e20 7365 6c66 2e5f 6765 744e  eturn self._getN
-000088c0: 6f6e 6552 6573 756c 7428 2772 6573 706f  oneResult('respo
-000088d0: 6e73 6520 6973 206e 6f6e 6527 290a 2020  nse is none').  
-000088e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000088f0: 2073 656c 662e 5f70 6172 7365 5f78 6d6c   self._parse_xml
-00008900: 5f69 6e74 6572 6e61 6c28 7265 7375 6c74  _internal(result
-00008910: 2c20 6d65 7468 6f64 4e61 6d65 2c20 7265  , methodName, re
-00008920: 6164 6162 6c65 3d72 6561 6461 626c 6529  adable=readable)
-00008930: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00008940: 5f52 6564 6972 6563 7445 7863 6570 7469  _RedirectExcepti
-00008950: 6f6e 2061 7320 6578 3a0a 2020 2020 2020  on as ex:.      
-00008960: 2020 2020 2020 7261 6973 6520 6578 0a20        raise ex. 
-00008970: 2020 2020 2020 2065 7863 6570 7420 5f49         except _I
-00008980: 6e74 6572 6e61 6c45 7863 6570 7469 6f6e  nternalException
-00008990: 2061 7320 6578 3a0a 2020 2020 2020 2020   as ex:.        
-000089a0: 2020 2020 7261 6973 6520 6578 0a20 2020      raise ex.   
-000089b0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-000089c0: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-000089d0: 2020 2020 2020 2020 636f 6e6e 2e5f 636c          conn._cl
-000089e0: 6561 7220 3d20 5472 7565 0a20 2020 2020  ear = True.     
-000089f0: 2020 2020 2020 2073 656c 662e 6c6f 675f         self.log_
-00008a00: 636c 6965 6e74 2e6c 6f67 2845 5252 4f52  client.log(ERROR
-00008a10: 2c20 7472 6163 6562 6163 6b2e 666f 726d  , traceback.form
-00008a20: 6174 5f65 7863 2829 290a 2020 2020 2020  at_exc()).      
-00008a30: 2020 2020 2020 7261 6973 6520 650a 2020        raise e.  
-00008a40: 2020 2020 2020 6669 6e61 6c6c 793a 0a20        finally:. 
-00008a50: 2020 2020 2020 2020 2020 2075 7469 6c2e             util.
-00008a60: 646f 5f63 6c6f 7365 2872 6573 756c 742c  do_close(result,
-00008a70: 2063 6f6e 6e2c 2073 656c 662e 636f 6e6e   conn, self.conn
-00008a80: 486f 6c64 6572 2c20 7365 6c66 2e6c 6f67  Holder, self.log
-00008a90: 5f63 6c69 656e 7429 0a0a 2020 2020 6465  _client)..    de
-00008aa0: 6620 5f70 6172 7365 5f63 6f6e 7465 6e74  f _parse_content
-00008ab0: 2873 656c 662c 206f 626a 6563 744b 6579  (self, objectKey
-00008ac0: 2c20 636f 6e6e 2c20 7265 7370 6f6e 7365  , conn, response
-00008ad0: 2c20 646f 776e 6c6f 6164 5f73 7461 7274  , download_start
-00008ae0: 3d27 272c 0a20 2020 2020 2020 2020 2020  ='',.           
-00008af0: 2020 2020 2020 2020 2020 2020 646f 776e              down
-00008b00: 6c6f 6164 5061 7468 3d4e 6f6e 652c 2063  loadPath=None, c
-00008b10: 6875 636b 5369 7a65 3d63 6f6e 7374 2e52  huckSize=const.R
-00008b20: 4541 445f 4f4e 4345 5f4c 454e 4754 482c  EAD_ONCE_LENGTH,
-00008b30: 206c 6f61 6453 7472 6561 6d49 6e4d 656d   loadStreamInMem
-00008b40: 6f72 793d 4661 6c73 652c 0a20 2020 2020  ory=False,.     
-00008b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008b60: 2020 7072 6f67 7265 7373 4361 6c6c 6261    progressCallba
-00008b70: 636b 3d4e 6f6e 652c 206e 6f74 6966 6965  ck=None, notifie
-00008b80: 723d 4e6f 6e65 293a 0a20 2020 2020 2020  r=None):.       
-00008b90: 2069 6620 6e6f 7420 636f 6e6e 3a0a 2020   if not conn:.  
-00008ba0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00008bb0: 2073 656c 662e 5f67 6574 4e6f 6e65 5265   self._getNoneRe
-00008bc0: 7375 6c74 2827 636f 6e6e 6563 7469 6f6e  sult('connection
-00008bd0: 2069 7320 6e6f 6e65 2729 0a20 2020 2020   is none').     
-00008be0: 2020 2063 6c6f 7365 5f63 6f6e 6e5f 666c     close_conn_fl
-00008bf0: 6167 203d 2054 7275 650a 2020 2020 2020  ag = True.      
-00008c00: 2020 7265 7375 6c74 5f77 7261 7070 6572    result_wrapper
-00008c10: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00008c20: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00008c30: 2069 6620 6e6f 7420 7265 7370 6f6e 7365   if not response
-00008c40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008c50: 2020 7265 7475 726e 2073 656c 662e 5f67    return self._g
-00008c60: 6574 4e6f 6e65 5265 7375 6c74 2827 7265  etNoneResult('re
-00008c70: 7370 6f6e 7365 2069 7320 6e6f 6e65 2729  sponse is none')
-00008c80: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00008c90: 206e 6f74 2075 7469 6c2e 746f 5f69 6e74   not util.to_int
-00008ca0: 2872 6573 706f 6e73 652e 7374 6174 7573  (response.status
-00008cb0: 2920 3c20 3330 303a 0a20 2020 2020 2020  ) < 300:.       
-00008cc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00008cd0: 7365 6c66 2e5f 7061 7273 655f 786d 6c5f  self._parse_xml_
-00008ce0: 696e 7465 726e 616c 2872 6573 706f 6e73  internal(respons
-00008cf0: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-00008d00: 6865 6164 6572 7320 3d20 7b7d 0a20 2020  headers = {}.   
-00008d10: 2020 2020 2020 2020 2066 6f72 206b 2c20           for k, 
-00008d20: 7620 696e 2072 6573 706f 6e73 652e 6765  v in response.ge
-00008d30: 7468 6561 6465 7273 2829 3a0a 2020 2020  theaders():.    
-00008d40: 2020 2020 2020 2020 2020 2020 6865 6164              head
-00008d50: 6572 735b 6b2e 6c6f 7765 7228 295d 203d  ers[k.lower()] =
-00008d60: 2076 0a0a 2020 2020 2020 2020 2020 2020   v..            
-00008d70: 636f 6e74 656e 745f 6c65 6e67 7468 203d  content_length =
-00008d80: 2068 6561 6465 7273 2e67 6574 2827 636f   headers.get('co
-00008d90: 6e74 656e 742d 6c65 6e67 7468 2729 0a20  ntent-length'). 
-00008da0: 2020 2020 2020 2020 2020 2063 6f6e 7465             conte
-00008db0: 6e74 5f6c 656e 6774 6820 3d20 7574 696c  nt_length = util
-00008dc0: 2e74 6f5f 6c6f 6e67 2863 6f6e 7465 6e74  .to_long(content
-00008dd0: 5f6c 656e 6774 6829 2069 6620 636f 6e74  _length) if cont
-00008de0: 656e 745f 6c65 6e67 7468 2069 7320 6e6f  ent_length is no
-00008df0: 7420 4e6f 6e65 2065 6c73 6520 4e6f 6e65  t None else None
-00008e00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00008e10: 6e6f 7420 6e6f 7469 6669 6572 3a0a 2020  not notifier:.  
-00008e20: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-00008e30: 7469 6669 6572 203d 2073 656c 662e 5f67  tifier = self._g
-00008e40: 6574 5f6e 6f74 6966 6965 7228 636f 6e74  et_notifier(cont
-00008e50: 656e 745f 6c65 6e67 7468 2c20 7072 6f67  ent_length, prog
-00008e60: 7265 7373 4361 6c6c 6261 636b 290a 2020  ressCallback).  
-00008e70: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-00008e80: 7469 6669 6572 2e73 7461 7274 2829 0a20  tifier.start(). 
-00008e90: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00008ea0: 745f 7772 6170 7065 7220 3d20 5265 7370  t_wrapper = Resp
-00008eb0: 6f6e 7365 5772 6170 7065 7228 636f 6e6e  onseWrapper(conn
-00008ec0: 2c20 7265 7370 6f6e 7365 2c20 7365 6c66  , response, self
-00008ed0: 2e63 6f6e 6e48 6f6c 6465 722c 2063 6f6e  .connHolder, con
-00008ee0: 7465 6e74 5f6c 656e 6774 682c 206e 6f74  tent_length, not
-00008ef0: 6966 6965 7229 0a20 2020 2020 2020 2020  ifier).         
-00008f00: 2020 2069 6620 6c6f 6164 5374 7265 616d     if loadStream
-00008f10: 496e 4d65 6d6f 7279 3a0a 2020 2020 2020  InMemory:.      
-00008f20: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00008f30: 6f67 5f63 6c69 656e 742e 6c6f 6728 4445  og_client.log(DE
-00008f40: 4255 472c 2027 6c6f 6164 5374 7265 616d  BUG, 'loadStream
-00008f50: 496e 4d65 6d6f 7279 2069 7320 5472 7565  InMemory is True
-00008f60: 2c20 7265 6164 2073 7472 6561 6d20 696e  , read stream in
-00008f70: 746f 206d 656d 6f72 7927 290a 2020 2020  to memory').    
-00008f80: 2020 2020 2020 2020 2020 2020 6275 6620              buf 
-00008f90: 3d20 7365 6c66 2e5f 6765 745f 6275 6666  = self._get_buff
-00008fa0: 6572 5f64 6174 6128 7265 7375 6c74 5f77  er_data(result_w
-00008fb0: 7261 7070 6572 2c20 6368 7563 6b53 697a  rapper, chuckSiz
-00008fc0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00008fd0: 2020 2062 6f64 7920 3d20 4f62 6a65 6374     body = Object
-00008fe0: 5374 7265 616d 2862 7566 6665 723d 6275  Stream(buffer=bu
-00008ff0: 662c 2073 697a 653d 7574 696c 2e74 6f5f  f, size=util.to_
-00009000: 6c6f 6e67 286c 656e 2862 7566 2929 2069  long(len(buf)) i
-00009010: 6620 6275 6620 6973 206e 6f74 204e 6f6e  f buf is not Non
-00009020: 6520 656c 7365 2030 290a 2020 2020 2020  e else 0).      
-00009030: 2020 2020 2020 656c 6966 2064 6f77 6e6c        elif downl
-00009040: 6f61 6450 6174 6820 6973 204e 6f6e 653a  oadPath is None:
-00009050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009060: 2073 656c 662e 6c6f 675f 636c 6965 6e74   self.log_client
-00009070: 2e6c 6f67 2844 4542 5547 2c20 2744 6f77  .log(DEBUG, 'Dow
-00009080: 6e6c 6f61 6450 6174 6820 6973 206e 6f6e  nloadPath is non
-00009090: 652c 2072 6574 7572 6e20 636f 6e6e 2064  e, return conn d
-000090a0: 6972 6563 746c 7927 290a 2020 2020 2020  irectly').      
-000090b0: 2020 2020 2020 2020 2020 636c 6f73 655f            close_
-000090c0: 636f 6e6e 5f66 6c61 6720 3d20 4661 6c73  conn_flag = Fals
-000090d0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000090e0: 2020 626f 6479 203d 204f 626a 6563 7453    body = ObjectS
-000090f0: 7472 6561 6d28 7265 7370 6f6e 7365 3d72  tream(response=r
-00009100: 6573 756c 745f 7772 6170 7065 7229 0a20  esult_wrapper). 
-00009110: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00009120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009130: 2064 6f77 6e6c 6f61 6450 6174 6820 3d20   downloadPath = 
-00009140: 7574 696c 2e73 6166 655f 656e 636f 6465  util.safe_encode
-00009150: 2864 6f77 6e6c 6f61 6450 6174 6829 0a20  (downloadPath). 
-00009160: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00009170: 696c 655f 7061 7468 2c20 5f20 3d20 7365  ile_path, _ = se
-00009180: 6c66 2e5f 6765 745f 6461 7461 2872 6573  lf._get_data(res
-00009190: 756c 745f 7772 6170 7065 722c 2064 6f77  ult_wrapper, dow
-000091a0: 6e6c 6f61 6450 6174 682c 2063 6875 636b  nloadPath, chuck
-000091b0: 5369 7a65 290a 2020 2020 2020 2020 2020  Size).          
-000091c0: 2020 2020 2020 626f 6479 203d 204f 626a        body = Obj
-000091d0: 6563 7453 7472 6561 6d28 7572 6c3d 7574  ectStream(url=ut
-000091e0: 696c 2e74 6f5f 7374 7269 6e67 2866 696c  il.to_string(fil
-000091f0: 655f 7061 7468 2929 0a20 2020 2020 2020  e_path)).       
-00009200: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-00009210: 675f 636c 6965 6e74 2e6c 6f67 2844 4542  g_client.log(DEB
-00009220: 5547 2c20 2744 6f77 6e6c 6f61 6450 6174  UG, 'DownloadPat
-00009230: 6820 6973 2027 202b 2075 7469 6c2e 746f  h is ' + util.to
-00009240: 5f73 7472 696e 6728 6669 6c65 5f70 6174  _string(file_pat
-00009250: 6829 290a 0a20 2020 2020 2020 2020 2020  h))..           
-00009260: 2073 7461 7475 7320 3d20 7574 696c 2e74   status = util.t
-00009270: 6f5f 696e 7428 7265 7370 6f6e 7365 2e73  o_int(response.s
-00009280: 7461 7475 7329 0a20 2020 2020 2020 2020  tatus).         
-00009290: 2020 2072 6561 736f 6e20 3d20 7265 7370     reason = resp
-000092a0: 6f6e 7365 2e72 6561 736f 6e0a 2020 2020  onse.reason.    
-000092b0: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
-000092c0: 7665 7274 6f72 2e70 6172 7365 4765 744f  vertor.parseGetO
-000092d0: 626a 6563 7428 6865 6164 6572 732c 2062  bject(headers, b
-000092e0: 6f64 7929 0a20 2020 2020 2020 2020 2020  ody).           
-000092f0: 2068 6561 6465 7220 3d20 7365 6c66 2e5f   header = self._
-00009300: 7265 6e61 6d65 5f72 6573 706f 6e73 655f  rename_response_
-00009310: 6865 6164 6572 7328 6865 6164 6572 7329  headers(headers)
-00009320: 0a20 2020 2020 2020 2020 2020 2072 6571  .            req
-00009330: 7565 7374 4964 203d 2064 6963 7428 6865  uestId = dict(he
-00009340: 6164 6572 292e 6765 7428 2772 6571 7565  ader).get('reque
-00009350: 7374 2d69 6427 290a 2020 2020 2020 2020  st-id').        
-00009360: 2020 2020 7265 7475 726e 2047 6574 5265      return GetRe
-00009370: 7375 6c74 2873 7461 7475 733d 7374 6174  sult(status=stat
-00009380: 7573 2c20 7265 6173 6f6e 3d72 6561 736f  us, reason=reaso
-00009390: 6e2c 2068 6561 6465 723d 6865 6164 6572  n, header=header
-000093a0: 2c20 626f 6479 3d62 6f64 792c 2072 6571  , body=body, req
-000093b0: 7565 7374 4964 3d72 6571 7565 7374 4964  uestId=requestId
-000093c0: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-000093d0: 205f 5265 6469 7265 6374 4578 6365 7074   _RedirectExcept
-000093e0: 696f 6e20 6173 2065 783a 0a20 2020 2020  ion as ex:.     
-000093f0: 2020 2020 2020 2072 6169 7365 2065 780a         raise ex.
-00009400: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-00009410: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
-00009420: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00009430: 6c6f 675f 636c 6965 6e74 2e6c 6f67 2845  log_client.log(E
-00009440: 5252 4f52 2c20 7472 6163 6562 6163 6b2e  RROR, traceback.
-00009450: 666f 726d 6174 5f65 7863 2829 290a 2020  format_exc()).  
-00009460: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00009470: 650a 2020 2020 2020 2020 6669 6e61 6c6c  e.        finall
-00009480: 793a 0a20 2020 2020 2020 2020 2020 2069  y:.            i
-00009490: 6620 636c 6f73 655f 636f 6e6e 5f66 6c61  f close_conn_fla
-000094a0: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
-000094b0: 2020 2069 6620 7265 7375 6c74 5f77 7261     if result_wra
-000094c0: 7070 6572 2069 7320 6e6f 7420 4e6f 6e65  pper is not None
-000094d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000094e0: 2020 2020 2020 7265 7375 6c74 5f77 7261        result_wra
-000094f0: 7070 6572 2e63 6c6f 7365 2829 0a20 2020  pper.close().   
-00009500: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00009510: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00009520: 2020 2020 2020 2075 7469 6c2e 646f 5f63         util.do_c
-00009530: 6c6f 7365 2872 6573 706f 6e73 652c 2063  lose(response, c
-00009540: 6f6e 6e2c 2073 656c 662e 636f 6e6e 486f  onn, self.connHo
-00009550: 6c64 6572 2c20 7365 6c66 2e6c 6f67 5f63  lder, self.log_c
-00009560: 6c69 656e 7429 0a0a 2020 2020 4073 7461  lient)..    @sta
-00009570: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
-00009580: 6620 5f67 6574 5f62 7566 6665 725f 6461  f _get_buffer_da
-00009590: 7461 2872 6573 756c 7457 7261 7070 6572  ta(resultWrapper
-000095a0: 2c20 6368 7563 6b53 697a 6529 3a0a 2020  , chuckSize):.  
-000095b0: 2020 2020 2020 6275 6620 3d20 4e6f 6e65        buf = None
-000095c0: 0a20 2020 2020 2020 2061 7070 656e 644c  .        appendL
-000095d0: 6973 7420 3d20 5b5d 0a20 2020 2020 2020  ist = [].       
-000095e0: 2077 6869 6c65 2054 7275 653a 0a20 2020   while True:.   
-000095f0: 2020 2020 2020 2020 2063 6875 6e6b 203d           chunk =
-00009600: 2072 6573 756c 7457 7261 7070 6572 2e72   resultWrapper.r
-00009610: 6561 6428 6368 7563 6b53 697a 6529 0a20  ead(chuckSize). 
-00009620: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00009630: 7420 6368 756e 6b3a 0a20 2020 2020 2020  t chunk:.       
-00009640: 2020 2020 2020 2020 2069 6620 626f 6f6c           if bool
-00009650: 2861 7070 656e 644c 6973 7429 3a0a 2020  (appendList):.  
-00009660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009670: 2020 7465 6d70 5374 7220 3d20 2222 0a20    tempStr = "". 
-00009680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009690: 2020 2069 6620 6e6f 7420 636f 6e73 742e     if not const.
-000096a0: 4953 5f50 5954 484f 4e32 3a0a 2020 2020  IS_PYTHON2:.    
-000096b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096c0: 2020 2020 7465 6d70 5374 7220 3d20 6222      tempStr = b"
-000096d0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000096e0: 2020 2020 2020 6275 6620 3d20 7465 6d70        buf = temp
-000096f0: 5374 722e 6a6f 696e 2861 7070 656e 644c  Str.join(appendL
-00009700: 6973 7429 0a20 2020 2020 2020 2020 2020  ist).           
-00009710: 2020 2020 2020 2020 2064 656c 2061 7070           del app
-00009720: 656e 644c 6973 745b 3a5d 0a20 2020 2020  endList[:].     
-00009730: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00009740: 0a20 2020 2020 2020 2020 2020 2061 7070  .            app
-00009750: 656e 644c 6973 742e 6170 7065 6e64 2863  endList.append(c
-00009760: 6875 6e6b 290a 2020 2020 2020 2020 7265  hunk).        re
-00009770: 7475 726e 2062 7566 0a0a 2020 2020 4073  turn buf..    @s
-00009780: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-00009790: 6465 6620 5f67 6574 5f6e 6f74 6966 6965  def _get_notifie
-000097a0: 7228 636f 6e74 656e 745f 6c65 6e67 7468  r(content_length
-000097b0: 2c20 7072 6f67 7265 7373 4361 6c6c 6261  , progressCallba
-000097c0: 636b 293a 0a20 2020 2020 2020 2072 6574  ck):.        ret
-000097d0: 7572 6e20 7072 6f67 7265 7373 2e50 726f  urn progress.Pro
-000097e0: 6772 6573 734e 6f74 6966 6965 7228 7072  gressNotifier(pr
-000097f0: 6f67 7265 7373 4361 6c6c 6261 636b 2c0a  ogressCallback,.
-00009800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009820: 2020 2020 2020 2020 2063 6f6e 7465 6e74           content
-00009830: 5f6c 656e 6774 6829 2069 6620 636f 6e74  _length) if cont
-00009840: 656e 745f 6c65 6e67 7468 2069 7320 6e6f  ent_length is no
-00009850: 7420 4e6f 6e65 2061 6e64 2063 6f6e 7465  t None and conte
-00009860: 6e74 5f6c 656e 6774 6820 3e20 3020 5c0a  nt_length > 0 \.
-00009870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000098a0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-000098b0: 7072 6f67 7265 7373 4361 6c6c 6261 636b  progressCallback
-000098c0: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
-000098d0: 6520 7072 6f67 7265 7373 2e4e 4f4e 455f  e progress.NONE_
-000098e0: 4e4f 5449 4649 4552 0a0a 2020 2020 4073  NOTIFIER..    @s
-000098f0: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-00009900: 6465 6620 5f67 6574 5f64 6174 6128 7265  def _get_data(re
-00009910: 7375 6c74 5772 6170 7065 722c 2064 6f77  sultWrapper, dow
-00009920: 6e6c 6f61 6450 6174 682c 2063 6875 636b  nloadPath, chuck
-00009930: 5369 7a65 293a 0a20 2020 2020 2020 206f  Size):.        o
-00009940: 7269 6769 6e5f 6669 6c65 5f70 6174 6820  rigin_file_path 
-00009950: 3d20 646f 776e 6c6f 6164 5061 7468 0a20  = downloadPath. 
-00009960: 2020 2020 2020 2072 6561 645f 636f 756e         read_coun
-00009970: 7420 3d20 300a 2020 2020 2020 2020 6966  t = 0.        if
-00009980: 2063 6f6e 7374 2e49 535f 5749 4e44 4f57   const.IS_WINDOW
-00009990: 533a 0a20 2020 2020 2020 2020 2020 2064  S:.            d
-000099a0: 6f77 6e6c 6f61 6450 6174 6820 3d20 7574  ownloadPath = ut
-000099b0: 696c 2e73 6166 655f 7472 616e 735f 746f  il.safe_trans_to
-000099c0: 5f67 6232 3331 3228 646f 776e 6c6f 6164  _gb2312(download
-000099d0: 5061 7468 290a 2020 2020 2020 2020 7061  Path).        pa
-000099e0: 7468 4469 7220 3d20 6f73 2e70 6174 682e  thDir = os.path.
-000099f0: 6469 726e 616d 6528 646f 776e 6c6f 6164  dirname(download
-00009a00: 5061 7468 290a 2020 2020 2020 2020 6966  Path).        if
-00009a10: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
-00009a20: 7374 7328 7061 7468 4469 7229 3a0a 2020  sts(pathDir):.  
-00009a30: 2020 2020 2020 2020 2020 6f73 2e6d 616b            os.mak
-00009a40: 6564 6972 7328 7061 7468 4469 722c 2030  edirs(pathDir, 0
-00009a50: 6f37 3535 290a 0a20 2020 2020 2020 206d  o755)..        m
-00009a60: 6f64 6573 203d 2073 7461 742e 535f 4957  odes = stat.S_IW
-00009a70: 5553 5220 7c20 7374 6174 2e53 5f49 5255  USR | stat.S_IRU
-00009a80: 5352 0a20 2020 2020 2020 2066 6c61 6773  SR.        flags
-00009a90: 203d 206f 732e 4f5f 5244 5752 207c 206f   = os.O_RDWR | o
-00009aa0: 732e 4f5f 5452 554e 4320 7c20 6f73 2e4f  s.O_TRUNC | os.O
-00009ab0: 5f43 5245 4154 0a20 2020 2020 2020 2077  _CREAT.        w
-00009ac0: 6974 6820 6f73 2e66 646f 7065 6e28 6f73  ith os.fdopen(os
-00009ad0: 2e6f 7065 6e28 646f 776e 6c6f 6164 5061  .open(downloadPa
-00009ae0: 7468 2c20 666c 6167 732c 206d 6f64 6573  th, flags, modes
-00009af0: 292c 2027 7762 2729 2061 7320 663a 0a20  ), 'wb') as f:. 
-00009b00: 2020 2020 2020 2020 2020 2077 6869 6c65             while
-00009b10: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
-00009b20: 2020 2020 2020 2063 6875 6e6b 203d 2072         chunk = r
-00009b30: 6573 756c 7457 7261 7070 6572 2e72 6561  esultWrapper.rea
-00009b40: 6428 6368 7563 6b53 697a 6529 0a20 2020  d(chuckSize).   
-00009b50: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00009b60: 6e6f 7420 6368 756e 6b3a 0a20 2020 2020  not chunk:.     
-00009b70: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00009b80: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
-00009b90: 2020 2020 2066 2e77 7269 7465 2863 6875       f.write(chu
-00009ba0: 6e6b 290a 2020 2020 2020 2020 2020 2020  nk).            
-00009bb0: 2020 2020 7265 6164 5f63 6f75 6e74 202b      read_count +
-00009bc0: 3d20 6c65 6e28 6368 756e 6b29 0a20 2020  = len(chunk).   
-00009bd0: 2020 2020 2072 6574 7572 6e20 6f72 6967       return orig
-00009be0: 696e 5f66 696c 655f 7061 7468 2c20 7265  in_file_path, re
-00009bf0: 6164 5f63 6f75 6e74 0a0a 2020 2020 4073  ad_count..    @s
-00009c00: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-00009c10: 6465 6620 5f72 656e 616d 655f 6b65 7928  def _rename_key(
-00009c20: 6b2c 2076 293a 0a20 2020 2020 2020 2066  k, v):.        f
-00009c30: 6c61 6720 3d20 300a 2020 2020 2020 2020  lag = 0.        
-00009c40: 6966 206b 2e73 7461 7274 7377 6974 6828  if k.startswith(
-00009c50: 636f 6e73 742e 5632 5f4d 4554 415f 4845  const.V2_META_HE
-00009c60: 4144 4552 5f50 5245 4649 5829 3a0a 2020  ADER_PREFIX):.  
-00009c70: 2020 2020 2020 2020 2020 6b20 3d20 6b5b            k = k[
-00009c80: 6b2e 696e 6465 7828 636f 6e73 742e 5632  k.index(const.V2
-00009c90: 5f4d 4554 415f 4845 4144 4552 5f50 5245  _META_HEADER_PRE
-00009ca0: 4649 5829 202b 206c 656e 2863 6f6e 7374  FIX) + len(const
-00009cb0: 2e56 325f 4d45 5441 5f48 4541 4445 525f  .V2_META_HEADER_
-00009cc0: 5052 4546 4958 293a 5d0a 2020 2020 2020  PREFIX):].      
-00009cd0: 2020 2020 2020 6b20 3d20 7574 696c 2e64        k = util.d
-00009ce0: 6563 6f64 655f 6974 656d 286b 290a 2020  ecode_item(k).  
-00009cf0: 2020 2020 2020 2020 2020 7620 3d20 7574            v = ut
-00009d00: 696c 2e64 6563 6f64 655f 6974 656d 2876  il.decode_item(v
-00009d10: 290a 2020 2020 2020 2020 2020 2020 666c  ).            fl
-00009d20: 6167 203d 2031 0a20 2020 2020 2020 2065  ag = 1.        e
-00009d30: 6c69 6620 6b2e 7374 6172 7473 7769 7468  lif k.startswith
-00009d40: 2863 6f6e 7374 2e56 325f 4845 4144 4552  (const.V2_HEADER
-00009d50: 5f50 5245 4649 5829 3a0a 2020 2020 2020  _PREFIX):.      
-00009d60: 2020 2020 2020 6b20 3d20 6b5b 6b2e 696e        k = k[k.in
-00009d70: 6465 7828 636f 6e73 742e 5632 5f48 4541  dex(const.V2_HEA
-00009d80: 4445 525f 5052 4546 4958 2920 2b20 6c65  DER_PREFIX) + le
-00009d90: 6e28 636f 6e73 742e 5632 5f48 4541 4445  n(const.V2_HEADE
-00009da0: 525f 5052 4546 4958 293a 5d0a 2020 2020  R_PREFIX):].    
-00009db0: 2020 2020 2020 2020 7620 3d20 7574 696c          v = util
-00009dc0: 2e64 6563 6f64 655f 6974 656d 2876 290a  .decode_item(v).
-00009dd0: 2020 2020 2020 2020 2020 2020 666c 6167              flag
-00009de0: 203d 2031 0a20 2020 2020 2020 2065 6c69   = 1.        eli
-00009df0: 6620 6b2e 7374 6172 7473 7769 7468 2863  f k.startswith(c
-00009e00: 6f6e 7374 2e4f 4253 5f4d 4554 415f 4845  onst.OBS_META_HE
-00009e10: 4144 4552 5f50 5245 4649 5829 3a0a 2020  ADER_PREFIX):.  
-00009e20: 2020 2020 2020 2020 2020 6b20 3d20 6b5b            k = k[
-00009e30: 6b2e 696e 6465 7828 636f 6e73 742e 4f42  k.index(const.OB
-00009e40: 535f 4d45 5441 5f48 4541 4445 525f 5052  S_META_HEADER_PR
-00009e50: 4546 4958 2920 2b20 6c65 6e28 636f 6e73  EFIX) + len(cons
-00009e60: 742e 4f42 535f 4d45 5441 5f48 4541 4445  t.OBS_META_HEADE
-00009e70: 525f 5052 4546 4958 293a 5d0a 2020 2020  R_PREFIX):].    
-00009e80: 2020 2020 2020 2020 6b20 3d20 7574 696c          k = util
-00009e90: 2e64 6563 6f64 655f 6974 656d 286b 290a  .decode_item(k).
-00009ea0: 2020 2020 2020 2020 2020 2020 7620 3d20              v = 
-00009eb0: 7574 696c 2e64 6563 6f64 655f 6974 656d  util.decode_item
-00009ec0: 2876 290a 2020 2020 2020 2020 2020 2020  (v).            
-00009ed0: 666c 6167 203d 2031 0a20 2020 2020 2020  flag = 1.       
-00009ee0: 2065 6c69 6620 6b2e 7374 6172 7473 7769   elif k.startswi
-00009ef0: 7468 2863 6f6e 7374 2e4f 4253 5f48 4541  th(const.OBS_HEA
-00009f00: 4445 525f 5052 4546 4958 293a 0a20 2020  DER_PREFIX):.   
-00009f10: 2020 2020 2020 2020 206b 203d 206b 5b6b           k = k[k
-00009f20: 2e69 6e64 6578 2863 6f6e 7374 2e4f 4253  .index(const.OBS
-00009f30: 5f48 4541 4445 525f 5052 4546 4958 2920  _HEADER_PREFIX) 
-00009f40: 2b20 6c65 6e28 636f 6e73 742e 4f42 535f  + len(const.OBS_
-00009f50: 4845 4144 4552 5f50 5245 4649 5829 3a5d  HEADER_PREFIX):]
-00009f60: 0a20 2020 2020 2020 2020 2020 2076 203d  .            v =
-00009f70: 2075 7469 6c2e 6465 636f 6465 5f69 7465   util.decode_ite
-00009f80: 6d28 7629 0a20 2020 2020 2020 2020 2020  m(v).           
-00009f90: 2066 6c61 6720 3d20 310a 2020 2020 2020   flag = 1.      
-00009fa0: 2020 7265 7475 726e 2066 6c61 672c 206b    return flag, k
-00009fb0: 2c20 760a 0a20 2020 2064 6566 205f 7265  , v..    def _re
-00009fc0: 6e61 6d65 5f72 6573 706f 6e73 655f 6865  name_response_he
-00009fd0: 6164 6572 7328 7365 6c66 2c20 6865 6164  aders(self, head
-00009fe0: 6572 7329 3a0a 2020 2020 2020 2020 6865  ers):.        he
-00009ff0: 6164 6572 203d 205b 5d0a 2020 2020 2020  ader = [].      
-0000a000: 2020 666f 7220 6b2c 2076 2069 6e20 6865    for k, v in he
-0000a010: 6164 6572 732e 6974 656d 7328 293a 0a20  aders.items():. 
-0000a020: 2020 2020 2020 2020 2020 2066 6c61 6720             flag 
-0000a030: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-0000a040: 6966 206b 2069 6e20 636f 6e73 742e 414c  if k in const.AL
-0000a050: 4c4f 5745 445f 5245 5350 4f4e 5345 5f48  LOWED_RESPONSE_H
-0000a060: 5454 505f 4845 4144 4552 5f4d 4554 4144  TTP_HEADER_METAD
-0000a070: 4154 415f 4e41 4d45 533a 0a20 2020 2020  ATA_NAMES:.     
-0000a080: 2020 2020 2020 2020 2020 2066 6c61 6720             flag 
-0000a090: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-0000a0a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000a0b0: 2020 2020 2020 666c 6167 2c20 6b2c 2076        flag, k, v
-0000a0c0: 203d 2073 656c 662e 5f72 656e 616d 655f   = self._rename_
-0000a0d0: 6b65 7928 6b2c 2076 290a 2020 2020 2020  key(k, v).      
-0000a0e0: 2020 2020 2020 6966 2066 6c61 673a 0a20        if flag:. 
-0000a0f0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-0000a100: 6561 6465 722e 6170 7065 6e64 2828 6b2c  eader.append((k,
-0000a110: 2076 2929 0a20 2020 2020 2020 2072 6574   v)).        ret
-0000a120: 7572 6e20 6865 6164 6572 0a0a 2020 2020  urn header..    
-0000a130: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
-0000a140: 2020 6465 6620 5f70 7265 7061 7265 5f72    def _prepare_r
-0000a150: 6573 706f 6e73 655f 6461 7461 2872 6573  esponse_data(res
-0000a160: 756c 742c 2063 6875 636b 5369 7a65 293a  ult, chuckSize):
-0000a170: 0a20 2020 2020 2020 2072 6573 706f 6e73  .        respons
-0000a180: 6544 6174 6120 3d20 4e6f 6e65 0a20 2020  eData = None.   
-0000a190: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
-0000a1a0: 0a20 2020 2020 2020 2020 2020 2063 6875  .            chu
-0000a1b0: 6e6b 203d 2072 6573 756c 742e 7265 6164  nk = result.read
-0000a1c0: 2863 6875 636b 5369 7a65 290a 2020 2020  (chuckSize).    
-0000a1d0: 2020 2020 2020 2020 6966 206e 6f74 2063          if not c
-0000a1e0: 6875 6e6b 3a0a 2020 2020 2020 2020 2020  hunk:.          
-0000a1f0: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
-0000a200: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
-0000a210: 4461 7461 203d 2063 6875 6e6b 2069 6620  Data = chunk if 
-0000a220: 7265 7370 6f6e 7365 4461 7461 2069 7320  responseData is 
-0000a230: 4e6f 6e65 2065 6c73 6520 7265 7370 6f6e  None else respon
-0000a240: 7365 4461 7461 202b 2063 6875 6e6b 0a20  seData + chunk. 
-0000a250: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-0000a260: 7370 6f6e 7365 4461 7461 0a0a 2020 2020  sponseData..    
-0000a270: 6465 6620 5f70 7265 7061 7265 5f62 6f64  def _prepare_bod
-0000a280: 7928 7365 6c66 2c20 6d65 7468 6f64 4e61  y(self, methodNa
-0000a290: 6d65 2c20 7265 7370 6f6e 7365 4461 7461  me, responseData
-0000a2a0: 2c20 6973 4a73 6f6e 2c20 6865 6164 6572  , isJson, header
-0000a2b0: 7329 3a0a 2020 2020 2020 2020 626f 6479  s):.        body
-0000a2c0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-0000a2d0: 6966 206d 6574 686f 644e 616d 6520 6973  if methodName is
-0000a2e0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000a2f0: 2020 2020 2020 2070 6172 7365 4d65 7468         parseMeth
-0000a300: 6f64 203d 2067 6574 6174 7472 2873 656c  od = getattr(sel
-0000a310: 662e 636f 6e76 6572 746f 722c 2027 7061  f.convertor, 'pa
-0000a320: 7273 6527 202b 206d 6574 686f 644e 616d  rse' + methodNam
-0000a330: 655b 3a31 5d2e 7570 7065 7228 2920 2b20  e[:1].upper() + 
-0000a340: 6d65 7468 6f64 4e61 6d65 5b31 3a5d 290a  methodName[1:]).
-0000a350: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-0000a360: 6172 7365 4d65 7468 6f64 2069 7320 6e6f  arseMethod is no
-0000a370: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000a380: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0000a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a3a0: 2069 6620 7265 7370 6f6e 7365 4461 7461   if responseData
-0000a3b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a3c0: 2020 2020 2020 2020 2020 7265 7370 6f6e            respon
-0000a3d0: 7365 4461 7461 203d 2072 6573 706f 6e73  seData = respons
-0000a3e0: 6544 6174 6120 6966 2063 6f6e 7374 2e49  eData if const.I
-0000a3f0: 535f 5059 5448 4f4e 3220 656c 7365 2072  S_PYTHON2 else r
-0000a400: 6573 706f 6e73 6544 6174 612e 6465 636f  esponseData.deco
-0000a410: 6465 2827 5554 462d 3827 290a 2020 2020  de('UTF-8').    
-0000a420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a430: 2020 2020 7365 6c66 2e6c 6f67 5f63 6c69      self.log_cli
-0000a440: 656e 742e 6c6f 6728 4445 4255 472c 2027  ent.log(DEBUG, '
-0000a450: 7265 6365 6976 6520 4d73 673a 2573 272c  receive Msg:%s',
-0000a460: 2072 6573 706f 6e73 6544 6174 6129 0a20   responseData). 
-0000a470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a480: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-0000a490: 4a73 6f6e 3a0a 2020 2020 2020 2020 2020  Json:.          
-0000a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4b0: 2020 7365 6172 6368 203d 2073 656c 662e    search = self.
-0000a4c0: 7061 7474 6572 6e2e 7365 6172 6368 2872  pattern.search(r
-0000a4d0: 6573 706f 6e73 6544 6174 6129 0a20 2020  esponseData).   
-0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4f0: 2020 2020 2020 2020 2072 6573 706f 6e73           respons
-0000a500: 6544 6174 6120 3d20 7265 7370 6f6e 7365  eData = response
-0000a510: 4461 7461 2069 6620 7365 6172 6368 2069  Data if search i
-0000a520: 7320 4e6f 6e65 2065 6c73 6520 7265 7370  s None else resp
-0000a530: 6f6e 7365 4461 7461 2e72 6570 6c61 6365  onseData.replace
-0000a540: 2873 6561 7263 682e 6772 6f75 7028 292c  (search.group(),
-0000a550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008360: 2020 2073 656c 662e 7072 6f78 795f 7573     self.proxy_us
+00008370: 6572 6e61 6d65 2920 2b20 273a 2720 2b20  ername) + ':' + 
+00008380: 7574 696c 2e74 6f5f 7374 7269 6e67 280a  util.to_string(.
+00008390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000083a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000083b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000083c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000083d0: 2020 2020 7365 6c66 2e70 726f 7879 5f70      self.proxy_p
+000083e0: 6173 7377 6f72 6429 290a 2020 2020 2020  assword)).      
+000083f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008420: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00008430: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00008440: 7573 655f 6874 7470 323a 0a20 2020 2020  use_http2:.     
+00008450: 2020 2020 2020 2020 2020 2063 6f6e 6e2e             conn.
+00008460: 7365 745f 7475 6e6e 656c 2873 6572 7665  set_tunnel(serve
+00008470: 722c 2070 6f72 742c 205f 6865 6164 6572  r, port, _header
+00008480: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00008490: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000084a0: 2020 2020 6865 6164 6572 5b63 6f6e 7374      header[const
+000084b0: 2e50 524f 5859 5f41 5554 484f 5249 5a41  .PROXY_AUTHORIZA
+000084c0: 5449 4f4e 5f48 4541 4445 525d 203d 205f  TION_HEADER] = _
+000084d0: 6865 6164 6572 5b63 6f6e 7374 2e50 524f  header[const.PRO
+000084e0: 5859 5f41 5554 484f 5249 5a41 5449 4f4e  XY_AUTHORIZATION
+000084f0: 5f48 4541 4445 525d 0a20 2020 2020 2020  _HEADER].       
+00008500: 2020 2020 2063 6f6e 6e65 6374 696f 6e5f       connection_
+00008510: 6b65 7920 3d20 636f 6e73 742e 5052 4f58  key = const.PROX
+00008520: 595f 434f 4e4e 4543 5449 4f4e 5f48 4541  Y_CONNECTION_HEA
+00008530: 4445 520a 2020 2020 2020 2020 656c 7365  DER.        else
+00008540: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+00008550: 6e6e 203d 2073 656c 662e 5f67 6574 5f73  nn = self._get_s
+00008560: 6572 7665 725f 636f 6e6e 6563 7469 6f6e  erver_connection
+00008570: 2873 6572 7665 722c 2070 6f72 742c 2073  (server, port, s
+00008580: 6368 656d 652c 2072 6564 6972 6563 7429  cheme, redirect)
+00008590: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000085a0: 2e6c 6f6e 675f 636f 6e6e 5f6d 6f64 653a  .long_conn_mode:
+000085b0: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
+000085c0: 6465 725b 636f 6e6e 6563 7469 6f6e 5f6b  der[connection_k
+000085d0: 6579 5d20 3d20 636f 6e73 742e 434f 4e4e  ey] = const.CONN
+000085e0: 4543 5449 4f4e 5f4b 4545 505f 414c 4956  ECTION_KEEP_ALIV
+000085f0: 455f 5641 4c55 450a 2020 2020 2020 2020  E_VALUE.        
+00008600: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00008610: 2020 6865 6164 6572 5b63 6f6e 7374 2e43    header[const.C
+00008620: 4f4e 4e45 4354 494f 4e5f 4845 4144 4552  ONNECTION_HEADER
+00008630: 5d20 3d20 636f 6e73 742e 434f 4e4e 4543  ] = const.CONNEC
+00008640: 5449 4f4e 5f43 4c4f 5345 5f56 414c 5545  TION_CLOSE_VALUE
+00008650: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00008660: 636f 6e6e 2c20 6865 6164 6572 0a0a 2020  conn, header..  
+00008670: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
+00008680: 2020 2020 6465 6620 5f70 6172 7365 5f63      def _parse_c
+00008690: 6f6e 6e65 6374 696f 6e5f 6368 756e 6b65  onnection_chunke
+000086a0: 645f 6d6f 6465 2863 6f6e 6e2c 2063 6875  d_mode(conn, chu
+000086b0: 6e6b 6564 4d6f 6465 2c20 6d65 7468 6f64  nkedMode, method
+000086c0: 2c20 7061 7468 2c20 6865 6164 6572 293a  , path, header):
+000086d0: 0a20 2020 2020 2020 2069 6620 6368 756e  .        if chun
+000086e0: 6b65 644d 6f64 653a 0a20 2020 2020 2020  kedMode:.       
+000086f0: 2020 2020 2063 6f6e 6e2e 7075 7472 6571       conn.putreq
+00008700: 7565 7374 286d 6574 686f 642c 2070 6174  uest(method, pat
+00008710: 682c 2073 6b69 705f 686f 7374 3d31 290a  h, skip_host=1).
+00008720: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00008730: 6b2c 2076 2069 6e20 6865 6164 6572 2e69  k, v in header.i
+00008740: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+00008750: 2020 2020 2020 2020 636f 6e6e 2e70 7574          conn.put
+00008760: 6865 6164 6572 286b 2c20 7629 0a20 2020  header(k, v).   
+00008770: 2020 2020 2020 2020 2063 6f6e 6e2e 656e           conn.en
+00008780: 6468 6561 6465 7273 2829 0a20 2020 2020  dheaders().     
+00008790: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000087a0: 2020 2020 2063 6f6e 6e2e 7265 7175 6573       conn.reques
+000087b0: 7428 6d65 7468 6f64 2c20 7061 7468 2c20  t(method, path, 
+000087c0: 6865 6164 6572 733d 6865 6164 6572 290a  headers=header).
+000087d0: 0a20 2020 2064 6566 205f 6765 744e 6f6e  .    def _getNon
+000087e0: 6552 6573 756c 7428 7365 6c66 2c20 6d65  eResult(self, me
+000087f0: 7373 6167 653d 274e 6f6e 6520 5265 7375  ssage='None Resu
+00008800: 6c74 2729 3a0a 2020 2020 2020 2020 7261  lt'):.        ra
+00008810: 6973 6520 4578 6365 7074 696f 6e28 6d65  ise Exception(me
+00008820: 7373 6167 6529 0a0a 2020 2020 6465 6620  ssage)..    def 
+00008830: 5f70 6172 7365 5f78 6d6c 2873 656c 662c  _parse_xml(self,
+00008840: 2063 6f6e 6e2c 206d 6574 686f 644e 616d   conn, methodNam
+00008850: 653d 4e6f 6e65 2c20 7265 6164 6162 6c65  e=None, readable
+00008860: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+00008870: 2069 6620 6e6f 7420 636f 6e6e 3a0a 2020   if not conn:.  
+00008880: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00008890: 2073 656c 662e 5f67 6574 4e6f 6e65 5265   self._getNoneRe
+000088a0: 7375 6c74 2827 636f 6e6e 6563 7469 6f6e  sult('connection
+000088b0: 2069 7320 6e6f 6e65 2729 0a20 2020 2020   is none').     
+000088c0: 2020 2072 6573 756c 7420 3d20 4e6f 6e65     result = None
+000088d0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+000088e0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+000088f0: 203d 2063 6f6e 6e2e 6765 7472 6573 706f   = conn.getrespo
+00008900: 6e73 6528 5472 7565 2920 6966 2063 6f6e  nse(True) if con
+00008910: 7374 2e49 535f 5059 5448 4f4e 3220 656c  st.IS_PYTHON2 el
+00008920: 7365 2063 6f6e 6e2e 6765 7472 6573 706f  se conn.getrespo
+00008930: 6e73 6528 290a 2020 2020 2020 2020 2020  nse().          
+00008940: 2020 6966 206e 6f74 2072 6573 756c 743a    if not result:
+00008950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008960: 2072 6574 7572 6e20 7365 6c66 2e5f 6765   return self._ge
+00008970: 744e 6f6e 6552 6573 756c 7428 2772 6573  tNoneResult('res
+00008980: 706f 6e73 6520 6973 206e 6f6e 6527 290a  ponse is none').
+00008990: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000089a0: 726e 2073 656c 662e 5f70 6172 7365 5f78  rn self._parse_x
+000089b0: 6d6c 5f69 6e74 6572 6e61 6c28 7265 7375  ml_internal(resu
+000089c0: 6c74 2c20 6d65 7468 6f64 4e61 6d65 2c20  lt, methodName, 
+000089d0: 7265 6164 6162 6c65 3d72 6561 6461 626c  readable=readabl
+000089e0: 6529 0a20 2020 2020 2020 2065 7863 6570  e).        excep
+000089f0: 7420 5f52 6564 6972 6563 7445 7863 6570  t _RedirectExcep
+00008a00: 7469 6f6e 2061 7320 6578 3a0a 2020 2020  tion as ex:.    
+00008a10: 2020 2020 2020 2020 7261 6973 6520 6578          raise ex
+00008a20: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00008a30: 5f49 6e74 6572 6e61 6c45 7863 6570 7469  _InternalExcepti
+00008a40: 6f6e 2061 7320 6578 3a0a 2020 2020 2020  on as ex:.      
+00008a50: 2020 2020 2020 7261 6973 6520 6578 0a20        raise ex. 
+00008a60: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+00008a70: 6365 7074 696f 6e20 6173 2065 3a0a 2020  ception as e:.  
+00008a80: 2020 2020 2020 2020 2020 636f 6e6e 2e5f            conn._
+00008a90: 636c 6561 7220 3d20 5472 7565 0a20 2020  clear = True.   
+00008aa0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+00008ab0: 675f 636c 6965 6e74 2e6c 6f67 2845 5252  g_client.log(ERR
+00008ac0: 4f52 2c20 7472 6163 6562 6163 6b2e 666f  OR, traceback.fo
+00008ad0: 726d 6174 5f65 7863 2829 290a 2020 2020  rmat_exc()).    
+00008ae0: 2020 2020 2020 2020 7261 6973 6520 650a          raise e.
+00008af0: 2020 2020 2020 2020 6669 6e61 6c6c 793a          finally:
+00008b00: 0a20 2020 2020 2020 2020 2020 2075 7469  .            uti
+00008b10: 6c2e 646f 5f63 6c6f 7365 2872 6573 756c  l.do_close(resul
+00008b20: 742c 2063 6f6e 6e2c 2073 656c 662e 636f  t, conn, self.co
+00008b30: 6e6e 486f 6c64 6572 2c20 7365 6c66 2e6c  nnHolder, self.l
+00008b40: 6f67 5f63 6c69 656e 7429 0a0a 2020 2020  og_client)..    
+00008b50: 6465 6620 5f70 6172 7365 5f63 6f6e 7465  def _parse_conte
+00008b60: 6e74 2873 656c 662c 206f 626a 6563 744b  nt(self, objectK
+00008b70: 6579 2c20 636f 6e6e 2c20 7265 7370 6f6e  ey, conn, respon
+00008b80: 7365 2c20 646f 776e 6c6f 6164 5f73 7461  se, download_sta
+00008b90: 7274 3d27 272c 0a20 2020 2020 2020 2020  rt='',.         
+00008ba0: 2020 2020 2020 2020 2020 2020 2020 646f                do
+00008bb0: 776e 6c6f 6164 5061 7468 3d4e 6f6e 652c  wnloadPath=None,
+00008bc0: 2063 6875 636b 5369 7a65 3d63 6f6e 7374   chuckSize=const
+00008bd0: 2e52 4541 445f 4f4e 4345 5f4c 454e 4754  .READ_ONCE_LENGT
+00008be0: 482c 206c 6f61 6453 7472 6561 6d49 6e4d  H, loadStreamInM
+00008bf0: 656d 6f72 793d 4661 6c73 652c 0a20 2020  emory=False,.   
+00008c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008c10: 2020 2020 7072 6f67 7265 7373 4361 6c6c      progressCall
+00008c20: 6261 636b 3d4e 6f6e 652c 206e 6f74 6966  back=None, notif
+00008c30: 6965 723d 4e6f 6e65 293a 0a20 2020 2020  ier=None):.     
+00008c40: 2020 2069 6620 6e6f 7420 636f 6e6e 3a0a     if not conn:.
+00008c50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00008c60: 726e 2073 656c 662e 5f67 6574 4e6f 6e65  rn self._getNone
+00008c70: 5265 7375 6c74 2827 636f 6e6e 6563 7469  Result('connecti
+00008c80: 6f6e 2069 7320 6e6f 6e65 2729 0a20 2020  on is none').   
+00008c90: 2020 2020 2063 6c6f 7365 5f63 6f6e 6e5f       close_conn_
+00008ca0: 666c 6167 203d 2054 7275 650a 2020 2020  flag = True.    
+00008cb0: 2020 2020 7265 7375 6c74 5f77 7261 7070      result_wrapp
+00008cc0: 6572 203d 204e 6f6e 650a 2020 2020 2020  er = None.      
+00008cd0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00008ce0: 2020 2069 6620 6e6f 7420 7265 7370 6f6e     if not respon
+00008cf0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00008d00: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00008d10: 5f67 6574 4e6f 6e65 5265 7375 6c74 2827  _getNoneResult('
+00008d20: 7265 7370 6f6e 7365 2069 7320 6e6f 6e65  response is none
+00008d30: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
+00008d40: 6966 206e 6f74 2075 7469 6c2e 746f 5f69  if not util.to_i
+00008d50: 6e74 2872 6573 706f 6e73 652e 7374 6174  nt(response.stat
+00008d60: 7573 2920 3c20 3330 303a 0a20 2020 2020  us) < 300:.     
+00008d70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00008d80: 6e20 7365 6c66 2e5f 7061 7273 655f 786d  n self._parse_xm
+00008d90: 6c5f 696e 7465 726e 616c 2872 6573 706f  l_internal(respo
+00008da0: 6e73 6529 0a0a 2020 2020 2020 2020 2020  nse)..          
+00008db0: 2020 6865 6164 6572 7320 3d20 7b7d 0a20    headers = {}. 
+00008dc0: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+00008dd0: 2c20 7620 696e 2072 6573 706f 6e73 652e  , v in response.
+00008de0: 6765 7468 6561 6465 7273 2829 3a0a 2020  getheaders():.  
+00008df0: 2020 2020 2020 2020 2020 2020 2020 6865                he
+00008e00: 6164 6572 735b 6b2e 6c6f 7765 7228 295d  aders[k.lower()]
+00008e10: 203d 2076 0a0a 2020 2020 2020 2020 2020   = v..          
+00008e20: 2020 636f 6e74 656e 745f 6c65 6e67 7468    content_length
+00008e30: 203d 2068 6561 6465 7273 2e67 6574 2827   = headers.get('
+00008e40: 636f 6e74 656e 742d 6c65 6e67 7468 2729  content-length')
+00008e50: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00008e60: 7465 6e74 5f6c 656e 6774 6820 3d20 7574  tent_length = ut
+00008e70: 696c 2e74 6f5f 6c6f 6e67 2863 6f6e 7465  il.to_long(conte
+00008e80: 6e74 5f6c 656e 6774 6829 2069 6620 636f  nt_length) if co
+00008e90: 6e74 656e 745f 6c65 6e67 7468 2069 7320  ntent_length is 
+00008ea0: 6e6f 7420 4e6f 6e65 2065 6c73 6520 4e6f  not None else No
+00008eb0: 6e65 0a20 2020 2020 2020 2020 2020 2069  ne.            i
+00008ec0: 6620 6e6f 7420 6e6f 7469 6669 6572 3a0a  f not notifier:.
+00008ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ee0: 6e6f 7469 6669 6572 203d 2073 656c 662e  notifier = self.
+00008ef0: 5f67 6574 5f6e 6f74 6966 6965 7228 636f  _get_notifier(co
+00008f00: 6e74 656e 745f 6c65 6e67 7468 2c20 7072  ntent_length, pr
+00008f10: 6f67 7265 7373 4361 6c6c 6261 636b 290a  ogressCallback).
+00008f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f30: 6e6f 7469 6669 6572 2e73 7461 7274 2829  notifier.start()
+00008f40: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00008f50: 756c 745f 7772 6170 7065 7220 3d20 5265  ult_wrapper = Re
+00008f60: 7370 6f6e 7365 5772 6170 7065 7228 636f  sponseWrapper(co
+00008f70: 6e6e 2c20 7265 7370 6f6e 7365 2c20 7365  nn, response, se
+00008f80: 6c66 2e63 6f6e 6e48 6f6c 6465 722c 2063  lf.connHolder, c
+00008f90: 6f6e 7465 6e74 5f6c 656e 6774 682c 206e  ontent_length, n
+00008fa0: 6f74 6966 6965 7229 0a20 2020 2020 2020  otifier).       
+00008fb0: 2020 2020 2069 6620 6c6f 6164 5374 7265       if loadStre
+00008fc0: 616d 496e 4d65 6d6f 7279 3a0a 2020 2020  amInMemory:.    
+00008fd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00008fe0: 2e6c 6f67 5f63 6c69 656e 742e 6c6f 6728  .log_client.log(
+00008ff0: 4445 4255 472c 2027 6c6f 6164 5374 7265  DEBUG, 'loadStre
+00009000: 616d 496e 4d65 6d6f 7279 2069 7320 5472  amInMemory is Tr
+00009010: 7565 2c20 7265 6164 2073 7472 6561 6d20  ue, read stream 
+00009020: 696e 746f 206d 656d 6f72 7927 290a 2020  into memory').  
+00009030: 2020 2020 2020 2020 2020 2020 2020 6275                bu
+00009040: 6620 3d20 7365 6c66 2e5f 6765 745f 6275  f = self._get_bu
+00009050: 6666 6572 5f64 6174 6128 7265 7375 6c74  ffer_data(result
+00009060: 5f77 7261 7070 6572 2c20 6368 7563 6b53  _wrapper, chuckS
+00009070: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
+00009080: 2020 2020 2062 6f64 7920 3d20 4f62 6a65       body = Obje
+00009090: 6374 5374 7265 616d 2862 7566 6665 723d  ctStream(buffer=
+000090a0: 6275 662c 2073 697a 653d 7574 696c 2e74  buf, size=util.t
+000090b0: 6f5f 6c6f 6e67 286c 656e 2862 7566 2929  o_long(len(buf))
+000090c0: 2069 6620 6275 6620 6973 206e 6f74 204e   if buf is not N
+000090d0: 6f6e 6520 656c 7365 2030 290a 2020 2020  one else 0).    
+000090e0: 2020 2020 2020 2020 656c 6966 2064 6f77          elif dow
+000090f0: 6e6c 6f61 6450 6174 6820 6973 204e 6f6e  nloadPath is Non
+00009100: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00009110: 2020 2073 656c 662e 6c6f 675f 636c 6965     self.log_clie
+00009120: 6e74 2e6c 6f67 2844 4542 5547 2c20 2744  nt.log(DEBUG, 'D
+00009130: 6f77 6e6c 6f61 6450 6174 6820 6973 206e  ownloadPath is n
+00009140: 6f6e 652c 2072 6574 7572 6e20 636f 6e6e  one, return conn
+00009150: 2064 6972 6563 746c 7927 290a 2020 2020   directly').    
+00009160: 2020 2020 2020 2020 2020 2020 636c 6f73              clos
+00009170: 655f 636f 6e6e 5f66 6c61 6720 3d20 4661  e_conn_flag = Fa
+00009180: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00009190: 2020 2020 626f 6479 203d 204f 626a 6563      body = Objec
+000091a0: 7453 7472 6561 6d28 7265 7370 6f6e 7365  tStream(response
+000091b0: 3d72 6573 756c 745f 7772 6170 7065 7229  =result_wrapper)
+000091c0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+000091d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000091e0: 2020 2064 6f77 6e6c 6f61 6450 6174 6820     downloadPath 
+000091f0: 3d20 7574 696c 2e73 6166 655f 656e 636f  = util.safe_enco
+00009200: 6465 2864 6f77 6e6c 6f61 6450 6174 6829  de(downloadPath)
+00009210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009220: 2066 696c 655f 7061 7468 2c20 5f20 3d20   file_path, _ = 
+00009230: 7365 6c66 2e5f 6765 745f 6461 7461 2872  self._get_data(r
+00009240: 6573 756c 745f 7772 6170 7065 722c 2064  esult_wrapper, d
+00009250: 6f77 6e6c 6f61 6450 6174 682c 2063 6875  ownloadPath, chu
+00009260: 636b 5369 7a65 290a 2020 2020 2020 2020  ckSize).        
+00009270: 2020 2020 2020 2020 626f 6479 203d 204f          body = O
+00009280: 626a 6563 7453 7472 6561 6d28 7572 6c3d  bjectStream(url=
+00009290: 7574 696c 2e74 6f5f 7374 7269 6e67 2866  util.to_string(f
+000092a0: 696c 655f 7061 7468 2929 0a20 2020 2020  ile_path)).     
+000092b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000092c0: 6c6f 675f 636c 6965 6e74 2e6c 6f67 2844  log_client.log(D
+000092d0: 4542 5547 2c20 2744 6f77 6e6c 6f61 6450  EBUG, 'DownloadP
+000092e0: 6174 6820 6973 2027 202b 2075 7469 6c2e  ath is ' + util.
+000092f0: 746f 5f73 7472 696e 6728 6669 6c65 5f70  to_string(file_p
+00009300: 6174 6829 290a 0a20 2020 2020 2020 2020  ath))..         
+00009310: 2020 2073 7461 7475 7320 3d20 7574 696c     status = util
+00009320: 2e74 6f5f 696e 7428 7265 7370 6f6e 7365  .to_int(response
+00009330: 2e73 7461 7475 7329 0a20 2020 2020 2020  .status).       
+00009340: 2020 2020 2072 6561 736f 6e20 3d20 7265       reason = re
+00009350: 7370 6f6e 7365 2e72 6561 736f 6e0a 2020  sponse.reason.  
+00009360: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+00009370: 6f6e 7665 7274 6f72 2e70 6172 7365 4765  onvertor.parseGe
+00009380: 744f 626a 6563 7428 6865 6164 6572 732c  tObject(headers,
+00009390: 2062 6f64 7929 0a20 2020 2020 2020 2020   body).         
+000093a0: 2020 2068 6561 6465 7220 3d20 7365 6c66     header = self
+000093b0: 2e5f 7265 6e61 6d65 5f72 6573 706f 6e73  ._rename_respons
+000093c0: 655f 6865 6164 6572 7328 6865 6164 6572  e_headers(header
+000093d0: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
+000093e0: 6571 7565 7374 4964 203d 2064 6963 7428  equestId = dict(
+000093f0: 6865 6164 6572 292e 6765 7428 2772 6571  header).get('req
+00009400: 7565 7374 2d69 6427 290a 2020 2020 2020  uest-id').      
+00009410: 2020 2020 2020 7265 7475 726e 2047 6574        return Get
+00009420: 5265 7375 6c74 2873 7461 7475 733d 7374  Result(status=st
+00009430: 6174 7573 2c20 7265 6173 6f6e 3d72 6561  atus, reason=rea
+00009440: 736f 6e2c 2068 6561 6465 723d 6865 6164  son, header=head
+00009450: 6572 2c20 626f 6479 3d62 6f64 792c 2072  er, body=body, r
+00009460: 6571 7565 7374 4964 3d72 6571 7565 7374  equestId=request
+00009470: 4964 290a 2020 2020 2020 2020 6578 6365  Id).        exce
+00009480: 7074 205f 5265 6469 7265 6374 4578 6365  pt _RedirectExce
+00009490: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
+000094a0: 2020 2020 2020 2020 2072 6169 7365 2065           raise e
+000094b0: 780a 2020 2020 2020 2020 6578 6365 7074  x.        except
+000094c0: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+000094d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000094e0: 662e 6c6f 675f 636c 6965 6e74 2e6c 6f67  f.log_client.log
+000094f0: 2845 5252 4f52 2c20 7472 6163 6562 6163  (ERROR, tracebac
+00009500: 6b2e 666f 726d 6174 5f65 7863 2829 290a  k.format_exc()).
+00009510: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00009520: 6520 650a 2020 2020 2020 2020 6669 6e61  e e.        fina
+00009530: 6c6c 793a 0a20 2020 2020 2020 2020 2020  lly:.           
+00009540: 2069 6620 636c 6f73 655f 636f 6e6e 5f66   if close_conn_f
+00009550: 6c61 673a 0a20 2020 2020 2020 2020 2020  lag:.           
+00009560: 2020 2020 2069 6620 7265 7375 6c74 5f77       if result_w
+00009570: 7261 7070 6572 2069 7320 6e6f 7420 4e6f  rapper is not No
+00009580: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00009590: 2020 2020 2020 2020 7265 7375 6c74 5f77          result_w
+000095a0: 7261 7070 6572 2e63 6c6f 7365 2829 0a20  rapper.close(). 
+000095b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000095c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000095d0: 2020 2020 2020 2020 2075 7469 6c2e 646f           util.do
+000095e0: 5f63 6c6f 7365 2872 6573 706f 6e73 652c  _close(response,
+000095f0: 2063 6f6e 6e2c 2073 656c 662e 636f 6e6e   conn, self.conn
+00009600: 486f 6c64 6572 2c20 7365 6c66 2e6c 6f67  Holder, self.log
+00009610: 5f63 6c69 656e 7429 0a0a 2020 2020 4073  _client)..    @s
+00009620: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
+00009630: 6465 6620 5f67 6574 5f62 7566 6665 725f  def _get_buffer_
+00009640: 6461 7461 2872 6573 756c 7457 7261 7070  data(resultWrapp
+00009650: 6572 2c20 6368 7563 6b53 697a 6529 3a0a  er, chuckSize):.
+00009660: 2020 2020 2020 2020 6275 6620 3d20 4e6f          buf = No
+00009670: 6e65 0a20 2020 2020 2020 2061 7070 656e  ne.        appen
+00009680: 644c 6973 7420 3d20 5b5d 0a20 2020 2020  dList = [].     
+00009690: 2020 2077 6869 6c65 2054 7275 653a 0a20     while True:. 
+000096a0: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
+000096b0: 203d 2072 6573 756c 7457 7261 7070 6572   = resultWrapper
+000096c0: 2e72 6561 6428 6368 7563 6b53 697a 6529  .read(chuckSize)
+000096d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000096e0: 6e6f 7420 6368 756e 6b3a 0a20 2020 2020  not chunk:.     
+000096f0: 2020 2020 2020 2020 2020 2069 6620 626f             if bo
+00009700: 6f6c 2861 7070 656e 644c 6973 7429 3a0a  ol(appendList):.
+00009710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009720: 2020 2020 7465 6d70 5374 7220 3d20 2222      tempStr = ""
+00009730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009740: 2020 2020 2069 6620 6e6f 7420 636f 6e73       if not cons
+00009750: 742e 4953 5f50 5954 484f 4e32 3a0a 2020  t.IS_PYTHON2:.  
+00009760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009770: 2020 2020 2020 7465 6d70 5374 7220 3d20        tempStr = 
+00009780: 6222 220a 2020 2020 2020 2020 2020 2020  b"".            
+00009790: 2020 2020 2020 2020 6275 6620 3d20 7465          buf = te
+000097a0: 6d70 5374 722e 6a6f 696e 2861 7070 656e  mpStr.join(appen
+000097b0: 644c 6973 7429 0a20 2020 2020 2020 2020  dList).         
+000097c0: 2020 2020 2020 2020 2020 2064 656c 2061             del a
+000097d0: 7070 656e 644c 6973 745b 3a5d 0a20 2020  ppendList[:].   
+000097e0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+000097f0: 616b 0a20 2020 2020 2020 2020 2020 2061  ak.            a
+00009800: 7070 656e 644c 6973 742e 6170 7065 6e64  ppendList.append
+00009810: 2863 6875 6e6b 290a 2020 2020 2020 2020  (chunk).        
+00009820: 7265 7475 726e 2062 7566 0a0a 2020 2020  return buf..    
+00009830: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+00009840: 2020 6465 6620 5f67 6574 5f6e 6f74 6966    def _get_notif
+00009850: 6965 7228 636f 6e74 656e 745f 6c65 6e67  ier(content_leng
+00009860: 7468 2c20 7072 6f67 7265 7373 4361 6c6c  th, progressCall
+00009870: 6261 636b 293a 0a20 2020 2020 2020 2072  back):.        r
+00009880: 6574 7572 6e20 7072 6f67 7265 7373 2e50  eturn progress.P
+00009890: 726f 6772 6573 734e 6f74 6966 6965 7228  rogressNotifier(
+000098a0: 7072 6f67 7265 7373 4361 6c6c 6261 636b  progressCallback
+000098b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000098c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000098d0: 2020 2020 2020 2020 2020 2063 6f6e 7465             conte
+000098e0: 6e74 5f6c 656e 6774 6829 2069 6620 636f  nt_length) if co
+000098f0: 6e74 656e 745f 6c65 6e67 7468 2069 7320  ntent_length is 
+00009900: 6e6f 7420 4e6f 6e65 2061 6e64 2063 6f6e  not None and con
+00009910: 7465 6e74 5f6c 656e 6774 6820 3e20 3020  tent_length > 0 
+00009920: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00009930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009950: 2020 2020 2020 2020 2020 2020 2020 616e                an
+00009960: 6420 7072 6f67 7265 7373 4361 6c6c 6261  d progressCallba
+00009970: 636b 2069 7320 6e6f 7420 4e6f 6e65 2065  ck is not None e
+00009980: 6c73 6520 7072 6f67 7265 7373 2e4e 4f4e  lse progress.NON
+00009990: 455f 4e4f 5449 4649 4552 0a0a 2020 2020  E_NOTIFIER..    
+000099a0: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+000099b0: 2020 6465 6620 5f67 6574 5f64 6174 6128    def _get_data(
+000099c0: 7265 7375 6c74 5772 6170 7065 722c 2064  resultWrapper, d
+000099d0: 6f77 6e6c 6f61 6450 6174 682c 2063 6875  ownloadPath, chu
+000099e0: 636b 5369 7a65 293a 0a20 2020 2020 2020  ckSize):.       
+000099f0: 206f 7269 6769 6e5f 6669 6c65 5f70 6174   origin_file_pat
+00009a00: 6820 3d20 646f 776e 6c6f 6164 5061 7468  h = downloadPath
+00009a10: 0a20 2020 2020 2020 2072 6561 645f 636f  .        read_co
+00009a20: 756e 7420 3d20 300a 2020 2020 2020 2020  unt = 0.        
+00009a30: 6966 2063 6f6e 7374 2e49 535f 5749 4e44  if const.IS_WIND
+00009a40: 4f57 533a 0a20 2020 2020 2020 2020 2020  OWS:.           
+00009a50: 2064 6f77 6e6c 6f61 6450 6174 6820 3d20   downloadPath = 
+00009a60: 7574 696c 2e73 6166 655f 7472 616e 735f  util.safe_trans_
+00009a70: 746f 5f67 6232 3331 3228 646f 776e 6c6f  to_gb2312(downlo
+00009a80: 6164 5061 7468 290a 2020 2020 2020 2020  adPath).        
+00009a90: 7061 7468 4469 7220 3d20 6f73 2e70 6174  pathDir = os.pat
+00009aa0: 682e 6469 726e 616d 6528 646f 776e 6c6f  h.dirname(downlo
+00009ab0: 6164 5061 7468 290a 2020 2020 2020 2020  adPath).        
+00009ac0: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
+00009ad0: 7869 7374 7328 7061 7468 4469 7229 3a0a  xists(pathDir):.
+00009ae0: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
+00009af0: 616b 6564 6972 7328 7061 7468 4469 722c  akedirs(pathDir,
+00009b00: 2030 6f37 3535 290a 0a20 2020 2020 2020   0o755)..       
+00009b10: 206d 6f64 6573 203d 2073 7461 742e 535f   modes = stat.S_
+00009b20: 4957 5553 5220 7c20 7374 6174 2e53 5f49  IWUSR | stat.S_I
+00009b30: 5255 5352 0a20 2020 2020 2020 2066 6c61  RUSR.        fla
+00009b40: 6773 203d 206f 732e 4f5f 5244 5752 207c  gs = os.O_RDWR |
+00009b50: 206f 732e 4f5f 5452 554e 4320 7c20 6f73   os.O_TRUNC | os
+00009b60: 2e4f 5f43 5245 4154 0a20 2020 2020 2020  .O_CREAT.       
+00009b70: 2077 6974 6820 6f73 2e66 646f 7065 6e28   with os.fdopen(
+00009b80: 6f73 2e6f 7065 6e28 646f 776e 6c6f 6164  os.open(download
+00009b90: 5061 7468 2c20 666c 6167 732c 206d 6f64  Path, flags, mod
+00009ba0: 6573 292c 2027 7762 2729 2061 7320 663a  es), 'wb') as f:
+00009bb0: 0a20 2020 2020 2020 2020 2020 2077 6869  .            whi
+00009bc0: 6c65 2054 7275 653a 0a20 2020 2020 2020  le True:.       
+00009bd0: 2020 2020 2020 2020 2063 6875 6e6b 203d           chunk =
+00009be0: 2072 6573 756c 7457 7261 7070 6572 2e72   resultWrapper.r
+00009bf0: 6561 6428 6368 7563 6b53 697a 6529 0a20  ead(chuckSize). 
+00009c00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00009c10: 6620 6e6f 7420 6368 756e 6b3a 0a20 2020  f not chunk:.   
+00009c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c30: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+00009c40: 2020 2020 2020 2066 2e77 7269 7465 2863         f.write(c
+00009c50: 6875 6e6b 290a 2020 2020 2020 2020 2020  hunk).          
+00009c60: 2020 2020 2020 7265 6164 5f63 6f75 6e74        read_count
+00009c70: 202b 3d20 6c65 6e28 6368 756e 6b29 0a20   += len(chunk). 
+00009c80: 2020 2020 2020 2072 6574 7572 6e20 6f72         return or
+00009c90: 6967 696e 5f66 696c 655f 7061 7468 2c20  igin_file_path, 
+00009ca0: 7265 6164 5f63 6f75 6e74 0a0a 2020 2020  read_count..    
+00009cb0: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+00009cc0: 2020 6465 6620 5f72 656e 616d 655f 6b65    def _rename_ke
+00009cd0: 7928 6b2c 2076 293a 0a20 2020 2020 2020  y(k, v):.       
+00009ce0: 2066 6c61 6720 3d20 300a 2020 2020 2020   flag = 0.      
+00009cf0: 2020 6966 206b 2e73 7461 7274 7377 6974    if k.startswit
+00009d00: 6828 636f 6e73 742e 5632 5f4d 4554 415f  h(const.V2_META_
+00009d10: 4845 4144 4552 5f50 5245 4649 5829 3a0a  HEADER_PREFIX):.
+00009d20: 2020 2020 2020 2020 2020 2020 6b20 3d20              k = 
+00009d30: 6b5b 6b2e 696e 6465 7828 636f 6e73 742e  k[k.index(const.
+00009d40: 5632 5f4d 4554 415f 4845 4144 4552 5f50  V2_META_HEADER_P
+00009d50: 5245 4649 5829 202b 206c 656e 2863 6f6e  REFIX) + len(con
+00009d60: 7374 2e56 325f 4d45 5441 5f48 4541 4445  st.V2_META_HEADE
+00009d70: 525f 5052 4546 4958 293a 5d0a 2020 2020  R_PREFIX):].    
+00009d80: 2020 2020 2020 2020 6b20 3d20 7574 696c          k = util
+00009d90: 2e64 6563 6f64 655f 6974 656d 286b 290a  .decode_item(k).
+00009da0: 2020 2020 2020 2020 2020 2020 7620 3d20              v = 
+00009db0: 7574 696c 2e64 6563 6f64 655f 6974 656d  util.decode_item
+00009dc0: 2876 290a 2020 2020 2020 2020 2020 2020  (v).            
+00009dd0: 666c 6167 203d 2031 0a20 2020 2020 2020  flag = 1.       
+00009de0: 2065 6c69 6620 6b2e 7374 6172 7473 7769   elif k.startswi
+00009df0: 7468 2863 6f6e 7374 2e56 325f 4845 4144  th(const.V2_HEAD
+00009e00: 4552 5f50 5245 4649 5829 3a0a 2020 2020  ER_PREFIX):.    
+00009e10: 2020 2020 2020 2020 6b20 3d20 6b5b 6b2e          k = k[k.
+00009e20: 696e 6465 7828 636f 6e73 742e 5632 5f48  index(const.V2_H
+00009e30: 4541 4445 525f 5052 4546 4958 2920 2b20  EADER_PREFIX) + 
+00009e40: 6c65 6e28 636f 6e73 742e 5632 5f48 4541  len(const.V2_HEA
+00009e50: 4445 525f 5052 4546 4958 293a 5d0a 2020  DER_PREFIX):].  
+00009e60: 2020 2020 2020 2020 2020 7620 3d20 7574            v = ut
+00009e70: 696c 2e64 6563 6f64 655f 6974 656d 2876  il.decode_item(v
+00009e80: 290a 2020 2020 2020 2020 2020 2020 666c  ).            fl
+00009e90: 6167 203d 2031 0a20 2020 2020 2020 2065  ag = 1.        e
+00009ea0: 6c69 6620 6b2e 7374 6172 7473 7769 7468  lif k.startswith
+00009eb0: 2863 6f6e 7374 2e4f 4253 5f4d 4554 415f  (const.OBS_META_
+00009ec0: 4845 4144 4552 5f50 5245 4649 5829 3a0a  HEADER_PREFIX):.
+00009ed0: 2020 2020 2020 2020 2020 2020 6b20 3d20              k = 
+00009ee0: 6b5b 6b2e 696e 6465 7828 636f 6e73 742e  k[k.index(const.
+00009ef0: 4f42 535f 4d45 5441 5f48 4541 4445 525f  OBS_META_HEADER_
+00009f00: 5052 4546 4958 2920 2b20 6c65 6e28 636f  PREFIX) + len(co
+00009f10: 6e73 742e 4f42 535f 4d45 5441 5f48 4541  nst.OBS_META_HEA
+00009f20: 4445 525f 5052 4546 4958 293a 5d0a 2020  DER_PREFIX):].  
+00009f30: 2020 2020 2020 2020 2020 6b20 3d20 7574            k = ut
+00009f40: 696c 2e64 6563 6f64 655f 6974 656d 286b  il.decode_item(k
+00009f50: 290a 2020 2020 2020 2020 2020 2020 7620  ).            v 
+00009f60: 3d20 7574 696c 2e64 6563 6f64 655f 6974  = util.decode_it
+00009f70: 656d 2876 290a 2020 2020 2020 2020 2020  em(v).          
+00009f80: 2020 666c 6167 203d 2031 0a20 2020 2020    flag = 1.     
+00009f90: 2020 2065 6c69 6620 6b2e 7374 6172 7473     elif k.starts
+00009fa0: 7769 7468 2863 6f6e 7374 2e4f 4253 5f48  with(const.OBS_H
+00009fb0: 4541 4445 525f 5052 4546 4958 293a 0a20  EADER_PREFIX):. 
+00009fc0: 2020 2020 2020 2020 2020 206b 203d 206b             k = k
+00009fd0: 5b6b 2e69 6e64 6578 2863 6f6e 7374 2e4f  [k.index(const.O
+00009fe0: 4253 5f48 4541 4445 525f 5052 4546 4958  BS_HEADER_PREFIX
+00009ff0: 2920 2b20 6c65 6e28 636f 6e73 742e 4f42  ) + len(const.OB
+0000a000: 535f 4845 4144 4552 5f50 5245 4649 5829  S_HEADER_PREFIX)
+0000a010: 3a5d 0a20 2020 2020 2020 2020 2020 2076  :].            v
+0000a020: 203d 2075 7469 6c2e 6465 636f 6465 5f69   = util.decode_i
+0000a030: 7465 6d28 7629 0a20 2020 2020 2020 2020  tem(v).         
+0000a040: 2020 2066 6c61 6720 3d20 310a 2020 2020     flag = 1.    
+0000a050: 2020 2020 7265 7475 726e 2066 6c61 672c      return flag,
+0000a060: 206b 2c20 760a 0a20 2020 2064 6566 205f   k, v..    def _
+0000a070: 7265 6e61 6d65 5f72 6573 706f 6e73 655f  rename_response_
+0000a080: 6865 6164 6572 7328 7365 6c66 2c20 6865  headers(self, he
+0000a090: 6164 6572 7329 3a0a 2020 2020 2020 2020  aders):.        
+0000a0a0: 6865 6164 6572 203d 205b 5d0a 2020 2020  header = [].    
+0000a0b0: 2020 2020 666f 7220 6b2c 2076 2069 6e20      for k, v in 
+0000a0c0: 6865 6164 6572 732e 6974 656d 7328 293a  headers.items():
+0000a0d0: 0a20 2020 2020 2020 2020 2020 2066 6c61  .            fla
+0000a0e0: 6720 3d20 300a 2020 2020 2020 2020 2020  g = 0.          
+0000a0f0: 2020 6966 206b 2069 6e20 636f 6e73 742e    if k in const.
+0000a100: 414c 4c4f 5745 445f 5245 5350 4f4e 5345  ALLOWED_RESPONSE
+0000a110: 5f48 5454 505f 4845 4144 4552 5f4d 4554  _HTTP_HEADER_MET
+0000a120: 4144 4154 415f 4e41 4d45 533a 0a20 2020  ADATA_NAMES:.   
+0000a130: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
+0000a140: 6720 3d20 310a 2020 2020 2020 2020 2020  g = 1.          
+0000a150: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000a160: 2020 2020 2020 2020 666c 6167 2c20 6b2c          flag, k,
+0000a170: 2076 203d 2073 656c 662e 5f72 656e 616d   v = self._renam
+0000a180: 655f 6b65 7928 6b2c 2076 290a 2020 2020  e_key(k, v).    
+0000a190: 2020 2020 2020 2020 6966 2066 6c61 673a          if flag:
+0000a1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a1b0: 2068 6561 6465 722e 6170 7065 6e64 2828   header.append((
+0000a1c0: 6b2c 2076 2929 0a20 2020 2020 2020 2072  k, v)).        r
+0000a1d0: 6574 7572 6e20 6865 6164 6572 0a0a 2020  eturn header..  
+0000a1e0: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
+0000a1f0: 2020 2020 6465 6620 5f70 7265 7061 7265      def _prepare
+0000a200: 5f72 6573 706f 6e73 655f 6461 7461 2872  _response_data(r
+0000a210: 6573 756c 742c 2063 6875 636b 5369 7a65  esult, chuckSize
+0000a220: 293a 0a20 2020 2020 2020 2072 6573 706f  ):.        respo
+0000a230: 6e73 6544 6174 6120 3d20 4e6f 6e65 0a20  nseData = None. 
+0000a240: 2020 2020 2020 2077 6869 6c65 2054 7275         while Tru
+0000a250: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
+0000a260: 6875 6e6b 203d 2072 6573 756c 742e 7265  hunk = result.re
+0000a270: 6164 2863 6875 636b 5369 7a65 290a 2020  ad(chuckSize).  
+0000a280: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000a290: 2063 6875 6e6b 3a0a 2020 2020 2020 2020   chunk:.        
+0000a2a0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+0000a2b0: 2020 2020 2020 2020 2020 7265 7370 6f6e            respon
+0000a2c0: 7365 4461 7461 203d 2063 6875 6e6b 2069  seData = chunk i
+0000a2d0: 6620 7265 7370 6f6e 7365 4461 7461 2069  f responseData i
+0000a2e0: 7320 4e6f 6e65 2065 6c73 6520 7265 7370  s None else resp
+0000a2f0: 6f6e 7365 4461 7461 202b 2063 6875 6e6b  onseData + chunk
+0000a300: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000a310: 7265 7370 6f6e 7365 4461 7461 0a0a 2020  responseData..  
+0000a320: 2020 6465 6620 5f70 7265 7061 7265 5f62    def _prepare_b
+0000a330: 6f64 7928 7365 6c66 2c20 6d65 7468 6f64  ody(self, method
+0000a340: 4e61 6d65 2c20 7265 7370 6f6e 7365 4461  Name, responseDa
+0000a350: 7461 2c20 6973 4a73 6f6e 2c20 6865 6164  ta, isJson, head
+0000a360: 6572 7329 3a0a 2020 2020 2020 2020 626f  ers):.        bo
+0000a370: 6479 203d 204e 6f6e 650a 2020 2020 2020  dy = None.      
+0000a380: 2020 6966 206d 6574 686f 644e 616d 6520    if methodName 
+0000a390: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000a3a0: 2020 2020 2020 2020 2070 6172 7365 4d65           parseMe
+0000a3b0: 7468 6f64 203d 2067 6574 6174 7472 2873  thod = getattr(s
+0000a3c0: 656c 662e 636f 6e76 6572 746f 722c 2027  elf.convertor, '
+0000a3d0: 7061 7273 6527 202b 206d 6574 686f 644e  parse' + methodN
+0000a3e0: 616d 655b 3a31 5d2e 7570 7065 7228 2920  ame[:1].upper() 
+0000a3f0: 2b20 6d65 7468 6f64 4e61 6d65 5b31 3a5d  + methodName[1:]
+0000a400: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000a410: 2070 6172 7365 4d65 7468 6f64 2069 7320   parseMethod is 
+0000a420: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0000a430: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+0000a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a450: 2020 2069 6620 7265 7370 6f6e 7365 4461     if responseDa
+0000a460: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+0000a470: 2020 2020 2020 2020 2020 2020 7265 7370              resp
+0000a480: 6f6e 7365 4461 7461 203d 2072 6573 706f  onseData = respo
+0000a490: 6e73 6544 6174 6120 6966 2063 6f6e 7374  nseData if const
+0000a4a0: 2e49 535f 5059 5448 4f4e 3220 656c 7365  .IS_PYTHON2 else
+0000a4b0: 2072 6573 706f 6e73 6544 6174 612e 6465   responseData.de
+0000a4c0: 636f 6465 2827 5554 462d 3827 290a 2020  code('UTF-8').  
+0000a4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4e0: 2020 2020 2020 7365 6c66 2e6c 6f67 5f63        self.log_c
+0000a4f0: 6c69 656e 742e 6c6f 6728 4445 4255 472c  lient.log(DEBUG,
+0000a500: 2027 7265 6365 6976 6520 4d73 673a 2573   'receive Msg:%s
+0000a510: 272c 2072 6573 706f 6e73 6544 6174 6129  ', responseData)
+0000a520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a530: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0000a540: 6973 4a73 6f6e 3a0a 2020 2020 2020 2020  isJson:.        
+0000a550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a560: 2020 2020 7365 6172 6368 203d 2073 656c      search = sel
+0000a570: 662e 7061 7474 6572 6e2e 7365 6172 6368  f.pattern.search
+0000a580: 2872 6573 706f 6e73 6544 6174 6129 0a20  (responseData). 
 0000a590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5b0: 2020 2020 2027 2729 0a20 2020 2020 2020       '').       
-0000a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5d0: 2062 6f64 7920 3d20 7061 7273 654d 6574   body = parseMet
-0000a5e0: 686f 6428 7265 7370 6f6e 7365 4461 7461  hod(responseData
-0000a5f0: 2c20 6865 6164 6572 7329 0a20 2020 2020  , headers).     
-0000a600: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000a610: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000a620: 2020 2020 2020 2020 2020 2020 2062 6f64               bod
-0000a630: 7920 3d20 7061 7273 654d 6574 686f 6428  y = parseMethod(
-0000a640: 6865 6164 6572 7329 0a20 2020 2020 2020  headers).       
-0000a650: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-0000a660: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
+0000a5a0: 2020 2020 2020 2020 2020 2072 6573 706f             respo
+0000a5b0: 6e73 6544 6174 6120 3d20 7265 7370 6f6e  nseData = respon
+0000a5c0: 7365 4461 7461 2069 6620 7365 6172 6368  seData if search
+0000a5d0: 2069 7320 4e6f 6e65 2065 6c73 6520 7265   is None else re
+0000a5e0: 7370 6f6e 7365 4461 7461 2e72 6570 6c61  sponseData.repla
+0000a5f0: 6365 2873 6561 7263 682e 6772 6f75 7028  ce(search.group(
+0000a600: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0000a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a660: 2020 2020 2020 2027 2729 0a20 2020 2020         '').     
 0000a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a680: 2020 2020 7365 6c66 2e6c 6f67 5f63 6c69      self.log_cli
-0000a690: 656e 742e 6c6f 6728 4552 524f 522c 2075  ent.log(ERROR, u
-0000a6a0: 7469 6c2e 746f 5f73 7472 696e 6728 6529  til.to_string(e)
-0000a6b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000a6c0: 2020 2020 2020 7365 6c66 2e6c 6f67 5f63        self.log_c
-0000a6d0: 6c69 656e 742e 6c6f 6728 4552 524f 522c  lient.log(ERROR,
-0000a6e0: 2074 7261 6365 6261 636b 2e66 6f72 6d61   traceback.forma
-0000a6f0: 745f 6578 6328 2929 0a20 2020 2020 2020  t_exc()).       
-0000a700: 2072 6574 7572 6e20 7265 7370 6f6e 7365   return response
-0000a710: 4461 7461 2c20 626f 6479 0a0a 2020 2020  Data, body..    
-0000a720: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
-0000a730: 2020 6465 6620 5f70 7265 7061 7265 5f72    def _prepare_r
-0000a740: 6571 7565 7374 5f69 6428 7265 7175 6573  equest_id(reques
-0000a750: 7449 642c 2068 6561 6465 7273 293a 0a20  tId, headers):. 
-0000a760: 2020 2020 2020 2069 6620 7265 7175 6573         if reques
-0000a770: 7449 6420 6973 204e 6f6e 653a 0a20 2020  tId is None:.   
-0000a780: 2020 2020 2020 2020 2072 6571 7565 7374           request
-0000a790: 4964 203d 2068 6561 6465 7273 2e67 6574  Id = headers.get
-0000a7a0: 2827 782d 6f62 732d 7265 7175 6573 742d  ('x-obs-request-
-0000a7b0: 6964 2729 0a20 2020 2020 2020 2069 6620  id').        if 
-0000a7c0: 7265 7175 6573 7449 6420 6973 204e 6f6e  requestId is Non
-0000a7d0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0000a7e0: 6571 7565 7374 4964 203d 2068 6561 6465  equestId = heade
-0000a7f0: 7273 2e67 6574 2827 782d 616d 7a2d 7265  rs.get('x-amz-re
-0000a800: 7175 6573 742d 6964 2729 0a20 2020 2020  quest-id').     
-0000a810: 2020 2072 6574 7572 6e20 7265 7175 6573     return reques
-0000a820: 7449 640a 0a20 2020 2040 7374 6174 6963  tId..    @static
-0000a830: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
-0000a840: 6973 5f72 6564 6972 6563 745f 6578 6365  is_redirect_exce
-0000a850: 7074 696f 6e28 7374 6174 7573 2c20 6865  ption(status, he
-0000a860: 6164 6572 7329 3a0a 2020 2020 2020 2020  aders):.        
-0000a870: 7265 7475 726e 2033 3030 203c 3d20 7374  return 300 <= st
-0000a880: 6174 7573 203c 2034 3030 2061 6e64 2073  atus < 400 and s
-0000a890: 7461 7475 7320 213d 2033 3034 2061 6e64  tatus != 304 and
-0000a8a0: 2063 6f6e 7374 2e4c 4f43 4154 494f 4e5f   const.LOCATION_
-0000a8b0: 4845 4144 4552 2e6c 6f77 6572 2829 2069  HEADER.lower() i
-0000a8c0: 6e20 6865 6164 6572 730a 0a20 2020 2064  n headers..    d
-0000a8d0: 6566 205f 7061 7273 655f 786d 6c5f 696e  ef _parse_xml_in
-0000a8e0: 7465 726e 616c 2873 656c 662c 2072 6573  ternal(self, res
-0000a8f0: 756c 742c 206d 6574 686f 644e 616d 653d  ult, methodName=
-0000a900: 4e6f 6e65 2c20 6368 7563 6b53 697a 653d  None, chuckSize=
-0000a910: 636f 6e73 742e 5245 4144 5f4f 4e43 455f  const.READ_ONCE_
-0000a920: 4c45 4e47 5448 2c20 7265 6164 6162 6c65  LENGTH, readable
-0000a930: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-0000a940: 2073 7461 7475 7320 3d20 7574 696c 2e74   status = util.t
-0000a950: 6f5f 696e 7428 7265 7375 6c74 2e73 7461  o_int(result.sta
-0000a960: 7475 7329 0a20 2020 2020 2020 2072 6561  tus).        rea
-0000a970: 736f 6e20 3d20 7265 7375 6c74 2e72 6561  son = result.rea
-0000a980: 736f 6e0a 2020 2020 2020 2020 636f 6465  son.        code
-0000a990: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-0000a9a0: 6d65 7373 6167 6520 3d20 4e6f 6e65 0a20  message = None. 
-0000a9b0: 2020 2020 2020 2062 6f64 7920 3d20 4e6f         body = No
-0000a9c0: 6e65 0a20 2020 2020 2020 2072 6571 7565  ne.        reque
-0000a9d0: 7374 4964 203d 204e 6f6e 650a 2020 2020  stId = None.    
-0000a9e0: 2020 2020 686f 7374 4964 203d 204e 6f6e      hostId = Non
-0000a9f0: 650a 2020 2020 2020 2020 7265 736f 7572  e.        resour
-0000aa00: 6365 203d 204e 6f6e 650a 2020 2020 2020  ce = None.      
-0000aa10: 2020 6865 6164 6572 7320 3d20 7b7d 0a20    headers = {}. 
-0000aa20: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-0000aa30: 696e 2072 6573 756c 742e 6765 7468 6561  in result.gethea
-0000aa40: 6465 7273 2829 3a0a 2020 2020 2020 2020  ders():.        
-0000aa50: 2020 2020 6865 6164 6572 735b 6b2e 6c6f      headers[k.lo
-0000aa60: 7765 7228 295d 203d 2076 0a20 2020 2020  wer()] = v.     
-0000aa70: 2020 2072 6573 706f 6e73 6544 6174 6120     responseData 
-0000aa80: 3d20 7365 6c66 2e5f 7072 6570 6172 655f  = self._prepare_
-0000aa90: 7265 7370 6f6e 7365 5f64 6174 6128 7265  response_data(re
-0000aaa0: 7375 6c74 2c20 6368 7563 6b53 697a 6529  sult, chuckSize)
-0000aab0: 0a0a 2020 2020 2020 2020 6865 6164 6572  ..        header
-0000aac0: 203d 2073 656c 662e 5f72 656e 616d 655f   = self._rename_
-0000aad0: 7265 7370 6f6e 7365 5f68 6561 6465 7273  response_headers
-0000aae0: 2868 6561 6465 7273 290a 2020 2020 2020  (headers).      
-0000aaf0: 2020 6973 4a73 6f6e 203d 2068 6561 6465    isJson = heade
-0000ab00: 7273 2e67 6574 2863 6f6e 7374 2e43 4f4e  rs.get(const.CON
-0000ab10: 5445 4e54 5f54 5950 455f 4845 4144 4552  TENT_TYPE_HEADER
-0000ab20: 2e6c 6f77 6572 2829 2c20 2778 6d6c 2729  .lower(), 'xml')
-0000ab30: 203d 3d20 636f 6e73 742e 4d49 4d45 5f54   == const.MIME_T
-0000ab40: 5950 4553 2e67 6574 2827 6a73 6f6e 2729  YPES.get('json')
-0000ab50: 0a20 2020 2020 2020 2069 6e64 6963 6174  .        indicat
-0000ab60: 6f72 203d 2068 6561 6465 7273 2e67 6574  or = headers.get
-0000ab70: 2873 656c 662e 6861 2e69 6e64 6963 6174  (self.ha.indicat
-0000ab80: 6f72 5f68 6561 6465 7228 2929 0a0a 2020  or_header())..  
-0000ab90: 2020 2020 2020 6966 2073 7461 7475 7320        if status 
-0000aba0: 3c20 3330 303a 0a20 2020 2020 2020 2020  < 300:.         
-0000abb0: 2020 2072 6573 706f 6e73 6544 6174 612c     responseData,
-0000abc0: 2062 6f64 7920 3d20 7365 6c66 2e5f 7072   body = self._pr
-0000abd0: 6570 6172 655f 626f 6479 286d 6574 686f  epare_body(metho
-0000abe0: 644e 616d 652c 2072 6573 706f 6e73 6544  dName, responseD
-0000abf0: 6174 612c 2069 734a 736f 6e2c 2068 6561  ata, isJson, hea
-0000ac00: 6465 7273 290a 2020 2020 2020 2020 2020  ders).          
-0000ac10: 2020 7265 7175 6573 7449 6420 3d20 7365    requestId = se
-0000ac20: 6c66 2e5f 7072 6570 6172 655f 7265 7175  lf._prepare_requ
-0000ac30: 6573 745f 6964 284e 6f6e 652c 2068 6561  est_id(None, hea
-0000ac40: 6465 7273 290a 0a20 2020 2020 2020 2065  ders)..        e
-0000ac50: 6c69 6620 7265 7370 6f6e 7365 4461 7461  lif responseData
-0000ac60: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000ac70: 7370 6f6e 7365 4461 7461 203d 2072 6573  sponseData = res
-0000ac80: 706f 6e73 6544 6174 6120 6966 2063 6f6e  ponseData if con
-0000ac90: 7374 2e49 535f 5059 5448 4f4e 3220 656c  st.IS_PYTHON2 el
-0000aca0: 7365 2072 6573 706f 6e73 6544 6174 612e  se responseData.
-0000acb0: 6465 636f 6465 2827 5554 462d 3827 290a  decode('UTF-8').
-0000acc0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-0000acd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ace0: 2069 6620 6973 4a73 6f6e 3a0a 2020 2020   if isJson:.    
-0000acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad00: 636f 6465 2c20 6d65 7373 6167 652c 2072  code, message, r
-0000ad10: 6571 7565 7374 4964 203d 2073 656c 662e  equestId = self.
-0000ad20: 636f 6e76 6572 746f 722e 7061 7273 654a  convertor.parseJ
-0000ad30: 736f 6e45 7272 6f72 5265 7375 6c74 2872  sonErrorResult(r
-0000ad40: 6573 706f 6e73 6544 6174 6129 0a20 2020  esponseData).   
-0000ad50: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0000ad60: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000ad70: 2020 2020 2020 2073 6561 7263 6820 3d20         search = 
-0000ad80: 7365 6c66 2e70 6174 7465 726e 2e73 6561  self.pattern.sea
-0000ad90: 7263 6828 7265 7370 6f6e 7365 4461 7461  rch(responseData
-0000ada0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000adb0: 2020 2020 2020 7265 7370 6f6e 7365 4461        responseDa
-0000adc0: 7461 203d 2072 6573 706f 6e73 6544 6174  ta = responseDat
-0000add0: 6120 6966 2073 6561 7263 6820 6973 204e  a if search is N
-0000ade0: 6f6e 6520 656c 7365 2072 6573 706f 6e73  one else respons
-0000adf0: 6544 6174 612e 7265 706c 6163 6528 7365  eData.replace(se
-0000ae00: 6172 6368 2e67 726f 7570 2829 2c20 2727  arch.group(), ''
-0000ae10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000ae20: 2020 2020 2020 636f 6465 2c20 6d65 7373        code, mess
-0000ae30: 6167 652c 2072 6571 7565 7374 4964 2c20  age, requestId, 
-0000ae40: 686f 7374 4964 2c20 7265 736f 7572 6365  hostId, resource
-0000ae50: 203d 2073 656c 662e 636f 6e76 6572 746f   = self.converto
-0000ae60: 722e 7061 7273 6545 7272 6f72 5265 7375  r.parseErrorResu
-0000ae70: 6c74 2872 6573 706f 6e73 6544 6174 6129  lt(responseData)
-0000ae80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ae90: 2062 6f64 7920 3d20 7265 7370 6f6e 7365   body = response
-0000aea0: 4461 7461 0a20 2020 2020 2020 2020 2020  Data.           
-0000aeb0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-0000aec0: 6e20 6173 2065 653a 0a20 2020 2020 2020  n as ee:.       
-0000aed0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-0000aee0: 675f 636c 6965 6e74 2e6c 6f67 2845 5252  g_client.log(ERR
-0000aef0: 4f52 2c20 7574 696c 2e74 6f5f 7374 7269  OR, util.to_stri
-0000af00: 6e67 2865 6529 290a 2020 2020 2020 2020  ng(ee)).        
-0000af10: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-0000af20: 5f63 6c69 656e 742e 6c6f 6728 4552 524f  _client.log(ERRO
-0000af30: 522c 2074 7261 6365 6261 636b 2e66 6f72  R, traceback.for
-0000af40: 6d61 745f 6578 6328 2929 0a0a 2020 2020  mat_exc())..    
-0000af50: 2020 2020 7265 7175 6573 7449 6420 3d20      requestId = 
-0000af60: 7365 6c66 2e5f 7072 6570 6172 655f 7265  self._prepare_re
-0000af70: 7175 6573 745f 6964 2872 6571 7565 7374  quest_id(request
-0000af80: 4964 2c20 6865 6164 6572 7329 0a0a 2020  Id, headers)..  
-0000af90: 2020 2020 2020 7365 6c66 2e6c 6f67 5f63        self.log_c
-0000afa0: 6c69 656e 742e 6c6f 6728 4445 4255 472c  lient.log(DEBUG,
-0000afb0: 2027 6874 7470 2072 6573 706f 6e73 6520   'http response 
-0000afc0: 7265 7375 6c74 3a73 7461 7475 733a 2564  result:status:%d
-0000afd0: 2c72 6561 736f 6e3a 2573 2c63 6f64 653a  ,reason:%s,code:
-0000afe0: 2573 2c6d 6573 7361 6765 3a25 732c 6865  %s,message:%s,he
-0000aff0: 6164 6572 733a 2573 272c 0a20 2020 2020  aders:%s',.     
-0000b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b010: 2020 2020 2020 2073 7461 7475 732c 2072         status, r
-0000b020: 6561 736f 6e2c 2063 6f64 652c 206d 6573  eason, code, mes
-0000b030: 7361 6765 2c20 6865 6164 6572 290a 0a20  sage, header).. 
-0000b040: 2020 2020 2020 2069 6620 7374 6174 7573         if status
-0000b050: 203e 3d20 3330 303a 0a20 2020 2020 2020   >= 300:.       
-0000b060: 2020 2020 2073 656c 662e 6c6f 675f 636c       self.log_cl
-0000b070: 6965 6e74 2e6c 6f67 2845 5252 4f52 2c20  ient.log(ERROR, 
-0000b080: 2765 7863 6570 7469 6f6e 616c 206f 6273  'exceptional obs
-0000b090: 2072 6573 706f 6e73 653a 7374 6174 7573   response:status
-0000b0a0: 3a25 642c 7265 6173 6f6e 3a25 732c 636f  :%d,reason:%s,co
-0000b0b0: 6465 3a25 732c 6d65 7373 6167 653a 2573  de:%s,message:%s
-0000b0c0: 2c72 6571 7565 7374 4964 3a25 7327 2c0a  ,requestId:%s',.
-0000b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0f0: 7374 6174 7573 2c20 7265 6173 6f6e 2c20  status, reason, 
-0000b100: 636f 6465 2c20 6d65 7373 6167 652c 2072  code, message, r
-0000b110: 6571 7565 7374 4964 290a 0a20 2020 2020  equestId)..     
-0000b120: 2020 2072 6574 203d 2047 6574 5265 7375     ret = GetResu
-0000b130: 6c74 2863 6f64 653d 636f 6465 2c20 6d65  lt(code=code, me
-0000b140: 7373 6167 653d 6d65 7373 6167 652c 2073  ssage=message, s
-0000b150: 7461 7475 733d 7374 6174 7573 2c20 7265  tatus=status, re
-0000b160: 6173 6f6e 3d72 6561 736f 6e2c 2062 6f64  ason=reason, bod
-0000b170: 793d 626f 6479 2c0a 2020 2020 2020 2020  y=body,.        
-0000b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b190: 7265 7175 6573 7449 643d 7265 7175 6573  requestId=reques
-0000b1a0: 7449 642c 2068 6f73 7449 643d 686f 7374  tId, hostId=host
-0000b1b0: 4964 2c20 7265 736f 7572 6365 3d72 6573  Id, resource=res
-0000b1c0: 6f75 7263 652c 2068 6561 6465 723d 6865  ource, header=he
-0000b1d0: 6164 6572 2c20 696e 6469 6361 746f 723d  ader, indicator=
-0000b1e0: 696e 6469 6361 746f 7229 0a0a 2020 2020  indicator)..    
-0000b1f0: 2020 2020 6966 206e 6f74 2072 6561 6461      if not reada
-0000b200: 626c 653a 0a20 2020 2020 2020 2020 2020  ble:.           
-0000b210: 2069 6620 7365 6c66 2e5f 6973 5f72 6564   if self._is_red
-0000b220: 6972 6563 745f 6578 6365 7074 696f 6e28  irect_exception(
-0000b230: 7374 6174 7573 2c20 6865 6164 6572 7329  status, headers)
-0000b240: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000b250: 2020 6c6f 6361 7469 6f6e 203d 2068 6561    location = hea
-0000b260: 6465 7273 2e67 6574 2863 6f6e 7374 2e4c  ders.get(const.L
-0000b270: 4f43 4154 494f 4e5f 4845 4144 4552 2e6c  OCATION_HEADER.l
-0000b280: 6f77 6572 2829 290a 2020 2020 2020 2020  ower()).        
-0000b290: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-0000b2a0: 5f63 6c69 656e 742e 6c6f 6728 5741 524e  _client.log(WARN
-0000b2b0: 494e 472c 2027 6874 7470 2063 6f64 6520  ING, 'http code 
-0000b2c0: 6973 2025 642c 206e 6565 6420 746f 2072  is %d, need to r
-0000b2d0: 6564 6972 6563 7420 746f 2025 7327 2c20  edirect to %s', 
-0000b2e0: 7374 6174 7573 2c20 6c6f 6361 7469 6f6e  status, location
-0000b2f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000b300: 2020 7261 6973 6520 5f52 6564 6972 6563    raise _Redirec
-0000b310: 7445 7863 6570 7469 6f6e 2827 6874 7470  tException('http
-0000b320: 2063 6f64 6520 6973 207b 307d 2c20 6e65   code is {0}, ne
-0000b330: 6564 2074 6f20 7265 6469 7265 6374 2074  ed to redirect t
-0000b340: 6f20 7b31 7d27 2e66 6f72 6d61 7428 7374  o {1}'.format(st
-0000b350: 6174 7573 2c20 6c6f 6361 7469 6f6e 292c  atus, location),
-0000b360: 206c 6f63 6174 696f 6e2c 0a20 2020 2020   location,.     
-0000b370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b390: 2020 2020 7265 7429 0a0a 2020 2020 2020      ret)..      
-0000b3a0: 2020 2020 2020 6966 2073 7461 7475 7320        if status 
-0000b3b0: 3e3d 2035 3030 3a0a 2020 2020 2020 2020  >= 500:.        
-0000b3c0: 2020 2020 2020 2020 7261 6973 6520 5f49          raise _I
-0000b3d0: 6e74 6572 6e61 6c45 7863 6570 7469 6f6e  nternalException
-0000b3e0: 2872 6574 290a 2020 2020 2020 2020 7265  (ret).        re
-0000b3f0: 7475 726e 2072 6574 0a0a 0a63 6c61 7373  turn ret...class
-0000b400: 205f 4372 6561 7465 5369 676e 6564 5572   _CreateSignedUr
-0000b410: 6c52 6573 706f 6e73 6528 4261 7365 4d6f  lResponse(BaseMo
-0000b420: 6465 6c29 3a0a 2020 2020 616c 6c6f 7765  del):.    allowe
-0000b430: 6441 7474 7220 3d20 7b27 7369 676e 6564  dAttr = {'signed
-0000b440: 5572 6c27 3a20 636f 6e73 742e 4241 5345  Url': const.BASE
-0000b450: 5354 5249 4e47 2c20 2761 6374 7561 6c53  STRING, 'actualS
-0000b460: 6967 6e65 6452 6571 7565 7374 4865 6164  ignedRequestHead
-0000b470: 6572 7327 3a20 6469 6374 7d0a 0a0a 636c  ers': dict}...cl
-0000b480: 6173 7320 5f43 7265 6174 6550 6f73 7453  ass _CreatePostS
-0000b490: 6967 6e61 7475 7265 5265 7370 6f6e 7365  ignatureResponse
-0000b4a0: 2842 6173 654d 6f64 656c 293a 0a20 2020  (BaseModel):.   
-0000b4b0: 2061 6c6c 6f77 6564 4174 7472 203d 207b   allowedAttr = {
-0000b4c0: 276f 7269 6769 6e50 6f6c 6963 7927 3a20  'originPolicy': 
-0000b4d0: 636f 6e73 742e 4241 5345 5354 5249 4e47  const.BASESTRING
-0000b4e0: 2c20 2770 6f6c 6963 7927 3a20 636f 6e73  , 'policy': cons
-0000b4f0: 742e 4241 5345 5354 5249 4e47 2c0a 2020  t.BASESTRING,.  
-0000b500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b510: 2027 6372 6564 656e 7469 616c 273a 2063   'credential': c
-0000b520: 6f6e 7374 2e42 4153 4553 5452 494e 472c  onst.BASESTRING,
-0000b530: 2027 6461 7465 273a 2063 6f6e 7374 2e42   'date': const.B
-0000b540: 4153 4553 5452 494e 472c 2027 7369 676e  ASESTRING, 'sign
-0000b550: 6174 7572 6527 3a20 636f 6e73 742e 4241  ature': const.BA
-0000b560: 5345 5354 5249 4e47 2c0a 2020 2020 2020  SESTRING,.      
-0000b570: 2020 2020 2020 2020 2020 2020 2027 6163               'ac
-0000b580: 6365 7373 4b65 7949 6427 3a20 636f 6e73  cessKeyId': cons
-0000b590: 742e 4241 5345 5354 5249 4e47 7d0a 0a0a  t.BASESTRING}...
-0000b5a0: 636c 6173 7320 4f62 7343 6c69 656e 7428  class ObsClient(
-0000b5b0: 5f42 6173 6963 436c 6965 6e74 293a 0a0a  _BasicClient):..
-0000b5c0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-0000b5d0: 2873 656c 662c 202a 6172 6773 2c20 2a2a  (self, *args, **
-0000b5e0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-0000b5f0: 2073 7570 6572 284f 6273 436c 6965 6e74   super(ObsClient
-0000b600: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
-0000b610: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
-0000b620: 290a 0a20 2020 2064 6566 205f 7072 6570  )..    def _prep
-0000b630: 6172 6550 6172 616d 6574 6572 466f 7253  areParameterForS
-0000b640: 6967 6e65 6455 726c 2873 656c 662c 2073  ignedUrl(self, s
-0000b650: 7065 6369 616c 5061 7261 6d2c 2065 7870  pecialParam, exp
-0000b660: 6972 6573 2c20 6865 6164 6572 732c 2071  ires, headers, q
-0000b670: 7565 7279 5061 7261 6d73 293a 0a0a 2020  ueryParams):..  
-0000b680: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
-0000b690: 7b7d 2069 6620 6865 6164 6572 7320 6973  {} if headers is
-0000b6a0: 204e 6f6e 6520 6f72 206e 6f74 2069 7369   None or not isi
-0000b6b0: 6e73 7461 6e63 6528 6865 6164 6572 732c  nstance(headers,
-0000b6c0: 2064 6963 7429 2065 6c73 6520 6865 6164   dict) else head
-0000b6d0: 6572 732e 636f 7079 2829 0a20 2020 2020  ers.copy().     
-0000b6e0: 2020 2071 7565 7279 5061 7261 6d73 203d     queryParams =
-0000b6f0: 207b 7d20 6966 2071 7565 7279 5061 7261   {} if queryPara
-0000b700: 6d73 2069 7320 4e6f 6e65 206f 7220 6e6f  ms is None or no
-0000b710: 7420 6973 696e 7374 616e 6365 2871 7565  t isinstance(que
-0000b720: 7279 5061 7261 6d73 2c20 6469 6374 2920  ryParams, dict) 
-0000b730: 656c 7365 2071 7565 7279 5061 7261 6d73  else queryParams
-0000b740: 2e63 6f70 7928 290a 0a20 2020 2020 2020  .copy()..       
-0000b750: 205f 6865 6164 6572 7320 3d20 7b7d 0a20   _headers = {}. 
-0000b760: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-0000b770: 696e 2068 6561 6465 7273 2e69 7465 6d73  in headers.items
-0000b780: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0000b790: 6966 206b 2069 7320 6e6f 7420 4e6f 6e65  if k is not None
-0000b7a0: 2061 6e64 206b 2021 3d20 2727 3a0a 2020   and k != '':.  
-0000b7b0: 2020 2020 2020 2020 2020 2020 2020 5f68                _h
-0000b7c0: 6561 6465 7273 5b6b 5d20 3d20 760a 0a20  eaders[k] = v.. 
-0000b7d0: 2020 2020 2020 205f 7175 6572 7950 6172         _queryPar
-0000b7e0: 616d 7320 3d20 7365 6c66 2e5f 7072 6570  ams = self._prep
-0000b7f0: 6172 6550 6172 616d 6574 6572 466f 7253  areParameterForS
-0000b800: 6967 6e65 6455 726c 5175 6572 7928 7175  ignedUrlQuery(qu
-0000b810: 6572 7950 6172 616d 732c 2073 7065 6369  eryParams, speci
-0000b820: 616c 5061 7261 6d29 0a0a 2020 2020 2020  alParam)..      
-0000b830: 2020 6578 7069 7265 7320 3d20 3330 3020    expires = 300 
-0000b840: 6966 2065 7870 6972 6573 2069 7320 4e6f  if expires is No
-0000b850: 6e65 2065 6c73 6520 7574 696c 2e74 6f5f  ne else util.to_
-0000b860: 696e 7428 6578 7069 7265 7329 0a0a 2020  int(expires)..  
-0000b870: 2020 2020 2020 7265 7475 726e 205f 6865        return _he
-0000b880: 6164 6572 732c 205f 7175 6572 7950 6172  aders, _queryPar
-0000b890: 616d 732c 2065 7870 6972 6573 2c20 7365  ams, expires, se
-0000b8a0: 6c66 2e63 616c 6c69 6e67 5f66 6f72 6d61  lf.calling_forma
-0000b8b0: 740a 0a20 2020 2064 6566 205f 7072 6570  t..    def _prep
-0000b8c0: 6172 6550 6172 616d 6574 6572 466f 7253  areParameterForS
-0000b8d0: 6967 6e65 6455 726c 5175 6572 7928 7365  ignedUrlQuery(se
-0000b8e0: 6c66 2c20 7175 6572 7950 6172 616d 732c  lf, queryParams,
-0000b8f0: 2073 7065 6369 616c 5061 7261 6d29 3a0a   specialParam):.
-0000b900: 2020 2020 2020 2020 5f71 7565 7279 5061          _queryPa
-0000b910: 7261 6d73 203d 207b 7d0a 2020 2020 2020  rams = {}.      
-0000b920: 2020 666f 7220 6b2c 2076 2069 6e20 7175    for k, v in qu
-0000b930: 6572 7950 6172 616d 732e 6974 656d 7328  eryParams.items(
-0000b940: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-0000b950: 6620 6b20 6973 206e 6f74 204e 6f6e 6520  f k is not None 
-0000b960: 616e 6420 6b20 213d 2027 273a 0a20 2020  and k != '':.   
-0000b970: 2020 2020 2020 2020 2020 2020 205f 7175               _qu
-0000b980: 6572 7950 6172 616d 735b 6b5d 203d 2076  eryParams[k] = v
-0000b990: 0a0a 2020 2020 2020 2020 6966 2073 7065  ..        if spe
-0000b9a0: 6369 616c 5061 7261 6d20 6973 206e 6f74  cialParam is not
-0000b9b0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000b9c0: 2020 2073 7065 6369 616c 5061 7261 6d20     specialParam 
-0000b9d0: 3d20 2773 746f 7261 6765 436c 6173 7327  = 'storageClass'
-0000b9e0: 2069 6620 7365 6c66 2e73 6967 6e61 7475   if self.signatu
-0000b9f0: 7265 2e6c 6f77 6572 2829 203d 3d20 276f  re.lower() == 'o
-0000ba00: 6273 2720 616e 6420 7370 6563 6961 6c50  bs' and specialP
-0000ba10: 6172 616d 203d 3d20 2773 746f 7261 6765  aram == 'storage
-0000ba20: 506f 6c69 6379 2720 5c0a 2020 2020 2020  Policy' \.      
-0000ba30: 2020 2020 2020 2020 2020 656c 7365 2027            else '
-0000ba40: 7374 6f72 6167 6550 6f6c 6963 7927 2069  storagePolicy' i
-0000ba50: 6620 7365 6c66 2e73 6967 6e61 7475 7265  f self.signature
-0000ba60: 2e6c 6f77 6572 2829 2021 3d20 276f 6273  .lower() != 'obs
-0000ba70: 2720 616e 6420 7370 6563 6961 6c50 6172  ' and specialPar
-0000ba80: 616d 203d 3d20 2773 746f 7261 6765 436c  am == 'storageCl
-0000ba90: 6173 7327 205c 0a20 2020 2020 2020 2020  ass' \.         
-0000baa0: 2020 2020 2020 2065 6c73 6520 7370 6563         else spec
-0000bab0: 6961 6c50 6172 616d 0a20 2020 2020 2020  ialParam.       
-0000bac0: 2020 2020 205f 7175 6572 7950 6172 616d       _queryParam
-0000bad0: 735b 7370 6563 6961 6c50 6172 616d 5d20  s[specialParam] 
-0000bae0: 3d20 4e6f 6e65 0a0a 2020 2020 2020 2020  = None..        
-0000baf0: 7265 7475 726e 205f 7175 6572 7950 6172  return _queryPar
-0000bb00: 616d 730a 0a20 2020 2064 6566 2063 7265  ams..    def cre
-0000bb10: 6174 6553 6967 6e65 6455 726c 2873 656c  ateSignedUrl(sel
-0000bb20: 662c 206d 6574 686f 642c 2062 7563 6b65  f, method, bucke
-0000bb30: 744e 616d 653d 4e6f 6e65 2c20 6f62 6a65  tName=None, obje
-0000bb40: 6374 4b65 793d 4e6f 6e65 2c20 7370 6563  ctKey=None, spec
-0000bb50: 6961 6c50 6172 616d 3d4e 6f6e 652c 2065  ialParam=None, e
-0000bb60: 7870 6972 6573 3d33 3030 2c20 6865 6164  xpires=300, head
-0000bb70: 6572 733d 4e6f 6e65 2c0a 2020 2020 2020  ers=None,.      
-0000bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb90: 2020 7175 6572 7950 6172 616d 733d 4e6f    queryParams=No
-0000bba0: 6e65 293a 0a20 2020 2020 2020 2064 656c  ne):.        del
-0000bbb0: 6567 6174 6520 3d20 7365 6c66 2e5f 6372  egate = self._cr
-0000bbc0: 6561 7465 5634 5369 676e 6564 5572 6c20  eateV4SignedUrl 
-0000bbd0: 6966 2073 656c 662e 7369 676e 6174 7572  if self.signatur
-0000bbe0: 652e 6c6f 7765 7228 2920 3d3d 2027 7634  e.lower() == 'v4
-0000bbf0: 2720 656c 7365 2073 656c 662e 5f63 7265  ' else self._cre
-0000bc00: 6174 6556 3253 6967 6e65 6455 726c 0a20  ateV2SignedUrl. 
-0000bc10: 2020 2020 2020 2072 6574 7572 6e20 6465         return de
-0000bc20: 6c65 6761 7465 286d 6574 686f 642c 2062  legate(method, b
-0000bc30: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
-0000bc40: 744b 6579 2c20 7370 6563 6961 6c50 6172  tKey, specialPar
-0000bc50: 616d 2c20 6578 7069 7265 732c 2068 6561  am, expires, hea
-0000bc60: 6465 7273 2c20 7175 6572 7950 6172 616d  ders, queryParam
-0000bc70: 7329 0a0a 2020 2020 6465 6620 6372 6561  s)..    def crea
-0000bc80: 7465 5632 5369 676e 6564 5572 6c28 7365  teV2SignedUrl(se
-0000bc90: 6c66 2c20 6d65 7468 6f64 2c20 6275 636b  lf, method, buck
-0000bca0: 6574 4e61 6d65 3d4e 6f6e 652c 206f 626a  etName=None, obj
-0000bcb0: 6563 744b 6579 3d4e 6f6e 652c 2073 7065  ectKey=None, spe
-0000bcc0: 6369 616c 5061 7261 6d3d 4e6f 6e65 2c20  cialParam=None, 
-0000bcd0: 6578 7069 7265 733d 3330 302c 2068 6561  expires=300, hea
-0000bce0: 6465 7273 3d4e 6f6e 652c 0a20 2020 2020  ders=None,.     
-0000bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd00: 2020 2020 2071 7565 7279 5061 7261 6d73       queryParams
-0000bd10: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0000bd20: 7265 7475 726e 2073 656c 662e 5f63 7265  return self._cre
-0000bd30: 6174 6556 3253 6967 6e65 6455 726c 286d  ateV2SignedUrl(m
-0000bd40: 6574 686f 642c 2062 7563 6b65 744e 616d  ethod, bucketNam
-0000bd50: 652c 206f 626a 6563 744b 6579 2c20 7370  e, objectKey, sp
-0000bd60: 6563 6961 6c50 6172 616d 2c20 6578 7069  ecialParam, expi
-0000bd70: 7265 732c 2068 6561 6465 7273 2c20 7175  res, headers, qu
-0000bd80: 6572 7950 6172 616d 7329 0a0a 2020 2020  eryParams)..    
-0000bd90: 6465 6620 6372 6561 7465 5634 5369 676e  def createV4Sign
-0000bda0: 6564 5572 6c28 7365 6c66 2c20 6d65 7468  edUrl(self, meth
-0000bdb0: 6f64 2c20 6275 636b 6574 4e61 6d65 3d4e  od, bucketName=N
-0000bdc0: 6f6e 652c 206f 626a 6563 744b 6579 3d4e  one, objectKey=N
-0000bdd0: 6f6e 652c 2073 7065 6369 616c 5061 7261  one, specialPara
-0000bde0: 6d3d 4e6f 6e65 2c20 6578 7069 7265 733d  m=None, expires=
-0000bdf0: 3330 302c 2068 6561 6465 7273 3d4e 6f6e  300, headers=Non
-0000be00: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0000be10: 2020 2020 2020 2020 2020 2020 2071 7565               que
-0000be20: 7279 5061 7261 6d73 3d4e 6f6e 6529 3a0a  ryParams=None):.
-0000be30: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000be40: 656c 662e 5f63 7265 6174 6556 3453 6967  elf._createV4Sig
-0000be50: 6e65 6455 726c 286d 6574 686f 642c 2062  nedUrl(method, b
-0000be60: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
-0000be70: 744b 6579 2c20 7370 6563 6961 6c50 6172  tKey, specialPar
-0000be80: 616d 2c20 6578 7069 7265 732c 2068 6561  am, expires, hea
-0000be90: 6465 7273 2c20 7175 6572 7950 6172 616d  ders, queryParam
-0000bea0: 7329 0a0a 2020 2020 6465 6620 5f63 7265  s)..    def _cre
-0000beb0: 6174 6556 3253 6967 6e65 6455 726c 2873  ateV2SignedUrl(s
-0000bec0: 656c 662c 206d 6574 686f 642c 2062 7563  elf, method, buc
-0000bed0: 6b65 744e 616d 653d 4e6f 6e65 2c20 6f62  ketName=None, ob
-0000bee0: 6a65 6374 4b65 793d 4e6f 6e65 2c20 7370  jectKey=None, sp
-0000bef0: 6563 6961 6c50 6172 616d 3d4e 6f6e 652c  ecialParam=None,
-0000bf00: 2065 7870 6972 6573 3d33 3030 2c20 6865   expires=300, he
-0000bf10: 6164 6572 733d 4e6f 6e65 2c0a 2020 2020  aders=None,.    
-0000bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf30: 2020 2020 2020 2071 7565 7279 5061 7261         queryPara
-0000bf40: 6d73 3d4e 6f6e 6529 3a0a 0a20 2020 2020  ms=None):..     
-0000bf50: 2020 2068 6561 6465 7273 2c20 7175 6572     headers, quer
-0000bf60: 7950 6172 616d 732c 2065 7870 6972 6573  yParams, expires
-0000bf70: 2c20 6361 6c6c 696e 675f 666f 726d 6174  , calling_format
-0000bf80: 203d 2073 656c 662e 5f70 7265 7061 7265   = self._prepare
-0000bf90: 5061 7261 6d65 7465 7246 6f72 5369 676e  ParameterForSign
-0000bfa0: 6564 5572 6c28 7370 6563 6961 6c50 6172  edUrl(specialPar
-0000bfb0: 616d 2c20 6578 7069 7265 732c 0a20 2020  am, expires,.   
-0000bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a680: 2020 2062 6f64 7920 3d20 7061 7273 654d     body = parseM
+0000a690: 6574 686f 6428 7265 7370 6f6e 7365 4461  ethod(responseDa
+0000a6a0: 7461 2c20 6865 6164 6572 7329 0a20 2020  ta, headers).   
+0000a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000a6d0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0000a6e0: 6f64 7920 3d20 7061 7273 654d 6574 686f  ody = parseMetho
+0000a6f0: 6428 6865 6164 6572 7329 0a20 2020 2020  d(headers).     
+0000a700: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0000a710: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+0000a720: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000a730: 2020 2020 2020 7365 6c66 2e6c 6f67 5f63        self.log_c
+0000a740: 6c69 656e 742e 6c6f 6728 4552 524f 522c  lient.log(ERROR,
+0000a750: 2075 7469 6c2e 746f 5f73 7472 696e 6728   util.to_string(
+0000a760: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
+0000a770: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+0000a780: 5f63 6c69 656e 742e 6c6f 6728 4552 524f  _client.log(ERRO
+0000a790: 522c 2074 7261 6365 6261 636b 2e66 6f72  R, traceback.for
+0000a7a0: 6d61 745f 6578 6328 2929 0a20 2020 2020  mat_exc()).     
+0000a7b0: 2020 2072 6574 7572 6e20 7265 7370 6f6e     return respon
+0000a7c0: 7365 4461 7461 2c20 626f 6479 0a0a 2020  seData, body..  
+0000a7d0: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
+0000a7e0: 2020 2020 6465 6620 5f70 7265 7061 7265      def _prepare
+0000a7f0: 5f72 6571 7565 7374 5f69 6428 7265 7175  _request_id(requ
+0000a800: 6573 7449 642c 2068 6561 6465 7273 293a  estId, headers):
+0000a810: 0a20 2020 2020 2020 2069 6620 7265 7175  .        if requ
+0000a820: 6573 7449 6420 6973 204e 6f6e 653a 0a20  estId is None:. 
+0000a830: 2020 2020 2020 2020 2020 2072 6571 7565             reque
+0000a840: 7374 4964 203d 2068 6561 6465 7273 2e67  stId = headers.g
+0000a850: 6574 2827 782d 6f62 732d 7265 7175 6573  et('x-obs-reques
+0000a860: 742d 6964 2729 0a20 2020 2020 2020 2069  t-id').        i
+0000a870: 6620 7265 7175 6573 7449 6420 6973 204e  f requestId is N
+0000a880: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000a890: 2072 6571 7565 7374 4964 203d 2068 6561   requestId = hea
+0000a8a0: 6465 7273 2e67 6574 2827 782d 616d 7a2d  ders.get('x-amz-
+0000a8b0: 7265 7175 6573 742d 6964 2729 0a20 2020  request-id').   
+0000a8c0: 2020 2020 2072 6574 7572 6e20 7265 7175       return requ
+0000a8d0: 6573 7449 640a 0a20 2020 2040 7374 6174  estId..    @stat
+0000a8e0: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+0000a8f0: 205f 6973 5f72 6564 6972 6563 745f 6578   _is_redirect_ex
+0000a900: 6365 7074 696f 6e28 7374 6174 7573 2c20  ception(status, 
+0000a910: 6865 6164 6572 7329 3a0a 2020 2020 2020  headers):.      
+0000a920: 2020 7265 7475 726e 2033 3030 203c 3d20    return 300 <= 
+0000a930: 7374 6174 7573 203c 2034 3030 2061 6e64  status < 400 and
+0000a940: 2073 7461 7475 7320 213d 2033 3034 2061   status != 304 a
+0000a950: 6e64 2063 6f6e 7374 2e4c 4f43 4154 494f  nd const.LOCATIO
+0000a960: 4e5f 4845 4144 4552 2e6c 6f77 6572 2829  N_HEADER.lower()
+0000a970: 2069 6e20 6865 6164 6572 730a 0a20 2020   in headers..   
+0000a980: 2064 6566 205f 7061 7273 655f 786d 6c5f   def _parse_xml_
+0000a990: 696e 7465 726e 616c 2873 656c 662c 2072  internal(self, r
+0000a9a0: 6573 756c 742c 206d 6574 686f 644e 616d  esult, methodNam
+0000a9b0: 653d 4e6f 6e65 2c20 6368 7563 6b53 697a  e=None, chuckSiz
+0000a9c0: 653d 636f 6e73 742e 5245 4144 5f4f 4e43  e=const.READ_ONC
+0000a9d0: 455f 4c45 4e47 5448 2c20 7265 6164 6162  E_LENGTH, readab
+0000a9e0: 6c65 3d46 616c 7365 293a 0a20 2020 2020  le=False):.     
+0000a9f0: 2020 2073 7461 7475 7320 3d20 7574 696c     status = util
+0000aa00: 2e74 6f5f 696e 7428 7265 7375 6c74 2e73  .to_int(result.s
+0000aa10: 7461 7475 7329 0a20 2020 2020 2020 2072  tatus).        r
+0000aa20: 6561 736f 6e20 3d20 7265 7375 6c74 2e72  eason = result.r
+0000aa30: 6561 736f 6e0a 2020 2020 2020 2020 636f  eason.        co
+0000aa40: 6465 203d 204e 6f6e 650a 2020 2020 2020  de = None.      
+0000aa50: 2020 6d65 7373 6167 6520 3d20 4e6f 6e65    message = None
+0000aa60: 0a20 2020 2020 2020 2062 6f64 7920 3d20  .        body = 
+0000aa70: 4e6f 6e65 0a20 2020 2020 2020 2072 6571  None.        req
+0000aa80: 7565 7374 4964 203d 204e 6f6e 650a 2020  uestId = None.  
+0000aa90: 2020 2020 2020 686f 7374 4964 203d 204e        hostId = N
+0000aaa0: 6f6e 650a 2020 2020 2020 2020 7265 736f  one.        reso
+0000aab0: 7572 6365 203d 204e 6f6e 650a 2020 2020  urce = None.    
+0000aac0: 2020 2020 6865 6164 6572 7320 3d20 7b7d      headers = {}
+0000aad0: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
+0000aae0: 7620 696e 2072 6573 756c 742e 6765 7468  v in result.geth
+0000aaf0: 6561 6465 7273 2829 3a0a 2020 2020 2020  eaders():.      
+0000ab00: 2020 2020 2020 6865 6164 6572 735b 6b2e        headers[k.
+0000ab10: 6c6f 7765 7228 295d 203d 2076 0a20 2020  lower()] = v.   
+0000ab20: 2020 2020 2072 6573 706f 6e73 6544 6174       responseDat
+0000ab30: 6120 3d20 7365 6c66 2e5f 7072 6570 6172  a = self._prepar
+0000ab40: 655f 7265 7370 6f6e 7365 5f64 6174 6128  e_response_data(
+0000ab50: 7265 7375 6c74 2c20 6368 7563 6b53 697a  result, chuckSiz
+0000ab60: 6529 0a0a 2020 2020 2020 2020 6865 6164  e)..        head
+0000ab70: 6572 203d 2073 656c 662e 5f72 656e 616d  er = self._renam
+0000ab80: 655f 7265 7370 6f6e 7365 5f68 6561 6465  e_response_heade
+0000ab90: 7273 2868 6561 6465 7273 290a 2020 2020  rs(headers).    
+0000aba0: 2020 2020 6973 4a73 6f6e 203d 2068 6561      isJson = hea
+0000abb0: 6465 7273 2e67 6574 2863 6f6e 7374 2e43  ders.get(const.C
+0000abc0: 4f4e 5445 4e54 5f54 5950 455f 4845 4144  ONTENT_TYPE_HEAD
+0000abd0: 4552 2e6c 6f77 6572 2829 2c20 2778 6d6c  ER.lower(), 'xml
+0000abe0: 2729 203d 3d20 636f 6e73 742e 4d49 4d45  ') == const.MIME
+0000abf0: 5f54 5950 4553 2e67 6574 2827 6a73 6f6e  _TYPES.get('json
+0000ac00: 2729 0a20 2020 2020 2020 2069 6e64 6963  ').        indic
+0000ac10: 6174 6f72 203d 2068 6561 6465 7273 2e67  ator = headers.g
+0000ac20: 6574 2873 656c 662e 6861 2e69 6e64 6963  et(self.ha.indic
+0000ac30: 6174 6f72 5f68 6561 6465 7228 2929 0a0a  ator_header())..
+0000ac40: 2020 2020 2020 2020 6966 2073 7461 7475          if statu
+0000ac50: 7320 3c20 3330 303a 0a20 2020 2020 2020  s < 300:.       
+0000ac60: 2020 2020 2072 6573 706f 6e73 6544 6174       responseDat
+0000ac70: 612c 2062 6f64 7920 3d20 7365 6c66 2e5f  a, body = self._
+0000ac80: 7072 6570 6172 655f 626f 6479 286d 6574  prepare_body(met
+0000ac90: 686f 644e 616d 652c 2072 6573 706f 6e73  hodName, respons
+0000aca0: 6544 6174 612c 2069 734a 736f 6e2c 2068  eData, isJson, h
+0000acb0: 6561 6465 7273 290a 2020 2020 2020 2020  eaders).        
+0000acc0: 2020 2020 7265 7175 6573 7449 6420 3d20      requestId = 
+0000acd0: 7365 6c66 2e5f 7072 6570 6172 655f 7265  self._prepare_re
+0000ace0: 7175 6573 745f 6964 284e 6f6e 652c 2068  quest_id(None, h
+0000acf0: 6561 6465 7273 290a 0a20 2020 2020 2020  eaders)..       
+0000ad00: 2065 6c69 6620 7265 7370 6f6e 7365 4461   elif responseDa
+0000ad10: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+0000ad20: 7265 7370 6f6e 7365 4461 7461 203d 2072  responseData = r
+0000ad30: 6573 706f 6e73 6544 6174 6120 6966 2063  esponseData if c
+0000ad40: 6f6e 7374 2e49 535f 5059 5448 4f4e 3220  onst.IS_PYTHON2 
+0000ad50: 656c 7365 2072 6573 706f 6e73 6544 6174  else responseDat
+0000ad60: 612e 6465 636f 6465 2827 5554 462d 3827  a.decode('UTF-8'
+0000ad70: 290a 2020 2020 2020 2020 2020 2020 7472  ).            tr
+0000ad80: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0000ad90: 2020 2069 6620 6973 4a73 6f6e 3a0a 2020     if isJson:.  
+0000ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000adb0: 2020 636f 6465 2c20 6d65 7373 6167 652c    code, message,
+0000adc0: 2072 6571 7565 7374 4964 203d 2073 656c   requestId = sel
+0000add0: 662e 636f 6e76 6572 746f 722e 7061 7273  f.convertor.pars
+0000ade0: 654a 736f 6e45 7272 6f72 5265 7375 6c74  eJsonErrorResult
+0000adf0: 2872 6573 706f 6e73 6544 6174 6129 0a20  (responseData). 
+0000ae00: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000ae10: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000ae20: 2020 2020 2020 2020 2073 6561 7263 6820           search 
+0000ae30: 3d20 7365 6c66 2e70 6174 7465 726e 2e73  = self.pattern.s
+0000ae40: 6561 7263 6828 7265 7370 6f6e 7365 4461  earch(responseDa
+0000ae50: 7461 290a 2020 2020 2020 2020 2020 2020  ta).            
+0000ae60: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
+0000ae70: 4461 7461 203d 2072 6573 706f 6e73 6544  Data = responseD
+0000ae80: 6174 6120 6966 2073 6561 7263 6820 6973  ata if search is
+0000ae90: 204e 6f6e 6520 656c 7365 2072 6573 706f   None else respo
+0000aea0: 6e73 6544 6174 612e 7265 706c 6163 6528  nseData.replace(
+0000aeb0: 7365 6172 6368 2e67 726f 7570 2829 2c20  search.group(), 
+0000aec0: 2727 290a 2020 2020 2020 2020 2020 2020  '').            
+0000aed0: 2020 2020 2020 2020 636f 6465 2c20 6d65          code, me
+0000aee0: 7373 6167 652c 2072 6571 7565 7374 4964  ssage, requestId
+0000aef0: 2c20 686f 7374 4964 2c20 7265 736f 7572  , hostId, resour
+0000af00: 6365 203d 2073 656c 662e 636f 6e76 6572  ce = self.conver
+0000af10: 746f 722e 7061 7273 6545 7272 6f72 5265  tor.parseErrorRe
+0000af20: 7375 6c74 2872 6573 706f 6e73 6544 6174  sult(responseDat
+0000af30: 6129 0a20 2020 2020 2020 2020 2020 2020  a).             
+0000af40: 2020 2062 6f64 7920 3d20 7265 7370 6f6e     body = respon
+0000af50: 7365 4461 7461 0a20 2020 2020 2020 2020  seData.         
+0000af60: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+0000af70: 696f 6e20 6173 2065 653a 0a20 2020 2020  ion as ee:.     
+0000af80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000af90: 6c6f 675f 636c 6965 6e74 2e6c 6f67 2845  log_client.log(E
+0000afa0: 5252 4f52 2c20 7574 696c 2e74 6f5f 7374  RROR, util.to_st
+0000afb0: 7269 6e67 2865 6529 290a 2020 2020 2020  ring(ee)).      
+0000afc0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+0000afd0: 6f67 5f63 6c69 656e 742e 6c6f 6728 4552  og_client.log(ER
+0000afe0: 524f 522c 2074 7261 6365 6261 636b 2e66  ROR, traceback.f
+0000aff0: 6f72 6d61 745f 6578 6328 2929 0a0a 2020  ormat_exc())..  
+0000b000: 2020 2020 2020 7265 7175 6573 7449 6420        requestId 
+0000b010: 3d20 7365 6c66 2e5f 7072 6570 6172 655f  = self._prepare_
+0000b020: 7265 7175 6573 745f 6964 2872 6571 7565  request_id(reque
+0000b030: 7374 4964 2c20 6865 6164 6572 7329 0a0a  stId, headers)..
+0000b040: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+0000b050: 5f63 6c69 656e 742e 6c6f 6728 4445 4255  _client.log(DEBU
+0000b060: 472c 2027 6874 7470 2072 6573 706f 6e73  G, 'http respons
+0000b070: 6520 7265 7375 6c74 3a73 7461 7475 733a  e result:status:
+0000b080: 2564 2c72 6561 736f 6e3a 2573 2c63 6f64  %d,reason:%s,cod
+0000b090: 653a 2573 2c6d 6573 7361 6765 3a25 732c  e:%s,message:%s,
+0000b0a0: 6865 6164 6572 733a 2573 272c 0a20 2020  headers:%s',.   
+0000b0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0c0: 2020 2020 2020 2020 2073 7461 7475 732c           status,
+0000b0d0: 2072 6561 736f 6e2c 2063 6f64 652c 206d   reason, code, m
+0000b0e0: 6573 7361 6765 2c20 6865 6164 6572 290a  essage, header).
+0000b0f0: 0a20 2020 2020 2020 2069 6620 7374 6174  .        if stat
+0000b100: 7573 203e 3d20 3330 303a 0a20 2020 2020  us >= 300:.     
+0000b110: 2020 2020 2020 2073 656c 662e 6c6f 675f         self.log_
+0000b120: 636c 6965 6e74 2e6c 6f67 2845 5252 4f52  client.log(ERROR
+0000b130: 2c20 2765 7863 6570 7469 6f6e 616c 206f  , 'exceptional o
+0000b140: 6273 2072 6573 706f 6e73 653a 7374 6174  bs response:stat
+0000b150: 7573 3a25 642c 7265 6173 6f6e 3a25 732c  us:%d,reason:%s,
+0000b160: 636f 6465 3a25 732c 6d65 7373 6167 653a  code:%s,message:
+0000b170: 2573 2c72 6571 7565 7374 4964 3a25 7327  %s,requestId:%s'
+0000b180: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1a0: 2020 7374 6174 7573 2c20 7265 6173 6f6e    status, reason
+0000b1b0: 2c20 636f 6465 2c20 6d65 7373 6167 652c  , code, message,
+0000b1c0: 2072 6571 7565 7374 4964 290a 0a20 2020   requestId)..   
+0000b1d0: 2020 2020 2072 6574 203d 2047 6574 5265       ret = GetRe
+0000b1e0: 7375 6c74 2863 6f64 653d 636f 6465 2c20  sult(code=code, 
+0000b1f0: 6d65 7373 6167 653d 6d65 7373 6167 652c  message=message,
+0000b200: 2073 7461 7475 733d 7374 6174 7573 2c20   status=status, 
+0000b210: 7265 6173 6f6e 3d72 6561 736f 6e2c 2062  reason=reason, b
+0000b220: 6f64 793d 626f 6479 2c0a 2020 2020 2020  ody=body,.      
+0000b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b240: 2020 7265 7175 6573 7449 643d 7265 7175    requestId=requ
+0000b250: 6573 7449 642c 2068 6f73 7449 643d 686f  estId, hostId=ho
+0000b260: 7374 4964 2c20 7265 736f 7572 6365 3d72  stId, resource=r
+0000b270: 6573 6f75 7263 652c 2068 6561 6465 723d  esource, header=
+0000b280: 6865 6164 6572 2c20 696e 6469 6361 746f  header, indicato
+0000b290: 723d 696e 6469 6361 746f 7229 0a0a 2020  r=indicator)..  
+0000b2a0: 2020 2020 2020 6966 206e 6f74 2072 6561        if not rea
+0000b2b0: 6461 626c 653a 0a20 2020 2020 2020 2020  dable:.         
+0000b2c0: 2020 2069 6620 7365 6c66 2e5f 6973 5f72     if self._is_r
+0000b2d0: 6564 6972 6563 745f 6578 6365 7074 696f  edirect_exceptio
+0000b2e0: 6e28 7374 6174 7573 2c20 6865 6164 6572  n(status, header
+0000b2f0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+0000b300: 2020 2020 6c6f 6361 7469 6f6e 203d 2068      location = h
+0000b310: 6561 6465 7273 2e67 6574 2863 6f6e 7374  eaders.get(const
+0000b320: 2e4c 4f43 4154 494f 4e5f 4845 4144 4552  .LOCATION_HEADER
+0000b330: 2e6c 6f77 6572 2829 290a 2020 2020 2020  .lower()).      
+0000b340: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+0000b350: 6f67 5f63 6c69 656e 742e 6c6f 6728 5741  og_client.log(WA
+0000b360: 524e 494e 472c 2027 6874 7470 2063 6f64  RNING, 'http cod
+0000b370: 6520 6973 2025 642c 206e 6565 6420 746f  e is %d, need to
+0000b380: 2072 6564 6972 6563 7420 746f 2025 7327   redirect to %s'
+0000b390: 2c20 7374 6174 7573 2c20 6c6f 6361 7469  , status, locati
+0000b3a0: 6f6e 290a 2020 2020 2020 2020 2020 2020  on).            
+0000b3b0: 2020 2020 7261 6973 6520 5f52 6564 6972      raise _Redir
+0000b3c0: 6563 7445 7863 6570 7469 6f6e 2827 6874  ectException('ht
+0000b3d0: 7470 2063 6f64 6520 6973 207b 307d 2c20  tp code is {0}, 
+0000b3e0: 6e65 6564 2074 6f20 7265 6469 7265 6374  need to redirect
+0000b3f0: 2074 6f20 7b31 7d27 2e66 6f72 6d61 7428   to {1}'.format(
+0000b400: 7374 6174 7573 2c20 6c6f 6361 7469 6f6e  status, location
+0000b410: 292c 206c 6f63 6174 696f 6e2c 0a20 2020  ), location,.   
+0000b420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b440: 2020 2020 2020 7265 7429 0a0a 2020 2020        ret)..    
+0000b450: 2020 2020 2020 2020 6966 2073 7461 7475          if statu
+0000b460: 7320 3e3d 2035 3030 3a0a 2020 2020 2020  s >= 500:.      
+0000b470: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000b480: 5f49 6e74 6572 6e61 6c45 7863 6570 7469  _InternalExcepti
+0000b490: 6f6e 2872 6574 290a 2020 2020 2020 2020  on(ret).        
+0000b4a0: 7265 7475 726e 2072 6574 0a0a 0a63 6c61  return ret...cla
+0000b4b0: 7373 205f 4372 6561 7465 5369 676e 6564  ss _CreateSigned
+0000b4c0: 5572 6c52 6573 706f 6e73 6528 4261 7365  UrlResponse(Base
+0000b4d0: 4d6f 6465 6c29 3a0a 2020 2020 616c 6c6f  Model):.    allo
+0000b4e0: 7765 6441 7474 7220 3d20 7b27 7369 676e  wedAttr = {'sign
+0000b4f0: 6564 5572 6c27 3a20 636f 6e73 742e 4241  edUrl': const.BA
+0000b500: 5345 5354 5249 4e47 2c20 2761 6374 7561  SESTRING, 'actua
+0000b510: 6c53 6967 6e65 6452 6571 7565 7374 4865  lSignedRequestHe
+0000b520: 6164 6572 7327 3a20 6469 6374 7d0a 0a0a  aders': dict}...
+0000b530: 636c 6173 7320 5f43 7265 6174 6550 6f73  class _CreatePos
+0000b540: 7453 6967 6e61 7475 7265 5265 7370 6f6e  tSignatureRespon
+0000b550: 7365 2842 6173 654d 6f64 656c 293a 0a20  se(BaseModel):. 
+0000b560: 2020 2061 6c6c 6f77 6564 4174 7472 203d     allowedAttr =
+0000b570: 207b 276f 7269 6769 6e50 6f6c 6963 7927   {'originPolicy'
+0000b580: 3a20 636f 6e73 742e 4241 5345 5354 5249  : const.BASESTRI
+0000b590: 4e47 2c20 2770 6f6c 6963 7927 3a20 636f  NG, 'policy': co
+0000b5a0: 6e73 742e 4241 5345 5354 5249 4e47 2c0a  nst.BASESTRING,.
+0000b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5c0: 2020 2027 6372 6564 656e 7469 616c 273a     'credential':
+0000b5d0: 2063 6f6e 7374 2e42 4153 4553 5452 494e   const.BASESTRIN
+0000b5e0: 472c 2027 6461 7465 273a 2063 6f6e 7374  G, 'date': const
+0000b5f0: 2e42 4153 4553 5452 494e 472c 2027 7369  .BASESTRING, 'si
+0000b600: 676e 6174 7572 6527 3a20 636f 6e73 742e  gnature': const.
+0000b610: 4241 5345 5354 5249 4e47 2c0a 2020 2020  BASESTRING,.    
+0000b620: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0000b630: 6163 6365 7373 4b65 7949 6427 3a20 636f  accessKeyId': co
+0000b640: 6e73 742e 4241 5345 5354 5249 4e47 7d0a  nst.BASESTRING}.
+0000b650: 0a0a 636c 6173 7320 4f62 7343 6c69 656e  ..class ObsClien
+0000b660: 7428 5f42 6173 6963 436c 6965 6e74 293a  t(_BasicClient):
+0000b670: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+0000b680: 5f5f 2873 656c 662c 202a 6172 6773 2c20  __(self, *args, 
+0000b690: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+0000b6a0: 2020 2073 7570 6572 284f 6273 436c 6965     super(ObsClie
+0000b6b0: 6e74 2c20 7365 6c66 292e 5f5f 696e 6974  nt, self).__init
+0000b6c0: 5f5f 282a 6172 6773 2c20 2a2a 6b77 6172  __(*args, **kwar
+0000b6d0: 6773 290a 0a20 2020 2064 6566 205f 7072  gs)..    def _pr
+0000b6e0: 6570 6172 6550 6172 616d 6574 6572 466f  epareParameterFo
+0000b6f0: 7253 6967 6e65 6455 726c 2873 656c 662c  rSignedUrl(self,
+0000b700: 2073 7065 6369 616c 5061 7261 6d2c 2065   specialParam, e
+0000b710: 7870 6972 6573 2c20 6865 6164 6572 732c  xpires, headers,
+0000b720: 2071 7565 7279 5061 7261 6d73 293a 0a0a   queryParams):..
+0000b730: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
+0000b740: 3d20 7b7d 2069 6620 6865 6164 6572 7320  = {} if headers 
+0000b750: 6973 204e 6f6e 6520 6f72 206e 6f74 2069  is None or not i
+0000b760: 7369 6e73 7461 6e63 6528 6865 6164 6572  sinstance(header
+0000b770: 732c 2064 6963 7429 2065 6c73 6520 6865  s, dict) else he
+0000b780: 6164 6572 732e 636f 7079 2829 0a20 2020  aders.copy().   
+0000b790: 2020 2020 2071 7565 7279 5061 7261 6d73       queryParams
+0000b7a0: 203d 207b 7d20 6966 2071 7565 7279 5061   = {} if queryPa
+0000b7b0: 7261 6d73 2069 7320 4e6f 6e65 206f 7220  rams is None or 
+0000b7c0: 6e6f 7420 6973 696e 7374 616e 6365 2871  not isinstance(q
+0000b7d0: 7565 7279 5061 7261 6d73 2c20 6469 6374  ueryParams, dict
+0000b7e0: 2920 656c 7365 2071 7565 7279 5061 7261  ) else queryPara
+0000b7f0: 6d73 2e63 6f70 7928 290a 0a20 2020 2020  ms.copy()..     
+0000b800: 2020 205f 6865 6164 6572 7320 3d20 7b7d     _headers = {}
+0000b810: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
+0000b820: 7620 696e 2068 6561 6465 7273 2e69 7465  v in headers.ite
+0000b830: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+0000b840: 2020 6966 206b 2069 7320 6e6f 7420 4e6f    if k is not No
+0000b850: 6e65 2061 6e64 206b 2021 3d20 2727 3a0a  ne and k != '':.
+0000b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b870: 5f68 6561 6465 7273 5b6b 5d20 3d20 760a  _headers[k] = v.
+0000b880: 0a20 2020 2020 2020 205f 7175 6572 7950  .        _queryP
+0000b890: 6172 616d 7320 3d20 7365 6c66 2e5f 7072  arams = self._pr
+0000b8a0: 6570 6172 6550 6172 616d 6574 6572 466f  epareParameterFo
+0000b8b0: 7253 6967 6e65 6455 726c 5175 6572 7928  rSignedUrlQuery(
+0000b8c0: 7175 6572 7950 6172 616d 732c 2073 7065  queryParams, spe
+0000b8d0: 6369 616c 5061 7261 6d29 0a0a 2020 2020  cialParam)..    
+0000b8e0: 2020 2020 6578 7069 7265 7320 3d20 3330      expires = 30
+0000b8f0: 3020 6966 2065 7870 6972 6573 2069 7320  0 if expires is 
+0000b900: 4e6f 6e65 2065 6c73 6520 7574 696c 2e74  None else util.t
+0000b910: 6f5f 696e 7428 6578 7069 7265 7329 0a0a  o_int(expires)..
+0000b920: 2020 2020 2020 2020 7265 7475 726e 205f          return _
+0000b930: 6865 6164 6572 732c 205f 7175 6572 7950  headers, _queryP
+0000b940: 6172 616d 732c 2065 7870 6972 6573 2c20  arams, expires, 
+0000b950: 7365 6c66 2e63 616c 6c69 6e67 5f66 6f72  self.calling_for
+0000b960: 6d61 740a 0a20 2020 2064 6566 205f 7072  mat..    def _pr
+0000b970: 6570 6172 6550 6172 616d 6574 6572 466f  epareParameterFo
+0000b980: 7253 6967 6e65 6455 726c 5175 6572 7928  rSignedUrlQuery(
+0000b990: 7365 6c66 2c20 7175 6572 7950 6172 616d  self, queryParam
+0000b9a0: 732c 2073 7065 6369 616c 5061 7261 6d29  s, specialParam)
+0000b9b0: 3a0a 2020 2020 2020 2020 5f71 7565 7279  :.        _query
+0000b9c0: 5061 7261 6d73 203d 207b 7d0a 2020 2020  Params = {}.    
+0000b9d0: 2020 2020 666f 7220 6b2c 2076 2069 6e20      for k, v in 
+0000b9e0: 7175 6572 7950 6172 616d 732e 6974 656d  queryParams.item
+0000b9f0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+0000ba00: 2069 6620 6b20 6973 206e 6f74 204e 6f6e   if k is not Non
+0000ba10: 6520 616e 6420 6b20 213d 2027 273a 0a20  e and k != '':. 
+0000ba20: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+0000ba30: 7175 6572 7950 6172 616d 735b 6b5d 203d  queryParams[k] =
+0000ba40: 2076 0a0a 2020 2020 2020 2020 6966 2073   v..        if s
+0000ba50: 7065 6369 616c 5061 7261 6d20 6973 206e  pecialParam is n
+0000ba60: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0000ba70: 2020 2020 2073 7065 6369 616c 5061 7261       specialPara
+0000ba80: 6d20 3d20 2773 746f 7261 6765 436c 6173  m = 'storageClas
+0000ba90: 7327 2069 6620 7365 6c66 2e73 6967 6e61  s' if self.signa
+0000baa0: 7475 7265 2e6c 6f77 6572 2829 203d 3d20  ture.lower() == 
+0000bab0: 276f 6273 2720 616e 6420 7370 6563 6961  'obs' and specia
+0000bac0: 6c50 6172 616d 203d 3d20 2773 746f 7261  lParam == 'stora
+0000bad0: 6765 506f 6c69 6379 2720 5c0a 2020 2020  gePolicy' \.    
+0000bae0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000baf0: 2027 7374 6f72 6167 6550 6f6c 6963 7927   'storagePolicy'
+0000bb00: 2069 6620 7365 6c66 2e73 6967 6e61 7475   if self.signatu
+0000bb10: 7265 2e6c 6f77 6572 2829 2021 3d20 276f  re.lower() != 'o
+0000bb20: 6273 2720 616e 6420 7370 6563 6961 6c50  bs' and specialP
+0000bb30: 6172 616d 203d 3d20 2773 746f 7261 6765  aram == 'storage
+0000bb40: 436c 6173 7327 205c 0a20 2020 2020 2020  Class' \.       
+0000bb50: 2020 2020 2020 2020 2065 6c73 6520 7370           else sp
+0000bb60: 6563 6961 6c50 6172 616d 0a20 2020 2020  ecialParam.     
+0000bb70: 2020 2020 2020 205f 7175 6572 7950 6172         _queryPar
+0000bb80: 616d 735b 7370 6563 6961 6c50 6172 616d  ams[specialParam
+0000bb90: 5d20 3d20 4e6f 6e65 0a0a 2020 2020 2020  ] = None..      
+0000bba0: 2020 7265 7475 726e 205f 7175 6572 7950    return _queryP
+0000bbb0: 6172 616d 730a 0a20 2020 2064 6566 2063  arams..    def c
+0000bbc0: 7265 6174 6553 6967 6e65 6455 726c 2873  reateSignedUrl(s
+0000bbd0: 656c 662c 206d 6574 686f 642c 2062 7563  elf, method, buc
+0000bbe0: 6b65 744e 616d 653d 4e6f 6e65 2c20 6f62  ketName=None, ob
+0000bbf0: 6a65 6374 4b65 793d 4e6f 6e65 2c20 7370  jectKey=None, sp
+0000bc00: 6563 6961 6c50 6172 616d 3d4e 6f6e 652c  ecialParam=None,
+0000bc10: 2065 7870 6972 6573 3d33 3030 2c20 6865   expires=300, he
+0000bc20: 6164 6572 733d 4e6f 6e65 2c0a 2020 2020  aders=None,.    
+0000bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc40: 2020 2020 7175 6572 7950 6172 616d 733d      queryParams=
+0000bc50: 4e6f 6e65 293a 0a20 2020 2020 2020 2064  None):.        d
+0000bc60: 656c 6567 6174 6520 3d20 7365 6c66 2e5f  elegate = self._
+0000bc70: 6372 6561 7465 5634 5369 676e 6564 5572  createV4SignedUr
+0000bc80: 6c20 6966 2073 656c 662e 7369 676e 6174  l if self.signat
+0000bc90: 7572 652e 6c6f 7765 7228 2920 3d3d 2027  ure.lower() == '
+0000bca0: 7634 2720 656c 7365 2073 656c 662e 5f63  v4' else self._c
+0000bcb0: 7265 6174 6556 3253 6967 6e65 6455 726c  reateV2SignedUrl
+0000bcc0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000bcd0: 6465 6c65 6761 7465 286d 6574 686f 642c  delegate(method,
+0000bce0: 2062 7563 6b65 744e 616d 652c 206f 626a   bucketName, obj
+0000bcf0: 6563 744b 6579 2c20 7370 6563 6961 6c50  ectKey, specialP
+0000bd00: 6172 616d 2c20 6578 7069 7265 732c 2068  aram, expires, h
+0000bd10: 6561 6465 7273 2c20 7175 6572 7950 6172  eaders, queryPar
+0000bd20: 616d 7329 0a0a 2020 2020 6465 6620 6372  ams)..    def cr
+0000bd30: 6561 7465 5632 5369 676e 6564 5572 6c28  eateV2SignedUrl(
+0000bd40: 7365 6c66 2c20 6d65 7468 6f64 2c20 6275  self, method, bu
+0000bd50: 636b 6574 4e61 6d65 3d4e 6f6e 652c 206f  cketName=None, o
+0000bd60: 626a 6563 744b 6579 3d4e 6f6e 652c 2073  bjectKey=None, s
+0000bd70: 7065 6369 616c 5061 7261 6d3d 4e6f 6e65  pecialParam=None
+0000bd80: 2c20 6578 7069 7265 733d 3330 302c 2068  , expires=300, h
+0000bd90: 6561 6465 7273 3d4e 6f6e 652c 0a20 2020  eaders=None,.   
+0000bda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bdb0: 2020 2020 2020 2071 7565 7279 5061 7261         queryPara
+0000bdc0: 6d73 3d4e 6f6e 6529 3a0a 2020 2020 2020  ms=None):.      
+0000bdd0: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
+0000bde0: 7265 6174 6556 3253 6967 6e65 6455 726c  reateV2SignedUrl
+0000bdf0: 286d 6574 686f 642c 2062 7563 6b65 744e  (method, bucketN
+0000be00: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
+0000be10: 7370 6563 6961 6c50 6172 616d 2c20 6578  specialParam, ex
+0000be20: 7069 7265 732c 2068 6561 6465 7273 2c20  pires, headers, 
+0000be30: 7175 6572 7950 6172 616d 7329 0a0a 2020  queryParams)..  
+0000be40: 2020 6465 6620 6372 6561 7465 5634 5369    def createV4Si
+0000be50: 676e 6564 5572 6c28 7365 6c66 2c20 6d65  gnedUrl(self, me
+0000be60: 7468 6f64 2c20 6275 636b 6574 4e61 6d65  thod, bucketName
+0000be70: 3d4e 6f6e 652c 206f 626a 6563 744b 6579  =None, objectKey
+0000be80: 3d4e 6f6e 652c 2073 7065 6369 616c 5061  =None, specialPa
+0000be90: 7261 6d3d 4e6f 6e65 2c20 6578 7069 7265  ram=None, expire
+0000bea0: 733d 3330 302c 2068 6561 6465 7273 3d4e  s=300, headers=N
+0000beb0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+0000bec0: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+0000bed0: 7565 7279 5061 7261 6d73 3d4e 6f6e 6529  ueryParams=None)
+0000bee0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000bef0: 2073 656c 662e 5f63 7265 6174 6556 3453   self._createV4S
+0000bf00: 6967 6e65 6455 726c 286d 6574 686f 642c  ignedUrl(method,
+0000bf10: 2062 7563 6b65 744e 616d 652c 206f 626a   bucketName, obj
+0000bf20: 6563 744b 6579 2c20 7370 6563 6961 6c50  ectKey, specialP
+0000bf30: 6172 616d 2c20 6578 7069 7265 732c 2068  aram, expires, h
+0000bf40: 6561 6465 7273 2c20 7175 6572 7950 6172  eaders, queryPar
+0000bf50: 616d 7329 0a0a 2020 2020 6465 6620 5f63  ams)..    def _c
+0000bf60: 7265 6174 6556 3253 6967 6e65 6455 726c  reateV2SignedUrl
+0000bf70: 2873 656c 662c 206d 6574 686f 642c 2062  (self, method, b
+0000bf80: 7563 6b65 744e 616d 653d 4e6f 6e65 2c20  ucketName=None, 
+0000bf90: 6f62 6a65 6374 4b65 793d 4e6f 6e65 2c20  objectKey=None, 
+0000bfa0: 7370 6563 6961 6c50 6172 616d 3d4e 6f6e  specialParam=Non
+0000bfb0: 652c 2065 7870 6972 6573 3d33 3030 2c20  e, expires=300, 
+0000bfc0: 6865 6164 6572 733d 4e6f 6e65 2c0a 2020  headers=None,.  
 0000bfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c010: 2020 2020 2020 2020 6865 6164 6572 732c          headers,
-0000c020: 2071 7565 7279 5061 7261 6d73 290a 0a20   queryParams).. 
-0000c030: 2020 2020 2020 2063 6f6e 6e65 6374 5f73         connect_s
-0000c040: 6572 7665 7220 3d20 7365 6c66 2e73 6572  erver = self.ser
-0000c050: 7665 7220 6966 2073 656c 662e 6973 5f63  ver if self.is_c
-0000c060: 6e61 6d65 2065 6c73 6520 6361 6c6c 696e  name else callin
-0000c070: 675f 666f 726d 6174 2e67 6574 5f73 6572  g_format.get_ser
-0000c080: 7665 7228 7365 6c66 2e73 6572 7665 722c  ver(self.server,
-0000c090: 2062 7563 6b65 744e 616d 6529 0a0a 2020   bucketName)..  
-0000c0a0: 2020 2020 2020 6865 6164 6572 735b 636f        headers[co
-0000c0b0: 6e73 742e 484f 5354 5f48 4541 4445 525d  nst.HOST_HEADER]
-0000c0c0: 203d 2027 2573 3a25 7327 2025 2028 0a20   = '%s:%s' % (. 
-0000c0d0: 2020 2020 2020 2020 2020 2063 6f6e 6e65             conne
-0000c0e0: 6374 5f73 6572 7665 722c 2073 656c 662e  ct_server, self.
-0000c0f0: 706f 7274 2920 6966 2073 656c 662e 706f  port) if self.po
-0000c100: 7274 2021 3d20 3434 3320 616e 6420 7365  rt != 443 and se
-0000c110: 6c66 2e70 6f72 7420 213d 2038 3020 656c  lf.port != 80 el
-0000c120: 7365 2063 6f6e 6e65 6374 5f73 6572 7665  se connect_serve
-0000c130: 720a 0a20 2020 2020 2020 2065 7870 6972  r..        expir
-0000c140: 6573 202b 3d20 7574 696c 2e74 6f5f 696e  es += util.to_in
-0000c150: 7428 7469 6d65 2e74 696d 6528 2929 0a0a  t(time.time())..
-0000c160: 2020 2020 2020 2020 7365 6375 7269 7479          security
-0000c170: 5072 6f76 6964 6572 203d 2073 656c 662e  Provider = self.
-0000c180: 5f67 6574 5f74 6f6b 656e 2829 0a20 2020  _get_token().   
-0000c190: 2020 2020 2069 6620 7365 6375 7269 7479       if security
-0000c1a0: 5072 6f76 6964 6572 2e73 6563 7572 6974  Provider.securit
-0000c1b0: 795f 746f 6b65 6e20 6973 206e 6f74 204e  y_token is not N
-0000c1c0: 6f6e 6520 616e 6420 7365 6c66 2e68 612e  one and self.ha.
-0000c1d0: 7365 6375 7269 7479 5f74 6f6b 656e 5f68  security_token_h
-0000c1e0: 6561 6465 7228 2920 6e6f 7420 696e 2071  eader() not in q
-0000c1f0: 7565 7279 5061 7261 6d73 3a0a 2020 2020  ueryParams:.    
-0000c200: 2020 2020 2020 2020 7175 6572 7950 6172          queryPar
-0000c210: 616d 735b 7365 6c66 2e68 612e 7365 6375  ams[self.ha.secu
-0000c220: 7269 7479 5f74 6f6b 656e 5f68 6561 6465  rity_token_heade
-0000c230: 7228 295d 203d 2073 6563 7572 6974 7950  r()] = securityP
-0000c240: 726f 7669 6465 722e 7365 6375 7269 7479  rovider.security
-0000c250: 5f74 6f6b 656e 0a0a 2020 2020 2020 2020  _token..        
-0000c260: 7632 4175 7468 203d 2061 7574 682e 4175  v2Auth = auth.Au
-0000c270: 7468 656e 7469 6361 7469 6f6e 2873 6563  thentication(sec
-0000c280: 7572 6974 7950 726f 7669 6465 722e 6163  urityProvider.ac
-0000c290: 6365 7373 5f6b 6579 5f69 642c 2073 6563  cess_key_id, sec
-0000c2a0: 7572 6974 7950 726f 7669 6465 722e 7365  urityProvider.se
-0000c2b0: 6372 6574 5f61 6363 6573 735f 6b65 792c  cret_access_key,
-0000c2c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2e0: 2020 2020 2020 7365 6c66 2e70 6174 685f        self.path_
-0000c2f0: 7374 796c 652c 2073 656c 662e 6861 2c20  style, self.ha, 
-0000c300: 7365 6c66 2e73 6572 7665 722c 2073 656c  self.server, sel
-0000c310: 662e 6973 5f63 6e61 6d65 290a 0a20 2020  f.is_cname)..   
-0000c320: 2020 2020 2073 6967 6e61 7475 7265 203d       signature =
-0000c330: 2076 3241 7574 682e 6765 7453 6967 6e61   v2Auth.getSigna
-0000c340: 7475 7265 286d 6574 686f 642c 2062 7563  ture(method, buc
-0000c350: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
-0000c360: 6579 2c20 7175 6572 7950 6172 616d 732c  ey, queryParams,
-0000c370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bfe0: 2020 2020 2020 2020 2071 7565 7279 5061           queryPa
+0000bff0: 7261 6d73 3d4e 6f6e 6529 3a0a 0a20 2020  rams=None):..   
+0000c000: 2020 2020 2068 6561 6465 7273 2c20 7175       headers, qu
+0000c010: 6572 7950 6172 616d 732c 2065 7870 6972  eryParams, expir
+0000c020: 6573 2c20 6361 6c6c 696e 675f 666f 726d  es, calling_form
+0000c030: 6174 203d 2073 656c 662e 5f70 7265 7061  at = self._prepa
+0000c040: 7265 5061 7261 6d65 7465 7246 6f72 5369  reParameterForSi
+0000c050: 676e 6564 5572 6c28 7370 6563 6961 6c50  gnedUrl(specialP
+0000c060: 6172 616d 2c20 6578 7069 7265 732c 0a20  aram, expires,. 
+0000c070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0c0: 2020 2020 2020 2020 2020 6865 6164 6572            header
+0000c0d0: 732c 2071 7565 7279 5061 7261 6d73 290a  s, queryParams).
+0000c0e0: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
+0000c0f0: 5f73 6572 7665 7220 3d20 7365 6c66 2e73  _server = self.s
+0000c100: 6572 7665 7220 6966 2073 656c 662e 6973  erver if self.is
+0000c110: 5f63 6e61 6d65 2065 6c73 6520 6361 6c6c  _cname else call
+0000c120: 696e 675f 666f 726d 6174 2e67 6574 5f73  ing_format.get_s
+0000c130: 6572 7665 7228 7365 6c66 2e73 6572 7665  erver(self.serve
+0000c140: 722c 2062 7563 6b65 744e 616d 6529 0a0a  r, bucketName)..
+0000c150: 2020 2020 2020 2020 6865 6164 6572 735b          headers[
+0000c160: 636f 6e73 742e 484f 5354 5f48 4541 4445  const.HOST_HEADE
+0000c170: 525d 203d 2027 2573 3a25 7327 2025 2028  R] = '%s:%s' % (
+0000c180: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+0000c190: 6e65 6374 5f73 6572 7665 722c 2073 656c  nect_server, sel
+0000c1a0: 662e 706f 7274 2920 6966 2073 656c 662e  f.port) if self.
+0000c1b0: 706f 7274 2021 3d20 3434 3320 616e 6420  port != 443 and 
+0000c1c0: 7365 6c66 2e70 6f72 7420 213d 2038 3020  self.port != 80 
+0000c1d0: 656c 7365 2063 6f6e 6e65 6374 5f73 6572  else connect_ser
+0000c1e0: 7665 720a 0a20 2020 2020 2020 2065 7870  ver..        exp
+0000c1f0: 6972 6573 202b 3d20 7574 696c 2e74 6f5f  ires += util.to_
+0000c200: 696e 7428 7469 6d65 2e74 696d 6528 2929  int(time.time())
+0000c210: 0a0a 2020 2020 2020 2020 7365 6375 7269  ..        securi
+0000c220: 7479 5072 6f76 6964 6572 203d 2073 656c  tyProvider = sel
+0000c230: 662e 5f67 6574 5f74 6f6b 656e 2829 0a20  f._get_token(). 
+0000c240: 2020 2020 2020 2069 6620 7365 6375 7269         if securi
+0000c250: 7479 5072 6f76 6964 6572 2e73 6563 7572  tyProvider.secur
+0000c260: 6974 795f 746f 6b65 6e20 6973 206e 6f74  ity_token is not
+0000c270: 204e 6f6e 6520 616e 6420 7365 6c66 2e68   None and self.h
+0000c280: 612e 7365 6375 7269 7479 5f74 6f6b 656e  a.security_token
+0000c290: 5f68 6561 6465 7228 2920 6e6f 7420 696e  _header() not in
+0000c2a0: 2071 7565 7279 5061 7261 6d73 3a0a 2020   queryParams:.  
+0000c2b0: 2020 2020 2020 2020 2020 7175 6572 7950            queryP
+0000c2c0: 6172 616d 735b 7365 6c66 2e68 612e 7365  arams[self.ha.se
+0000c2d0: 6375 7269 7479 5f74 6f6b 656e 5f68 6561  curity_token_hea
+0000c2e0: 6465 7228 295d 203d 2073 6563 7572 6974  der()] = securit
+0000c2f0: 7950 726f 7669 6465 722e 7365 6375 7269  yProvider.securi
+0000c300: 7479 5f74 6f6b 656e 0a0a 2020 2020 2020  ty_token..      
+0000c310: 2020 7632 4175 7468 203d 2061 7574 682e    v2Auth = auth.
+0000c320: 4175 7468 656e 7469 6361 7469 6f6e 2873  Authentication(s
+0000c330: 6563 7572 6974 7950 726f 7669 6465 722e  ecurityProvider.
+0000c340: 6163 6365 7373 5f6b 6579 5f69 642c 2073  access_key_id, s
+0000c350: 6563 7572 6974 7950 726f 7669 6465 722e  ecurityProvider.
+0000c360: 7365 6372 6574 5f61 6363 6573 735f 6b65  secret_access_ke
+0000c370: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
 0000c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c390: 2020 2020 2020 2020 2068 6561 6465 7273           headers
-0000c3a0: 2c20 7574 696c 2e74 6f5f 7374 7269 6e67  , util.to_string
-0000c3b0: 2865 7870 6972 6573 2929 5b27 5369 676e  (expires))['Sign
-0000c3c0: 6174 7572 6527 5d0a 0a20 2020 2020 2020  ature']..       
-0000c3d0: 2071 7565 7279 5061 7261 6d73 5b27 4578   queryParams['Ex
-0000c3e0: 7069 7265 7327 5d20 3d20 6578 7069 7265  pires'] = expire
-0000c3f0: 730a 2020 2020 2020 2020 7175 6572 7950  s.        queryP
-0000c400: 6172 616d 735b 2741 6363 6573 734b 6579  arams['AccessKey
-0000c410: 4964 2720 6966 2073 656c 662e 7369 676e  Id' if self.sign
-0000c420: 6174 7572 6520 3d3d 2027 6f62 7327 2065  ature == 'obs' e
-0000c430: 6c73 6520 2741 5753 4163 6365 7373 4b65  lse 'AWSAccessKe
-0000c440: 7949 6427 5d20 3d20 7365 6375 7269 7479  yId'] = security
-0000c450: 5072 6f76 6964 6572 2e61 6363 6573 735f  Provider.access_
-0000c460: 6b65 795f 6964 0a20 2020 2020 2020 2071  key_id.        q
-0000c470: 7565 7279 5061 7261 6d73 5b27 5369 676e  ueryParams['Sign
-0000c480: 6174 7572 6527 5d20 3d20 7369 676e 6174  ature'] = signat
-0000c490: 7572 650a 0a20 2020 2020 2020 2069 6620  ure..        if 
-0000c4a0: 7365 6c66 2e69 735f 636e 616d 653a 0a20  self.is_cname:. 
-0000c4b0: 2020 2020 2020 2020 2020 2062 7563 6b65             bucke
-0000c4c0: 744e 616d 6520 3d20 4e6f 6e65 0a0a 2020  tName = None..  
-0000c4d0: 2020 2020 2020 7265 7375 6c74 203d 207b        result = {
-0000c4e0: 2773 6967 6e65 6455 726c 273a 2063 616c  'signedUrl': cal
-0000c4f0: 6c69 6e67 5f66 6f72 6d61 742e 6765 745f  ling_format.get_
-0000c500: 6675 6c6c 5f75 726c 2873 656c 662e 6973  full_url(self.is
-0000c510: 5f73 6563 7572 652c 2073 656c 662e 7365  _secure, self.se
-0000c520: 7276 6572 2c0a 2020 2020 2020 2020 2020  rver,.          
-0000c530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c560: 2073 656c 662e 706f 7274 2c20 6275 636b   self.port, buck
-0000c570: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
-0000c580: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
-0000c590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5b0: 2020 2020 2020 2020 2020 2020 2020 7175                qu
-0000c5c0: 6572 7950 6172 616d 7329 2c0a 2020 2020  eryParams),.    
-0000c5d0: 2020 2020 2020 2020 2020 2020 2020 2761                'a
-0000c5e0: 6374 7561 6c53 6967 6e65 6452 6571 7565  ctualSignedReque
-0000c5f0: 7374 4865 6164 6572 7327 3a20 6865 6164  stHeaders': head
-0000c600: 6572 737d 0a0a 2020 2020 2020 2020 7265  ers}..        re
-0000c610: 7475 726e 205f 4372 6561 7465 5369 676e  turn _CreateSign
-0000c620: 6564 5572 6c52 6573 706f 6e73 6528 2a2a  edUrlResponse(**
-0000c630: 7265 7375 6c74 290a 0a20 2020 2064 6566  result)..    def
-0000c640: 205f 6372 6561 7465 5634 5369 676e 6564   _createV4Signed
-0000c650: 5572 6c28 7365 6c66 2c20 6d65 7468 6f64  Url(self, method
-0000c660: 2c20 6275 636b 6574 4e61 6d65 3d4e 6f6e  , bucketName=Non
-0000c670: 652c 206f 626a 6563 744b 6579 3d4e 6f6e  e, objectKey=Non
-0000c680: 652c 2073 7065 6369 616c 5061 7261 6d3d  e, specialParam=
-0000c690: 4e6f 6e65 2c20 6578 7069 7265 733d 3330  None, expires=30
-0000c6a0: 302c 2068 6561 6465 7273 3d4e 6f6e 652c  0, headers=None,
-0000c6b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c6c0: 2020 2020 2020 2020 2020 2020 7175 6572              quer
-0000c6d0: 7950 6172 616d 733d 4e6f 6e65 293a 0a20  yParams=None):. 
-0000c6e0: 2020 2020 2020 2066 726f 6d20 6461 7465         from date
-0000c6f0: 7469 6d65 2069 6d70 6f72 7420 6461 7465  time import date
-0000c700: 7469 6d65 0a0a 2020 2020 2020 2020 6865  time..        he
-0000c710: 6164 6572 732c 2071 7565 7279 5061 7261  aders, queryPara
-0000c720: 6d73 2c20 6578 7069 7265 732c 2063 616c  ms, expires, cal
-0000c730: 6c69 6e67 5f66 6f72 6d61 7420 3d20 7365  ling_format = se
-0000c740: 6c66 2e5f 7072 6570 6172 6550 6172 616d  lf._prepareParam
-0000c750: 6574 6572 466f 7253 6967 6e65 6455 726c  eterForSignedUrl
-0000c760: 2873 7065 6369 616c 5061 7261 6d2c 2065  (specialParam, e
-0000c770: 7870 6972 6573 2c0a 2020 2020 2020 2020  xpires,.        
-0000c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c7d0: 2020 2068 6561 6465 7273 2c20 7175 6572     headers, quer
-0000c7e0: 7950 6172 616d 7329 0a0a 2020 2020 2020  yParams)..      
-0000c7f0: 2020 6966 2073 656c 662e 6973 5f63 6e61    if self.is_cna
-0000c800: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
-0000c810: 636f 6e6e 6563 745f 7365 7276 6572 203d  connect_server =
-0000c820: 2073 656c 662e 7365 7276 6572 0a20 2020   self.server.   
-0000c830: 2020 2020 2020 2020 2062 7563 6b65 744e           bucketN
-0000c840: 616d 6520 3d20 4e6f 6e65 0a20 2020 2020  ame = None.     
-0000c850: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000c860: 2020 2020 2063 6f6e 6e65 6374 5f73 6572       connect_ser
-0000c870: 7665 7220 3d20 6361 6c6c 696e 675f 666f  ver = calling_fo
-0000c880: 726d 6174 2e67 6574 5f73 6572 7665 7228  rmat.get_server(
-0000c890: 7365 6c66 2e73 6572 7665 722c 2062 7563  self.server, buc
-0000c8a0: 6b65 744e 616d 6529 0a0a 2020 2020 2020  ketName)..      
-0000c8b0: 2020 6865 6164 6572 735b 636f 6e73 742e    headers[const.
-0000c8c0: 484f 5354 5f48 4541 4445 525d 203d 2027  HOST_HEADER] = '
-0000c8d0: 2573 3a25 7327 2025 2028 0a20 2020 2020  %s:%s' % (.     
-0000c8e0: 2020 2020 2020 2063 6f6e 6e65 6374 5f73         connect_s
-0000c8f0: 6572 7665 722c 2073 656c 662e 706f 7274  erver, self.port
-0000c900: 2920 6966 2073 656c 662e 706f 7274 2021  ) if self.port !
-0000c910: 3d20 3434 3320 616e 6420 7365 6c66 2e70  = 443 and self.p
-0000c920: 6f72 7420 213d 2038 3020 656c 7365 2063  ort != 80 else c
-0000c930: 6f6e 6e65 6374 5f73 6572 7665 720a 0a20  onnect_server.. 
-0000c940: 2020 2020 2020 2064 6174 6520 3d20 6865         date = he
-0000c950: 6164 6572 735b 636f 6e73 742e 4441 5445  aders[const.DATE
-0000c960: 5f48 4541 4445 525d 2069 6620 636f 6e73  _HEADER] if cons
-0000c970: 742e 4441 5445 5f48 4541 4445 5220 696e  t.DATE_HEADER in
-0000c980: 2068 6561 6465 7273 2065 6c73 6520 6865   headers else he
-0000c990: 6164 6572 732e 6765 7428 636f 6e73 742e  aders.get(const.
-0000c9a0: 4441 5445 5f48 4541 4445 522e 6c6f 7765  DATE_HEADER.lowe
-0000c9b0: 7228 2929 0a20 2020 2020 2020 2064 6174  r()).        dat
-0000c9c0: 6520 3d20 6461 7465 7469 6d65 2e73 7472  e = datetime.str
-0000c9d0: 7074 696d 6528 6461 7465 2c20 636f 6e73  ptime(date, cons
-0000c9e0: 742e 474d 545f 4441 5445 5f46 4f52 4d41  t.GMT_DATE_FORMA
-0000c9f0: 5429 2069 6620 6461 7465 2065 6c73 6520  T) if date else 
-0000ca00: 6461 7465 7469 6d65 2e75 7463 6e6f 7728  datetime.utcnow(
-0000ca10: 290a 2020 2020 2020 2020 7368 6f72 7444  ).        shortD
-0000ca20: 6174 6520 3d20 6461 7465 2e73 7472 6674  ate = date.strft
-0000ca30: 696d 6528 636f 6e73 742e 5348 4f52 545f  ime(const.SHORT_
-0000ca40: 4441 5445 5f46 4f52 4d41 5429 0a20 2020  DATE_FORMAT).   
-0000ca50: 2020 2020 206c 6f6e 6744 6174 6520 3d20       longDate = 
-0000ca60: 6461 7465 2e73 7472 6674 696d 6528 636f  date.strftime(co
-0000ca70: 6e73 742e 4c4f 4e47 5f44 4154 455f 464f  nst.LONG_DATE_FO
-0000ca80: 524d 4154 290a 0a20 2020 2020 2020 2073  RMAT)..        s
-0000ca90: 6563 7572 6974 7950 726f 7669 6465 7220  ecurityProvider 
-0000caa0: 3d20 7365 6c66 2e5f 6765 745f 746f 6b65  = self._get_toke
-0000cab0: 6e28 290a 0a20 2020 2020 2020 2069 6620  n()..        if 
-0000cac0: 7365 6375 7269 7479 5072 6f76 6964 6572  securityProvider
-0000cad0: 2e73 6563 7572 6974 795f 746f 6b65 6e20  .security_token 
-0000cae0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-0000caf0: 7365 6c66 2e68 612e 7365 6375 7269 7479  self.ha.security
-0000cb00: 5f74 6f6b 656e 5f68 6561 6465 7228 2920  _token_header() 
-0000cb10: 6e6f 7420 696e 2071 7565 7279 5061 7261  not in queryPara
-0000cb20: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-0000cb30: 7175 6572 7950 6172 616d 735b 7365 6c66  queryParams[self
-0000cb40: 2e68 612e 7365 6375 7269 7479 5f74 6f6b  .ha.security_tok
-0000cb50: 656e 5f68 6561 6465 7228 295d 203d 2073  en_header()] = s
-0000cb60: 6563 7572 6974 7950 726f 7669 6465 722e  ecurityProvider.
-0000cb70: 7365 6375 7269 7479 5f74 6f6b 656e 0a0a  security_token..
-0000cb80: 2020 2020 2020 2020 7634 4175 7468 203d          v4Auth =
-0000cb90: 2061 7574 682e 5634 4175 7468 656e 7469   auth.V4Authenti
-0000cba0: 6361 7469 6f6e 2873 6563 7572 6974 7950  cation(securityP
-0000cbb0: 726f 7669 6465 722e 6163 6365 7373 5f6b  rovider.access_k
-0000cbc0: 6579 5f69 642c 2073 6563 7572 6974 7950  ey_id, securityP
-0000cbd0: 726f 7669 6465 722e 7365 6372 6574 5f61  rovider.secret_a
-0000cbe0: 6363 6573 735f 6b65 792c 2073 656c 662e  ccess_key, self.
-0000cbf0: 7265 6769 6f6e 2c0a 2020 2020 2020 2020  region,.        
-0000cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cc10: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000cc20: 686f 7274 4461 7465 2c20 6c6f 6e67 4461  hortDate, longDa
-0000cc30: 7465 2c20 7365 6c66 2e70 6174 685f 7374  te, self.path_st
-0000cc40: 796c 652c 2073 656c 662e 6861 290a 0a20  yle, self.ha).. 
-0000cc50: 2020 2020 2020 2071 7565 7279 5061 7261         queryPara
-0000cc60: 6d73 5b27 582d 416d 7a2d 416c 676f 7269  ms['X-Amz-Algori
-0000cc70: 7468 6d27 5d20 3d20 2741 5753 342d 484d  thm'] = 'AWS4-HM
-0000cc80: 4143 2d53 4841 3235 3627 0a20 2020 2020  AC-SHA256'.     
-0000cc90: 2020 2071 7565 7279 5061 7261 6d73 5b27     queryParams['
-0000cca0: 582d 416d 7a2d 4372 6564 656e 7469 616c  X-Amz-Credential
-0000ccb0: 275d 203d 2076 3441 7574 682e 6765 7443  '] = v4Auth.getC
-0000ccc0: 7265 6465 6e74 6961 6c28 290a 2020 2020  redential().    
-0000ccd0: 2020 2020 7175 6572 7950 6172 616d 735b      queryParams[
-0000cce0: 2758 2d41 6d7a 2d44 6174 6527 5d20 3d20  'X-Amz-Date'] = 
-0000ccf0: 6c6f 6e67 4461 7465 0a20 2020 2020 2020  longDate.       
-0000cd00: 2071 7565 7279 5061 7261 6d73 5b27 582d   queryParams['X-
-0000cd10: 416d 7a2d 4578 7069 7265 7327 5d20 3d20  Amz-Expires'] = 
-0000cd20: 6578 7069 7265 730a 0a20 2020 2020 2020  expires..       
-0000cd30: 2068 6561 644d 6170 203d 2076 3441 7574   headMap = v4Aut
-0000cd40: 682e 7365 744d 6170 4b65 794c 6f77 6572  h.setMapKeyLower
-0000cd50: 2868 6561 6465 7273 290a 2020 2020 2020  (headers).      
-0000cd60: 2020 7369 676e 6564 4865 6164 6572 7320    signedHeaders 
-0000cd70: 3d20 7634 4175 7468 2e67 6574 5369 676e  = v4Auth.getSign
-0000cd80: 6564 4865 6164 6572 7328 6865 6164 4d61  edHeaders(headMa
-0000cd90: 7029 0a0a 2020 2020 2020 2020 7175 6572  p)..        quer
-0000cda0: 7950 6172 616d 735b 2758 2d41 6d7a 2d53  yParams['X-Amz-S
-0000cdb0: 6967 6e65 6448 6561 6465 7273 275d 203d  ignedHeaders'] =
-0000cdc0: 2073 6967 6e65 6448 6561 6465 7273 0a0a   signedHeaders..
-0000cdd0: 2020 2020 2020 2020 7369 676e 6174 7572          signatur
-0000cde0: 6520 3d20 7634 4175 7468 2e67 6574 5369  e = v4Auth.getSi
-0000cdf0: 676e 6174 7572 6528 6d65 7468 6f64 2c20  gnature(method, 
-0000ce00: 6275 636b 6574 4e61 6d65 2c20 6f62 6a65  bucketName, obje
-0000ce10: 6374 4b65 792c 2071 7565 7279 5061 7261  ctKey, queryPara
-0000ce20: 6d73 2c0a 2020 2020 2020 2020 2020 2020  ms,.            
-0000ce30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce40: 2020 2020 2020 2020 2020 2020 6865 6164              head
-0000ce50: 4d61 702c 2073 6967 6e65 6448 6561 6465  Map, signedHeade
-0000ce60: 7273 2c20 2755 4e53 4947 4e45 442d 5041  rs, 'UNSIGNED-PA
-0000ce70: 594c 4f41 4427 295b 2753 6967 6e61 7475  YLOAD')['Signatu
-0000ce80: 7265 275d 0a0a 2020 2020 2020 2020 7175  re']..        qu
-0000ce90: 6572 7950 6172 616d 735b 2758 2d41 6d7a  eryParams['X-Amz
-0000cea0: 2d53 6967 6e61 7475 7265 275d 203d 2073  -Signature'] = s
-0000ceb0: 6967 6e61 7475 7265 0a0a 2020 2020 2020  ignature..      
-0000cec0: 2020 6966 2073 656c 662e 6973 5f63 6e61    if self.is_cna
-0000ced0: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
-0000cee0: 6275 636b 6574 4e61 6d65 203d 204e 6f6e  bucketName = Non
-0000cef0: 650a 0a20 2020 2020 2020 2072 6573 756c  e..        resul
-0000cf00: 7420 3d20 7b0a 2020 2020 2020 2020 2020  t = {.          
-0000cf10: 2020 2773 6967 6e65 6455 726c 273a 2063    'signedUrl': c
-0000cf20: 616c 6c69 6e67 5f66 6f72 6d61 742e 6765  alling_format.ge
-0000cf30: 745f 6675 6c6c 5f75 726c 2873 656c 662e  t_full_url(self.
-0000cf40: 6973 5f73 6563 7572 652c 2073 656c 662e  is_secure, self.
-0000cf50: 7365 7276 6572 2c20 7365 6c66 2e70 6f72  server, self.por
-0000cf60: 742c 2062 7563 6b65 744e 616d 652c 206f  t, bucketName, o
-0000cf70: 626a 6563 744b 6579 2c0a 2020 2020 2020  bjectKey,.      
-0000cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cfa0: 2020 2020 2020 2020 2020 2020 2020 2071                 q
-0000cfb0: 7565 7279 5061 7261 6d73 292c 0a20 2020  ueryParams),.   
-0000cfc0: 2020 2020 2020 2020 2027 6163 7475 616c           'actual
-0000cfd0: 5369 676e 6564 5265 7175 6573 7448 6561  SignedRequestHea
-0000cfe0: 6465 7273 273a 2068 6561 6465 7273 0a20  ders': headers. 
-0000cff0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
-0000d000: 2020 7265 7475 726e 205f 4372 6561 7465    return _Create
-0000d010: 5369 676e 6564 5572 6c52 6573 706f 6e73  SignedUrlRespons
-0000d020: 6528 2a2a 7265 7375 6c74 290a 0a20 2020  e(**result)..   
-0000d030: 2064 6566 2063 7265 6174 6556 3450 6f73   def createV4Pos
-0000d040: 7453 6967 6e61 7475 7265 2873 656c 662c  tSignature(self,
-0000d050: 2062 7563 6b65 744e 616d 653d 4e6f 6e65   bucketName=None
-0000d060: 2c20 6f62 6a65 6374 4b65 793d 4e6f 6e65  , objectKey=None
-0000d070: 2c20 6578 7069 7265 733d 3330 302c 2066  , expires=300, f
-0000d080: 6f72 6d50 6172 616d 733d 4e6f 6e65 293a  ormParams=None):
-0000d090: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000d0a0: 7365 6c66 2e5f 6372 6561 7465 506f 7374  self._createPost
-0000d0b0: 5369 676e 6174 7572 6528 6275 636b 6574  Signature(bucket
-0000d0c0: 4e61 6d65 2c20 6f62 6a65 6374 4b65 792c  Name, objectKey,
-0000d0d0: 2065 7870 6972 6573 2c20 666f 726d 5061   expires, formPa
-0000d0e0: 7261 6d73 2c20 5472 7565 290a 0a20 2020  rams, True)..   
-0000d0f0: 2064 6566 2063 7265 6174 6550 6f73 7453   def createPostS
-0000d100: 6967 6e61 7475 7265 2873 656c 662c 2062  ignature(self, b
-0000d110: 7563 6b65 744e 616d 653d 4e6f 6e65 2c20  ucketName=None, 
-0000d120: 6f62 6a65 6374 4b65 793d 4e6f 6e65 2c20  objectKey=None, 
-0000d130: 6578 7069 7265 733d 3330 302c 2066 6f72  expires=300, for
-0000d140: 6d50 6172 616d 733d 4e6f 6e65 293a 0a20  mParams=None):. 
-0000d150: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000d160: 6c66 2e5f 6372 6561 7465 506f 7374 5369  lf._createPostSi
-0000d170: 676e 6174 7572 6528 6275 636b 6574 4e61  gnature(bucketNa
-0000d180: 6d65 2c20 6f62 6a65 6374 4b65 792c 2065  me, objectKey, e
-0000d190: 7870 6972 6573 2c20 666f 726d 5061 7261  xpires, formPara
-0000d1a0: 6d73 2c20 7365 6c66 2e73 6967 6e61 7475  ms, self.signatu
-0000d1b0: 7265 2e6c 6f77 6572 2829 203d 3d20 2776  re.lower() == 'v
-0000d1c0: 3427 290a 0a20 2020 2064 6566 205f 6372  4')..    def _cr
-0000d1d0: 6561 7465 506f 7374 5369 676e 6174 7572  eatePostSignatur
-0000d1e0: 6528 7365 6c66 2c20 6275 636b 6574 4e61  e(self, bucketNa
-0000d1f0: 6d65 3d4e 6f6e 652c 206f 626a 6563 744b  me=None, objectK
-0000d200: 6579 3d4e 6f6e 652c 2065 7870 6972 6573  ey=None, expires
-0000d210: 3d33 3030 2c20 666f 726d 5061 7261 6d73  =300, formParams
-0000d220: 3d4e 6f6e 652c 2069 735f 7634 3d46 616c  =None, is_v4=Fal
-0000d230: 7365 293a 0a20 2020 2020 2020 2066 726f  se):.        fro
-0000d240: 6d20 6461 7465 7469 6d65 2069 6d70 6f72  m datetime impor
-0000d250: 7420 6461 7465 7469 6d65 2c20 7469 6d65  t datetime, time
-0000d260: 6465 6c74 610a 0a20 2020 2020 2020 2064  delta..        d
-0000d270: 6174 6520 3d20 6461 7465 7469 6d65 2e75  ate = datetime.u
-0000d280: 7463 6e6f 7728 290a 2020 2020 2020 2020  tcnow().        
-0000d290: 7368 6f72 7444 6174 6520 3d20 6461 7465  shortDate = date
-0000d2a0: 2e73 7472 6674 696d 6528 636f 6e73 742e  .strftime(const.
-0000d2b0: 5348 4f52 545f 4441 5445 5f46 4f52 4d41  SHORT_DATE_FORMA
-0000d2c0: 5429 0a20 2020 2020 2020 206c 6f6e 6744  T).        longD
-0000d2d0: 6174 6520 3d20 6461 7465 2e73 7472 6674  ate = date.strft
-0000d2e0: 696d 6528 636f 6e73 742e 4c4f 4e47 5f44  ime(const.LONG_D
-0000d2f0: 4154 455f 464f 524d 4154 290a 2020 2020  ATE_FORMAT).    
-0000d300: 2020 2020 7365 6375 7269 7479 5072 6f76      securityProv
-0000d310: 6964 6572 203d 2073 656c 662e 5f67 6574  ider = self._get
-0000d320: 5f74 6f6b 656e 2829 0a0a 2020 2020 2020  _token()..      
-0000d330: 2020 6578 7069 7265 7320 3d20 3330 3020    expires = 300 
-0000d340: 6966 2065 7870 6972 6573 2069 7320 4e6f  if expires is No
-0000d350: 6e65 2065 6c73 6520 7574 696c 2e74 6f5f  ne else util.to_
-0000d360: 696e 7428 6578 7069 7265 7329 0a20 2020  int(expires).   
-0000d370: 2020 2020 2065 7870 6972 6573 203d 2064       expires = d
-0000d380: 6174 6520 2b20 7469 6d65 6465 6c74 6128  ate + timedelta(
-0000d390: 7365 636f 6e64 733d 6578 7069 7265 7329  seconds=expires)
-0000d3a0: 0a0a 2020 2020 2020 2020 6578 7069 7265  ..        expire
-0000d3b0: 7320 3d20 6578 7069 7265 732e 7374 7266  s = expires.strf
-0000d3c0: 7469 6d65 2863 6f6e 7374 2e45 5850 4952  time(const.EXPIR
-0000d3d0: 4154 494f 4e5f 4441 5445 5f46 4f52 4d41  ATION_DATE_FORMA
-0000d3e0: 5429 0a0a 2020 2020 2020 2020 666f 726d  T)..        form
-0000d3f0: 5061 7261 6d73 203d 2073 656c 662e 5f70  Params = self._p
-0000d400: 6172 7365 5f70 6f73 745f 7061 7261 6d73  arse_post_params
-0000d410: 2866 6f72 6d50 6172 616d 732c 2073 6563  (formParams, sec
-0000d420: 7572 6974 7950 726f 7669 6465 722c 2069  urityProvider, i
-0000d430: 735f 7634 2c0a 2020 2020 2020 2020 2020  s_v4,.          
-0000d440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d460: 2020 2062 7563 6b65 744e 616d 652c 206f     bucketName, o
-0000d470: 626a 6563 744b 6579 2c20 6c6f 6e67 4461  bjectKey, longDa
-0000d480: 7465 2c20 7368 6f72 7444 6174 6529 0a0a  te, shortDate)..
-0000d490: 2020 2020 2020 2020 706f 6c69 6379 203d          policy =
-0000d4a0: 205b 277b 2265 7870 6972 6174 696f 6e22   ['{"expiration"
-0000d4b0: 3a22 275d 0a20 2020 2020 2020 2070 6f6c  :"'].        pol
-0000d4c0: 6963 792e 6170 7065 6e64 2865 7870 6972  icy.append(expir
-0000d4d0: 6573 290a 2020 2020 2020 2020 706f 6c69  es).        poli
-0000d4e0: 6379 2e61 7070 656e 6428 2722 2c20 2263  cy.append('", "c
-0000d4f0: 6f6e 6469 7469 6f6e 7322 3a5b 2729 0a0a  onditions":[')..
-0000d500: 2020 2020 2020 2020 6d61 7463 6841 6e79          matchAny
-0000d510: 4275 636b 6574 203d 2054 7275 650a 2020  Bucket = True.  
-0000d520: 2020 2020 2020 6d61 7463 6841 6e79 4b65        matchAnyKe
-0000d530: 7920 3d20 5472 7565 0a0a 2020 2020 2020  y = True..      
-0000d540: 2020 636f 6e64 6974 696f 6e41 6c6c 6f77    conditionAllow
-0000d550: 4b65 7973 203d 205b 2761 636c 272c 2027  Keys = ['acl', '
-0000d560: 6275 636b 6574 272c 2027 6b65 7927 2c20  bucket', 'key', 
-0000d570: 2773 7563 6365 7373 5f61 6374 696f 6e5f  'success_action_
-0000d580: 7265 6469 7265 6374 272c 2027 7265 6469  redirect', 'redi
-0000d590: 7265 6374 272c 2027 7375 6363 6573 735f  rect', 'success_
-0000d5a0: 6163 7469 6f6e 5f73 7461 7475 7327 5d0a  action_status'].
-0000d5b0: 0a20 2020 2020 2020 2066 6f72 206b 6579  .        for key
-0000d5c0: 2c20 7661 6c75 6520 696e 2066 6f72 6d50  , value in formP
-0000d5d0: 6172 616d 732e 6974 656d 7328 293a 0a20  arams.items():. 
-0000d5e0: 2020 2020 2020 2020 2020 2069 6620 6b65             if ke
-0000d5f0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0000d600: 2020 206b 6579 203d 2075 7469 6c2e 746f     key = util.to
-0000d610: 5f73 7472 696e 6728 6b65 7929 2e6c 6f77  _string(key).low
-0000d620: 6572 2829 0a0a 2020 2020 2020 2020 2020  er()..          
-0000d630: 2020 2020 2020 6966 206b 6579 203d 3d20        if key == 
-0000d640: 2762 7563 6b65 7427 3a0a 2020 2020 2020  'bucket':.      
-0000d650: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0000d660: 7463 6841 6e79 4275 636b 6574 203d 2046  tchAnyBucket = F
-0000d670: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-0000d680: 2020 2020 2065 6c69 6620 6b65 7920 3d3d       elif key ==
-0000d690: 2027 6b65 7927 3a0a 2020 2020 2020 2020   'key':.        
-0000d6a0: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
-0000d6b0: 6841 6e79 4b65 7920 3d20 4661 6c73 650a  hAnyKey = False.
-0000d6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d6d0: 2069 6620 6b65 7920 6e6f 7420 696e 2063   if key not in c
-0000d6e0: 6f6e 7374 2e41 4c4c 4f57 4544 5f52 4551  onst.ALLOWED_REQ
-0000d6f0: 5545 5354 5f48 5454 505f 4845 4144 4552  UEST_HTTP_HEADER
-0000d700: 5f4d 4554 4144 4154 415f 4e41 4d45 5320  _METADATA_NAMES 
-0000d710: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0000d720: 2020 2020 2020 2020 2020 616e 6420 6e6f            and no
-0000d730: 7420 6b65 792e 7374 6172 7473 7769 7468  t key.startswith
-0000d740: 2873 656c 662e 6861 2e5f 6765 745f 6865  (self.ha._get_he
-0000d750: 6164 6572 5f70 7265 6669 7828 2929 205c  ader_prefix()) \
-0000d760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d770: 2020 2020 2020 2020 2061 6e64 206e 6f74           and not
-0000d780: 206b 6579 2e73 7461 7274 7377 6974 6828   key.startswith(
-0000d790: 636f 6e73 742e 4f42 535f 4845 4144 4552  const.OBS_HEADER
-0000d7a0: 5f50 5245 4649 5829 2061 6e64 206b 6579  _PREFIX) and key
-0000d7b0: 206e 6f74 2069 6e20 636f 6e64 6974 696f   not in conditio
-0000d7c0: 6e41 6c6c 6f77 4b65 7973 3a0a 2020 2020  nAllowKeys:.    
-0000d7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7e0: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
-0000d7f0: 2020 2020 2020 2020 2020 706f 6c69 6379            policy
-0000d800: 2e61 7070 656e 6428 277b 2227 290a 2020  .append('{"').  
-0000d810: 2020 2020 2020 2020 2020 2020 2020 706f                po
-0000d820: 6c69 6379 2e61 7070 656e 6428 6b65 7929  licy.append(key)
-0000d830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d840: 2070 6f6c 6963 792e 6170 7065 6e64 2827   policy.append('
-0000d850: 223a 2227 290a 2020 2020 2020 2020 2020  ":"').          
-0000d860: 2020 2020 2020 706f 6c69 6379 2e61 7070        policy.app
-0000d870: 656e 6428 7574 696c 2e74 6f5f 7374 7269  end(util.to_stri
-0000d880: 6e67 2876 616c 7565 2929 0a20 2020 2020  ng(value)).     
-0000d890: 2020 2020 2020 2020 2020 2070 6f6c 6963             polic
-0000d8a0: 792e 6170 7065 6e64 2827 227d 2c27 290a  y.append('"},').
-0000d8b0: 0a20 2020 2020 2020 2069 6620 6d61 7463  .        if matc
-0000d8c0: 6841 6e79 4275 636b 6574 3a0a 2020 2020  hAnyBucket:.    
-0000d8d0: 2020 2020 2020 2020 706f 6c69 6379 2e61          policy.a
-0000d8e0: 7070 656e 6428 275b 2273 7461 7274 732d  ppend('["starts-
-0000d8f0: 7769 7468 222c 2022 2462 7563 6b65 7422  with", "$bucket"
-0000d900: 2c20 2222 5d2c 2729 0a0a 2020 2020 2020  , ""],')..      
-0000d910: 2020 6966 206d 6174 6368 416e 794b 6579    if matchAnyKey
-0000d920: 3a0a 2020 2020 2020 2020 2020 2020 706f  :.            po
-0000d930: 6c69 6379 2e61 7070 656e 6428 275b 2273  licy.append('["s
-0000d940: 7461 7274 732d 7769 7468 222c 2022 246b  tarts-with", "$k
-0000d950: 6579 222c 2022 225d 2c27 290a 0a20 2020  ey", ""],')..   
-0000d960: 2020 2020 2070 6f6c 6963 792e 6170 7065       policy.appe
-0000d970: 6e64 2827 5d7d 2729 0a0a 2020 2020 2020  nd(']}')..      
-0000d980: 2020 6f72 6967 696e 506f 6c69 6379 203d    originPolicy =
-0000d990: 2027 272e 6a6f 696e 2870 6f6c 6963 7929   ''.join(policy)
-0000d9a0: 0a0a 2020 2020 2020 2020 706f 6c69 6379  ..        policy
-0000d9b0: 203d 2075 7469 6c2e 6261 7365 3634 5f65   = util.base64_e
-0000d9c0: 6e63 6f64 6528 6f72 6967 696e 506f 6c69  ncode(originPoli
-0000d9d0: 6379 290a 0a20 2020 2020 2020 2072 6573  cy)..        res
-0000d9e0: 756c 7420 3d20 7365 6c66 2e5f 7061 7273  ult = self._pars
-0000d9f0: 655f 706f 7374 5f73 6967 6e61 7475 7265  e_post_signature
-0000da00: 5f74 7970 6528 6973 5f76 342c 2073 6563  _type(is_v4, sec
-0000da10: 7572 6974 7950 726f 7669 6465 722c 206f  urityProvider, o
-0000da20: 7269 6769 6e50 6f6c 6963 792c 0a20 2020  riginPolicy,.   
-0000da30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da50: 2020 2020 2020 2020 2020 2020 2020 706f                po
-0000da60: 6c69 6379 2c20 666f 726d 5061 7261 6d73  licy, formParams
-0000da70: 2c20 7368 6f72 7444 6174 652c 206c 6f6e  , shortDate, lon
-0000da80: 6744 6174 6529 0a20 2020 2020 2020 2072  gDate).        r
-0000da90: 6574 7572 6e20 5f43 7265 6174 6550 6f73  eturn _CreatePos
-0000daa0: 7453 6967 6e61 7475 7265 5265 7370 6f6e  tSignatureRespon
-0000dab0: 7365 282a 2a72 6573 756c 7429 0a0a 2020  se(**result)..  
-0000dac0: 2020 6465 6620 5f70 6172 7365 5f70 6f73    def _parse_pos
-0000dad0: 745f 7061 7261 6d73 2873 656c 662c 2066  t_params(self, f
-0000dae0: 6f72 6d50 6172 616d 732c 2073 6563 7572  ormParams, secur
-0000daf0: 6974 7950 726f 7669 6465 722c 2069 735f  ityProvider, is_
-0000db00: 7634 2c20 6275 636b 6574 4e61 6d65 2c20  v4, bucketName, 
-0000db10: 6f62 6a65 6374 4b65 792c 206c 6f6e 6744  objectKey, longD
-0000db20: 6174 652c 2073 686f 7274 4461 7465 293a  ate, shortDate):
-0000db30: 0a20 2020 2020 2020 2066 6f72 6d50 6172  .        formPar
-0000db40: 616d 7320 3d20 7b7d 2069 6620 666f 726d  ams = {} if form
-0000db50: 5061 7261 6d73 2069 7320 4e6f 6e65 206f  Params is None o
-0000db60: 7220 6e6f 7420 6973 696e 7374 616e 6365  r not isinstance
-0000db70: 2866 6f72 6d50 6172 616d 732c 0a20 2020  (formParams,.   
-0000db80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dbb0: 2020 2020 2020 2020 2020 2020 2064 6963               dic
-0000dbc0: 7429 2065 6c73 6520 666f 726d 5061 7261  t) else formPara
-0000dbd0: 6d73 2e63 6f70 7928 290a 0a20 2020 2020  ms.copy()..     
-0000dbe0: 2020 2069 6620 7365 6375 7269 7479 5072     if securityPr
-0000dbf0: 6f76 6964 6572 2e73 6563 7572 6974 795f  ovider.security_
-0000dc00: 746f 6b65 6e20 6973 206e 6f74 204e 6f6e  token is not Non
-0000dc10: 6520 616e 6420 7365 6c66 2e68 612e 7365  e and self.ha.se
-0000dc20: 6375 7269 7479 5f74 6f6b 656e 5f68 6561  curity_token_hea
-0000dc30: 6465 7228 2920 6e6f 7420 696e 2066 6f72  der() not in for
-0000dc40: 6d50 6172 616d 733a 0a20 2020 2020 2020  mParams:.       
-0000dc50: 2020 2020 2066 6f72 6d50 6172 616d 735b       formParams[
-0000dc60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dc70: 2073 656c 662e 6861 2e73 6563 7572 6974   self.ha.securit
-0000dc80: 795f 746f 6b65 6e5f 6865 6164 6572 2829  y_token_header()
-0000dc90: 5d20 3d20 7365 6375 7269 7479 5072 6f76  ] = securityProv
-0000dca0: 6964 6572 2e73 6563 7572 6974 795f 746f  ider.security_to
-0000dcb0: 6b65 6e0a 0a20 2020 2020 2020 2069 6620  ken..        if 
-0000dcc0: 6973 5f76 343a 0a20 2020 2020 2020 2020  is_v4:.         
-0000dcd0: 2020 2066 6f72 6d50 6172 616d 735b 2758     formParams['X
-0000dce0: 2d41 6d7a 2d41 6c67 6f72 6974 686d 275d  -Amz-Algorithm']
-0000dcf0: 203d 2027 4157 5334 2d48 4d41 432d 5348   = 'AWS4-HMAC-SH
-0000dd00: 4132 3536 270a 2020 2020 2020 2020 2020  A256'.          
-0000dd10: 2020 666f 726d 5061 7261 6d73 5b27 582d    formParams['X-
-0000dd20: 416d 7a2d 4461 7465 275d 203d 206c 6f6e  Amz-Date'] = lon
-0000dd30: 6744 6174 650a 2020 2020 2020 2020 2020  gDate.          
-0000dd40: 2020 666f 726d 5061 7261 6d73 5b27 582d    formParams['X-
-0000dd50: 416d 7a2d 4372 6564 656e 7469 616c 275d  Amz-Credential']
-0000dd60: 203d 2027 2573 2f25 732f 2573 2f73 332f   = '%s/%s/%s/s3/
-0000dd70: 6177 7334 5f72 6571 7565 7374 2720 2520  aws4_request' % 
-0000dd80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000dd90: 2020 7365 6375 7269 7479 5072 6f76 6964    securityProvid
-0000dda0: 6572 2e61 6363 6573 735f 6b65 795f 6964  er.access_key_id
-0000ddb0: 2c20 7368 6f72 7444 6174 652c 2073 656c  , shortDate, sel
-0000ddc0: 662e 7265 6769 6f6e 290a 0a20 2020 2020  f.region)..     
-0000ddd0: 2020 2069 6620 6275 636b 6574 4e61 6d65     if bucketName
-0000dde0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-0000ddf0: 726d 5061 7261 6d73 5b27 6275 636b 6574  rmParams['bucket
-0000de00: 275d 203d 2062 7563 6b65 744e 616d 650a  '] = bucketName.
-0000de10: 0a20 2020 2020 2020 2069 6620 6f62 6a65  .        if obje
-0000de20: 6374 4b65 793a 0a20 2020 2020 2020 2020  ctKey:.         
-0000de30: 2020 2066 6f72 6d50 6172 616d 735b 276b     formParams['k
-0000de40: 6579 275d 203d 206f 626a 6563 744b 6579  ey'] = objectKey
-0000de50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000de60: 666f 726d 5061 7261 6d73 0a0a 2020 2020  formParams..    
-0000de70: 6465 6620 5f70 6172 7365 5f70 6f73 745f  def _parse_post_
-0000de80: 7369 676e 6174 7572 655f 7479 7065 2873  signature_type(s
-0000de90: 656c 662c 2069 735f 7634 2c20 7365 6375  elf, is_v4, secu
-0000dea0: 7269 7479 5072 6f76 6964 6572 2c20 6f72  rityProvider, or
-0000deb0: 6967 696e 506f 6c69 6379 2c20 706f 6c69  iginPolicy, poli
-0000dec0: 6379 2c20 666f 726d 5061 7261 6d73 2c0a  cy, formParams,.
-0000ded0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000def0: 2020 2073 686f 7274 4461 7465 2c20 6c6f     shortDate, lo
-0000df00: 6e67 4461 7465 293a 0a20 2020 2020 2020  ngDate):.       
-0000df10: 2069 6620 6973 5f76 343a 0a20 2020 2020   if is_v4:.     
-0000df20: 2020 2020 2020 2076 3441 7574 6820 3d20         v4Auth = 
-0000df30: 6175 7468 2e56 3441 7574 6865 6e74 6963  auth.V4Authentic
-0000df40: 6174 696f 6e28 7365 6375 7269 7479 5072  ation(securityPr
-0000df50: 6f76 6964 6572 2e61 6363 6573 735f 6b65  ovider.access_ke
-0000df60: 795f 6964 2c20 7365 6375 7269 7479 5072  y_id, securityPr
-0000df70: 6f76 6964 6572 2e73 6563 7265 745f 6163  ovider.secret_ac
-0000df80: 6365 7373 5f6b 6579 2c0a 2020 2020 2020  cess_key,.      
+0000c390: 2020 2020 2020 2020 7365 6c66 2e70 6174          self.pat
+0000c3a0: 685f 7374 796c 652c 2073 656c 662e 6861  h_style, self.ha
+0000c3b0: 2c20 7365 6c66 2e73 6572 7665 722c 2073  , self.server, s
+0000c3c0: 656c 662e 6973 5f63 6e61 6d65 290a 0a20  elf.is_cname).. 
+0000c3d0: 2020 2020 2020 2073 6967 6e61 7475 7265         signature
+0000c3e0: 203d 2076 3241 7574 682e 6765 7453 6967   = v2Auth.getSig
+0000c3f0: 6e61 7475 7265 286d 6574 686f 642c 2062  nature(method, b
+0000c400: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
+0000c410: 744b 6579 2c20 7175 6572 7950 6172 616d  tKey, queryParam
+0000c420: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0000c430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c440: 2020 2020 2020 2020 2020 2068 6561 6465             heade
+0000c450: 7273 2c20 7574 696c 2e74 6f5f 7374 7269  rs, util.to_stri
+0000c460: 6e67 2865 7870 6972 6573 2929 5b27 5369  ng(expires))['Si
+0000c470: 676e 6174 7572 6527 5d0a 0a20 2020 2020  gnature']..     
+0000c480: 2020 2071 7565 7279 5061 7261 6d73 5b27     queryParams['
+0000c490: 4578 7069 7265 7327 5d20 3d20 6578 7069  Expires'] = expi
+0000c4a0: 7265 730a 2020 2020 2020 2020 7175 6572  res.        quer
+0000c4b0: 7950 6172 616d 735b 2741 6363 6573 734b  yParams['AccessK
+0000c4c0: 6579 4964 2720 6966 2073 656c 662e 7369  eyId' if self.si
+0000c4d0: 676e 6174 7572 6520 3d3d 2027 6f62 7327  gnature == 'obs'
+0000c4e0: 2065 6c73 6520 2741 5753 4163 6365 7373   else 'AWSAccess
+0000c4f0: 4b65 7949 6427 5d20 3d20 7365 6375 7269  KeyId'] = securi
+0000c500: 7479 5072 6f76 6964 6572 2e61 6363 6573  tyProvider.acces
+0000c510: 735f 6b65 795f 6964 0a20 2020 2020 2020  s_key_id.       
+0000c520: 2071 7565 7279 5061 7261 6d73 5b27 5369   queryParams['Si
+0000c530: 676e 6174 7572 6527 5d20 3d20 7369 676e  gnature'] = sign
+0000c540: 6174 7572 650a 0a20 2020 2020 2020 2069  ature..        i
+0000c550: 6620 7365 6c66 2e69 735f 636e 616d 653a  f self.is_cname:
+0000c560: 0a20 2020 2020 2020 2020 2020 2062 7563  .            buc
+0000c570: 6b65 744e 616d 6520 3d20 4e6f 6e65 0a0a  ketName = None..
+0000c580: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+0000c590: 207b 2773 6967 6e65 6455 726c 273a 2063   {'signedUrl': c
+0000c5a0: 616c 6c69 6e67 5f66 6f72 6d61 742e 6765  alling_format.ge
+0000c5b0: 745f 6675 6c6c 5f75 726c 2873 656c 662e  t_full_url(self.
+0000c5c0: 6973 5f73 6563 7572 652c 2073 656c 662e  is_secure, self.
+0000c5d0: 7365 7276 6572 2c0a 2020 2020 2020 2020  server,.        
+0000c5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c610: 2020 2073 656c 662e 706f 7274 2c20 6275     self.port, bu
+0000c620: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
+0000c630: 4b65 792c 0a20 2020 2020 2020 2020 2020  Key,.           
+0000c640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c670: 7175 6572 7950 6172 616d 7329 2c0a 2020  queryParams),.  
+0000c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c690: 2761 6374 7561 6c53 6967 6e65 6452 6571  'actualSignedReq
+0000c6a0: 7565 7374 4865 6164 6572 7327 3a20 6865  uestHeaders': he
+0000c6b0: 6164 6572 737d 0a0a 2020 2020 2020 2020  aders}..        
+0000c6c0: 7265 7475 726e 205f 4372 6561 7465 5369  return _CreateSi
+0000c6d0: 676e 6564 5572 6c52 6573 706f 6e73 6528  gnedUrlResponse(
+0000c6e0: 2a2a 7265 7375 6c74 290a 0a20 2020 2064  **result)..    d
+0000c6f0: 6566 205f 6372 6561 7465 5634 5369 676e  ef _createV4Sign
+0000c700: 6564 5572 6c28 7365 6c66 2c20 6d65 7468  edUrl(self, meth
+0000c710: 6f64 2c20 6275 636b 6574 4e61 6d65 3d4e  od, bucketName=N
+0000c720: 6f6e 652c 206f 626a 6563 744b 6579 3d4e  one, objectKey=N
+0000c730: 6f6e 652c 2073 7065 6369 616c 5061 7261  one, specialPara
+0000c740: 6d3d 4e6f 6e65 2c20 6578 7069 7265 733d  m=None, expires=
+0000c750: 3330 302c 2068 6561 6465 7273 3d4e 6f6e  300, headers=Non
+0000c760: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000c770: 2020 2020 2020 2020 2020 2020 2020 7175                qu
+0000c780: 6572 7950 6172 616d 733d 4e6f 6e65 293a  eryParams=None):
+0000c790: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
+0000c7a0: 7465 7469 6d65 2069 6d70 6f72 7420 6461  tetime import da
+0000c7b0: 7465 7469 6d65 0a0a 2020 2020 2020 2020  tetime..        
+0000c7c0: 6865 6164 6572 732c 2071 7565 7279 5061  headers, queryPa
+0000c7d0: 7261 6d73 2c20 6578 7069 7265 732c 2063  rams, expires, c
+0000c7e0: 616c 6c69 6e67 5f66 6f72 6d61 7420 3d20  alling_format = 
+0000c7f0: 7365 6c66 2e5f 7072 6570 6172 6550 6172  self._preparePar
+0000c800: 616d 6574 6572 466f 7253 6967 6e65 6455  ameterForSignedU
+0000c810: 726c 2873 7065 6369 616c 5061 7261 6d2c  rl(specialParam,
+0000c820: 2065 7870 6972 6573 2c0a 2020 2020 2020   expires,.      
+0000c830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c880: 2020 2020 2068 6561 6465 7273 2c20 7175       headers, qu
+0000c890: 6572 7950 6172 616d 7329 0a0a 2020 2020  eryParams)..    
+0000c8a0: 2020 2020 6966 2073 656c 662e 6973 5f63      if self.is_c
+0000c8b0: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
+0000c8c0: 2020 636f 6e6e 6563 745f 7365 7276 6572    connect_server
+0000c8d0: 203d 2073 656c 662e 7365 7276 6572 0a20   = self.server. 
+0000c8e0: 2020 2020 2020 2020 2020 2062 7563 6b65             bucke
+0000c8f0: 744e 616d 6520 3d20 4e6f 6e65 0a20 2020  tName = None.   
+0000c900: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000c910: 2020 2020 2020 2063 6f6e 6e65 6374 5f73         connect_s
+0000c920: 6572 7665 7220 3d20 6361 6c6c 696e 675f  erver = calling_
+0000c930: 666f 726d 6174 2e67 6574 5f73 6572 7665  format.get_serve
+0000c940: 7228 7365 6c66 2e73 6572 7665 722c 2062  r(self.server, b
+0000c950: 7563 6b65 744e 616d 6529 0a0a 2020 2020  ucketName)..    
+0000c960: 2020 2020 6865 6164 6572 735b 636f 6e73      headers[cons
+0000c970: 742e 484f 5354 5f48 4541 4445 525d 203d  t.HOST_HEADER] =
+0000c980: 2027 2573 3a25 7327 2025 2028 0a20 2020   '%s:%s' % (.   
+0000c990: 2020 2020 2020 2020 2063 6f6e 6e65 6374           connect
+0000c9a0: 5f73 6572 7665 722c 2073 656c 662e 706f  _server, self.po
+0000c9b0: 7274 2920 6966 2073 656c 662e 706f 7274  rt) if self.port
+0000c9c0: 2021 3d20 3434 3320 616e 6420 7365 6c66   != 443 and self
+0000c9d0: 2e70 6f72 7420 213d 2038 3020 656c 7365  .port != 80 else
+0000c9e0: 2063 6f6e 6e65 6374 5f73 6572 7665 720a   connect_server.
+0000c9f0: 0a20 2020 2020 2020 2064 6174 6520 3d20  .        date = 
+0000ca00: 6865 6164 6572 735b 636f 6e73 742e 4441  headers[const.DA
+0000ca10: 5445 5f48 4541 4445 525d 2069 6620 636f  TE_HEADER] if co
+0000ca20: 6e73 742e 4441 5445 5f48 4541 4445 5220  nst.DATE_HEADER 
+0000ca30: 696e 2068 6561 6465 7273 2065 6c73 6520  in headers else 
+0000ca40: 6865 6164 6572 732e 6765 7428 636f 6e73  headers.get(cons
+0000ca50: 742e 4441 5445 5f48 4541 4445 522e 6c6f  t.DATE_HEADER.lo
+0000ca60: 7765 7228 2929 0a20 2020 2020 2020 2064  wer()).        d
+0000ca70: 6174 6520 3d20 6461 7465 7469 6d65 2e73  ate = datetime.s
+0000ca80: 7472 7074 696d 6528 6461 7465 2c20 636f  trptime(date, co
+0000ca90: 6e73 742e 474d 545f 4441 5445 5f46 4f52  nst.GMT_DATE_FOR
+0000caa0: 4d41 5429 2069 6620 6461 7465 2065 6c73  MAT) if date els
+0000cab0: 6520 6461 7465 7469 6d65 2e75 7463 6e6f  e datetime.utcno
+0000cac0: 7728 290a 2020 2020 2020 2020 7368 6f72  w().        shor
+0000cad0: 7444 6174 6520 3d20 6461 7465 2e73 7472  tDate = date.str
+0000cae0: 6674 696d 6528 636f 6e73 742e 5348 4f52  ftime(const.SHOR
+0000caf0: 545f 4441 5445 5f46 4f52 4d41 5429 0a20  T_DATE_FORMAT). 
+0000cb00: 2020 2020 2020 206c 6f6e 6744 6174 6520         longDate 
+0000cb10: 3d20 6461 7465 2e73 7472 6674 696d 6528  = date.strftime(
+0000cb20: 636f 6e73 742e 4c4f 4e47 5f44 4154 455f  const.LONG_DATE_
+0000cb30: 464f 524d 4154 290a 0a20 2020 2020 2020  FORMAT)..       
+0000cb40: 2073 6563 7572 6974 7950 726f 7669 6465   securityProvide
+0000cb50: 7220 3d20 7365 6c66 2e5f 6765 745f 746f  r = self._get_to
+0000cb60: 6b65 6e28 290a 0a20 2020 2020 2020 2069  ken()..        i
+0000cb70: 6620 7365 6375 7269 7479 5072 6f76 6964  f securityProvid
+0000cb80: 6572 2e73 6563 7572 6974 795f 746f 6b65  er.security_toke
+0000cb90: 6e20 6973 206e 6f74 204e 6f6e 6520 616e  n is not None an
+0000cba0: 6420 7365 6c66 2e68 612e 7365 6375 7269  d self.ha.securi
+0000cbb0: 7479 5f74 6f6b 656e 5f68 6561 6465 7228  ty_token_header(
+0000cbc0: 2920 6e6f 7420 696e 2071 7565 7279 5061  ) not in queryPa
+0000cbd0: 7261 6d73 3a0a 2020 2020 2020 2020 2020  rams:.          
+0000cbe0: 2020 7175 6572 7950 6172 616d 735b 7365    queryParams[se
+0000cbf0: 6c66 2e68 612e 7365 6375 7269 7479 5f74  lf.ha.security_t
+0000cc00: 6f6b 656e 5f68 6561 6465 7228 295d 203d  oken_header()] =
+0000cc10: 2073 6563 7572 6974 7950 726f 7669 6465   securityProvide
+0000cc20: 722e 7365 6375 7269 7479 5f74 6f6b 656e  r.security_token
+0000cc30: 0a0a 2020 2020 2020 2020 7634 4175 7468  ..        v4Auth
+0000cc40: 203d 2061 7574 682e 5634 4175 7468 656e   = auth.V4Authen
+0000cc50: 7469 6361 7469 6f6e 2873 6563 7572 6974  tication(securit
+0000cc60: 7950 726f 7669 6465 722e 6163 6365 7373  yProvider.access
+0000cc70: 5f6b 6579 5f69 642c 2073 6563 7572 6974  _key_id, securit
+0000cc80: 7950 726f 7669 6465 722e 7365 6372 6574  yProvider.secret
+0000cc90: 5f61 6363 6573 735f 6b65 792c 2073 656c  _access_key, sel
+0000cca0: 662e 7265 6769 6f6e 2c0a 2020 2020 2020  f.region,.      
+0000ccb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ccc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ccd0: 2073 686f 7274 4461 7465 2c20 6c6f 6e67   shortDate, long
+0000cce0: 4461 7465 2c20 7365 6c66 2e70 6174 685f  Date, self.path_
+0000ccf0: 7374 796c 652c 2073 656c 662e 6861 290a  style, self.ha).
+0000cd00: 0a20 2020 2020 2020 2071 7565 7279 5061  .        queryPa
+0000cd10: 7261 6d73 5b27 582d 416d 7a2d 416c 676f  rams['X-Amz-Algo
+0000cd20: 7269 7468 6d27 5d20 3d20 2741 5753 342d  rithm'] = 'AWS4-
+0000cd30: 484d 4143 2d53 4841 3235 3627 0a20 2020  HMAC-SHA256'.   
+0000cd40: 2020 2020 2071 7565 7279 5061 7261 6d73       queryParams
+0000cd50: 5b27 582d 416d 7a2d 4372 6564 656e 7469  ['X-Amz-Credenti
+0000cd60: 616c 275d 203d 2076 3441 7574 682e 6765  al'] = v4Auth.ge
+0000cd70: 7443 7265 6465 6e74 6961 6c28 290a 2020  tCredential().  
+0000cd80: 2020 2020 2020 7175 6572 7950 6172 616d        queryParam
+0000cd90: 735b 2758 2d41 6d7a 2d44 6174 6527 5d20  s['X-Amz-Date'] 
+0000cda0: 3d20 6c6f 6e67 4461 7465 0a20 2020 2020  = longDate.     
+0000cdb0: 2020 2071 7565 7279 5061 7261 6d73 5b27     queryParams['
+0000cdc0: 582d 416d 7a2d 4578 7069 7265 7327 5d20  X-Amz-Expires'] 
+0000cdd0: 3d20 6578 7069 7265 730a 0a20 2020 2020  = expires..     
+0000cde0: 2020 2068 6561 644d 6170 203d 2076 3441     headMap = v4A
+0000cdf0: 7574 682e 7365 744d 6170 4b65 794c 6f77  uth.setMapKeyLow
+0000ce00: 6572 2868 6561 6465 7273 290a 2020 2020  er(headers).    
+0000ce10: 2020 2020 7369 676e 6564 4865 6164 6572      signedHeader
+0000ce20: 7320 3d20 7634 4175 7468 2e67 6574 5369  s = v4Auth.getSi
+0000ce30: 676e 6564 4865 6164 6572 7328 6865 6164  gnedHeaders(head
+0000ce40: 4d61 7029 0a0a 2020 2020 2020 2020 7175  Map)..        qu
+0000ce50: 6572 7950 6172 616d 735b 2758 2d41 6d7a  eryParams['X-Amz
+0000ce60: 2d53 6967 6e65 6448 6561 6465 7273 275d  -SignedHeaders']
+0000ce70: 203d 2073 6967 6e65 6448 6561 6465 7273   = signedHeaders
+0000ce80: 0a0a 2020 2020 2020 2020 7369 676e 6174  ..        signat
+0000ce90: 7572 6520 3d20 7634 4175 7468 2e67 6574  ure = v4Auth.get
+0000cea0: 5369 676e 6174 7572 6528 6d65 7468 6f64  Signature(method
+0000ceb0: 2c20 6275 636b 6574 4e61 6d65 2c20 6f62  , bucketName, ob
+0000cec0: 6a65 6374 4b65 792c 2071 7565 7279 5061  jectKey, queryPa
+0000ced0: 7261 6d73 2c0a 2020 2020 2020 2020 2020  rams,.          
+0000cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cef0: 2020 2020 2020 2020 2020 2020 2020 6865                he
+0000cf00: 6164 4d61 702c 2073 6967 6e65 6448 6561  adMap, signedHea
+0000cf10: 6465 7273 2c20 2755 4e53 4947 4e45 442d  ders, 'UNSIGNED-
+0000cf20: 5041 594c 4f41 4427 295b 2753 6967 6e61  PAYLOAD')['Signa
+0000cf30: 7475 7265 275d 0a0a 2020 2020 2020 2020  ture']..        
+0000cf40: 7175 6572 7950 6172 616d 735b 2758 2d41  queryParams['X-A
+0000cf50: 6d7a 2d53 6967 6e61 7475 7265 275d 203d  mz-Signature'] =
+0000cf60: 2073 6967 6e61 7475 7265 0a0a 2020 2020   signature..    
+0000cf70: 2020 2020 6966 2073 656c 662e 6973 5f63      if self.is_c
+0000cf80: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
+0000cf90: 2020 6275 636b 6574 4e61 6d65 203d 204e    bucketName = N
+0000cfa0: 6f6e 650a 0a20 2020 2020 2020 2072 6573  one..        res
+0000cfb0: 756c 7420 3d20 7b0a 2020 2020 2020 2020  ult = {.        
+0000cfc0: 2020 2020 2773 6967 6e65 6455 726c 273a      'signedUrl':
+0000cfd0: 2063 616c 6c69 6e67 5f66 6f72 6d61 742e   calling_format.
+0000cfe0: 6765 745f 6675 6c6c 5f75 726c 2873 656c  get_full_url(sel
+0000cff0: 662e 6973 5f73 6563 7572 652c 2073 656c  f.is_secure, sel
+0000d000: 662e 7365 7276 6572 2c20 7365 6c66 2e70  f.server, self.p
+0000d010: 6f72 742c 2062 7563 6b65 744e 616d 652c  ort, bucketName,
+0000d020: 206f 626a 6563 744b 6579 2c0a 2020 2020   objectKey,.    
+0000d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d060: 2071 7565 7279 5061 7261 6d73 292c 0a20   queryParams),. 
+0000d070: 2020 2020 2020 2020 2020 2027 6163 7475             'actu
+0000d080: 616c 5369 676e 6564 5265 7175 6573 7448  alSignedRequestH
+0000d090: 6561 6465 7273 273a 2068 6561 6465 7273  eaders': headers
+0000d0a0: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+0000d0b0: 2020 2020 7265 7475 726e 205f 4372 6561      return _Crea
+0000d0c0: 7465 5369 676e 6564 5572 6c52 6573 706f  teSignedUrlRespo
+0000d0d0: 6e73 6528 2a2a 7265 7375 6c74 290a 0a20  nse(**result).. 
+0000d0e0: 2020 2064 6566 2063 7265 6174 6556 3450     def createV4P
+0000d0f0: 6f73 7453 6967 6e61 7475 7265 2873 656c  ostSignature(sel
+0000d100: 662c 2062 7563 6b65 744e 616d 653d 4e6f  f, bucketName=No
+0000d110: 6e65 2c20 6f62 6a65 6374 4b65 793d 4e6f  ne, objectKey=No
+0000d120: 6e65 2c20 6578 7069 7265 733d 3330 302c  ne, expires=300,
+0000d130: 2066 6f72 6d50 6172 616d 733d 4e6f 6e65   formParams=None
+0000d140: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+0000d150: 6e20 7365 6c66 2e5f 6372 6561 7465 506f  n self._createPo
+0000d160: 7374 5369 676e 6174 7572 6528 6275 636b  stSignature(buck
+0000d170: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
+0000d180: 792c 2065 7870 6972 6573 2c20 666f 726d  y, expires, form
+0000d190: 5061 7261 6d73 2c20 5472 7565 290a 0a20  Params, True).. 
+0000d1a0: 2020 2064 6566 2063 7265 6174 6550 6f73     def createPos
+0000d1b0: 7453 6967 6e61 7475 7265 2873 656c 662c  tSignature(self,
+0000d1c0: 2062 7563 6b65 744e 616d 653d 4e6f 6e65   bucketName=None
+0000d1d0: 2c20 6f62 6a65 6374 4b65 793d 4e6f 6e65  , objectKey=None
+0000d1e0: 2c20 6578 7069 7265 733d 3330 302c 2066  , expires=300, f
+0000d1f0: 6f72 6d50 6172 616d 733d 4e6f 6e65 293a  ormParams=None):
+0000d200: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000d210: 7365 6c66 2e5f 6372 6561 7465 506f 7374  self._createPost
+0000d220: 5369 676e 6174 7572 6528 6275 636b 6574  Signature(bucket
+0000d230: 4e61 6d65 2c20 6f62 6a65 6374 4b65 792c  Name, objectKey,
+0000d240: 2065 7870 6972 6573 2c20 666f 726d 5061   expires, formPa
+0000d250: 7261 6d73 2c20 7365 6c66 2e73 6967 6e61  rams, self.signa
+0000d260: 7475 7265 2e6c 6f77 6572 2829 203d 3d20  ture.lower() == 
+0000d270: 2776 3427 290a 0a20 2020 2064 6566 205f  'v4')..    def _
+0000d280: 6372 6561 7465 506f 7374 5369 676e 6174  createPostSignat
+0000d290: 7572 6528 7365 6c66 2c20 6275 636b 6574  ure(self, bucket
+0000d2a0: 4e61 6d65 3d4e 6f6e 652c 206f 626a 6563  Name=None, objec
+0000d2b0: 744b 6579 3d4e 6f6e 652c 2065 7870 6972  tKey=None, expir
+0000d2c0: 6573 3d33 3030 2c20 666f 726d 5061 7261  es=300, formPara
+0000d2d0: 6d73 3d4e 6f6e 652c 2069 735f 7634 3d46  ms=None, is_v4=F
+0000d2e0: 616c 7365 293a 0a20 2020 2020 2020 2066  alse):.        f
+0000d2f0: 726f 6d20 6461 7465 7469 6d65 2069 6d70  rom datetime imp
+0000d300: 6f72 7420 6461 7465 7469 6d65 2c20 7469  ort datetime, ti
+0000d310: 6d65 6465 6c74 610a 0a20 2020 2020 2020  medelta..       
+0000d320: 2064 6174 6520 3d20 6461 7465 7469 6d65   date = datetime
+0000d330: 2e75 7463 6e6f 7728 290a 2020 2020 2020  .utcnow().      
+0000d340: 2020 7368 6f72 7444 6174 6520 3d20 6461    shortDate = da
+0000d350: 7465 2e73 7472 6674 696d 6528 636f 6e73  te.strftime(cons
+0000d360: 742e 5348 4f52 545f 4441 5445 5f46 4f52  t.SHORT_DATE_FOR
+0000d370: 4d41 5429 0a20 2020 2020 2020 206c 6f6e  MAT).        lon
+0000d380: 6744 6174 6520 3d20 6461 7465 2e73 7472  gDate = date.str
+0000d390: 6674 696d 6528 636f 6e73 742e 4c4f 4e47  ftime(const.LONG
+0000d3a0: 5f44 4154 455f 464f 524d 4154 290a 2020  _DATE_FORMAT).  
+0000d3b0: 2020 2020 2020 7365 6375 7269 7479 5072        securityPr
+0000d3c0: 6f76 6964 6572 203d 2073 656c 662e 5f67  ovider = self._g
+0000d3d0: 6574 5f74 6f6b 656e 2829 0a0a 2020 2020  et_token()..    
+0000d3e0: 2020 2020 6578 7069 7265 7320 3d20 3330      expires = 30
+0000d3f0: 3020 6966 2065 7870 6972 6573 2069 7320  0 if expires is 
+0000d400: 4e6f 6e65 2065 6c73 6520 7574 696c 2e74  None else util.t
+0000d410: 6f5f 696e 7428 6578 7069 7265 7329 0a20  o_int(expires). 
+0000d420: 2020 2020 2020 2065 7870 6972 6573 203d         expires =
+0000d430: 2064 6174 6520 2b20 7469 6d65 6465 6c74   date + timedelt
+0000d440: 6128 7365 636f 6e64 733d 6578 7069 7265  a(seconds=expire
+0000d450: 7329 0a0a 2020 2020 2020 2020 6578 7069  s)..        expi
+0000d460: 7265 7320 3d20 6578 7069 7265 732e 7374  res = expires.st
+0000d470: 7266 7469 6d65 2863 6f6e 7374 2e45 5850  rftime(const.EXP
+0000d480: 4952 4154 494f 4e5f 4441 5445 5f46 4f52  IRATION_DATE_FOR
+0000d490: 4d41 5429 0a0a 2020 2020 2020 2020 666f  MAT)..        fo
+0000d4a0: 726d 5061 7261 6d73 203d 2073 656c 662e  rmParams = self.
+0000d4b0: 5f70 6172 7365 5f70 6f73 745f 7061 7261  _parse_post_para
+0000d4c0: 6d73 2866 6f72 6d50 6172 616d 732c 2073  ms(formParams, s
+0000d4d0: 6563 7572 6974 7950 726f 7669 6465 722c  ecurityProvider,
+0000d4e0: 2069 735f 7634 2c0a 2020 2020 2020 2020   is_v4,.        
+0000d4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d510: 2020 2020 2062 7563 6b65 744e 616d 652c       bucketName,
+0000d520: 206f 626a 6563 744b 6579 2c20 6c6f 6e67   objectKey, long
+0000d530: 4461 7465 2c20 7368 6f72 7444 6174 6529  Date, shortDate)
+0000d540: 0a0a 2020 2020 2020 2020 706f 6c69 6379  ..        policy
+0000d550: 203d 205b 277b 2265 7870 6972 6174 696f   = ['{"expiratio
+0000d560: 6e22 3a22 275d 0a20 2020 2020 2020 2070  n":"'].        p
+0000d570: 6f6c 6963 792e 6170 7065 6e64 2865 7870  olicy.append(exp
+0000d580: 6972 6573 290a 2020 2020 2020 2020 706f  ires).        po
+0000d590: 6c69 6379 2e61 7070 656e 6428 2722 2c20  licy.append('", 
+0000d5a0: 2263 6f6e 6469 7469 6f6e 7322 3a5b 2729  "conditions":[')
+0000d5b0: 0a0a 2020 2020 2020 2020 6d61 7463 6841  ..        matchA
+0000d5c0: 6e79 4275 636b 6574 203d 2054 7275 650a  nyBucket = True.
+0000d5d0: 2020 2020 2020 2020 6d61 7463 6841 6e79          matchAny
+0000d5e0: 4b65 7920 3d20 5472 7565 0a0a 2020 2020  Key = True..    
+0000d5f0: 2020 2020 636f 6e64 6974 696f 6e41 6c6c      conditionAll
+0000d600: 6f77 4b65 7973 203d 205b 2761 636c 272c  owKeys = ['acl',
+0000d610: 2027 6275 636b 6574 272c 2027 6b65 7927   'bucket', 'key'
+0000d620: 2c20 2773 7563 6365 7373 5f61 6374 696f  , 'success_actio
+0000d630: 6e5f 7265 6469 7265 6374 272c 2027 7265  n_redirect', 're
+0000d640: 6469 7265 6374 272c 2027 7375 6363 6573  direct', 'succes
+0000d650: 735f 6163 7469 6f6e 5f73 7461 7475 7327  s_action_status'
+0000d660: 5d0a 0a20 2020 2020 2020 2066 6f72 206b  ]..        for k
+0000d670: 6579 2c20 7661 6c75 6520 696e 2066 6f72  ey, value in for
+0000d680: 6d50 6172 616d 732e 6974 656d 7328 293a  mParams.items():
+0000d690: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000d6a0: 6b65 793a 0a20 2020 2020 2020 2020 2020  key:.           
+0000d6b0: 2020 2020 206b 6579 203d 2075 7469 6c2e       key = util.
+0000d6c0: 746f 5f73 7472 696e 6728 6b65 7929 2e6c  to_string(key).l
+0000d6d0: 6f77 6572 2829 0a0a 2020 2020 2020 2020  ower()..        
+0000d6e0: 2020 2020 2020 2020 6966 206b 6579 203d          if key =
+0000d6f0: 3d20 2762 7563 6b65 7427 3a0a 2020 2020  = 'bucket':.    
+0000d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d710: 6d61 7463 6841 6e79 4275 636b 6574 203d  matchAnyBucket =
+0000d720: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+0000d730: 2020 2020 2020 2065 6c69 6620 6b65 7920         elif key 
+0000d740: 3d3d 2027 6b65 7927 3a0a 2020 2020 2020  == 'key':.      
+0000d750: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+0000d760: 7463 6841 6e79 4b65 7920 3d20 4661 6c73  tchAnyKey = Fals
+0000d770: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
+0000d780: 2020 2069 6620 6b65 7920 6e6f 7420 696e     if key not in
+0000d790: 2063 6f6e 7374 2e41 4c4c 4f57 4544 5f52   const.ALLOWED_R
+0000d7a0: 4551 5545 5354 5f48 5454 505f 4845 4144  EQUEST_HTTP_HEAD
+0000d7b0: 4552 5f4d 4554 4144 4154 415f 4e41 4d45  ER_METADATA_NAME
+0000d7c0: 5320 5c0a 2020 2020 2020 2020 2020 2020  S \.            
+0000d7d0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0000d7e0: 6e6f 7420 6b65 792e 7374 6172 7473 7769  not key.startswi
+0000d7f0: 7468 2873 656c 662e 6861 2e5f 6765 745f  th(self.ha._get_
+0000d800: 6865 6164 6572 5f70 7265 6669 7828 2929  header_prefix())
+0000d810: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0000d820: 2020 2020 2020 2020 2020 2061 6e64 206e             and n
+0000d830: 6f74 206b 6579 2e73 7461 7274 7377 6974  ot key.startswit
+0000d840: 6828 636f 6e73 742e 4f42 535f 4845 4144  h(const.OBS_HEAD
+0000d850: 4552 5f50 5245 4649 5829 2061 6e64 206b  ER_PREFIX) and k
+0000d860: 6579 206e 6f74 2069 6e20 636f 6e64 6974  ey not in condit
+0000d870: 696f 6e41 6c6c 6f77 4b65 7973 3a0a 2020  ionAllowKeys:.  
+0000d880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d890: 2020 636f 6e74 696e 7565 0a0a 2020 2020    continue..    
+0000d8a0: 2020 2020 2020 2020 2020 2020 706f 6c69              poli
+0000d8b0: 6379 2e61 7070 656e 6428 277b 2227 290a  cy.append('{"').
+0000d8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8d0: 706f 6c69 6379 2e61 7070 656e 6428 6b65  policy.append(ke
+0000d8e0: 7929 0a20 2020 2020 2020 2020 2020 2020  y).             
+0000d8f0: 2020 2070 6f6c 6963 792e 6170 7065 6e64     policy.append
+0000d900: 2827 223a 2227 290a 2020 2020 2020 2020  ('":"').        
+0000d910: 2020 2020 2020 2020 706f 6c69 6379 2e61          policy.a
+0000d920: 7070 656e 6428 7574 696c 2e74 6f5f 7374  ppend(util.to_st
+0000d930: 7269 6e67 2876 616c 7565 2929 0a20 2020  ring(value)).   
+0000d940: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
+0000d950: 6963 792e 6170 7065 6e64 2827 227d 2c27  icy.append('"},'
+0000d960: 290a 0a20 2020 2020 2020 2069 6620 6d61  )..        if ma
+0000d970: 7463 6841 6e79 4275 636b 6574 3a0a 2020  tchAnyBucket:.  
+0000d980: 2020 2020 2020 2020 2020 706f 6c69 6379            policy
+0000d990: 2e61 7070 656e 6428 275b 2273 7461 7274  .append('["start
+0000d9a0: 732d 7769 7468 222c 2022 2462 7563 6b65  s-with", "$bucke
+0000d9b0: 7422 2c20 2222 5d2c 2729 0a0a 2020 2020  t", ""],')..    
+0000d9c0: 2020 2020 6966 206d 6174 6368 416e 794b      if matchAnyK
+0000d9d0: 6579 3a0a 2020 2020 2020 2020 2020 2020  ey:.            
+0000d9e0: 706f 6c69 6379 2e61 7070 656e 6428 275b  policy.append('[
+0000d9f0: 2273 7461 7274 732d 7769 7468 222c 2022  "starts-with", "
+0000da00: 246b 6579 222c 2022 225d 2c27 290a 0a20  $key", ""],').. 
+0000da10: 2020 2020 2020 2070 6f6c 6963 792e 6170         policy.ap
+0000da20: 7065 6e64 2827 5d7d 2729 0a0a 2020 2020  pend(']}')..    
+0000da30: 2020 2020 6f72 6967 696e 506f 6c69 6379      originPolicy
+0000da40: 203d 2027 272e 6a6f 696e 2870 6f6c 6963   = ''.join(polic
+0000da50: 7929 0a0a 2020 2020 2020 2020 706f 6c69  y)..        poli
+0000da60: 6379 203d 2075 7469 6c2e 6261 7365 3634  cy = util.base64
+0000da70: 5f65 6e63 6f64 6528 6f72 6967 696e 506f  _encode(originPo
+0000da80: 6c69 6379 290a 0a20 2020 2020 2020 2072  licy)..        r
+0000da90: 6573 756c 7420 3d20 7365 6c66 2e5f 7061  esult = self._pa
+0000daa0: 7273 655f 706f 7374 5f73 6967 6e61 7475  rse_post_signatu
+0000dab0: 7265 5f74 7970 6528 6973 5f76 342c 2073  re_type(is_v4, s
+0000dac0: 6563 7572 6974 7950 726f 7669 6465 722c  ecurityProvider,
+0000dad0: 206f 7269 6769 6e50 6f6c 6963 792c 0a20   originPolicy,. 
+0000dae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000daf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db10: 706f 6c69 6379 2c20 666f 726d 5061 7261  policy, formPara
+0000db20: 6d73 2c20 7368 6f72 7444 6174 652c 206c  ms, shortDate, l
+0000db30: 6f6e 6744 6174 6529 0a20 2020 2020 2020  ongDate).       
+0000db40: 2072 6574 7572 6e20 5f43 7265 6174 6550   return _CreateP
+0000db50: 6f73 7453 6967 6e61 7475 7265 5265 7370  ostSignatureResp
+0000db60: 6f6e 7365 282a 2a72 6573 756c 7429 0a0a  onse(**result)..
+0000db70: 2020 2020 6465 6620 5f70 6172 7365 5f70      def _parse_p
+0000db80: 6f73 745f 7061 7261 6d73 2873 656c 662c  ost_params(self,
+0000db90: 2066 6f72 6d50 6172 616d 732c 2073 6563   formParams, sec
+0000dba0: 7572 6974 7950 726f 7669 6465 722c 2069  urityProvider, i
+0000dbb0: 735f 7634 2c20 6275 636b 6574 4e61 6d65  s_v4, bucketName
+0000dbc0: 2c20 6f62 6a65 6374 4b65 792c 206c 6f6e  , objectKey, lon
+0000dbd0: 6744 6174 652c 2073 686f 7274 4461 7465  gDate, shortDate
+0000dbe0: 293a 0a20 2020 2020 2020 2066 6f72 6d50  ):.        formP
+0000dbf0: 6172 616d 7320 3d20 7b7d 2069 6620 666f  arams = {} if fo
+0000dc00: 726d 5061 7261 6d73 2069 7320 4e6f 6e65  rmParams is None
+0000dc10: 206f 7220 6e6f 7420 6973 696e 7374 616e   or not isinstan
+0000dc20: 6365 2866 6f72 6d50 6172 616d 732c 0a20  ce(formParams,. 
+0000dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc60: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000dc70: 6963 7429 2065 6c73 6520 666f 726d 5061  ict) else formPa
+0000dc80: 7261 6d73 2e63 6f70 7928 290a 0a20 2020  rams.copy()..   
+0000dc90: 2020 2020 2069 6620 7365 6375 7269 7479       if security
+0000dca0: 5072 6f76 6964 6572 2e73 6563 7572 6974  Provider.securit
+0000dcb0: 795f 746f 6b65 6e20 6973 206e 6f74 204e  y_token is not N
+0000dcc0: 6f6e 6520 616e 6420 7365 6c66 2e68 612e  one and self.ha.
+0000dcd0: 7365 6375 7269 7479 5f74 6f6b 656e 5f68  security_token_h
+0000dce0: 6561 6465 7228 2920 6e6f 7420 696e 2066  eader() not in f
+0000dcf0: 6f72 6d50 6172 616d 733a 0a20 2020 2020  ormParams:.     
+0000dd00: 2020 2020 2020 2066 6f72 6d50 6172 616d         formParam
+0000dd10: 735b 0a20 2020 2020 2020 2020 2020 2020  s[.             
+0000dd20: 2020 2073 656c 662e 6861 2e73 6563 7572     self.ha.secur
+0000dd30: 6974 795f 746f 6b65 6e5f 6865 6164 6572  ity_token_header
+0000dd40: 2829 5d20 3d20 7365 6375 7269 7479 5072  ()] = securityPr
+0000dd50: 6f76 6964 6572 2e73 6563 7572 6974 795f  ovider.security_
+0000dd60: 746f 6b65 6e0a 0a20 2020 2020 2020 2069  token..        i
+0000dd70: 6620 6973 5f76 343a 0a20 2020 2020 2020  f is_v4:.       
+0000dd80: 2020 2020 2066 6f72 6d50 6172 616d 735b       formParams[
+0000dd90: 2758 2d41 6d7a 2d41 6c67 6f72 6974 686d  'X-Amz-Algorithm
+0000dda0: 275d 203d 2027 4157 5334 2d48 4d41 432d  '] = 'AWS4-HMAC-
+0000ddb0: 5348 4132 3536 270a 2020 2020 2020 2020  SHA256'.        
+0000ddc0: 2020 2020 666f 726d 5061 7261 6d73 5b27      formParams['
+0000ddd0: 582d 416d 7a2d 4461 7465 275d 203d 206c  X-Amz-Date'] = l
+0000dde0: 6f6e 6744 6174 650a 2020 2020 2020 2020  ongDate.        
+0000ddf0: 2020 2020 666f 726d 5061 7261 6d73 5b27      formParams['
+0000de00: 582d 416d 7a2d 4372 6564 656e 7469 616c  X-Amz-Credential
+0000de10: 275d 203d 2027 2573 2f25 732f 2573 2f73  '] = '%s/%s/%s/s
+0000de20: 332f 6177 7334 5f72 6571 7565 7374 2720  3/aws4_request' 
+0000de30: 2520 280a 2020 2020 2020 2020 2020 2020  % (.            
+0000de40: 2020 2020 7365 6375 7269 7479 5072 6f76      securityProv
+0000de50: 6964 6572 2e61 6363 6573 735f 6b65 795f  ider.access_key_
+0000de60: 6964 2c20 7368 6f72 7444 6174 652c 2073  id, shortDate, s
+0000de70: 656c 662e 7265 6769 6f6e 290a 0a20 2020  elf.region)..   
+0000de80: 2020 2020 2069 6620 6275 636b 6574 4e61       if bucketNa
+0000de90: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+0000dea0: 666f 726d 5061 7261 6d73 5b27 6275 636b  formParams['buck
+0000deb0: 6574 275d 203d 2062 7563 6b65 744e 616d  et'] = bucketNam
+0000dec0: 650a 0a20 2020 2020 2020 2069 6620 6f62  e..        if ob
+0000ded0: 6a65 6374 4b65 793a 0a20 2020 2020 2020  jectKey:.       
+0000dee0: 2020 2020 2066 6f72 6d50 6172 616d 735b       formParams[
+0000def0: 276b 6579 275d 203d 206f 626a 6563 744b  'key'] = objectK
+0000df00: 6579 0a20 2020 2020 2020 2072 6574 7572  ey.        retur
+0000df10: 6e20 666f 726d 5061 7261 6d73 0a0a 2020  n formParams..  
+0000df20: 2020 6465 6620 5f70 6172 7365 5f70 6f73    def _parse_pos
+0000df30: 745f 7369 676e 6174 7572 655f 7479 7065  t_signature_type
+0000df40: 2873 656c 662c 2069 735f 7634 2c20 7365  (self, is_v4, se
+0000df50: 6375 7269 7479 5072 6f76 6964 6572 2c20  curityProvider, 
+0000df60: 6f72 6967 696e 506f 6c69 6379 2c20 706f  originPolicy, po
+0000df70: 6c69 6379 2c20 666f 726d 5061 7261 6d73  licy, formParams
+0000df80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 0000df90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfb0: 2020 2020 2073 656c 662e 7265 6769 6f6e       self.region
-0000dfc0: 2c20 7368 6f72 7444 6174 652c 206c 6f6e  , shortDate, lon
-0000dfd0: 6744 6174 652c 0a20 2020 2020 2020 2020  gDate,.         
-0000dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e000: 2020 7365 6c66 2e70 6174 685f 7374 796c    self.path_styl
-0000e010: 652c 2073 656c 662e 6861 290a 2020 2020  e, self.ha).    
-0000e020: 2020 2020 2020 2020 7369 676e 696e 674b          signingK
-0000e030: 6579 203d 2076 3441 7574 682e 6765 7453  ey = v4Auth.getS
-0000e040: 6967 6e69 6e67 4b65 795f 7079 7468 6f6e  igningKey_python
-0000e050: 3228 2920 6966 2063 6f6e 7374 2e49 535f  2() if const.IS_
-0000e060: 5059 5448 4f4e 3220 656c 7365 2076 3441  PYTHON2 else v4A
-0000e070: 7574 682e 6765 7453 6967 6e69 6e67 4b65  uth.getSigningKe
-0000e080: 795f 7079 7468 6f6e 3328 290a 2020 2020  y_python3().    
-0000e090: 2020 2020 2020 2020 7369 676e 6174 7572          signatur
-0000e0a0: 6520 3d20 7634 4175 7468 2e68 6d61 6353  e = v4Auth.hmacS
-0000e0b0: 6861 3235 3628 7369 676e 696e 674b 6579  ha256(signingKey
-0000e0c0: 2c20 706f 6c69 6379 2069 6620 636f 6e73  , policy if cons
-0000e0d0: 742e 4953 5f50 5954 484f 4e32 2065 6c73  t.IS_PYTHON2 els
-0000e0e0: 6520 706f 6c69 6379 2e65 6e63 6f64 6528  e policy.encode(
-0000e0f0: 2755 5446 2d38 2729 290a 2020 2020 2020  'UTF-8')).      
-0000e100: 2020 2020 2020 7265 7375 6c74 203d 207b        result = {
-0000e110: 276f 7269 6769 6e50 6f6c 6963 7927 3a20  'originPolicy': 
-0000e120: 6f72 6967 696e 506f 6c69 6379 2c20 2770  originPolicy, 'p
-0000e130: 6f6c 6963 7927 3a20 706f 6c69 6379 2c20  olicy': policy, 
-0000e140: 2761 6c67 6f72 6974 686d 273a 2066 6f72  'algorithm': for
-0000e150: 6d50 6172 616d 735b 2758 2d41 6d7a 2d41  mParams['X-Amz-A
-0000e160: 6c67 6f72 6974 686d 275d 2c0a 2020 2020  lgorithm'],.    
-0000e170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e180: 2020 2763 7265 6465 6e74 6961 6c27 3a20    'credential': 
-0000e190: 666f 726d 5061 7261 6d73 5b27 582d 416d  formParams['X-Am
-0000e1a0: 7a2d 4372 6564 656e 7469 616c 275d 2c20  z-Credential'], 
-0000e1b0: 2764 6174 6527 3a20 666f 726d 5061 7261  'date': formPara
-0000e1c0: 6d73 5b27 582d 416d 7a2d 4461 7465 275d  ms['X-Amz-Date']
-0000e1d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000e1e0: 2020 2020 2020 2020 2773 6967 6e61 7475          'signatu
-0000e1f0: 7265 273a 2073 6967 6e61 7475 7265 7d0a  re': signature}.
-0000e200: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000e210: 2020 2020 2020 2020 2020 7632 4175 7468            v2Auth
-0000e220: 203d 2061 7574 682e 4175 7468 656e 7469   = auth.Authenti
-0000e230: 6361 7469 6f6e 2873 6563 7572 6974 7950  cation(securityP
-0000e240: 726f 7669 6465 722e 6163 6365 7373 5f6b  rovider.access_k
-0000e250: 6579 5f69 642c 2073 6563 7572 6974 7950  ey_id, securityP
-0000e260: 726f 7669 6465 722e 7365 6372 6574 5f61  rovider.secret_a
-0000e270: 6363 6573 735f 6b65 792c 0a20 2020 2020  ccess_key,.     
-0000e280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2a0: 2020 2020 7365 6c66 2e70 6174 685f 7374      self.path_st
-0000e2b0: 796c 652c 2073 656c 662e 6861 2c20 7365  yle, self.ha, se
-0000e2c0: 6c66 2e73 6572 7665 722c 2073 656c 662e  lf.server, self.
-0000e2d0: 6973 5f63 6e61 6d65 290a 2020 2020 2020  is_cname).      
-0000e2e0: 2020 2020 2020 7369 676e 6174 7572 6520        signature 
-0000e2f0: 3d20 7632 4175 7468 2e68 6d61 6353 6861  = v2Auth.hmacSha
-0000e300: 3132 3828 706f 6c69 6379 290a 2020 2020  128(policy).    
-0000e310: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0000e320: 207b 276f 7269 6769 6e50 6f6c 6963 7927   {'originPolicy'
-0000e330: 3a20 6f72 6967 696e 506f 6c69 6379 2c20  : originPolicy, 
-0000e340: 2770 6f6c 6963 7927 3a20 706f 6c69 6379  'policy': policy
-0000e350: 2c20 2773 6967 6e61 7475 7265 273a 2073  , 'signature': s
-0000e360: 6967 6e61 7475 7265 2c0a 2020 2020 2020  ignature,.      
-0000e370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e380: 2761 6363 6573 734b 6579 4964 273a 2073  'accessKeyId': s
-0000e390: 6563 7572 6974 7950 726f 7669 6465 722e  ecurityProvider.
-0000e3a0: 6163 6365 7373 5f6b 6579 5f69 647d 0a20  access_key_id}. 
-0000e3b0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-0000e3c0: 7375 6c74 0a0a 2020 2020 6465 6620 6275  sult..    def bu
-0000e3d0: 636b 6574 436c 6965 6e74 2873 656c 662c  cketClient(self,
-0000e3e0: 2062 7563 6b65 744e 616d 6529 3a0a 2020   bucketName):.  
-0000e3f0: 2020 2020 2020 7265 7475 726e 2042 7563        return Buc
-0000e400: 6b65 7443 6c69 656e 7428 7365 6c66 2c20  ketClient(self, 
-0000e410: 6275 636b 6574 4e61 6d65 290a 0a20 2020  bucketName)..   
-0000e420: 2064 6566 205f 6765 7441 7069 5665 7273   def _getApiVers
-0000e430: 696f 6e28 7365 6c66 2c20 6275 636b 6574  ion(self, bucket
-0000e440: 4e61 6d65 3d27 2729 3a0a 2020 2020 2020  Name=''):.      
-0000e450: 2020 7265 7320 3d20 7365 6c66 2e5f 6d61    res = self._ma
-0000e460: 6b65 5f68 6561 645f 7265 7175 6573 7428  ke_head_request(
-0000e470: 6275 636b 6574 4e61 6d65 2c20 7061 7468  bucketName, path
-0000e480: 4172 6773 3d7b 2761 7069 7665 7273 696f  Args={'apiversio
-0000e490: 6e27 3a20 4e6f 6e65 7d2c 2073 6b69 7041  n': None}, skipA
-0000e4a0: 7574 6865 6e74 6963 6174 696f 6e3d 5472  uthentication=Tr
-0000e4b0: 7565 290a 2020 2020 2020 2020 6966 2072  ue).        if r
-0000e4c0: 6573 2e73 7461 7475 7320 3e3d 2035 3030  es.status >= 500
-0000e4d0: 206f 7220 7265 732e 7374 6174 7573 203d   or res.status =
-0000e4e0: 3d20 3430 343a 0a20 2020 2020 2020 2020  = 404:.         
-0000e4f0: 2020 2072 6574 7572 6e20 2727 2c20 7265     return '', re
-0000e500: 730a 2020 2020 2020 2020 6966 206e 6f74  s.        if not
-0000e510: 2068 6173 6174 7472 2872 6573 2c20 2768   hasattr(res, 'h
-0000e520: 6561 6465 7227 293a 0a20 2020 2020 2020  eader'):.       
-0000e530: 2020 2020 2072 6574 7572 6e20 636f 6e73       return cons
-0000e540: 742e 5632 5f53 4947 4e41 5455 5245 2c20  t.V2_SIGNATURE, 
-0000e550: 7265 730a 2020 2020 2020 2020 6865 6164  res.        head
-0000e560: 6572 203d 2064 6963 7428 7265 732e 6865  er = dict(res.he
-0000e570: 6164 6572 290a 2020 2020 2020 2020 6966  ader).        if
-0000e580: 2068 6561 6465 722e 6765 7428 2761 7069   header.get('api
-0000e590: 272c 2027 302e 3027 2920 3e3d 2027 332e  ', '0.0') >= '3.
-0000e5a0: 3027 206f 7220 6865 6164 6572 2e67 6574  0' or header.get
-0000e5b0: 2827 782d 6f62 732d 6170 6927 2c20 2730  ('x-obs-api', '0
-0000e5c0: 2e30 2729 203e 3d20 2733 2e30 273a 0a20  .0') >= '3.0':. 
-0000e5d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000e5e0: 6e20 636f 6e73 742e 4f42 535f 5349 474e  n const.OBS_SIGN
-0000e5f0: 4154 5552 452c 2072 6573 0a20 2020 2020  ATURE, res.     
-0000e600: 2020 2072 6574 7572 6e20 636f 6e73 742e     return const.
-0000e610: 5632 5f53 4947 4e41 5455 5245 2c20 7265  V2_SIGNATURE, re
-0000e620: 730a 0a20 2020 2040 6675 6e63 4361 6368  s..    @funcCach
-0000e630: 650a 2020 2020 6465 6620 6c69 7374 4275  e.    def listBu
-0000e640: 636b 6574 7328 7365 6c66 2c20 6973 5175  ckets(self, isQu
-0000e650: 6572 794c 6f63 6174 696f 6e3d 5472 7565  eryLocation=True
-0000e660: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
-0000e670: 7273 3d4e 6f6e 652c 2062 7563 6b65 7454  rs=None, bucketT
-0000e680: 7970 653d 4e6f 6e65 2c20 6d61 784b 6579  ype=None, maxKey
-0000e690: 733d 4e6f 6e65 2c20 6d61 726b 6572 3d4e  s=None, marker=N
-0000e6a0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-0000e6b0: 220a 2020 2020 2020 2020 4f62 7461 696e  ".        Obtain
-0000e6c0: 2061 2062 7563 6b65 7420 6c69 7374 2e0a   a bucket list..
-0000e6d0: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
-0000e6e0: 7351 7565 7279 4c6f 6361 7469 6f6e 3a20  sQueryLocation: 
-0000e6f0: 5768 6574 6865 7220 746f 2071 7565 7279  Whether to query
-0000e700: 2074 6865 2062 7563 6b65 7420 6c6f 6361   the bucket loca
-0000e710: 7469 6f6e 2e0a 2020 2020 2020 2020 3a70  tion..        :p
-0000e720: 6172 616d 2065 7874 656e 7369 6f6e 4865  aram extensionHe
-0000e730: 6164 6572 733a 204f 7468 6572 2068 6561  aders: Other hea
-0000e740: 6465 7273 0a20 2020 2020 2020 203a 7061  ders.        :pa
-0000e750: 7261 6d20 6275 636b 6574 5479 7065 3a20  ram bucketType: 
-0000e760: 5479 7065 206f 6620 7468 6520 6275 636b  Type of the buck
-0000e770: 6574 7320 796f 7520 7761 6e74 2074 6f20  ets you want to 
-0000e780: 6c69 7374 2e20 5468 6520 7661 6c75 6520  list. The value 
-0000e790: 6361 6e20 6265 204f 424a 4543 5420 6f72  can be OBJECT or
-0000e7a0: 2050 4f53 4958 2c20 6f72 2062 6520 6c65   POSIX, or be le
-0000e7b0: 6674 2062 6c61 6e6b 2e0a 2020 2020 2020  ft blank..      
-0000e7c0: 2020 2020 2020 2020 2022 4f42 4a45 4354           "OBJECT
-0000e7d0: 223a 2054 6f20 6c69 7374 2063 6f6d 6d6f  ": To list commo
-0000e7e0: 6e20 6275 636b 6574 732e 0a20 2020 2020  n buckets..     
-0000e7f0: 2020 2020 2020 2020 2020 2250 4f53 4958            "POSIX
-0000e800: 223a 2054 6f20 6c69 7374 2070 6172 616c  ": To list paral
-0000e810: 6c65 6c20 6669 6c65 2073 7973 7465 6d73  lel file systems
-0000e820: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e830: 2020 4966 2074 6869 7320 7061 7261 6d65    If this parame
-0000e840: 7465 7220 6973 206c 6566 7420 626c 616e  ter is left blan
-0000e850: 6b2c 2062 6f74 6820 6275 636b 6574 7320  k, both buckets 
-0000e860: 616e 6420 7061 7261 6c6c 656c 2066 696c  and parallel fil
-0000e870: 6520 7379 7374 656d 7320 7769 6c6c 2062  e systems will b
-0000e880: 6520 6c69 7374 6564 2e0a 2020 2020 2020  e listed..      
-0000e890: 2020 3a72 6574 7572 6e3a 2041 2062 7563    :return: A buc
-0000e8a0: 6b65 7420 6c69 7374 0a20 2020 2020 2020  ket list.       
-0000e8b0: 2022 2222 0a20 2020 2020 2020 2070 6174   """.        pat
-0000e8c0: 6841 7267 7320 3d20 4e6f 6e65 0a20 2020  hArgs = None.   
-0000e8d0: 2020 2020 2069 6620 6d61 784b 6579 7320       if maxKeys 
-0000e8e0: 6f72 206d 6172 6b65 723a 0a20 2020 2020  or marker:.     
-0000e8f0: 2020 2020 2020 2070 6174 6841 7267 7320         pathArgs 
-0000e900: 3d20 7b27 6d61 726b 6572 273a 206d 6172  = {'marker': mar
-0000e910: 6b65 722c 2027 6d61 782d 6b65 7973 273a  ker, 'max-keys':
-0000e920: 206d 6178 4b65 7973 7d0a 2020 2020 2020   maxKeys}.      
-0000e930: 2020 6966 2073 656c 662e 6973 5f63 6e61    if self.is_cna
-0000e940: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
-0000e950: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-0000e960: 276c 6973 7442 7563 6b65 7473 2069 7320  'listBuckets is 
-0000e970: 6e6f 7420 616c 6c6f 7765 6420 696e 2063  not allowed in c
-0000e980: 7573 746f 6d20 646f 6d61 696e 206d 6f64  ustom domain mod
-0000e990: 6527 290a 2020 2020 2020 2020 7265 7475  e').        retu
-0000e9a0: 726e 2073 656c 662e 5f6d 616b 655f 6765  rn self._make_ge
-0000e9b0: 745f 7265 7175 6573 7428 6d65 7468 6f64  t_request(method
-0000e9c0: 4e61 6d65 3d27 6c69 7374 4275 636b 6574  Name='listBucket
-0000e9d0: 7327 2c20 7061 7468 4172 6773 3d70 6174  s', pathArgs=pat
-0000e9e0: 6841 7267 732c 2065 7874 656e 7369 6f6e  hArgs, extension
-0000e9f0: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
-0000ea00: 6e48 6561 6465 7273 2c0a 2020 2020 2020  nHeaders,.      
-0000ea10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea30: 2a2a 7365 6c66 2e63 6f6e 7665 7274 6f72  **self.convertor
-0000ea40: 2e74 7261 6e73 5f6c 6973 745f 6275 636b  .trans_list_buck
-0000ea50: 6574 7328 6973 5175 6572 794c 6f63 6174  ets(isQueryLocat
-0000ea60: 696f 6e3d 6973 5175 6572 794c 6f63 6174  ion=isQueryLocat
-0000ea70: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-0000ea80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eab0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0000eac0: 7563 6b65 7454 7970 653d 6275 636b 6574  ucketType=bucket
-0000ead0: 5479 7065 2929 0a0a 2020 2020 4066 756e  Type))..    @fun
-0000eae0: 6343 6163 6865 0a20 2020 2064 6566 2063  cCache.    def c
-0000eaf0: 7265 6174 6542 7563 6b65 7428 7365 6c66  reateBucket(self
-0000eb00: 2c20 6275 636b 6574 4e61 6d65 2c20 6865  , bucketName, he
-0000eb10: 6164 6572 3d4e 6f6e 652c 206c 6f63 6174  ader=None, locat
-0000eb20: 696f 6e3d 4e6f 6e65 2c20 6578 7465 6e73  ion=None, extens
-0000eb30: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
-0000eb40: 3a0a 2020 2020 2020 2020 6966 2068 6561  :.        if hea
-0000eb50: 6465 7220 6973 204e 6f6e 653a 0a20 2020  der is None:.   
-0000eb60: 2020 2020 2020 2020 2068 6561 6465 7220           header 
-0000eb70: 3d20 4372 6561 7465 4275 636b 6574 4865  = CreateBucketHe
-0000eb80: 6164 6572 2829 0a20 2020 2020 2020 2069  ader().        i
-0000eb90: 6620 7365 6c66 2e69 735f 636e 616d 653a  f self.is_cname:
-0000eba0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000ebb0: 7365 2045 7863 6570 7469 6f6e 2827 6372  se Exception('cr
-0000ebc0: 6561 7465 4275 636b 6574 2069 7320 6e6f  eateBucket is no
-0000ebd0: 7420 616c 6c6f 7765 6420 696e 2063 7573  t allowed in cus
-0000ebe0: 746f 6d20 646f 6d61 696e 206d 6f64 6527  tom domain mode'
-0000ebf0: 290a 2020 2020 2020 2020 7265 7320 3d20  ).        res = 
-0000ec00: 7365 6c66 2e5f 6d61 6b65 5f70 7574 5f72  self._make_put_r
-0000ec10: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
-0000ec20: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
-0000ec30: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
-0000ec40: 6465 7273 2c0a 2020 2020 2020 2020 2020  ders,.          
-0000ec50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec60: 2020 2020 2020 2020 2020 202a 2a73 656c             **sel
-0000ec70: 662e 636f 6e76 6572 746f 722e 7472 616e  f.convertor.tran
-0000ec80: 735f 6372 6561 7465 5f62 7563 6b65 7428  s_create_bucket(
-0000ec90: 6865 6164 6572 3d68 6561 6465 722c 206c  header=header, l
-0000eca0: 6f63 6174 696f 6e3d 6c6f 6361 7469 6f6e  ocation=location
-0000ecb0: 2929 0a20 2020 2020 2020 2074 7279 3a0a  )).        try:.
-0000ecc0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0000ecd0: 656c 662e 6973 5f73 6967 6e61 7475 7265  elf.is_signature
-0000ece0: 5f6e 6567 6f74 6961 7469 6f6e 2061 6e64  _negotiation and
-0000ecf0: 2072 6573 2e73 7461 7475 7320 3d3d 2034   res.status == 4
-0000ed00: 3030 2061 6e64 205c 0a20 2020 2020 2020  00 and \.       
-0000ed10: 2020 2020 2020 2020 2020 2020 2072 6573               res
-0000ed20: 2e65 7272 6f72 4d65 7373 6167 6520 3d3d  .errorMessage ==
-0000ed30: 2027 556e 7375 7070 6f72 7465 6420 4175   'Unsupported Au
-0000ed40: 7468 6f72 697a 6174 696f 6e20 5479 7065  thorization Type
-0000ed50: 2720 616e 6420 5c0a 2020 2020 2020 2020  ' and \.        
-0000ed60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000ed70: 2e74 6872 6561 645f 6c6f 6361 6c2e 7369  .thread_local.si
-0000ed80: 676e 6174 7572 6520 3d3d 2063 6f6e 7374  gnature == const
-0000ed90: 2e4f 4253 5f53 4947 4e41 5455 5245 3a0a  .OBS_SIGNATURE:.
-0000eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000edb0: 7365 6c66 2e74 6872 6561 645f 6c6f 6361  self.thread_loca
-0000edc0: 6c2e 7369 676e 6174 7572 6520 3d20 636f  l.signature = co
-0000edd0: 6e73 742e 5632 5f53 4947 4e41 5455 5245  nst.V2_SIGNATURE
-0000ede0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000edf0: 2072 6573 203d 2073 656c 662e 5f6d 616b   res = self._mak
-0000ee00: 655f 7075 745f 7265 7175 6573 7428 6275  e_put_request(bu
-0000ee10: 636b 6574 4e61 6d65 2c20 6578 7465 6e73  cketName, extens
-0000ee20: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-0000ee30: 7369 6f6e 4865 6164 6572 732c 0a20 2020  sionHeaders,.   
-0000ee40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee60: 2020 2020 2020 2020 2020 2a2a 7365 6c66            **self
-0000ee70: 2e63 6f6e 7665 7274 6f72 2e74 7261 6e73  .convertor.trans
-0000ee80: 5f63 7265 6174 655f 6275 636b 6574 2868  _create_bucket(h
-0000ee90: 6561 6465 723d 6865 6164 6572 2c20 6c6f  eader=header, lo
-0000eea0: 6361 7469 6f6e 3d6c 6f63 6174 696f 6e29  cation=location)
-0000eeb0: 290a 2020 2020 2020 2020 6669 6e61 6c6c  ).        finall
-0000eec0: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
-0000eed0: 6574 7572 6e20 7265 730a 0a20 2020 2040  eturn res..    @
-0000eee0: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
-0000eef0: 6620 6c69 7374 4f62 6a65 6374 7328 7365  f listObjects(se
-0000ef00: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
-0000ef10: 7072 6566 6978 3d4e 6f6e 652c 206d 6172  prefix=None, mar
-0000ef20: 6b65 723d 4e6f 6e65 2c20 6d61 785f 6b65  ker=None, max_ke
-0000ef30: 7973 3d4e 6f6e 652c 2064 656c 696d 6974  ys=None, delimit
-0000ef40: 6572 3d4e 6f6e 652c 0a20 2020 2020 2020  er=None,.       
-0000ef50: 2020 2020 2020 2020 2020 2020 2065 7874               ext
-0000ef60: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
-0000ef70: 6e65 2c20 656e 636f 6469 6e67 5f74 7970  ne, encoding_typ
-0000ef80: 653d 4e6f 6e65 293a 0a20 2020 2020 2020  e=None):.       
-0000ef90: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
-0000efa0: 6b65 5f67 6574 5f72 6571 7565 7374 2862  ke_get_request(b
-0000efb0: 7563 6b65 744e 616d 652c 206d 6574 686f  ucketName, metho
-0000efc0: 644e 616d 653d 276c 6973 744f 626a 6563  dName='listObjec
-0000efd0: 7473 272c 2065 7874 656e 7369 6f6e 4865  ts', extensionHe
-0000efe0: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
-0000eff0: 6561 6465 7273 2c0a 2020 2020 2020 2020  eaders,.        
-0000f000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f010: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
-0000f020: 7365 6c66 2e63 6f6e 7665 7274 6f72 2e74  self.convertor.t
-0000f030: 7261 6e73 5f6c 6973 745f 6f62 6a65 6374  rans_list_object
-0000f040: 7328 7072 6566 6978 3d70 7265 6669 782c  s(prefix=prefix,
-0000f050: 206d 6172 6b65 723d 6d61 726b 6572 2c0a   marker=marker,.
-0000f060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f0a0: 2020 2020 2020 2020 2020 6d61 785f 6b65            max_ke
-0000f0b0: 7973 3d6d 6178 5f6b 6579 732c 2064 656c  ys=max_keys, del
-0000f0c0: 696d 6974 6572 3d64 656c 696d 6974 6572  imiter=delimiter
-0000f0d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000f0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f110: 2020 2020 2020 2020 2020 2020 656e 636f              enco
-0000f120: 6469 6e67 5f74 7970 653d 656e 636f 6469  ding_type=encodi
-0000f130: 6e67 5f74 7970 6529 290a 0a20 2020 2040  ng_type))..    @
-0000f140: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
-0000f150: 6620 6865 6164 4275 636b 6574 2873 656c  f headBucket(sel
-0000f160: 662c 2062 7563 6b65 744e 616d 652c 2065  f, bucketName, e
-0000f170: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-0000f180: 4e6f 6e65 293a 0a20 2020 2020 2020 2072  None):.        r
-0000f190: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
-0000f1a0: 5f68 6561 645f 7265 7175 6573 7428 6275  _head_request(bu
-0000f1b0: 636b 6574 4e61 6d65 2c20 6578 7465 6e73  cketName, extens
-0000f1c0: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-0000f1d0: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
-0000f1e0: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
-0000f1f0: 2064 6566 2068 6561 644f 626a 6563 7428   def headObject(
-0000f200: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
-0000f210: 2c20 6f62 6a65 6374 4b65 792c 2076 6572  , objectKey, ver
-0000f220: 7369 6f6e 4964 3d4e 6f6e 652c 2065 7874  sionId=None, ext
-0000f230: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
-0000f240: 6e65 293a 0a20 2020 2020 2020 2070 6174  ne):.        pat
-0000f250: 6841 7267 7320 3d20 7b7d 0a20 2020 2020  hArgs = {}.     
-0000f260: 2020 2069 6620 7665 7273 696f 6e49 643a     if versionId:
-0000f270: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-0000f280: 6841 7267 735b 636f 6e73 742e 5645 5253  hArgs[const.VERS
-0000f290: 494f 4e5f 4944 5f50 4152 414d 5d20 3d20  ION_ID_PARAM] = 
-0000f2a0: 7574 696c 2e74 6f5f 7374 7269 6e67 2876  util.to_string(v
-0000f2b0: 6572 7369 6f6e 4964 290a 2020 2020 2020  ersionId).      
-0000f2c0: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
-0000f2d0: 616b 655f 6865 6164 5f72 6571 7565 7374  ake_head_request
-0000f2e0: 2862 7563 6b65 744e 616d 652c 206f 626a  (bucketName, obj
-0000f2f0: 6563 744b 6579 2c20 7061 7468 4172 6773  ectKey, pathArgs
-0000f300: 3d70 6174 6841 7267 732c 2065 7874 656e  =pathArgs, exten
-0000f310: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
-0000f320: 6e73 696f 6e48 6561 6465 7273 290a 0a20  nsionHeaders).. 
-0000f330: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
-0000f340: 2020 6465 6620 6765 7442 7563 6b65 744d    def getBucketM
-0000f350: 6574 6164 6174 6128 7365 6c66 2c20 6275  etadata(self, bu
-0000f360: 636b 6574 4e61 6d65 2c20 6f72 6967 696e  cketName, origin
-0000f370: 3d4e 6f6e 652c 2072 6571 7565 7374 4865  =None, requestHe
-0000f380: 6164 6572 733d 4e6f 6e65 2c20 6578 7465  aders=None, exte
-0000f390: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
-0000f3a0: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
-0000f3b0: 726e 2073 656c 662e 5f6d 616b 655f 6865  rn self._make_he
-0000f3c0: 6164 5f72 6571 7565 7374 2862 7563 6b65  ad_request(bucke
-0000f3d0: 744e 616d 652c 206d 6574 686f 644e 616d  tName, methodNam
-0000f3e0: 653d 2767 6574 4275 636b 6574 4d65 7461  e='getBucketMeta
-0000f3f0: 6461 7461 272c 2065 7874 656e 7369 6f6e  data', extension
-0000f400: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
-0000f410: 6e48 6561 6465 7273 2c0a 2020 2020 2020  nHeaders,.      
-0000f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f440: 202a 2a73 656c 662e 636f 6e76 6572 746f   **self.converto
-0000f450: 722e 7472 616e 735f 6765 745f 6275 636b  r.trans_get_buck
-0000f460: 6574 5f6d 6574 6164 6174 6128 6f72 6967  et_metadata(orig
-0000f470: 696e 3d6f 7269 6769 6e2c 0a20 2020 2020  in=origin,.     
-0000f480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4c0: 2020 2020 2020 2020 2020 2020 2072 6571               req
-0000f4d0: 7565 7374 4865 6164 6572 733d 7265 7175  uestHeaders=requ
-0000f4e0: 6573 7448 6561 6465 7273 2929 0a0a 2020  estHeaders))..  
-0000f4f0: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
-0000f500: 2064 6566 2067 6574 4275 636b 6574 4c6f   def getBucketLo
-0000f510: 6361 7469 6f6e 2873 656c 662c 2062 7563  cation(self, buc
-0000f520: 6b65 744e 616d 652c 2065 7874 656e 7369  ketName, extensi
-0000f530: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
-0000f540: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000f550: 7365 6c66 2e5f 6d61 6b65 5f67 6574 5f72  self._make_get_r
-0000f560: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
-0000f570: 652c 2070 6174 6841 7267 733d 7b27 6c6f  e, pathArgs={'lo
-0000f580: 6361 7469 6f6e 273a 204e 6f6e 657d 2c20  cation': None}, 
-0000f590: 6d65 7468 6f64 4e61 6d65 3d27 6765 7442  methodName='getB
-0000f5a0: 7563 6b65 744c 6f63 6174 696f 6e27 2c0a  ucketLocation',.
-0000f5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f5d0: 2020 2020 2020 6578 7465 6e73 696f 6e48        extensionH
-0000f5e0: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
-0000f5f0: 4865 6164 6572 7329 0a0a 2020 2020 4066  Headers)..    @f
-0000f600: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
-0000f610: 2064 656c 6574 6542 7563 6b65 7428 7365   deleteBucket(se
-0000f620: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
-0000f630: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0000f640: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0000f650: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
-0000f660: 655f 6465 6c65 7465 5f72 6571 7565 7374  e_delete_request
-0000f670: 2862 7563 6b65 744e 616d 652c 2065 7874  (bucketName, ext
-0000f680: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
-0000f690: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
-0000f6a0: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
-0000f6b0: 2020 2020 6465 6620 7365 7442 7563 6b65      def setBucke
-0000f6c0: 7451 756f 7461 2873 656c 662c 2062 7563  tQuota(self, buc
-0000f6d0: 6b65 744e 616d 652c 2071 756f 7461 2c20  ketName, quota, 
-0000f6e0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0000f6f0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0000f700: 7365 6c66 2e5f 6173 7365 7274 5f6e 6f74  self._assert_not
-0000f710: 5f6e 756c 6c28 7175 6f74 612c 2027 7175  _null(quota, 'qu
-0000f720: 6f74 6120 6973 2065 6d70 7479 2729 0a20  ota is empty'). 
-0000f730: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000f740: 6c66 2e5f 6d61 6b65 5f70 7574 5f72 6571  lf._make_put_req
-0000f750: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
-0000f760: 2070 6174 6841 7267 733d 7b27 7175 6f74   pathArgs={'quot
-0000f770: 6127 3a20 4e6f 6e65 7d2c 2065 6e74 6974  a': None}, entit
-0000f780: 793d 7365 6c66 2e63 6f6e 7665 7274 6f72  y=self.convertor
-0000f790: 2e74 7261 6e73 5f71 756f 7461 2871 756f  .trans_quota(quo
-0000f7a0: 7461 292c 0a20 2020 2020 2020 2020 2020  ta),.           
-0000f7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f7c0: 2020 2020 2020 2020 2020 2065 7874 656e             exten
-0000f7d0: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
-0000f7e0: 6e73 696f 6e48 6561 6465 7273 290a 0a20  nsionHeaders).. 
-0000f7f0: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
-0000f800: 2020 6465 6620 6765 7442 7563 6b65 7451    def getBucketQ
-0000f810: 756f 7461 2873 656c 662c 2062 7563 6b65  uota(self, bucke
-0000f820: 744e 616d 652c 2065 7874 656e 7369 6f6e  tName, extension
-0000f830: 4865 6164 6572 733d 4e6f 6e65 293a 0a20  Headers=None):. 
-0000f840: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000f850: 6c66 2e5f 6d61 6b65 5f67 6574 5f72 6571  lf._make_get_req
-0000f860: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
-0000f870: 2070 6174 6841 7267 733d 7b27 7175 6f74   pathArgs={'quot
-0000f880: 6127 3a20 4e6f 6e65 7d2c 206d 6574 686f  a': None}, metho
-0000f890: 644e 616d 653d 2767 6574 4275 636b 6574  dName='getBucket
-0000f8a0: 5175 6f74 6127 2c0a 2020 2020 2020 2020  Quota',.        
-0000f8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f8c0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0000f8d0: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
-0000f8e0: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
-0000f8f0: 0a0a 2020 2020 4066 756e 6343 6163 6865  ..    @funcCache
-0000f900: 0a20 2020 2064 6566 2067 6574 4275 636b  .    def getBuck
-0000f910: 6574 5374 6f72 6167 6549 6e66 6f28 7365  etStorageInfo(se
-0000f920: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
-0000f930: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0000f940: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0000f950: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
-0000f960: 655f 6765 745f 7265 7175 6573 7428 6275  e_get_request(bu
-0000f970: 636b 6574 4e61 6d65 2c20 7061 7468 4172  cketName, pathAr
-0000f980: 6773 3d7b 2773 746f 7261 6765 696e 666f  gs={'storageinfo
-0000f990: 273a 204e 6f6e 657d 2c20 6d65 7468 6f64  ': None}, method
-0000f9a0: 4e61 6d65 3d27 6765 7442 7563 6b65 7453  Name='getBucketS
-0000f9b0: 746f 7261 6765 496e 666f 272c 0a20 2020  torageInfo',.   
-0000f9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f9e0: 2020 2065 7874 656e 7369 6f6e 4865 6164     extensionHead
-0000f9f0: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
-0000fa00: 6465 7273 290a 0a20 2020 2040 6675 6e63  ders)..    @func
-0000fa10: 4361 6368 650a 2020 2020 6465 6620 7365  Cache.    def se
-0000fa20: 7442 7563 6b65 7441 636c 2873 656c 662c  tBucketAcl(self,
-0000fa30: 2062 7563 6b65 744e 616d 652c 2061 636c   bucketName, acl
-0000fa40: 3d4e 6f6e 652c 2061 636c 436f 6e74 726f  =None, aclContro
-0000fa50: 6c3d 4e6f 6e65 2c20 6578 7465 6e73 696f  l=None, extensio
-0000fa60: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
-0000fa70: 2020 2020 2020 2020 6966 2061 636c 2069          if acl i
-0000fa80: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0000fa90: 2020 2020 6163 6c20 3d20 4143 4c28 290a      acl = ACL().
-0000faa0: 2020 2020 2020 2020 6966 2061 636c 2069          if acl i
-0000fab0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206c  s not None and l
-0000fac0: 656e 2861 636c 2920 3e20 3020 616e 6420  en(acl) > 0 and 
-0000fad0: 6163 6c43 6f6e 7472 6f6c 2069 7320 6e6f  aclControl is no
-0000fae0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000faf0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-0000fb00: 696f 6e28 2742 6f74 6820 6163 6c20 616e  ion('Both acl an
-0000fb10: 6420 6163 6c43 6f6e 7472 6f6c 2061 7265  d aclControl are
-0000fb20: 2073 6574 2729 0a20 2020 2020 2020 2069   set').        i
-0000fb30: 6620 6e6f 7420 6163 6c20 616e 6420 6e6f  f not acl and no
-0000fb40: 7420 6163 6c43 6f6e 7472 6f6c 3a0a 2020  t aclControl:.  
-0000fb50: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000fb60: 4578 6365 7074 696f 6e28 2742 6f74 6820  Exception('Both 
-0000fb70: 6163 6c20 616e 6420 6163 6c43 6f6e 7472  acl and aclContr
-0000fb80: 6f6c 2061 7265 206e 6f74 2073 6574 2729  ol are not set')
-0000fb90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000fba0: 7365 6c66 2e5f 6d61 6b65 5f70 7574 5f72  self._make_put_r
-0000fbb0: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
-0000fbc0: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
-0000fbd0: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
-0000fbe0: 6465 7273 2c0a 2020 2020 2020 2020 2020  ders,.          
-0000fbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc00: 2020 2020 2020 2020 2020 2020 2a2a 7365              **se
-0000fc10: 6c66 2e63 6f6e 7665 7274 6f72 2e74 7261  lf.convertor.tra
-0000fc20: 6e73 5f73 6574 5f62 7563 6b65 745f 6163  ns_set_bucket_ac
-0000fc30: 6c28 6163 6c3d 6163 6c2c 2061 636c 436f  l(acl=acl, aclCo
-0000fc40: 6e74 726f 6c3d 6163 6c43 6f6e 7472 6f6c  ntrol=aclControl
-0000fc50: 2929 0a0a 2020 2020 4066 756e 6343 6163  ))..    @funcCac
-0000fc60: 6865 0a20 2020 2064 6566 2067 6574 4275  he.    def getBu
-0000fc70: 636b 6574 4163 6c28 7365 6c66 2c20 6275  cketAcl(self, bu
-0000fc80: 636b 6574 4e61 6d65 2c20 6578 7465 6e73  cketName, extens
-0000fc90: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
-0000fca0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0000fcb0: 2073 656c 662e 5f6d 616b 655f 6765 745f   self._make_get_
-0000fcc0: 7265 7175 6573 7428 6275 636b 6574 4e61  request(bucketNa
-0000fcd0: 6d65 2c20 7061 7468 4172 6773 3d7b 2761  me, pathArgs={'a
-0000fce0: 636c 273a 204e 6f6e 657d 2c20 6d65 7468  cl': None}, meth
-0000fcf0: 6f64 4e61 6d65 3d27 6765 7442 7563 6b65  odName='getBucke
-0000fd00: 7441 636c 272c 0a20 2020 2020 2020 2020  tAcl',.         
-0000fd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd20: 2020 2020 2020 2020 2020 2020 2065 7874               ext
-0000fd30: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
-0000fd40: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
-0000fd50: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
-0000fd60: 2020 2020 6465 6620 7365 7442 7563 6b65      def setBucke
-0000fd70: 7450 6f6c 6963 7928 7365 6c66 2c20 6275  tPolicy(self, bu
-0000fd80: 636b 6574 4e61 6d65 2c20 706f 6c69 6379  cketName, policy
-0000fd90: 4a53 4f4e 2c20 6578 7465 6e73 696f 6e48  JSON, extensionH
-0000fda0: 6561 6465 7273 3d4e 6f6e 6529 3a0a 2020  eaders=None):.  
-0000fdb0: 2020 2020 2020 7365 6c66 2e5f 6173 7365        self._asse
-0000fdc0: 7274 5f6e 6f74 5f6e 756c 6c28 706f 6c69  rt_not_null(poli
-0000fdd0: 6379 4a53 4f4e 2c20 2770 6f6c 6963 794a  cyJSON, 'policyJ
-0000fde0: 534f 4e20 6973 2065 6d70 7479 2729 0a20  SON is empty'). 
-0000fdf0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000fe00: 6c66 2e5f 6d61 6b65 5f70 7574 5f72 6571  lf._make_put_req
-0000fe10: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
-0000fe20: 2070 6174 6841 7267 733d 7b27 706f 6c69   pathArgs={'poli
-0000fe30: 6379 273a 204e 6f6e 657d 2c20 656e 7469  cy': None}, enti
-0000fe40: 7479 3d70 6f6c 6963 794a 534f 4e2c 0a20  ty=policyJSON,. 
-0000fe50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe70: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
-0000fe80: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
-0000fe90: 6561 6465 7273 290a 0a20 2020 2040 6675  eaders)..    @fu
-0000fea0: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
-0000feb0: 6765 7442 7563 6b65 7450 6f6c 6963 7928  getBucketPolicy(
-0000fec0: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
-0000fed0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
-0000fee0: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
-0000fef0: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
-0000ff00: 616b 655f 6765 745f 7265 7175 6573 7428  ake_get_request(
-0000ff10: 6275 636b 6574 4e61 6d65 2c20 7061 7468  bucketName, path
-0000ff20: 4172 6773 3d7b 2770 6f6c 6963 7927 3a20  Args={'policy': 
-0000ff30: 4e6f 6e65 7d2c 206d 6574 686f 644e 616d  None}, methodNam
-0000ff40: 653d 2767 6574 4275 636b 6574 506f 6c69  e='getBucketPoli
-0000ff50: 6379 272c 0a20 2020 2020 2020 2020 2020  cy',.           
-0000ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff70: 2020 2020 2020 2020 2020 2065 7874 656e             exten
-0000ff80: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
-0000ff90: 6e73 696f 6e48 6561 6465 7273 290a 0a20  nsionHeaders).. 
-0000ffa0: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
-0000ffb0: 2020 6465 6620 6465 6c65 7465 4275 636b    def deleteBuck
-0000ffc0: 6574 506f 6c69 6379 2873 656c 662c 2062  etPolicy(self, b
-0000ffd0: 7563 6b65 744e 616d 652c 2065 7874 656e  ucketName, exten
-0000ffe0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
-0000fff0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00010000: 6e20 7365 6c66 2e5f 6d61 6b65 5f64 656c  n self._make_del
-00010010: 6574 655f 7265 7175 6573 7428 6275 636b  ete_request(buck
-00010020: 6574 4e61 6d65 2c20 7061 7468 4172 6773  etName, pathArgs
-00010030: 3d7b 2770 6f6c 6963 7927 3a20 4e6f 6e65  ={'policy': None
-00010040: 7d2c 2065 7874 656e 7369 6f6e 4865 6164  }, extensionHead
-00010050: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
-00010060: 6465 7273 290a 0a20 2020 2040 6675 6e63  ders)..    @func
-00010070: 4361 6368 650a 2020 2020 6465 6620 7365  Cache.    def se
-00010080: 7442 7563 6b65 7456 6572 7369 6f6e 696e  tBucketVersionin
-00010090: 6728 7365 6c66 2c20 6275 636b 6574 4e61  g(self, bucketNa
-000100a0: 6d65 2c20 7374 6174 7573 2c20 6578 7465  me, status, exte
-000100b0: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
-000100c0: 6529 3a0a 2020 2020 2020 2020 7365 6c66  e):.        self
-000100d0: 2e5f 6173 7365 7274 5f6e 6f74 5f6e 756c  ._assert_not_nul
-000100e0: 6c28 7374 6174 7573 2c20 2773 7461 7475  l(status, 'statu
-000100f0: 7320 6973 2065 6d70 7479 2729 0a20 2020  s is empty').   
-00010100: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00010110: 2e5f 6d61 6b65 5f70 7574 5f72 6571 7565  ._make_put_reque
-00010120: 7374 2862 7563 6b65 744e 616d 652c 2070  st(bucketName, p
-00010130: 6174 6841 7267 733d 7b27 7665 7273 696f  athArgs={'versio
-00010140: 6e69 6e67 273a 204e 6f6e 657d 2c0a 2020  ning': None},.  
-00010150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010170: 2020 2020 656e 7469 7479 3d73 656c 662e      entity=self.
-00010180: 636f 6e76 6572 746f 722e 7472 616e 735f  convertor.trans_
-00010190: 7665 7273 696f 6e5f 7374 6174 7573 2873  version_status(s
-000101a0: 7461 7475 7329 2c0a 2020 2020 2020 2020  tatus),.        
-000101b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000101c0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-000101d0: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
-000101e0: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
-000101f0: 0a0a 2020 2020 4066 756e 6343 6163 6865  ..    @funcCache
-00010200: 0a20 2020 2064 6566 2067 6574 4275 636b  .    def getBuck
-00010210: 6574 5665 7273 696f 6e69 6e67 2873 656c  etVersioning(sel
-00010220: 662c 2062 7563 6b65 744e 616d 652c 2065  f, bucketName, e
-00010230: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-00010240: 4e6f 6e65 293a 0a20 2020 2020 2020 2072  None):.        r
-00010250: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
-00010260: 5f67 6574 5f72 6571 7565 7374 2862 7563  _get_request(buc
-00010270: 6b65 744e 616d 652c 2070 6174 6841 7267  ketName, pathArg
-00010280: 733d 7b27 7665 7273 696f 6e69 6e67 273a  s={'versioning':
-00010290: 204e 6f6e 657d 2c20 6d65 7468 6f64 4e61   None}, methodNa
-000102a0: 6d65 3d27 6765 7442 7563 6b65 7456 6572  me='getBucketVer
-000102b0: 7369 6f6e 696e 6727 2c0a 2020 2020 2020  sioning',.      
-000102c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000102d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000102e0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-000102f0: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
-00010300: 7329 0a0a 2020 2020 4066 756e 6343 6163  s)..    @funcCac
-00010310: 6865 0a20 2020 2064 6566 206c 6973 7456  he.    def listV
-00010320: 6572 7369 6f6e 7328 7365 6c66 2c20 6275  ersions(self, bu
-00010330: 636b 6574 4e61 6d65 2c20 7665 7273 696f  cketName, versio
-00010340: 6e3d 4e6f 6e65 2c20 6578 7465 6e73 696f  n=None, extensio
-00010350: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
-00010360: 2020 2020 2020 2020 6966 2076 6572 7369          if versi
-00010370: 6f6e 2069 7320 4e6f 6e65 3a0a 2020 2020  on is None:.    
-00010380: 2020 2020 2020 2020 7665 7273 696f 6e20          version 
-00010390: 3d20 5665 7273 696f 6e73 2829 0a20 2020  = Versions().   
-000103a0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-000103b0: 2e5f 6d61 6b65 5f67 6574 5f72 6571 7565  ._make_get_reque
-000103c0: 7374 2862 7563 6b65 744e 616d 652c 206d  st(bucketName, m
-000103d0: 6574 686f 644e 616d 653d 276c 6973 7456  ethodName='listV
-000103e0: 6572 7369 6f6e 7327 2c20 6578 7465 6e73  ersions', extens
-000103f0: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-00010400: 7369 6f6e 4865 6164 6572 732c 0a20 2020  sionHeaders,.   
-00010410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010430: 2020 202a 2a73 656c 662e 636f 6e76 6572     **self.conver
-00010440: 746f 722e 7472 616e 735f 6c69 7374 5f76  tor.trans_list_v
-00010450: 6572 7369 6f6e 7328 7665 7273 696f 6e3d  ersions(version=
-00010460: 7665 7273 696f 6e29 290a 0a20 2020 2040  version))..    @
-00010470: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
-00010480: 6620 6c69 7374 4d75 6c74 6970 6172 7455  f listMultipartU
-00010490: 706c 6f61 6473 2873 656c 662c 2062 7563  ploads(self, buc
-000104a0: 6b65 744e 616d 652c 206d 756c 7469 7061  ketName, multipa
-000104b0: 7274 3d4e 6f6e 652c 2065 7874 656e 7369  rt=None, extensi
-000104c0: 6f6e 4865 6164 6572 733d 4e6f 6e65 2c0a  onHeaders=None,.
+0000dfa0: 2020 2020 2073 686f 7274 4461 7465 2c20       shortDate, 
+0000dfb0: 6c6f 6e67 4461 7465 293a 0a20 2020 2020  longDate):.     
+0000dfc0: 2020 2069 6620 6973 5f76 343a 0a20 2020     if is_v4:.   
+0000dfd0: 2020 2020 2020 2020 2076 3441 7574 6820           v4Auth 
+0000dfe0: 3d20 6175 7468 2e56 3441 7574 6865 6e74  = auth.V4Authent
+0000dff0: 6963 6174 696f 6e28 7365 6375 7269 7479  ication(security
+0000e000: 5072 6f76 6964 6572 2e61 6363 6573 735f  Provider.access_
+0000e010: 6b65 795f 6964 2c20 7365 6375 7269 7479  key_id, security
+0000e020: 5072 6f76 6964 6572 2e73 6563 7265 745f  Provider.secret_
+0000e030: 6163 6365 7373 5f6b 6579 2c0a 2020 2020  access_key,.    
+0000e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e060: 2020 2020 2020 2073 656c 662e 7265 6769         self.regi
+0000e070: 6f6e 2c20 7368 6f72 7444 6174 652c 206c  on, shortDate, l
+0000e080: 6f6e 6744 6174 652c 0a20 2020 2020 2020  ongDate,.       
+0000e090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e0b0: 2020 2020 7365 6c66 2e70 6174 685f 7374      self.path_st
+0000e0c0: 796c 652c 2073 656c 662e 6861 290a 2020  yle, self.ha).  
+0000e0d0: 2020 2020 2020 2020 2020 7369 676e 696e            signin
+0000e0e0: 674b 6579 203d 2076 3441 7574 682e 6765  gKey = v4Auth.ge
+0000e0f0: 7453 6967 6e69 6e67 4b65 795f 7079 7468  tSigningKey_pyth
+0000e100: 6f6e 3228 2920 6966 2063 6f6e 7374 2e49  on2() if const.I
+0000e110: 535f 5059 5448 4f4e 3220 656c 7365 2076  S_PYTHON2 else v
+0000e120: 3441 7574 682e 6765 7453 6967 6e69 6e67  4Auth.getSigning
+0000e130: 4b65 795f 7079 7468 6f6e 3328 290a 2020  Key_python3().  
+0000e140: 2020 2020 2020 2020 2020 7369 676e 6174            signat
+0000e150: 7572 6520 3d20 7634 4175 7468 2e68 6d61  ure = v4Auth.hma
+0000e160: 6353 6861 3235 3628 7369 676e 696e 674b  cSha256(signingK
+0000e170: 6579 2c20 706f 6c69 6379 2069 6620 636f  ey, policy if co
+0000e180: 6e73 742e 4953 5f50 5954 484f 4e32 2065  nst.IS_PYTHON2 e
+0000e190: 6c73 6520 706f 6c69 6379 2e65 6e63 6f64  lse policy.encod
+0000e1a0: 6528 2755 5446 2d38 2729 290a 2020 2020  e('UTF-8')).    
+0000e1b0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+0000e1c0: 207b 276f 7269 6769 6e50 6f6c 6963 7927   {'originPolicy'
+0000e1d0: 3a20 6f72 6967 696e 506f 6c69 6379 2c20  : originPolicy, 
+0000e1e0: 2770 6f6c 6963 7927 3a20 706f 6c69 6379  'policy': policy
+0000e1f0: 2c20 2761 6c67 6f72 6974 686d 273a 2066  , 'algorithm': f
+0000e200: 6f72 6d50 6172 616d 735b 2758 2d41 6d7a  ormParams['X-Amz
+0000e210: 2d41 6c67 6f72 6974 686d 275d 2c0a 2020  -Algorithm'],.  
+0000e220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e230: 2020 2020 2763 7265 6465 6e74 6961 6c27      'credential'
+0000e240: 3a20 666f 726d 5061 7261 6d73 5b27 582d  : formParams['X-
+0000e250: 416d 7a2d 4372 6564 656e 7469 616c 275d  Amz-Credential']
+0000e260: 2c20 2764 6174 6527 3a20 666f 726d 5061  , 'date': formPa
+0000e270: 7261 6d73 5b27 582d 416d 7a2d 4461 7465  rams['X-Amz-Date
+0000e280: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
+0000e290: 2020 2020 2020 2020 2020 2773 6967 6e61            'signa
+0000e2a0: 7475 7265 273a 2073 6967 6e61 7475 7265  ture': signature
+0000e2b0: 7d0a 2020 2020 2020 2020 656c 7365 3a0a  }.        else:.
+0000e2c0: 2020 2020 2020 2020 2020 2020 7632 4175              v2Au
+0000e2d0: 7468 203d 2061 7574 682e 4175 7468 656e  th = auth.Authen
+0000e2e0: 7469 6361 7469 6f6e 2873 6563 7572 6974  tication(securit
+0000e2f0: 7950 726f 7669 6465 722e 6163 6365 7373  yProvider.access
+0000e300: 5f6b 6579 5f69 642c 2073 6563 7572 6974  _key_id, securit
+0000e310: 7950 726f 7669 6465 722e 7365 6372 6574  yProvider.secret
+0000e320: 5f61 6363 6573 735f 6b65 792c 0a20 2020  _access_key,.   
+0000e330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e350: 2020 2020 2020 7365 6c66 2e70 6174 685f        self.path_
+0000e360: 7374 796c 652c 2073 656c 662e 6861 2c20  style, self.ha, 
+0000e370: 7365 6c66 2e73 6572 7665 722c 2073 656c  self.server, sel
+0000e380: 662e 6973 5f63 6e61 6d65 290a 2020 2020  f.is_cname).    
+0000e390: 2020 2020 2020 2020 7369 676e 6174 7572          signatur
+0000e3a0: 6520 3d20 7632 4175 7468 2e68 6d61 6353  e = v2Auth.hmacS
+0000e3b0: 6861 3132 3828 706f 6c69 6379 290a 2020  ha128(policy).  
+0000e3c0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+0000e3d0: 203d 207b 276f 7269 6769 6e50 6f6c 6963   = {'originPolic
+0000e3e0: 7927 3a20 6f72 6967 696e 506f 6c69 6379  y': originPolicy
+0000e3f0: 2c20 2770 6f6c 6963 7927 3a20 706f 6c69  , 'policy': poli
+0000e400: 6379 2c20 2773 6967 6e61 7475 7265 273a  cy, 'signature':
+0000e410: 2073 6967 6e61 7475 7265 2c0a 2020 2020   signature,.    
+0000e420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e430: 2020 2761 6363 6573 734b 6579 4964 273a    'accessKeyId':
+0000e440: 2073 6563 7572 6974 7950 726f 7669 6465   securityProvide
+0000e450: 722e 6163 6365 7373 5f6b 6579 5f69 647d  r.access_key_id}
+0000e460: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000e470: 7265 7375 6c74 0a0a 2020 2020 6465 6620  result..    def 
+0000e480: 6275 636b 6574 436c 6965 6e74 2873 656c  bucketClient(sel
+0000e490: 662c 2062 7563 6b65 744e 616d 6529 3a0a  f, bucketName):.
+0000e4a0: 2020 2020 2020 2020 7265 7475 726e 2042          return B
+0000e4b0: 7563 6b65 7443 6c69 656e 7428 7365 6c66  ucketClient(self
+0000e4c0: 2c20 6275 636b 6574 4e61 6d65 290a 0a20  , bucketName).. 
+0000e4d0: 2020 2064 6566 205f 6765 7441 7069 5665     def _getApiVe
+0000e4e0: 7273 696f 6e28 7365 6c66 2c20 6275 636b  rsion(self, buck
+0000e4f0: 6574 4e61 6d65 3d27 2729 3a0a 2020 2020  etName=''):.    
+0000e500: 2020 2020 7265 7320 3d20 7365 6c66 2e5f      res = self._
+0000e510: 6d61 6b65 5f68 6561 645f 7265 7175 6573  make_head_reques
+0000e520: 7428 6275 636b 6574 4e61 6d65 2c20 7061  t(bucketName, pa
+0000e530: 7468 4172 6773 3d7b 2761 7069 7665 7273  thArgs={'apivers
+0000e540: 696f 6e27 3a20 4e6f 6e65 7d2c 2073 6b69  ion': None}, ski
+0000e550: 7041 7574 6865 6e74 6963 6174 696f 6e3d  pAuthentication=
+0000e560: 5472 7565 290a 2020 2020 2020 2020 6966  True).        if
+0000e570: 2072 6573 2e73 7461 7475 7320 3e3d 2035   res.status >= 5
+0000e580: 3030 206f 7220 7265 732e 7374 6174 7573  00 or res.status
+0000e590: 203d 3d20 3430 343a 0a20 2020 2020 2020   == 404:.       
+0000e5a0: 2020 2020 2072 6574 7572 6e20 2727 2c20       return '', 
+0000e5b0: 7265 730a 2020 2020 2020 2020 6966 206e  res.        if n
+0000e5c0: 6f74 2068 6173 6174 7472 2872 6573 2c20  ot hasattr(res, 
+0000e5d0: 2768 6561 6465 7227 293a 0a20 2020 2020  'header'):.     
+0000e5e0: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
+0000e5f0: 6e73 742e 5632 5f53 4947 4e41 5455 5245  nst.V2_SIGNATURE
+0000e600: 2c20 7265 730a 2020 2020 2020 2020 6865  , res.        he
+0000e610: 6164 6572 203d 2064 6963 7428 7265 732e  ader = dict(res.
+0000e620: 6865 6164 6572 290a 2020 2020 2020 2020  header).        
+0000e630: 6966 2068 6561 6465 722e 6765 7428 2761  if header.get('a
+0000e640: 7069 272c 2027 302e 3027 2920 3e3d 2027  pi', '0.0') >= '
+0000e650: 332e 3027 206f 7220 6865 6164 6572 2e67  3.0' or header.g
+0000e660: 6574 2827 782d 6f62 732d 6170 6927 2c20  et('x-obs-api', 
+0000e670: 2730 2e30 2729 203e 3d20 2733 2e30 273a  '0.0') >= '3.0':
+0000e680: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000e690: 7572 6e20 636f 6e73 742e 4f42 535f 5349  urn const.OBS_SI
+0000e6a0: 474e 4154 5552 452c 2072 6573 0a20 2020  GNATURE, res.   
+0000e6b0: 2020 2020 2072 6574 7572 6e20 636f 6e73       return cons
+0000e6c0: 742e 5632 5f53 4947 4e41 5455 5245 2c20  t.V2_SIGNATURE, 
+0000e6d0: 7265 730a 0a20 2020 2040 6675 6e63 4361  res..    @funcCa
+0000e6e0: 6368 650a 2020 2020 6465 6620 6c69 7374  che.    def list
+0000e6f0: 4275 636b 6574 7328 7365 6c66 2c20 6973  Buckets(self, is
+0000e700: 5175 6572 794c 6f63 6174 696f 6e3d 5472  QueryLocation=Tr
+0000e710: 7565 2c20 6578 7465 6e73 696f 6e48 6561  ue, extensionHea
+0000e720: 6465 7273 3d4e 6f6e 652c 2062 7563 6b65  ders=None, bucke
+0000e730: 7454 7970 653d 4e6f 6e65 2c20 6d61 784b  tType=None, maxK
+0000e740: 6579 733d 4e6f 6e65 2c20 6d61 726b 6572  eys=None, marker
+0000e750: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+0000e760: 2222 220a 2020 2020 2020 2020 4f62 7461  """.        Obta
+0000e770: 696e 2061 2062 7563 6b65 7420 6c69 7374  in a bucket list
+0000e780: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0000e790: 2069 7351 7565 7279 4c6f 6361 7469 6f6e   isQueryLocation
+0000e7a0: 3a20 5768 6574 6865 7220 746f 2071 7565  : Whether to que
+0000e7b0: 7279 2074 6865 2062 7563 6b65 7420 6c6f  ry the bucket lo
+0000e7c0: 6361 7469 6f6e 2e0a 2020 2020 2020 2020  cation..        
+0000e7d0: 3a70 6172 616d 2065 7874 656e 7369 6f6e  :param extension
+0000e7e0: 4865 6164 6572 733a 204f 7468 6572 2068  Headers: Other h
+0000e7f0: 6561 6465 7273 0a20 2020 2020 2020 203a  eaders.        :
+0000e800: 7061 7261 6d20 6275 636b 6574 5479 7065  param bucketType
+0000e810: 3a20 5479 7065 206f 6620 7468 6520 6275  : Type of the bu
+0000e820: 636b 6574 7320 796f 7520 7761 6e74 2074  ckets you want t
+0000e830: 6f20 6c69 7374 2e20 5468 6520 7661 6c75  o list. The valu
+0000e840: 6520 6361 6e20 6265 204f 424a 4543 5420  e can be OBJECT 
+0000e850: 6f72 2050 4f53 4958 2c20 6f72 2062 6520  or POSIX, or be 
+0000e860: 6c65 6674 2062 6c61 6e6b 2e0a 2020 2020  left blank..    
+0000e870: 2020 2020 2020 2020 2020 2022 4f42 4a45             "OBJE
+0000e880: 4354 223a 2054 6f20 6c69 7374 2063 6f6d  CT": To list com
+0000e890: 6d6f 6e20 6275 636b 6574 732e 0a20 2020  mon buckets..   
+0000e8a0: 2020 2020 2020 2020 2020 2020 2250 4f53              "POS
+0000e8b0: 4958 223a 2054 6f20 6c69 7374 2070 6172  IX": To list par
+0000e8c0: 616c 6c65 6c20 6669 6c65 2073 7973 7465  allel file syste
+0000e8d0: 6d73 2e0a 2020 2020 2020 2020 2020 2020  ms..            
+0000e8e0: 2020 2020 4966 2074 6869 7320 7061 7261      If this para
+0000e8f0: 6d65 7465 7220 6973 206c 6566 7420 626c  meter is left bl
+0000e900: 616e 6b2c 2062 6f74 6820 6275 636b 6574  ank, both bucket
+0000e910: 7320 616e 6420 7061 7261 6c6c 656c 2066  s and parallel f
+0000e920: 696c 6520 7379 7374 656d 7320 7769 6c6c  ile systems will
+0000e930: 2062 6520 6c69 7374 6564 2e0a 2020 2020   be listed..    
+0000e940: 2020 2020 3a72 6574 7572 6e3a 2041 2062      :return: A b
+0000e950: 7563 6b65 7420 6c69 7374 0a20 2020 2020  ucket list.     
+0000e960: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
+0000e970: 6174 6841 7267 7320 3d20 4e6f 6e65 0a20  athArgs = None. 
+0000e980: 2020 2020 2020 2069 6620 6d61 784b 6579         if maxKey
+0000e990: 7320 6f72 206d 6172 6b65 723a 0a20 2020  s or marker:.   
+0000e9a0: 2020 2020 2020 2020 2070 6174 6841 7267           pathArg
+0000e9b0: 7320 3d20 7b27 6d61 726b 6572 273a 206d  s = {'marker': m
+0000e9c0: 6172 6b65 722c 2027 6d61 782d 6b65 7973  arker, 'max-keys
+0000e9d0: 273a 206d 6178 4b65 7973 7d0a 2020 2020  ': maxKeys}.    
+0000e9e0: 2020 2020 6966 2073 656c 662e 6973 5f63      if self.is_c
+0000e9f0: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
+0000ea00: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+0000ea10: 6e28 276c 6973 7442 7563 6b65 7473 2069  n('listBuckets i
+0000ea20: 7320 6e6f 7420 616c 6c6f 7765 6420 696e  s not allowed in
+0000ea30: 2063 7573 746f 6d20 646f 6d61 696e 206d   custom domain m
+0000ea40: 6f64 6527 290a 2020 2020 2020 2020 7265  ode').        re
+0000ea50: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
+0000ea60: 6765 745f 7265 7175 6573 7428 6d65 7468  get_request(meth
+0000ea70: 6f64 4e61 6d65 3d27 6c69 7374 4275 636b  odName='listBuck
+0000ea80: 6574 7327 2c20 7061 7468 4172 6773 3d70  ets', pathArgs=p
+0000ea90: 6174 6841 7267 732c 2065 7874 656e 7369  athArgs, extensi
+0000eaa0: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
+0000eab0: 696f 6e48 6561 6465 7273 2c0a 2020 2020  ionHeaders,.    
+0000eac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ead0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eae0: 2020 2a2a 7365 6c66 2e63 6f6e 7665 7274    **self.convert
+0000eaf0: 6f72 2e74 7261 6e73 5f6c 6973 745f 6275  or.trans_list_bu
+0000eb00: 636b 6574 7328 6973 5175 6572 794c 6f63  ckets(isQueryLoc
+0000eb10: 6174 696f 6e3d 6973 5175 6572 794c 6f63  ation=isQueryLoc
+0000eb20: 6174 696f 6e2c 0a20 2020 2020 2020 2020  ation,.         
+0000eb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb70: 2062 7563 6b65 7454 7970 653d 6275 636b   bucketType=buck
+0000eb80: 6574 5479 7065 2929 0a0a 2020 2020 4066  etType))..    @f
+0000eb90: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
+0000eba0: 2063 7265 6174 6542 7563 6b65 7428 7365   createBucket(se
+0000ebb0: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
+0000ebc0: 6865 6164 6572 3d4e 6f6e 652c 206c 6f63  header=None, loc
+0000ebd0: 6174 696f 6e3d 4e6f 6e65 2c20 6578 7465  ation=None, exte
+0000ebe0: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
+0000ebf0: 6529 3a0a 2020 2020 2020 2020 6966 2068  e):.        if h
+0000ec00: 6561 6465 7220 6973 204e 6f6e 653a 0a20  eader is None:. 
+0000ec10: 2020 2020 2020 2020 2020 2068 6561 6465             heade
+0000ec20: 7220 3d20 4372 6561 7465 4275 636b 6574  r = CreateBucket
+0000ec30: 4865 6164 6572 2829 0a20 2020 2020 2020  Header().       
+0000ec40: 2069 6620 7365 6c66 2e69 735f 636e 616d   if self.is_cnam
+0000ec50: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000ec60: 6169 7365 2045 7863 6570 7469 6f6e 2827  aise Exception('
+0000ec70: 6372 6561 7465 4275 636b 6574 2069 7320  createBucket is 
+0000ec80: 6e6f 7420 616c 6c6f 7765 6420 696e 2063  not allowed in c
+0000ec90: 7573 746f 6d20 646f 6d61 696e 206d 6f64  ustom domain mod
+0000eca0: 6527 290a 2020 2020 2020 2020 7265 7320  e').        res 
+0000ecb0: 3d20 7365 6c66 2e5f 6d61 6b65 5f70 7574  = self._make_put
+0000ecc0: 5f72 6571 7565 7374 2862 7563 6b65 744e  _request(bucketN
+0000ecd0: 616d 652c 2065 7874 656e 7369 6f6e 4865  ame, extensionHe
+0000ece0: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+0000ecf0: 6561 6465 7273 2c0a 2020 2020 2020 2020  eaders,.        
+0000ed00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed10: 2020 2020 2020 2020 2020 2020 202a 2a73               **s
+0000ed20: 656c 662e 636f 6e76 6572 746f 722e 7472  elf.convertor.tr
+0000ed30: 616e 735f 6372 6561 7465 5f62 7563 6b65  ans_create_bucke
+0000ed40: 7428 6865 6164 6572 3d68 6561 6465 722c  t(header=header,
+0000ed50: 206c 6f63 6174 696f 6e3d 6c6f 6361 7469   location=locati
+0000ed60: 6f6e 2929 0a20 2020 2020 2020 2074 7279  on)).        try
+0000ed70: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000ed80: 2073 656c 662e 6973 5f73 6967 6e61 7475   self.is_signatu
+0000ed90: 7265 5f6e 6567 6f74 6961 7469 6f6e 2061  re_negotiation a
+0000eda0: 6e64 2072 6573 2e73 7461 7475 7320 3d3d  nd res.status ==
+0000edb0: 2034 3030 2061 6e64 205c 0a20 2020 2020   400 and \.     
+0000edc0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000edd0: 6573 2e65 7272 6f72 4d65 7373 6167 6520  es.errorMessage 
+0000ede0: 3d3d 2027 556e 7375 7070 6f72 7465 6420  == 'Unsupported 
+0000edf0: 4175 7468 6f72 697a 6174 696f 6e20 5479  Authorization Ty
+0000ee00: 7065 2720 616e 6420 5c0a 2020 2020 2020  pe' and \.      
+0000ee10: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000ee20: 6c66 2e74 6872 6561 645f 6c6f 6361 6c2e  lf.thread_local.
+0000ee30: 7369 676e 6174 7572 6520 3d3d 2063 6f6e  signature == con
+0000ee40: 7374 2e4f 4253 5f53 4947 4e41 5455 5245  st.OBS_SIGNATURE
+0000ee50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000ee60: 2020 7365 6c66 2e74 6872 6561 645f 6c6f    self.thread_lo
+0000ee70: 6361 6c2e 7369 676e 6174 7572 6520 3d20  cal.signature = 
+0000ee80: 636f 6e73 742e 5632 5f53 4947 4e41 5455  const.V2_SIGNATU
+0000ee90: 5245 0a20 2020 2020 2020 2020 2020 2020  RE.             
+0000eea0: 2020 2072 6573 203d 2073 656c 662e 5f6d     res = self._m
+0000eeb0: 616b 655f 7075 745f 7265 7175 6573 7428  ake_put_request(
+0000eec0: 6275 636b 6574 4e61 6d65 2c20 6578 7465  bucketName, exte
+0000eed0: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
+0000eee0: 656e 7369 6f6e 4865 6164 6572 732c 0a20  ensionHeaders,. 
+0000eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef10: 2020 2020 2020 2020 2020 2020 2a2a 7365              **se
+0000ef20: 6c66 2e63 6f6e 7665 7274 6f72 2e74 7261  lf.convertor.tra
+0000ef30: 6e73 5f63 7265 6174 655f 6275 636b 6574  ns_create_bucket
+0000ef40: 2868 6561 6465 723d 6865 6164 6572 2c20  (header=header, 
+0000ef50: 6c6f 6361 7469 6f6e 3d6c 6f63 6174 696f  location=locatio
+0000ef60: 6e29 290a 2020 2020 2020 2020 6669 6e61  n)).        fina
+0000ef70: 6c6c 793a 0a20 2020 2020 2020 2020 2020  lly:.           
+0000ef80: 2072 6574 7572 6e20 7265 730a 0a20 2020   return res..   
+0000ef90: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
+0000efa0: 6465 6620 6c69 7374 4f62 6a65 6374 7328  def listObjects(
+0000efb0: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
+0000efc0: 2c20 7072 6566 6978 3d4e 6f6e 652c 206d  , prefix=None, m
+0000efd0: 6172 6b65 723d 4e6f 6e65 2c20 6d61 785f  arker=None, max_
+0000efe0: 6b65 7973 3d4e 6f6e 652c 2064 656c 696d  keys=None, delim
+0000eff0: 6974 6572 3d4e 6f6e 652c 0a20 2020 2020  iter=None,.     
+0000f000: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000f010: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+0000f020: 4e6f 6e65 2c20 656e 636f 6469 6e67 5f74  None, encoding_t
+0000f030: 7970 653d 4e6f 6e65 293a 0a20 2020 2020  ype=None):.     
+0000f040: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0000f050: 6d61 6b65 5f67 6574 5f72 6571 7565 7374  make_get_request
+0000f060: 2862 7563 6b65 744e 616d 652c 206d 6574  (bucketName, met
+0000f070: 686f 644e 616d 653d 276c 6973 744f 626a  hodName='listObj
+0000f080: 6563 7473 272c 2065 7874 656e 7369 6f6e  ects', extension
+0000f090: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
+0000f0a0: 6e48 6561 6465 7273 2c0a 2020 2020 2020  nHeaders,.      
+0000f0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0d0: 2a2a 7365 6c66 2e63 6f6e 7665 7274 6f72  **self.convertor
+0000f0e0: 2e74 7261 6e73 5f6c 6973 745f 6f62 6a65  .trans_list_obje
+0000f0f0: 6374 7328 7072 6566 6978 3d70 7265 6669  cts(prefix=prefi
+0000f100: 782c 206d 6172 6b65 723d 6d61 726b 6572  x, marker=marker
+0000f110: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f150: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
+0000f160: 6b65 7973 3d6d 6178 5f6b 6579 732c 2064  keys=max_keys, d
+0000f170: 656c 696d 6974 6572 3d64 656c 696d 6974  elimiter=delimit
+0000f180: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+0000f190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1c0: 2020 2020 2020 2020 2020 2020 2020 656e                en
+0000f1d0: 636f 6469 6e67 5f74 7970 653d 656e 636f  coding_type=enco
+0000f1e0: 6469 6e67 5f74 7970 6529 290a 0a20 2020  ding_type))..   
+0000f1f0: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
+0000f200: 6465 6620 6865 6164 4275 636b 6574 2873  def headBucket(s
+0000f210: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+0000f220: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+0000f230: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
+0000f240: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
+0000f250: 6b65 5f68 6561 645f 7265 7175 6573 7428  ke_head_request(
+0000f260: 6275 636b 6574 4e61 6d65 2c20 6578 7465  bucketName, exte
+0000f270: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
+0000f280: 656e 7369 6f6e 4865 6164 6572 7329 0a0a  ensionHeaders)..
+0000f290: 2020 2020 4066 756e 6343 6163 6865 0a20      @funcCache. 
+0000f2a0: 2020 2064 6566 2068 6561 644f 626a 6563     def headObjec
+0000f2b0: 7428 7365 6c66 2c20 6275 636b 6574 4e61  t(self, bucketNa
+0000f2c0: 6d65 2c20 6f62 6a65 6374 4b65 792c 2076  me, objectKey, v
+0000f2d0: 6572 7369 6f6e 4964 3d4e 6f6e 652c 2065  ersionId=None, e
+0000f2e0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+0000f2f0: 4e6f 6e65 293a 0a20 2020 2020 2020 2070  None):.        p
+0000f300: 6174 6841 7267 7320 3d20 7b7d 0a20 2020  athArgs = {}.   
+0000f310: 2020 2020 2069 6620 7665 7273 696f 6e49       if versionI
+0000f320: 643a 0a20 2020 2020 2020 2020 2020 2070  d:.            p
+0000f330: 6174 6841 7267 735b 636f 6e73 742e 5645  athArgs[const.VE
+0000f340: 5253 494f 4e5f 4944 5f50 4152 414d 5d20  RSION_ID_PARAM] 
+0000f350: 3d20 7574 696c 2e74 6f5f 7374 7269 6e67  = util.to_string
+0000f360: 2876 6572 7369 6f6e 4964 290a 2020 2020  (versionId).    
+0000f370: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000f380: 5f6d 616b 655f 6865 6164 5f72 6571 7565  _make_head_reque
+0000f390: 7374 2862 7563 6b65 744e 616d 652c 206f  st(bucketName, o
+0000f3a0: 626a 6563 744b 6579 2c20 7061 7468 4172  bjectKey, pathAr
+0000f3b0: 6773 3d70 6174 6841 7267 732c 2065 7874  gs=pathArgs, ext
+0000f3c0: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+0000f3d0: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
+0000f3e0: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
+0000f3f0: 2020 2020 6465 6620 6765 7442 7563 6b65      def getBucke
+0000f400: 744d 6574 6164 6174 6128 7365 6c66 2c20  tMetadata(self, 
+0000f410: 6275 636b 6574 4e61 6d65 2c20 6f72 6967  bucketName, orig
+0000f420: 696e 3d4e 6f6e 652c 2072 6571 7565 7374  in=None, request
+0000f430: 4865 6164 6572 733d 4e6f 6e65 2c20 6578  Headers=None, ex
+0000f440: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
+0000f450: 6f6e 6529 3a0a 2020 2020 2020 2020 7265  one):.        re
+0000f460: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
+0000f470: 6865 6164 5f72 6571 7565 7374 2862 7563  head_request(buc
+0000f480: 6b65 744e 616d 652c 206d 6574 686f 644e  ketName, methodN
+0000f490: 616d 653d 2767 6574 4275 636b 6574 4d65  ame='getBucketMe
+0000f4a0: 7461 6461 7461 272c 2065 7874 656e 7369  tadata', extensi
+0000f4b0: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
+0000f4c0: 696f 6e48 6561 6465 7273 2c0a 2020 2020  ionHeaders,.    
+0000f4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4f0: 2020 202a 2a73 656c 662e 636f 6e76 6572     **self.conver
+0000f500: 746f 722e 7472 616e 735f 6765 745f 6275  tor.trans_get_bu
+0000f510: 636b 6574 5f6d 6574 6164 6174 6128 6f72  cket_metadata(or
+0000f520: 6967 696e 3d6f 7269 6769 6e2c 0a20 2020  igin=origin,.   
+0000f530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f570: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000f580: 6571 7565 7374 4865 6164 6572 733d 7265  equestHeaders=re
+0000f590: 7175 6573 7448 6561 6465 7273 2929 0a0a  questHeaders))..
+0000f5a0: 2020 2020 4066 756e 6343 6163 6865 0a20      @funcCache. 
+0000f5b0: 2020 2064 6566 2067 6574 4275 636b 6574     def getBucket
+0000f5c0: 4c6f 6361 7469 6f6e 2873 656c 662c 2062  Location(self, b
+0000f5d0: 7563 6b65 744e 616d 652c 2065 7874 656e  ucketName, exten
+0000f5e0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
+0000f5f0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+0000f600: 6e20 7365 6c66 2e5f 6d61 6b65 5f67 6574  n self._make_get
+0000f610: 5f72 6571 7565 7374 2862 7563 6b65 744e  _request(bucketN
+0000f620: 616d 652c 2070 6174 6841 7267 733d 7b27  ame, pathArgs={'
+0000f630: 6c6f 6361 7469 6f6e 273a 204e 6f6e 657d  location': None}
+0000f640: 2c20 6d65 7468 6f64 4e61 6d65 3d27 6765  , methodName='ge
+0000f650: 7442 7563 6b65 744c 6f63 6174 696f 6e27  tBucketLocation'
+0000f660: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f680: 2020 2020 2020 2020 6578 7465 6e73 696f          extensio
+0000f690: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
+0000f6a0: 6f6e 4865 6164 6572 7329 0a0a 2020 2020  onHeaders)..    
+0000f6b0: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
+0000f6c0: 6566 2064 656c 6574 6542 7563 6b65 7428  ef deleteBucket(
+0000f6d0: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
+0000f6e0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+0000f6f0: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
+0000f700: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+0000f710: 616b 655f 6465 6c65 7465 5f72 6571 7565  ake_delete_reque
+0000f720: 7374 2862 7563 6b65 744e 616d 652c 2065  st(bucketName, e
+0000f730: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+0000f740: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+0000f750: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
+0000f760: 650a 2020 2020 6465 6620 7365 7442 7563  e.    def setBuc
+0000f770: 6b65 7451 756f 7461 2873 656c 662c 2062  ketQuota(self, b
+0000f780: 7563 6b65 744e 616d 652c 2071 756f 7461  ucketName, quota
+0000f790: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+0000f7a0: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
+0000f7b0: 2020 7365 6c66 2e5f 6173 7365 7274 5f6e    self._assert_n
+0000f7c0: 6f74 5f6e 756c 6c28 7175 6f74 612c 2027  ot_null(quota, '
+0000f7d0: 7175 6f74 6120 6973 2065 6d70 7479 2729  quota is empty')
+0000f7e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000f7f0: 7365 6c66 2e5f 6d61 6b65 5f70 7574 5f72  self._make_put_r
+0000f800: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
+0000f810: 652c 2070 6174 6841 7267 733d 7b27 7175  e, pathArgs={'qu
+0000f820: 6f74 6127 3a20 4e6f 6e65 7d2c 2065 6e74  ota': None}, ent
+0000f830: 6974 793d 7365 6c66 2e63 6f6e 7665 7274  ity=self.convert
+0000f840: 6f72 2e74 7261 6e73 5f71 756f 7461 2871  or.trans_quota(q
+0000f850: 756f 7461 292c 0a20 2020 2020 2020 2020  uota),.         
+0000f860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f870: 2020 2020 2020 2020 2020 2020 2065 7874               ext
+0000f880: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+0000f890: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
+0000f8a0: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
+0000f8b0: 2020 2020 6465 6620 6765 7442 7563 6b65      def getBucke
+0000f8c0: 7451 756f 7461 2873 656c 662c 2062 7563  tQuota(self, buc
+0000f8d0: 6b65 744e 616d 652c 2065 7874 656e 7369  ketName, extensi
+0000f8e0: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
+0000f8f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000f900: 7365 6c66 2e5f 6d61 6b65 5f67 6574 5f72  self._make_get_r
+0000f910: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
+0000f920: 652c 2070 6174 6841 7267 733d 7b27 7175  e, pathArgs={'qu
+0000f930: 6f74 6127 3a20 4e6f 6e65 7d2c 206d 6574  ota': None}, met
+0000f940: 686f 644e 616d 653d 2767 6574 4275 636b  hodName='getBuck
+0000f950: 6574 5175 6f74 6127 2c0a 2020 2020 2020  etQuota',.      
+0000f960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f980: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+0000f990: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
+0000f9a0: 7329 0a0a 2020 2020 4066 756e 6343 6163  s)..    @funcCac
+0000f9b0: 6865 0a20 2020 2064 6566 2067 6574 4275  he.    def getBu
+0000f9c0: 636b 6574 5374 6f72 6167 6549 6e66 6f28  cketStorageInfo(
+0000f9d0: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
+0000f9e0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+0000f9f0: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
+0000fa00: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+0000fa10: 616b 655f 6765 745f 7265 7175 6573 7428  ake_get_request(
+0000fa20: 6275 636b 6574 4e61 6d65 2c20 7061 7468  bucketName, path
+0000fa30: 4172 6773 3d7b 2773 746f 7261 6765 696e  Args={'storagein
+0000fa40: 666f 273a 204e 6f6e 657d 2c20 6d65 7468  fo': None}, meth
+0000fa50: 6f64 4e61 6d65 3d27 6765 7442 7563 6b65  odName='getBucke
+0000fa60: 7453 746f 7261 6765 496e 666f 272c 0a20  tStorageInfo',. 
+0000fa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa90: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
+0000faa0: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+0000fab0: 6561 6465 7273 290a 0a20 2020 2040 6675  eaders)..    @fu
+0000fac0: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
+0000fad0: 7365 7442 7563 6b65 7441 636c 2873 656c  setBucketAcl(sel
+0000fae0: 662c 2062 7563 6b65 744e 616d 652c 2061  f, bucketName, a
+0000faf0: 636c 3d4e 6f6e 652c 2061 636c 436f 6e74  cl=None, aclCont
+0000fb00: 726f 6c3d 4e6f 6e65 2c20 6578 7465 6e73  rol=None, extens
+0000fb10: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
+0000fb20: 3a0a 2020 2020 2020 2020 6966 2061 636c  :.        if acl
+0000fb30: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000fb40: 2020 2020 2020 6163 6c20 3d20 4143 4c28        acl = ACL(
+0000fb50: 290a 2020 2020 2020 2020 6966 2061 636c  ).        if acl
+0000fb60: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+0000fb70: 206c 656e 2861 636c 2920 3e20 3020 616e   len(acl) > 0 an
+0000fb80: 6420 6163 6c43 6f6e 7472 6f6c 2069 7320  d aclControl is 
+0000fb90: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0000fba0: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+0000fbb0: 7074 696f 6e28 2742 6f74 6820 6163 6c20  ption('Both acl 
+0000fbc0: 616e 6420 6163 6c43 6f6e 7472 6f6c 2061  and aclControl a
+0000fbd0: 7265 2073 6574 2729 0a20 2020 2020 2020  re set').       
+0000fbe0: 2069 6620 6e6f 7420 6163 6c20 616e 6420   if not acl and 
+0000fbf0: 6e6f 7420 6163 6c43 6f6e 7472 6f6c 3a0a  not aclControl:.
+0000fc00: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000fc10: 6520 4578 6365 7074 696f 6e28 2742 6f74  e Exception('Bot
+0000fc20: 6820 6163 6c20 616e 6420 6163 6c43 6f6e  h acl and aclCon
+0000fc30: 7472 6f6c 2061 7265 206e 6f74 2073 6574  trol are not set
+0000fc40: 2729 0a20 2020 2020 2020 2072 6574 7572  ').        retur
+0000fc50: 6e20 7365 6c66 2e5f 6d61 6b65 5f70 7574  n self._make_put
+0000fc60: 5f72 6571 7565 7374 2862 7563 6b65 744e  _request(bucketN
+0000fc70: 616d 652c 2065 7874 656e 7369 6f6e 4865  ame, extensionHe
+0000fc80: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+0000fc90: 6561 6465 7273 2c0a 2020 2020 2020 2020  eaders,.        
+0000fca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fcb0: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
+0000fcc0: 7365 6c66 2e63 6f6e 7665 7274 6f72 2e74  self.convertor.t
+0000fcd0: 7261 6e73 5f73 6574 5f62 7563 6b65 745f  rans_set_bucket_
+0000fce0: 6163 6c28 6163 6c3d 6163 6c2c 2061 636c  acl(acl=acl, acl
+0000fcf0: 436f 6e74 726f 6c3d 6163 6c43 6f6e 7472  Control=aclContr
+0000fd00: 6f6c 2929 0a0a 2020 2020 4066 756e 6343  ol))..    @funcC
+0000fd10: 6163 6865 0a20 2020 2064 6566 2067 6574  ache.    def get
+0000fd20: 4275 636b 6574 4163 6c28 7365 6c66 2c20  BucketAcl(self, 
+0000fd30: 6275 636b 6574 4e61 6d65 2c20 6578 7465  bucketName, exte
+0000fd40: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
+0000fd50: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
+0000fd60: 726e 2073 656c 662e 5f6d 616b 655f 6765  rn self._make_ge
+0000fd70: 745f 7265 7175 6573 7428 6275 636b 6574  t_request(bucket
+0000fd80: 4e61 6d65 2c20 7061 7468 4172 6773 3d7b  Name, pathArgs={
+0000fd90: 2761 636c 273a 204e 6f6e 657d 2c20 6d65  'acl': None}, me
+0000fda0: 7468 6f64 4e61 6d65 3d27 6765 7442 7563  thodName='getBuc
+0000fdb0: 6b65 7441 636c 272c 0a20 2020 2020 2020  ketAcl',.       
+0000fdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fdd0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000fde0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+0000fdf0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+0000fe00: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
+0000fe10: 650a 2020 2020 6465 6620 7365 7442 7563  e.    def setBuc
+0000fe20: 6b65 7450 6f6c 6963 7928 7365 6c66 2c20  ketPolicy(self, 
+0000fe30: 6275 636b 6574 4e61 6d65 2c20 706f 6c69  bucketName, poli
+0000fe40: 6379 4a53 4f4e 2c20 6578 7465 6e73 696f  cyJSON, extensio
+0000fe50: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
+0000fe60: 2020 2020 2020 2020 7365 6c66 2e5f 6173          self._as
+0000fe70: 7365 7274 5f6e 6f74 5f6e 756c 6c28 706f  sert_not_null(po
+0000fe80: 6c69 6379 4a53 4f4e 2c20 2770 6f6c 6963  licyJSON, 'polic
+0000fe90: 794a 534f 4e20 6973 2065 6d70 7479 2729  yJSON is empty')
+0000fea0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000feb0: 7365 6c66 2e5f 6d61 6b65 5f70 7574 5f72  self._make_put_r
+0000fec0: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
+0000fed0: 652c 2070 6174 6841 7267 733d 7b27 706f  e, pathArgs={'po
+0000fee0: 6c69 6379 273a 204e 6f6e 657d 2c20 656e  licy': None}, en
+0000fef0: 7469 7479 3d70 6f6c 6963 794a 534f 4e2c  tity=policyJSON,
+0000ff00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ff10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff20: 2020 2020 2020 2065 7874 656e 7369 6f6e         extension
+0000ff30: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
+0000ff40: 6e48 6561 6465 7273 290a 0a20 2020 2040  nHeaders)..    @
+0000ff50: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
+0000ff60: 6620 6765 7442 7563 6b65 7450 6f6c 6963  f getBucketPolic
+0000ff70: 7928 7365 6c66 2c20 6275 636b 6574 4e61  y(self, bucketNa
+0000ff80: 6d65 2c20 6578 7465 6e73 696f 6e48 6561  me, extensionHea
+0000ff90: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
+0000ffa0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000ffb0: 5f6d 616b 655f 6765 745f 7265 7175 6573  _make_get_reques
+0000ffc0: 7428 6275 636b 6574 4e61 6d65 2c20 7061  t(bucketName, pa
+0000ffd0: 7468 4172 6773 3d7b 2770 6f6c 6963 7927  thArgs={'policy'
+0000ffe0: 3a20 4e6f 6e65 7d2c 206d 6574 686f 644e  : None}, methodN
+0000fff0: 616d 653d 2767 6574 4275 636b 6574 506f  ame='getBucketPo
+00010000: 6c69 6379 272c 0a20 2020 2020 2020 2020  licy',.         
+00010010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010020: 2020 2020 2020 2020 2020 2020 2065 7874               ext
+00010030: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+00010040: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
+00010050: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
+00010060: 2020 2020 6465 6620 6465 6c65 7465 4275      def deleteBu
+00010070: 636b 6574 506f 6c69 6379 2873 656c 662c  cketPolicy(self,
+00010080: 2062 7563 6b65 744e 616d 652c 2065 7874   bucketName, ext
+00010090: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
+000100a0: 6e65 293a 0a20 2020 2020 2020 2072 6574  ne):.        ret
+000100b0: 7572 6e20 7365 6c66 2e5f 6d61 6b65 5f64  urn self._make_d
+000100c0: 656c 6574 655f 7265 7175 6573 7428 6275  elete_request(bu
+000100d0: 636b 6574 4e61 6d65 2c20 7061 7468 4172  cketName, pathAr
+000100e0: 6773 3d7b 2770 6f6c 6963 7927 3a20 4e6f  gs={'policy': No
+000100f0: 6e65 7d2c 2065 7874 656e 7369 6f6e 4865  ne}, extensionHe
+00010100: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+00010110: 6561 6465 7273 290a 0a20 2020 2040 6675  eaders)..    @fu
+00010120: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
+00010130: 7365 7442 7563 6b65 7456 6572 7369 6f6e  setBucketVersion
+00010140: 696e 6728 7365 6c66 2c20 6275 636b 6574  ing(self, bucket
+00010150: 4e61 6d65 2c20 7374 6174 7573 2c20 6578  Name, status, ex
+00010160: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
+00010170: 6f6e 6529 3a0a 2020 2020 2020 2020 7365  one):.        se
+00010180: 6c66 2e5f 6173 7365 7274 5f6e 6f74 5f6e  lf._assert_not_n
+00010190: 756c 6c28 7374 6174 7573 2c20 2773 7461  ull(status, 'sta
+000101a0: 7475 7320 6973 2065 6d70 7479 2729 0a20  tus is empty'). 
+000101b0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000101c0: 6c66 2e5f 6d61 6b65 5f70 7574 5f72 6571  lf._make_put_req
+000101d0: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
+000101e0: 2070 6174 6841 7267 733d 7b27 7665 7273   pathArgs={'vers
+000101f0: 696f 6e69 6e67 273a 204e 6f6e 657d 2c0a  ioning': None},.
+00010200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010220: 2020 2020 2020 656e 7469 7479 3d73 656c        entity=sel
+00010230: 662e 636f 6e76 6572 746f 722e 7472 616e  f.convertor.tran
+00010240: 735f 7665 7273 696f 6e5f 7374 6174 7573  s_version_status
+00010250: 2873 7461 7475 7329 2c0a 2020 2020 2020  (status),.      
+00010260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010280: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+00010290: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
+000102a0: 7329 0a0a 2020 2020 4066 756e 6343 6163  s)..    @funcCac
+000102b0: 6865 0a20 2020 2064 6566 2067 6574 4275  he.    def getBu
+000102c0: 636b 6574 5665 7273 696f 6e69 6e67 2873  cketVersioning(s
+000102d0: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+000102e0: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+000102f0: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
+00010300: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
+00010310: 6b65 5f67 6574 5f72 6571 7565 7374 2862  ke_get_request(b
+00010320: 7563 6b65 744e 616d 652c 2070 6174 6841  ucketName, pathA
+00010330: 7267 733d 7b27 7665 7273 696f 6e69 6e67  rgs={'versioning
+00010340: 273a 204e 6f6e 657d 2c20 6d65 7468 6f64  ': None}, method
+00010350: 4e61 6d65 3d27 6765 7442 7563 6b65 7456  Name='getBucketV
+00010360: 6572 7369 6f6e 696e 6727 2c0a 2020 2020  ersioning',.    
+00010370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010390: 2020 6578 7465 6e73 696f 6e48 6561 6465    extensionHeade
+000103a0: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
+000103b0: 6572 7329 0a0a 2020 2020 4066 756e 6343  ers)..    @funcC
+000103c0: 6163 6865 0a20 2020 2064 6566 206c 6973  ache.    def lis
+000103d0: 7456 6572 7369 6f6e 7328 7365 6c66 2c20  tVersions(self, 
+000103e0: 6275 636b 6574 4e61 6d65 2c20 7665 7273  bucketName, vers
+000103f0: 696f 6e3d 4e6f 6e65 2c20 6578 7465 6e73  ion=None, extens
+00010400: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
+00010410: 3a0a 2020 2020 2020 2020 6966 2076 6572  :.        if ver
+00010420: 7369 6f6e 2069 7320 4e6f 6e65 3a0a 2020  sion is None:.  
+00010430: 2020 2020 2020 2020 2020 7665 7273 696f            versio
+00010440: 6e20 3d20 5665 7273 696f 6e73 2829 0a20  n = Versions(). 
+00010450: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00010460: 6c66 2e5f 6d61 6b65 5f67 6574 5f72 6571  lf._make_get_req
+00010470: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
+00010480: 206d 6574 686f 644e 616d 653d 276c 6973   methodName='lis
+00010490: 7456 6572 7369 6f6e 7327 2c20 6578 7465  tVersions', exte
+000104a0: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
+000104b0: 656e 7369 6f6e 4865 6164 6572 732c 0a20  ensionHeaders,. 
+000104c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000104d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000104e0: 2020 2020 2020 2020 2020 2020 2065 6e63               enc
-000104f0: 6f64 696e 675f 7479 7065 3d4e 6f6e 6529  oding_type=None)
-00010500: 3a0a 2020 2020 2020 2020 6966 206d 756c  :.        if mul
-00010510: 7469 7061 7274 2069 7320 4e6f 6e65 3a0a  tipart is None:.
-00010520: 2020 2020 2020 2020 2020 2020 6d75 6c74              mult
-00010530: 6970 6172 7420 3d20 4c69 7374 4d75 6c74  ipart = ListMult
-00010540: 6970 6172 7455 706c 6f61 6473 5265 7175  ipartUploadsRequ
-00010550: 6573 7428 290a 2020 2020 2020 2020 7265  est().        re
-00010560: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
-00010570: 6765 745f 7265 7175 6573 7428 6275 636b  get_request(buck
-00010580: 6574 4e61 6d65 2c20 6d65 7468 6f64 4e61  etName, methodNa
-00010590: 6d65 3d27 6c69 7374 4d75 6c74 6970 6172  me='listMultipar
-000105a0: 7455 706c 6f61 6473 272c 2065 7874 656e  tUploads', exten
-000105b0: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
-000105c0: 6e73 696f 6e48 6561 6465 7273 2c0a 2020  nsionHeaders,.  
-000105d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105f0: 2020 2020 2a2a 7365 6c66 2e63 6f6e 7665      **self.conve
-00010600: 7274 6f72 2e74 7261 6e73 5f6c 6973 745f  rtor.trans_list_
-00010610: 6d75 6c74 6970 6172 745f 7570 6c6f 6164  multipart_upload
-00010620: 7328 6d75 6c74 6970 6172 743d 6d75 6c74  s(multipart=mult
-00010630: 6970 6172 742c 0a20 2020 2020 2020 2020  ipart,.         
-00010640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010680: 2020 2020 2020 2020 2020 2065 6e63 6f64             encod
-00010690: 696e 675f 7479 7065 3d65 6e63 6f64 696e  ing_type=encodin
-000106a0: 675f 7479 7065 2929 0a0a 2020 2020 4066  g_type))..    @f
-000106b0: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
-000106c0: 2064 656c 6574 6542 7563 6b65 744c 6966   deleteBucketLif
-000106d0: 6563 7963 6c65 2873 656c 662c 2062 7563  ecycle(self, buc
-000106e0: 6b65 744e 616d 652c 2065 7874 656e 7369  ketName, extensi
-000106f0: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
-00010700: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00010710: 7365 6c66 2e5f 6d61 6b65 5f64 656c 6574  self._make_delet
-00010720: 655f 7265 7175 6573 7428 6275 636b 6574  e_request(bucket
-00010730: 4e61 6d65 2c20 7061 7468 4172 6773 3d7b  Name, pathArgs={
-00010740: 276c 6966 6563 7963 6c65 273a 204e 6f6e  'lifecycle': Non
-00010750: 657d 2c20 6578 7465 6e73 696f 6e48 6561  e}, extensionHea
-00010760: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
-00010770: 6164 6572 7329 0a0a 2020 2020 4066 756e  aders)..    @fun
-00010780: 6343 6163 6865 0a20 2020 2064 6566 2073  cCache.    def s
-00010790: 6574 4275 636b 6574 4c69 6665 6379 636c  etBucketLifecycl
-000107a0: 6528 7365 6c66 2c20 6275 636b 6574 4e61  e(self, bucketNa
-000107b0: 6d65 2c20 6c69 6665 6379 636c 652c 2065  me, lifecycle, e
-000107c0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-000107d0: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
-000107e0: 656c 662e 5f61 7373 6572 745f 6e6f 745f  elf._assert_not_
-000107f0: 6e75 6c6c 286c 6966 6563 7963 6c65 2c20  null(lifecycle, 
-00010800: 276c 6966 6563 7963 6c65 2069 7320 656d  'lifecycle is em
-00010810: 7074 7927 290a 2020 2020 2020 2020 7265  pty').        re
-00010820: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
-00010830: 7075 745f 7265 7175 6573 7428 6275 636b  put_request(buck
-00010840: 6574 4e61 6d65 2c20 6578 7465 6e73 696f  etName, extensio
-00010850: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
-00010860: 6f6e 4865 6164 6572 732c 0a20 2020 2020  onHeaders,.     
-00010870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010890: 202a 2a73 656c 662e 636f 6e76 6572 746f   **self.converto
-000108a0: 722e 7472 616e 735f 7365 745f 6275 636b  r.trans_set_buck
-000108b0: 6574 5f6c 6966 6563 7963 6c65 286c 6966  et_lifecycle(lif
-000108c0: 6563 7963 6c65 3d6c 6966 6563 7963 6c65  ecycle=lifecycle
-000108d0: 2929 0a0a 2020 2020 4066 756e 6343 6163  ))..    @funcCac
-000108e0: 6865 0a20 2020 2064 6566 2067 6574 4275  he.    def getBu
-000108f0: 636b 6574 4c69 6665 6379 636c 6528 7365  cketLifecycle(se
-00010900: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
-00010910: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-00010920: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00010930: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
-00010940: 655f 6765 745f 7265 7175 6573 7428 6275  e_get_request(bu
-00010950: 636b 6574 4e61 6d65 2c20 7061 7468 4172  cketName, pathAr
-00010960: 6773 3d7b 276c 6966 6563 7963 6c65 273a  gs={'lifecycle':
-00010970: 204e 6f6e 657d 2c20 6d65 7468 6f64 4e61   None}, methodNa
-00010980: 6d65 3d27 6765 7442 7563 6b65 744c 6966  me='getBucketLif
-00010990: 6563 7963 6c65 272c 0a20 2020 2020 2020  ecycle',.       
-000109a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000109c0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-000109d0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-000109e0: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
-000109f0: 650a 2020 2020 6465 6620 6465 6c65 7465  e.    def delete
-00010a00: 4275 636b 6574 5765 6273 6974 6528 7365  BucketWebsite(se
-00010a10: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
-00010a20: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-00010a30: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00010a40: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
-00010a50: 655f 6465 6c65 7465 5f72 6571 7565 7374  e_delete_request
-00010a60: 2862 7563 6b65 744e 616d 652c 2070 6174  (bucketName, pat
-00010a70: 6841 7267 733d 7b27 7765 6273 6974 6527  hArgs={'website'
-00010a80: 3a20 4e6f 6e65 7d2c 2065 7874 656e 7369  : None}, extensi
-00010a90: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
-00010aa0: 696f 6e48 6561 6465 7273 290a 0a20 2020  ionHeaders)..   
-00010ab0: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
-00010ac0: 6465 6620 7365 7442 7563 6b65 7457 6562  def setBucketWeb
-00010ad0: 7369 7465 2873 656c 662c 2062 7563 6b65  site(self, bucke
-00010ae0: 744e 616d 652c 2077 6562 7369 7465 2c20  tName, website, 
-00010af0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-00010b00: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00010b10: 7365 6c66 2e5f 6173 7365 7274 5f6e 6f74  self._assert_not
-00010b20: 5f6e 756c 6c28 7765 6273 6974 652c 2027  _null(website, '
-00010b30: 7765 6273 6974 6520 6973 2065 6d70 7479  website is empty
-00010b40: 2729 0a20 2020 2020 2020 2072 6574 7572  ').        retur
-00010b50: 6e20 7365 6c66 2e5f 6d61 6b65 5f70 7574  n self._make_put
-00010b60: 5f72 6571 7565 7374 2862 7563 6b65 744e  _request(bucketN
-00010b70: 616d 652c 2070 6174 6841 7267 733d 7b27  ame, pathArgs={'
-00010b80: 7765 6273 6974 6527 3a20 4e6f 6e65 7d2c  website': None},
-00010b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010bb0: 2020 2020 2020 2065 6e74 6974 793d 7365         entity=se
-00010bc0: 6c66 2e63 6f6e 7665 7274 6f72 2e74 7261  lf.convertor.tra
-00010bd0: 6e73 5f77 6562 7369 7465 2877 6562 7369  ns_website(websi
-00010be0: 7465 292c 2065 7874 656e 7369 6f6e 4865  te), extensionHe
-00010bf0: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
-00010c00: 6561 6465 7273 290a 0a20 2020 2040 6675  eaders)..    @fu
-00010c10: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
-00010c20: 6765 7442 7563 6b65 7457 6562 7369 7465  getBucketWebsite
-00010c30: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
-00010c40: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
-00010c50: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
-00010c60: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00010c70: 6d61 6b65 5f67 6574 5f72 6571 7565 7374  make_get_request
-00010c80: 2862 7563 6b65 744e 616d 652c 2070 6174  (bucketName, pat
-00010c90: 6841 7267 733d 7b27 7765 6273 6974 6527  hArgs={'website'
-00010ca0: 3a20 4e6f 6e65 7d2c 206d 6574 686f 644e  : None}, methodN
-00010cb0: 616d 653d 2767 6574 4275 636b 6574 5765  ame='getBucketWe
-00010cc0: 6273 6974 6527 2c0a 2020 2020 2020 2020  bsite',.        
-00010cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ce0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00010cf0: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
-00010d00: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
-00010d10: 0a0a 2020 2020 4066 756e 6343 6163 6865  ..    @funcCache
-00010d20: 0a20 2020 2064 6566 2073 6574 4275 636b  .    def setBuck
-00010d30: 6574 4c6f 6767 696e 6728 7365 6c66 2c20  etLogging(self, 
-00010d40: 6275 636b 6574 4e61 6d65 2c20 6c6f 6773  bucketName, logs
-00010d50: 7461 7475 733d 4e6f 6e65 2c20 6578 7465  tatus=None, exte
-00010d60: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
-00010d70: 6529 3a0a 2020 2020 2020 2020 6966 206c  e):.        if l
-00010d80: 6f67 7374 6174 7573 2069 7320 4e6f 6e65  ogstatus is None
-00010d90: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-00010da0: 6773 7461 7475 7320 3d20 4c6f 6767 696e  gstatus = Loggin
-00010db0: 6728 290a 2020 2020 2020 2020 7265 7475  g().        retu
-00010dc0: 726e 2073 656c 662e 5f6d 616b 655f 7075  rn self._make_pu
-00010dd0: 745f 7265 7175 6573 7428 6275 636b 6574  t_request(bucket
-00010de0: 4e61 6d65 2c20 7061 7468 4172 6773 3d7b  Name, pathArgs={
-00010df0: 276c 6f67 6769 6e67 273a 204e 6f6e 657d  'logging': None}
-00010e00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00010e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e20: 2020 2020 2020 2020 656e 7469 7479 3d73          entity=s
-00010e30: 656c 662e 636f 6e76 6572 746f 722e 7472  elf.convertor.tr
-00010e40: 616e 735f 6c6f 6767 696e 6728 6c6f 6773  ans_logging(logs
-00010e50: 7461 7475 7329 2c20 6578 7465 6e73 696f  tatus), extensio
-00010e60: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
-00010e70: 6f6e 4865 6164 6572 7329 0a0a 2020 2020  onHeaders)..    
-00010e80: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
-00010e90: 6566 2067 6574 4275 636b 6574 4c6f 6767  ef getBucketLogg
-00010ea0: 696e 6728 7365 6c66 2c20 6275 636b 6574  ing(self, bucket
-00010eb0: 4e61 6d65 2c20 6578 7465 6e73 696f 6e48  Name, extensionH
-00010ec0: 6561 6465 7273 3d4e 6f6e 6529 3a0a 2020  eaders=None):.  
-00010ed0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00010ee0: 662e 5f6d 616b 655f 6765 745f 7265 7175  f._make_get_requ
-00010ef0: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
-00010f00: 7061 7468 4172 6773 3d7b 276c 6f67 6769  pathArgs={'loggi
-00010f10: 6e67 273a 204e 6f6e 657d 2c20 6d65 7468  ng': None}, meth
-00010f20: 6f64 4e61 6d65 3d27 6765 7442 7563 6b65  odName='getBucke
-00010f30: 744c 6f67 6769 6e67 272c 0a20 2020 2020  tLogging',.     
-00010f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f60: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-00010f70: 733d 6578 7465 6e73 696f 6e48 6561 6465  s=extensionHeade
-00010f80: 7273 290a 0a20 2020 2040 6675 6e63 4361  rs)..    @funcCa
-00010f90: 6368 650a 2020 2020 6465 6620 6765 7442  che.    def getB
-00010fa0: 7563 6b65 7454 6167 6769 6e67 2873 656c  ucketTagging(sel
-00010fb0: 662c 2062 7563 6b65 744e 616d 652c 2065  f, bucketName, e
-00010fc0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-00010fd0: 4e6f 6e65 293a 0a20 2020 2020 2020 2072  None):.        r
-00010fe0: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
-00010ff0: 5f67 6574 5f72 6571 7565 7374 2862 7563  _get_request(buc
-00011000: 6b65 744e 616d 652c 2070 6174 6841 7267  ketName, pathArg
-00011010: 733d 7b27 7461 6767 696e 6727 3a20 4e6f  s={'tagging': No
-00011020: 6e65 7d2c 206d 6574 686f 644e 616d 653d  ne}, methodName=
-00011030: 2767 6574 4275 636b 6574 5461 6767 696e  'getBucketTaggin
-00011040: 6727 2c0a 2020 2020 2020 2020 2020 2020  g',.            
-00011050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011060: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
-00011070: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-00011080: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
-00011090: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
-000110a0: 2064 6566 2073 6574 4275 636b 6574 5461   def setBucketTa
-000110b0: 6767 696e 6728 7365 6c66 2c20 6275 636b  gging(self, buck
-000110c0: 6574 4e61 6d65 2c20 7461 6749 6e66 6f2c  etName, tagInfo,
-000110d0: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-000110e0: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
-000110f0: 2073 656c 662e 5f61 7373 6572 745f 6e6f   self._assert_no
-00011100: 745f 6e75 6c6c 2874 6167 496e 666f 2c20  t_null(tagInfo, 
-00011110: 2774 6167 496e 666f 2069 7320 656d 7074  'tagInfo is empt
-00011120: 7927 290a 2020 2020 2020 2020 7265 7475  y').        retu
-00011130: 726e 2073 656c 662e 5f6d 616b 655f 7075  rn self._make_pu
-00011140: 745f 7265 7175 6573 7428 6275 636b 6574  t_request(bucket
-00011150: 4e61 6d65 2c20 6578 7465 6e73 696f 6e48  Name, extensionH
-00011160: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
-00011170: 4865 6164 6572 732c 0a20 2020 2020 2020  Headers,.       
-00011180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011190: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-000111a0: 2a73 656c 662e 636f 6e76 6572 746f 722e  *self.convertor.
-000111b0: 7472 616e 735f 7365 745f 6275 636b 6574  trans_set_bucket
-000111c0: 5f74 6167 6769 6e67 2874 6167 496e 666f  _tagging(tagInfo
-000111d0: 3d74 6167 496e 666f 2929 0a0a 2020 2020  =tagInfo))..    
-000111e0: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
-000111f0: 6566 2064 656c 6574 6542 7563 6b65 7454  ef deleteBucketT
-00011200: 6167 6769 6e67 2873 656c 662c 2062 7563  agging(self, buc
-00011210: 6b65 744e 616d 652c 2065 7874 656e 7369  ketName, extensi
-00011220: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
-00011230: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00011240: 7365 6c66 2e5f 6d61 6b65 5f64 656c 6574  self._make_delet
-00011250: 655f 7265 7175 6573 7428 6275 636b 6574  e_request(bucket
-00011260: 4e61 6d65 2c20 7061 7468 4172 6773 3d7b  Name, pathArgs={
-00011270: 2774 6167 6769 6e67 273a 204e 6f6e 657d  'tagging': None}
-00011280: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
-00011290: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
-000112a0: 6572 7329 0a0a 2020 2020 4066 756e 6343  ers)..    @funcC
-000112b0: 6163 6865 0a20 2020 2064 6566 2073 6574  ache.    def set
-000112c0: 4275 636b 6574 436f 7273 2873 656c 662c  BucketCors(self,
-000112d0: 2062 7563 6b65 744e 616d 652c 2063 6f72   bucketName, cor
-000112e0: 7352 756c 654c 6973 742c 2065 7874 656e  sRuleList, exten
-000112f0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
-00011300: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-00011310: 5f61 7373 6572 745f 6e6f 745f 6e75 6c6c  _assert_not_null
-00011320: 2863 6f72 7352 756c 654c 6973 742c 2027  (corsRuleList, '
-00011330: 636f 7273 5275 6c65 4c69 7374 2069 7320  corsRuleList is 
-00011340: 656d 7074 7927 290a 2020 2020 2020 2020  empty').        
-00011350: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
-00011360: 655f 7075 745f 7265 7175 6573 7428 6275  e_put_request(bu
-00011370: 636b 6574 4e61 6d65 2c20 6578 7465 6e73  cketName, extens
-00011380: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-00011390: 7369 6f6e 4865 6164 6572 732c 0a20 2020  sionHeaders,.   
-000113a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000113b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000113c0: 2020 202a 2a73 656c 662e 636f 6e76 6572     **self.conver
-000113d0: 746f 722e 7472 616e 735f 7365 745f 6275  tor.trans_set_bu
-000113e0: 636b 6574 5f63 6f72 7328 636f 7273 5275  cket_cors(corsRu
-000113f0: 6c65 4c69 7374 3d63 6f72 7352 756c 654c  leList=corsRuleL
-00011400: 6973 7429 290a 0a20 2020 2040 6675 6e63  ist))..    @func
-00011410: 4361 6368 650a 2020 2020 6465 6620 6465  Cache.    def de
-00011420: 6c65 7465 4275 636b 6574 436f 7273 2873  leteBucketCors(s
-00011430: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
-00011440: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-00011450: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
-00011460: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
-00011470: 6b65 5f64 656c 6574 655f 7265 7175 6573  ke_delete_reques
-00011480: 7428 6275 636b 6574 4e61 6d65 2c20 7061  t(bucketName, pa
-00011490: 7468 4172 6773 3d7b 2763 6f72 7327 3a20  thArgs={'cors': 
-000114a0: 4e6f 6e65 7d2c 2065 7874 656e 7369 6f6e  None}, extension
-000114b0: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
-000114c0: 6e48 6561 6465 7273 290a 0a20 2020 2040  nHeaders)..    @
-000114d0: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
-000114e0: 6620 6765 7442 7563 6b65 7443 6f72 7328  f getBucketCors(
-000114f0: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
-00011500: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
-00011510: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
-00011520: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
-00011530: 616b 655f 6765 745f 7265 7175 6573 7428  ake_get_request(
-00011540: 6275 636b 6574 4e61 6d65 2c20 7061 7468  bucketName, path
-00011550: 4172 6773 3d7b 2763 6f72 7327 3a20 4e6f  Args={'cors': No
-00011560: 6e65 7d2c 206d 6574 686f 644e 616d 653d  ne}, methodName=
-00011570: 2767 6574 4275 636b 6574 436f 7273 272c  'getBucketCors',
-00011580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000115a0: 2020 2020 2020 2065 7874 656e 7369 6f6e         extension
-000115b0: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
-000115c0: 6e48 6561 6465 7273 290a 0a20 2020 2040  nHeaders)..    @
-000115d0: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
-000115e0: 6620 6f70 7469 6f6e 7342 7563 6b65 7428  f optionsBucket(
-000115f0: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
-00011600: 2c20 6f70 7469 6f6e 2c20 6578 7465 6e73  , option, extens
-00011610: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
-00011620: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00011630: 2073 656c 662e 6f70 7469 6f6e 734f 626a   self.optionsObj
-00011640: 6563 7428 6275 636b 6574 4e61 6d65 2c20  ect(bucketName, 
-00011650: 4e6f 6e65 2c20 6f70 7469 6f6e 3d6f 7074  None, option=opt
-00011660: 696f 6e2c 2065 7874 656e 7369 6f6e 4865  ion, extensionHe
-00011670: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
-00011680: 6561 6465 7273 290a 0a20 2020 2040 6675  eaders)..    @fu
-00011690: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
-000116a0: 7365 7442 7563 6b65 744e 6f74 6966 6963  setBucketNotific
-000116b0: 6174 696f 6e28 7365 6c66 2c20 6275 636b  ation(self, buck
-000116c0: 6574 4e61 6d65 2c20 6e6f 7469 6669 6361  etName, notifica
-000116d0: 7469 6f6e 3d4e 6f6e 652c 2065 7874 656e  tion=None, exten
-000116e0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
-000116f0: 293a 0a20 2020 2020 2020 2069 6620 6e6f  ):.        if no
-00011700: 7469 6669 6361 7469 6f6e 2069 7320 4e6f  tification is No
-00011710: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00011720: 6e6f 7469 6669 6361 7469 6f6e 203d 204e  notification = N
-00011730: 6f74 6966 6963 6174 696f 6e28 290a 2020  otification().  
-00011740: 2020 2020 2020 6966 206e 6f74 6966 6963        if notific
-00011750: 6174 696f 6e20 6973 204e 6f6e 653a 0a20  ation is None:. 
-00011760: 2020 2020 2020 2020 2020 206e 6f74 6966             notif
-00011770: 6963 6174 696f 6e20 3d20 4e6f 7469 6669  ication = Notifi
-00011780: 6361 7469 6f6e 2829 0a20 2020 2020 2020  cation().       
-00011790: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
-000117a0: 6b65 5f70 7574 5f72 6571 7565 7374 2862  ke_put_request(b
-000117b0: 7563 6b65 744e 616d 652c 2070 6174 6841  ucketName, pathA
-000117c0: 7267 733d 7b27 6e6f 7469 6669 6361 7469  rgs={'notificati
-000117d0: 6f6e 273a 204e 6f6e 657d 2c0a 2020 2020  on': None},.    
-000117e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000117f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011800: 2020 656e 7469 7479 3d73 656c 662e 636f    entity=self.co
-00011810: 6e76 6572 746f 722e 7472 616e 735f 6e6f  nvertor.trans_no
-00011820: 7469 6669 6361 7469 6f6e 286e 6f74 6966  tification(notif
-00011830: 6963 6174 696f 6e29 2c0a 2020 2020 2020  ication),.      
-00011840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011860: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-00011870: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
-00011880: 7329 0a0a 2020 2020 4066 756e 6343 6163  s)..    @funcCac
-00011890: 6865 0a20 2020 2064 6566 2072 656e 616d  he.    def renam
-000118a0: 6546 696c 6528 7365 6c66 2c20 6275 636b  eFile(self, buck
-000118b0: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
-000118c0: 792c 206e 6577 4f62 6a65 6374 4b65 793d  y, newObjectKey=
-000118d0: 4e6f 6e65 2c20 6865 6164 6572 733d 5265  None, headers=Re
-000118e0: 6e61 6d65 4669 6c65 4865 6164 6572 2829  nameFileHeader()
-000118f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00011900: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
-00011910: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
-00011920: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00011930: 2e5f 6d61 6b65 5f70 6f73 745f 7265 7175  ._make_post_requ
-00011940: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
-00011950: 6f62 6a65 6374 4b65 792c 0a20 2020 2020  objectKey,.     
-00011960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011980: 2020 7061 7468 4172 6773 3d7b 2772 656e    pathArgs={'ren
-00011990: 616d 6527 3a20 4e6f 6e65 2c20 276e 616d  ame': None, 'nam
-000119a0: 6527 3a20 7574 696c 2e74 6f5f 7374 7269  e': util.to_stri
-000119b0: 6e67 286e 6577 4f62 6a65 6374 4b65 7929  ng(newObjectKey)
-000119c0: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
-000119d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119e0: 2020 2020 2020 2020 2020 6865 6164 6572            header
-000119f0: 733d 6865 6164 6572 732c 0a20 2020 2020  s=headers,.     
-00011a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000104e0: 2020 2020 202a 2a73 656c 662e 636f 6e76       **self.conv
+000104f0: 6572 746f 722e 7472 616e 735f 6c69 7374  ertor.trans_list
+00010500: 5f76 6572 7369 6f6e 7328 7665 7273 696f  _versions(versio
+00010510: 6e3d 7665 7273 696f 6e29 290a 0a20 2020  n=version))..   
+00010520: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
+00010530: 6465 6620 6c69 7374 4d75 6c74 6970 6172  def listMultipar
+00010540: 7455 706c 6f61 6473 2873 656c 662c 2062  tUploads(self, b
+00010550: 7563 6b65 744e 616d 652c 206d 756c 7469  ucketName, multi
+00010560: 7061 7274 3d4e 6f6e 652c 2065 7874 656e  part=None, exten
+00010570: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
+00010580: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010590: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000105a0: 6e63 6f64 696e 675f 7479 7065 3d4e 6f6e  ncoding_type=Non
+000105b0: 6529 3a0a 2020 2020 2020 2020 6966 206d  e):.        if m
+000105c0: 756c 7469 7061 7274 2069 7320 4e6f 6e65  ultipart is None
+000105d0: 3a0a 2020 2020 2020 2020 2020 2020 6d75  :.            mu
+000105e0: 6c74 6970 6172 7420 3d20 4c69 7374 4d75  ltipart = ListMu
+000105f0: 6c74 6970 6172 7455 706c 6f61 6473 5265  ltipartUploadsRe
+00010600: 7175 6573 7428 290a 2020 2020 2020 2020  quest().        
+00010610: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
+00010620: 655f 6765 745f 7265 7175 6573 7428 6275  e_get_request(bu
+00010630: 636b 6574 4e61 6d65 2c20 6d65 7468 6f64  cketName, method
+00010640: 4e61 6d65 3d27 6c69 7374 4d75 6c74 6970  Name='listMultip
+00010650: 6172 7455 706c 6f61 6473 272c 2065 7874  artUploads', ext
+00010660: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+00010670: 7465 6e73 696f 6e48 6561 6465 7273 2c0a  tensionHeaders,.
+00010680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000106a0: 2020 2020 2020 2a2a 7365 6c66 2e63 6f6e        **self.con
+000106b0: 7665 7274 6f72 2e74 7261 6e73 5f6c 6973  vertor.trans_lis
+000106c0: 745f 6d75 6c74 6970 6172 745f 7570 6c6f  t_multipart_uplo
+000106d0: 6164 7328 6d75 6c74 6970 6172 743d 6d75  ads(multipart=mu
+000106e0: 6c74 6970 6172 742c 0a20 2020 2020 2020  ltipart,.       
+000106f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010730: 2020 2020 2020 2020 2020 2020 2065 6e63               enc
+00010740: 6f64 696e 675f 7479 7065 3d65 6e63 6f64  oding_type=encod
+00010750: 696e 675f 7479 7065 2929 0a0a 2020 2020  ing_type))..    
+00010760: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
+00010770: 6566 2064 656c 6574 6542 7563 6b65 744c  ef deleteBucketL
+00010780: 6966 6563 7963 6c65 2873 656c 662c 2062  ifecycle(self, b
+00010790: 7563 6b65 744e 616d 652c 2065 7874 656e  ucketName, exten
+000107a0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
+000107b0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+000107c0: 6e20 7365 6c66 2e5f 6d61 6b65 5f64 656c  n self._make_del
+000107d0: 6574 655f 7265 7175 6573 7428 6275 636b  ete_request(buck
+000107e0: 6574 4e61 6d65 2c20 7061 7468 4172 6773  etName, pathArgs
+000107f0: 3d7b 276c 6966 6563 7963 6c65 273a 204e  ={'lifecycle': N
+00010800: 6f6e 657d 2c20 6578 7465 6e73 696f 6e48  one}, extensionH
+00010810: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
+00010820: 4865 6164 6572 7329 0a0a 2020 2020 4066  Headers)..    @f
+00010830: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
+00010840: 2073 6574 4275 636b 6574 4c69 6665 6379   setBucketLifecy
+00010850: 636c 6528 7365 6c66 2c20 6275 636b 6574  cle(self, bucket
+00010860: 4e61 6d65 2c20 6c69 6665 6379 636c 652c  Name, lifecycle,
+00010870: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+00010880: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
+00010890: 2073 656c 662e 5f61 7373 6572 745f 6e6f   self._assert_no
+000108a0: 745f 6e75 6c6c 286c 6966 6563 7963 6c65  t_null(lifecycle
+000108b0: 2c20 276c 6966 6563 7963 6c65 2069 7320  , 'lifecycle is 
+000108c0: 656d 7074 7927 290a 2020 2020 2020 2020  empty').        
+000108d0: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
+000108e0: 655f 7075 745f 7265 7175 6573 7428 6275  e_put_request(bu
+000108f0: 636b 6574 4e61 6d65 2c20 6578 7465 6e73  cketName, extens
+00010900: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
+00010910: 7369 6f6e 4865 6164 6572 732c 0a20 2020  sionHeaders,.   
+00010920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010940: 2020 202a 2a73 656c 662e 636f 6e76 6572     **self.conver
+00010950: 746f 722e 7472 616e 735f 7365 745f 6275  tor.trans_set_bu
+00010960: 636b 6574 5f6c 6966 6563 7963 6c65 286c  cket_lifecycle(l
+00010970: 6966 6563 7963 6c65 3d6c 6966 6563 7963  ifecycle=lifecyc
+00010980: 6c65 2929 0a0a 2020 2020 4066 756e 6343  le))..    @funcC
+00010990: 6163 6865 0a20 2020 2064 6566 2067 6574  ache.    def get
+000109a0: 4275 636b 6574 4c69 6665 6379 636c 6528  BucketLifecycle(
+000109b0: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
+000109c0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+000109d0: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
+000109e0: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+000109f0: 616b 655f 6765 745f 7265 7175 6573 7428  ake_get_request(
+00010a00: 6275 636b 6574 4e61 6d65 2c20 7061 7468  bucketName, path
+00010a10: 4172 6773 3d7b 276c 6966 6563 7963 6c65  Args={'lifecycle
+00010a20: 273a 204e 6f6e 657d 2c20 6d65 7468 6f64  ': None}, method
+00010a30: 4e61 6d65 3d27 6765 7442 7563 6b65 744c  Name='getBucketL
+00010a40: 6966 6563 7963 6c65 272c 0a20 2020 2020  ifecycle',.     
+00010a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a70: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+00010a80: 733d 6578 7465 6e73 696f 6e48 6561 6465  s=extensionHeade
+00010a90: 7273 290a 0a20 2020 2040 6675 6e63 4361  rs)..    @funcCa
+00010aa0: 6368 650a 2020 2020 6465 6620 6465 6c65  che.    def dele
+00010ab0: 7465 4275 636b 6574 5765 6273 6974 6528  teBucketWebsite(
+00010ac0: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
+00010ad0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+00010ae0: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
+00010af0: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+00010b00: 616b 655f 6465 6c65 7465 5f72 6571 7565  ake_delete_reque
+00010b10: 7374 2862 7563 6b65 744e 616d 652c 2070  st(bucketName, p
+00010b20: 6174 6841 7267 733d 7b27 7765 6273 6974  athArgs={'websit
+00010b30: 6527 3a20 4e6f 6e65 7d2c 2065 7874 656e  e': None}, exten
+00010b40: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
+00010b50: 6e73 696f 6e48 6561 6465 7273 290a 0a20  nsionHeaders).. 
+00010b60: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
+00010b70: 2020 6465 6620 7365 7442 7563 6b65 7457    def setBucketW
+00010b80: 6562 7369 7465 2873 656c 662c 2062 7563  ebsite(self, buc
+00010b90: 6b65 744e 616d 652c 2077 6562 7369 7465  ketName, website
+00010ba0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+00010bb0: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
+00010bc0: 2020 7365 6c66 2e5f 6173 7365 7274 5f6e    self._assert_n
+00010bd0: 6f74 5f6e 756c 6c28 7765 6273 6974 652c  ot_null(website,
+00010be0: 2027 7765 6273 6974 6520 6973 2065 6d70   'website is emp
+00010bf0: 7479 2729 0a20 2020 2020 2020 2072 6574  ty').        ret
+00010c00: 7572 6e20 7365 6c66 2e5f 6d61 6b65 5f70  urn self._make_p
+00010c10: 7574 5f72 6571 7565 7374 2862 7563 6b65  ut_request(bucke
+00010c20: 744e 616d 652c 2070 6174 6841 7267 733d  tName, pathArgs=
+00010c30: 7b27 7765 6273 6974 6527 3a20 4e6f 6e65  {'website': None
+00010c40: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
+00010c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c60: 2020 2020 2020 2020 2065 6e74 6974 793d           entity=
+00010c70: 7365 6c66 2e63 6f6e 7665 7274 6f72 2e74  self.convertor.t
+00010c80: 7261 6e73 5f77 6562 7369 7465 2877 6562  rans_website(web
+00010c90: 7369 7465 292c 2065 7874 656e 7369 6f6e  site), extension
+00010ca0: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
+00010cb0: 6e48 6561 6465 7273 290a 0a20 2020 2040  nHeaders)..    @
+00010cc0: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
+00010cd0: 6620 6765 7442 7563 6b65 7457 6562 7369  f getBucketWebsi
+00010ce0: 7465 2873 656c 662c 2062 7563 6b65 744e  te(self, bucketN
+00010cf0: 616d 652c 2065 7874 656e 7369 6f6e 4865  ame, extensionHe
+00010d00: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
+00010d10: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00010d20: 2e5f 6d61 6b65 5f67 6574 5f72 6571 7565  ._make_get_reque
+00010d30: 7374 2862 7563 6b65 744e 616d 652c 2070  st(bucketName, p
+00010d40: 6174 6841 7267 733d 7b27 7765 6273 6974  athArgs={'websit
+00010d50: 6527 3a20 4e6f 6e65 7d2c 206d 6574 686f  e': None}, metho
+00010d60: 644e 616d 653d 2767 6574 4275 636b 6574  dName='getBucket
+00010d70: 5765 6273 6974 6527 2c0a 2020 2020 2020  Website',.      
+00010d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010da0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+00010db0: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
+00010dc0: 7329 0a0a 2020 2020 4066 756e 6343 6163  s)..    @funcCac
+00010dd0: 6865 0a20 2020 2064 6566 2073 6574 4275  he.    def setBu
+00010de0: 636b 6574 4c6f 6767 696e 6728 7365 6c66  cketLogging(self
+00010df0: 2c20 6275 636b 6574 4e61 6d65 2c20 6c6f  , bucketName, lo
+00010e00: 6773 7461 7475 733d 4e6f 6e65 2c20 6578  gstatus=None, ex
+00010e10: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
+00010e20: 6f6e 6529 3a0a 2020 2020 2020 2020 6966  one):.        if
+00010e30: 206c 6f67 7374 6174 7573 2069 7320 4e6f   logstatus is No
+00010e40: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00010e50: 6c6f 6773 7461 7475 7320 3d20 4c6f 6767  logstatus = Logg
+00010e60: 696e 6728 290a 2020 2020 2020 2020 7265  ing().        re
+00010e70: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
+00010e80: 7075 745f 7265 7175 6573 7428 6275 636b  put_request(buck
+00010e90: 6574 4e61 6d65 2c20 7061 7468 4172 6773  etName, pathArgs
+00010ea0: 3d7b 276c 6f67 6769 6e67 273a 204e 6f6e  ={'logging': Non
+00010eb0: 657d 2c0a 2020 2020 2020 2020 2020 2020  e},.            
+00010ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ed0: 2020 2020 2020 2020 2020 656e 7469 7479            entity
+00010ee0: 3d73 656c 662e 636f 6e76 6572 746f 722e  =self.convertor.
+00010ef0: 7472 616e 735f 6c6f 6767 696e 6728 6c6f  trans_logging(lo
+00010f00: 6773 7461 7475 7329 2c20 6578 7465 6e73  gstatus), extens
+00010f10: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
+00010f20: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
+00010f30: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
+00010f40: 2064 6566 2067 6574 4275 636b 6574 4c6f   def getBucketLo
+00010f50: 6767 696e 6728 7365 6c66 2c20 6275 636b  gging(self, buck
+00010f60: 6574 4e61 6d65 2c20 6578 7465 6e73 696f  etName, extensio
+00010f70: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
+00010f80: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00010f90: 656c 662e 5f6d 616b 655f 6765 745f 7265  elf._make_get_re
+00010fa0: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
+00010fb0: 2c20 7061 7468 4172 6773 3d7b 276c 6f67  , pathArgs={'log
+00010fc0: 6769 6e67 273a 204e 6f6e 657d 2c20 6d65  ging': None}, me
+00010fd0: 7468 6f64 4e61 6d65 3d27 6765 7442 7563  thodName='getBuc
+00010fe0: 6b65 744c 6f67 6769 6e67 272c 0a20 2020  ketLogging',.   
+00010ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011010: 2020 2065 7874 656e 7369 6f6e 4865 6164     extensionHead
+00011020: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
+00011030: 6465 7273 290a 0a20 2020 2040 6675 6e63  ders)..    @func
+00011040: 4361 6368 650a 2020 2020 6465 6620 6765  Cache.    def ge
+00011050: 7442 7563 6b65 7454 6167 6769 6e67 2873  tBucketTagging(s
+00011060: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+00011070: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+00011080: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
+00011090: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
+000110a0: 6b65 5f67 6574 5f72 6571 7565 7374 2862  ke_get_request(b
+000110b0: 7563 6b65 744e 616d 652c 2070 6174 6841  ucketName, pathA
+000110c0: 7267 733d 7b27 7461 6767 696e 6727 3a20  rgs={'tagging': 
+000110d0: 4e6f 6e65 7d2c 206d 6574 686f 644e 616d  None}, methodNam
+000110e0: 653d 2767 6574 4275 636b 6574 5461 6767  e='getBucketTagg
+000110f0: 696e 6727 2c0a 2020 2020 2020 2020 2020  ing',.          
+00011100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011110: 2020 2020 2020 2020 2020 2020 6578 7465              exte
+00011120: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
+00011130: 656e 7369 6f6e 4865 6164 6572 7329 0a0a  ensionHeaders)..
+00011140: 2020 2020 4066 756e 6343 6163 6865 0a20      @funcCache. 
+00011150: 2020 2064 6566 2073 6574 4275 636b 6574     def setBucket
+00011160: 5461 6767 696e 6728 7365 6c66 2c20 6275  Tagging(self, bu
+00011170: 636b 6574 4e61 6d65 2c20 7461 6749 6e66  cketName, tagInf
+00011180: 6f2c 2065 7874 656e 7369 6f6e 4865 6164  o, extensionHead
+00011190: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
+000111a0: 2020 2073 656c 662e 5f61 7373 6572 745f     self._assert_
+000111b0: 6e6f 745f 6e75 6c6c 2874 6167 496e 666f  not_null(tagInfo
+000111c0: 2c20 2774 6167 496e 666f 2069 7320 656d  , 'tagInfo is em
+000111d0: 7074 7927 290a 2020 2020 2020 2020 7265  pty').        re
+000111e0: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
+000111f0: 7075 745f 7265 7175 6573 7428 6275 636b  put_request(buck
+00011200: 6574 4e61 6d65 2c20 6578 7465 6e73 696f  etName, extensio
+00011210: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
+00011220: 6f6e 4865 6164 6572 732c 0a20 2020 2020  onHeaders,.     
+00011230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011250: 202a 2a73 656c 662e 636f 6e76 6572 746f   **self.converto
+00011260: 722e 7472 616e 735f 7365 745f 6275 636b  r.trans_set_buck
+00011270: 6574 5f74 6167 6769 6e67 2874 6167 496e  et_tagging(tagIn
+00011280: 666f 3d74 6167 496e 666f 2929 0a0a 2020  fo=tagInfo))..  
+00011290: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
+000112a0: 2064 6566 2064 656c 6574 6542 7563 6b65   def deleteBucke
+000112b0: 7454 6167 6769 6e67 2873 656c 662c 2062  tTagging(self, b
+000112c0: 7563 6b65 744e 616d 652c 2065 7874 656e  ucketName, exten
+000112d0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
+000112e0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+000112f0: 6e20 7365 6c66 2e5f 6d61 6b65 5f64 656c  n self._make_del
+00011300: 6574 655f 7265 7175 6573 7428 6275 636b  ete_request(buck
+00011310: 6574 4e61 6d65 2c20 7061 7468 4172 6773  etName, pathArgs
+00011320: 3d7b 2774 6167 6769 6e67 273a 204e 6f6e  ={'tagging': Non
+00011330: 657d 2c20 6578 7465 6e73 696f 6e48 6561  e}, extensionHea
+00011340: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
+00011350: 6164 6572 7329 0a0a 2020 2020 4066 756e  aders)..    @fun
+00011360: 6343 6163 6865 0a20 2020 2064 6566 2073  cCache.    def s
+00011370: 6574 4275 636b 6574 436f 7273 2873 656c  etBucketCors(sel
+00011380: 662c 2062 7563 6b65 744e 616d 652c 2063  f, bucketName, c
+00011390: 6f72 7352 756c 654c 6973 742c 2065 7874  orsRuleList, ext
+000113a0: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
+000113b0: 6e65 293a 0a20 2020 2020 2020 2073 656c  ne):.        sel
+000113c0: 662e 5f61 7373 6572 745f 6e6f 745f 6e75  f._assert_not_nu
+000113d0: 6c6c 2863 6f72 7352 756c 654c 6973 742c  ll(corsRuleList,
+000113e0: 2027 636f 7273 5275 6c65 4c69 7374 2069   'corsRuleList i
+000113f0: 7320 656d 7074 7927 290a 2020 2020 2020  s empty').      
+00011400: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+00011410: 616b 655f 7075 745f 7265 7175 6573 7428  ake_put_request(
+00011420: 6275 636b 6574 4e61 6d65 2c20 6578 7465  bucketName, exte
+00011430: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
+00011440: 656e 7369 6f6e 4865 6164 6572 732c 0a20  ensionHeaders,. 
+00011450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011470: 2020 2020 202a 2a73 656c 662e 636f 6e76       **self.conv
+00011480: 6572 746f 722e 7472 616e 735f 7365 745f  ertor.trans_set_
+00011490: 6275 636b 6574 5f63 6f72 7328 636f 7273  bucket_cors(cors
+000114a0: 5275 6c65 4c69 7374 3d63 6f72 7352 756c  RuleList=corsRul
+000114b0: 654c 6973 7429 290a 0a20 2020 2040 6675  eList))..    @fu
+000114c0: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
+000114d0: 6465 6c65 7465 4275 636b 6574 436f 7273  deleteBucketCors
+000114e0: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
+000114f0: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
+00011500: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
+00011510: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00011520: 6d61 6b65 5f64 656c 6574 655f 7265 7175  make_delete_requ
+00011530: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
+00011540: 7061 7468 4172 6773 3d7b 2763 6f72 7327  pathArgs={'cors'
+00011550: 3a20 4e6f 6e65 7d2c 2065 7874 656e 7369  : None}, extensi
+00011560: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
+00011570: 696f 6e48 6561 6465 7273 290a 0a20 2020  ionHeaders)..   
+00011580: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
+00011590: 6465 6620 6765 7442 7563 6b65 7443 6f72  def getBucketCor
+000115a0: 7328 7365 6c66 2c20 6275 636b 6574 4e61  s(self, bucketNa
+000115b0: 6d65 2c20 6578 7465 6e73 696f 6e48 6561  me, extensionHea
+000115c0: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
+000115d0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000115e0: 5f6d 616b 655f 6765 745f 7265 7175 6573  _make_get_reques
+000115f0: 7428 6275 636b 6574 4e61 6d65 2c20 7061  t(bucketName, pa
+00011600: 7468 4172 6773 3d7b 2763 6f72 7327 3a20  thArgs={'cors': 
+00011610: 4e6f 6e65 7d2c 206d 6574 686f 644e 616d  None}, methodNam
+00011620: 653d 2767 6574 4275 636b 6574 436f 7273  e='getBucketCors
+00011630: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+00011640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011650: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
+00011660: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
+00011670: 696f 6e48 6561 6465 7273 290a 0a20 2020  ionHeaders)..   
+00011680: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
+00011690: 6465 6620 6f70 7469 6f6e 7342 7563 6b65  def optionsBucke
+000116a0: 7428 7365 6c66 2c20 6275 636b 6574 4e61  t(self, bucketNa
+000116b0: 6d65 2c20 6f70 7469 6f6e 2c20 6578 7465  me, option, exte
+000116c0: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
+000116d0: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
+000116e0: 726e 2073 656c 662e 6f70 7469 6f6e 734f  rn self.optionsO
+000116f0: 626a 6563 7428 6275 636b 6574 4e61 6d65  bject(bucketName
+00011700: 2c20 4e6f 6e65 2c20 6f70 7469 6f6e 3d6f  , None, option=o
+00011710: 7074 696f 6e2c 2065 7874 656e 7369 6f6e  ption, extension
+00011720: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
+00011730: 6e48 6561 6465 7273 290a 0a20 2020 2040  nHeaders)..    @
+00011740: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
+00011750: 6620 7365 7442 7563 6b65 744e 6f74 6966  f setBucketNotif
+00011760: 6963 6174 696f 6e28 7365 6c66 2c20 6275  ication(self, bu
+00011770: 636b 6574 4e61 6d65 2c20 6e6f 7469 6669  cketName, notifi
+00011780: 6361 7469 6f6e 3d4e 6f6e 652c 2065 7874  cation=None, ext
+00011790: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
+000117a0: 6e65 293a 0a20 2020 2020 2020 2069 6620  ne):.        if 
+000117b0: 6e6f 7469 6669 6361 7469 6f6e 2069 7320  notification is 
+000117c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000117d0: 2020 6e6f 7469 6669 6361 7469 6f6e 203d    notification =
+000117e0: 204e 6f74 6966 6963 6174 696f 6e28 290a   Notification().
+000117f0: 2020 2020 2020 2020 6966 206e 6f74 6966          if notif
+00011800: 6963 6174 696f 6e20 6973 204e 6f6e 653a  ication is None:
+00011810: 0a20 2020 2020 2020 2020 2020 206e 6f74  .            not
+00011820: 6966 6963 6174 696f 6e20 3d20 4e6f 7469  ification = Noti
+00011830: 6669 6361 7469 6f6e 2829 0a20 2020 2020  fication().     
+00011840: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00011850: 6d61 6b65 5f70 7574 5f72 6571 7565 7374  make_put_request
+00011860: 2862 7563 6b65 744e 616d 652c 2070 6174  (bucketName, pat
+00011870: 6841 7267 733d 7b27 6e6f 7469 6669 6361  hArgs={'notifica
+00011880: 7469 6f6e 273a 204e 6f6e 657d 2c0a 2020  tion': None},.  
+00011890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118b0: 2020 2020 656e 7469 7479 3d73 656c 662e      entity=self.
+000118c0: 636f 6e76 6572 746f 722e 7472 616e 735f  convertor.trans_
+000118d0: 6e6f 7469 6669 6361 7469 6f6e 286e 6f74  notification(not
+000118e0: 6966 6963 6174 696f 6e29 2c0a 2020 2020  ification),.    
+000118f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011910: 2020 6578 7465 6e73 696f 6e48 6561 6465    extensionHeade
+00011920: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
+00011930: 6572 7329 0a0a 2020 2020 4066 756e 6343  ers)..    @funcC
+00011940: 6163 6865 0a20 2020 2064 6566 2072 656e  ache.    def ren
+00011950: 616d 6546 696c 6528 7365 6c66 2c20 6275  ameFile(self, bu
+00011960: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
+00011970: 4b65 792c 206e 6577 4f62 6a65 6374 4b65  Key, newObjectKe
+00011980: 793d 4e6f 6e65 2c20 6865 6164 6572 733d  y=None, headers=
+00011990: 5265 6e61 6d65 4669 6c65 4865 6164 6572  RenameFileHeader
+000119a0: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
+000119b0: 2020 2020 2020 2065 7874 656e 7369 6f6e         extension
+000119c0: 4865 6164 6572 733d 4e6f 6e65 293a 0a20  Headers=None):. 
+000119d0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000119e0: 6c66 2e5f 6d61 6b65 5f70 6f73 745f 7265  lf._make_post_re
+000119f0: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
+00011a00: 2c20 6f62 6a65 6374 4b65 792c 0a20 2020  , objectKey,.   
 00011a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a20: 2020 6578 7465 6e73 696f 6e48 6561 6465    extensionHeade
-00011a30: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
-00011a40: 6572 7329 0a0a 2020 2020 4066 756e 6343  ers)..    @funcC
-00011a50: 6163 6865 0a20 2020 2064 6566 2067 6574  ache.    def get
-00011a60: 4275 636b 6574 4e6f 7469 6669 6361 7469  BucketNotificati
-00011a70: 6f6e 2873 656c 662c 2062 7563 6b65 744e  on(self, bucketN
-00011a80: 616d 652c 2065 7874 656e 7369 6f6e 4865  ame, extensionHe
-00011a90: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
-00011aa0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00011ab0: 2e5f 6d61 6b65 5f67 6574 5f72 6571 7565  ._make_get_reque
-00011ac0: 7374 2862 7563 6b65 744e 616d 652c 2070  st(bucketName, p
-00011ad0: 6174 6841 7267 733d 7b27 6e6f 7469 6669  athArgs={'notifi
-00011ae0: 6361 7469 6f6e 273a 204e 6f6e 657d 2c20  cation': None}, 
-00011af0: 6d65 7468 6f64 4e61 6d65 3d27 6765 7442  methodName='getB
-00011b00: 7563 6b65 744e 6f74 6966 6963 6174 696f  ucketNotificatio
-00011b10: 6e27 2c0a 2020 2020 2020 2020 2020 2020  n',.            
-00011b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b30: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
-00011b40: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-00011b50: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
-00011b60: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
-00011b70: 2064 6566 206f 7074 696f 6e73 4f62 6a65   def optionsObje
-00011b80: 6374 2873 656c 662c 2062 7563 6b65 744e  ct(self, bucketN
-00011b90: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
-00011ba0: 6f70 7469 6f6e 2c20 6578 7465 6e73 696f  option, extensio
-00011bb0: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
-00011bc0: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
-00011bd0: 3d20 7b7d 0a20 2020 2020 2020 2069 6620  = {}.        if 
-00011be0: 6f70 7469 6f6e 2069 7320 6e6f 7420 4e6f  option is not No
-00011bf0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00011c00: 6966 206f 7074 696f 6e2e 6765 7428 276f  if option.get('o
-00011c10: 7269 6769 6e27 2920 6973 206e 6f74 204e  rigin') is not N
-00011c20: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00011c30: 2020 2020 2068 6561 6465 7273 5b63 6f6e       headers[con
-00011c40: 7374 2e4f 5249 4749 4e5f 4845 4144 4552  st.ORIGIN_HEADER
-00011c50: 5d20 3d20 7574 696c 2e74 6f5f 7374 7269  ] = util.to_stri
-00011c60: 6e67 286f 7074 696f 6e5b 276f 7269 6769  ng(option['origi
-00011c70: 6e27 5d29 0a20 2020 2020 2020 2020 2020  n']).           
-00011c80: 2069 6620 6f70 7469 6f6e 2e67 6574 2827   if option.get('
-00011c90: 6163 6365 7373 436f 6e74 726f 6c52 6571  accessControlReq
-00011ca0: 7565 7374 4d65 7468 6f64 7327 2920 6973  uestMethods') is
-00011cb0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00011cc0: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-00011cd0: 7273 5b63 6f6e 7374 2e41 4343 4553 535f  rs[const.ACCESS_
-00011ce0: 434f 4e54 524f 4c5f 5245 5155 4553 545f  CONTROL_REQUEST_
-00011cf0: 4d45 5448 4f44 5f48 4541 4445 525d 203d  METHOD_HEADER] =
-00011d00: 206f 7074 696f 6e5b 2761 6363 6573 7343   option['accessC
-00011d10: 6f6e 7472 6f6c 5265 7175 6573 744d 6574  ontrolRequestMet
-00011d20: 686f 6473 275d 0a20 2020 2020 2020 2020  hods'].         
+00011a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a30: 2020 2020 7061 7468 4172 6773 3d7b 2772      pathArgs={'r
+00011a40: 656e 616d 6527 3a20 4e6f 6e65 2c20 276e  ename': None, 'n
+00011a50: 616d 6527 3a20 7574 696c 2e74 6f5f 7374  ame': util.to_st
+00011a60: 7269 6e67 286e 6577 4f62 6a65 6374 4b65  ring(newObjectKe
+00011a70: 7929 7d2c 0a20 2020 2020 2020 2020 2020  y)},.           
+00011a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a90: 2020 2020 2020 2020 2020 2020 6865 6164              head
+00011aa0: 6572 733d 6865 6164 6572 732c 0a20 2020  ers=headers,.   
+00011ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ad0: 2020 2020 6578 7465 6e73 696f 6e48 6561      extensionHea
+00011ae0: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
+00011af0: 6164 6572 7329 0a0a 2020 2020 4066 756e  aders)..    @fun
+00011b00: 6343 6163 6865 0a20 2020 2064 6566 2067  cCache.    def g
+00011b10: 6574 4275 636b 6574 4e6f 7469 6669 6361  etBucketNotifica
+00011b20: 7469 6f6e 2873 656c 662c 2062 7563 6b65  tion(self, bucke
+00011b30: 744e 616d 652c 2065 7874 656e 7369 6f6e  tName, extension
+00011b40: 4865 6164 6572 733d 4e6f 6e65 293a 0a20  Headers=None):. 
+00011b50: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00011b60: 6c66 2e5f 6d61 6b65 5f67 6574 5f72 6571  lf._make_get_req
+00011b70: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
+00011b80: 2070 6174 6841 7267 733d 7b27 6e6f 7469   pathArgs={'noti
+00011b90: 6669 6361 7469 6f6e 273a 204e 6f6e 657d  fication': None}
+00011ba0: 2c20 6d65 7468 6f64 4e61 6d65 3d27 6765  , methodName='ge
+00011bb0: 7442 7563 6b65 744e 6f74 6966 6963 6174  tBucketNotificat
+00011bc0: 696f 6e27 2c0a 2020 2020 2020 2020 2020  ion',.          
+00011bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011be0: 2020 2020 2020 2020 2020 2020 6578 7465              exte
+00011bf0: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
+00011c00: 656e 7369 6f6e 4865 6164 6572 7329 0a0a  ensionHeaders)..
+00011c10: 2020 2020 4066 756e 6343 6163 6865 0a20      @funcCache. 
+00011c20: 2020 2064 6566 206f 7074 696f 6e73 4f62     def optionsOb
+00011c30: 6a65 6374 2873 656c 662c 2062 7563 6b65  ject(self, bucke
+00011c40: 744e 616d 652c 206f 626a 6563 744b 6579  tName, objectKey
+00011c50: 2c20 6f70 7469 6f6e 2c20 6578 7465 6e73  , option, extens
+00011c60: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
+00011c70: 3a0a 2020 2020 2020 2020 6865 6164 6572  :.        header
+00011c80: 7320 3d20 7b7d 0a20 2020 2020 2020 2069  s = {}.        i
+00011c90: 6620 6f70 7469 6f6e 2069 7320 6e6f 7420  f option is not 
+00011ca0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00011cb0: 2020 6966 206f 7074 696f 6e2e 6765 7428    if option.get(
+00011cc0: 276f 7269 6769 6e27 2920 6973 206e 6f74  'origin') is not
+00011cd0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00011ce0: 2020 2020 2020 2068 6561 6465 7273 5b63         headers[c
+00011cf0: 6f6e 7374 2e4f 5249 4749 4e5f 4845 4144  onst.ORIGIN_HEAD
+00011d00: 4552 5d20 3d20 7574 696c 2e74 6f5f 7374  ER] = util.to_st
+00011d10: 7269 6e67 286f 7074 696f 6e5b 276f 7269  ring(option['ori
+00011d20: 6769 6e27 5d29 0a20 2020 2020 2020 2020  gin']).         
 00011d30: 2020 2069 6620 6f70 7469 6f6e 2e67 6574     if option.get
 00011d40: 2827 6163 6365 7373 436f 6e74 726f 6c52  ('accessControlR
-00011d50: 6571 7565 7374 4865 6164 6572 7327 2920  equestHeaders') 
+00011d50: 6571 7565 7374 4d65 7468 6f64 7327 2920  equestMethods') 
 00011d60: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
 00011d70: 2020 2020 2020 2020 2020 2020 2068 6561               hea
 00011d80: 6465 7273 5b63 6f6e 7374 2e41 4343 4553  ders[const.ACCES
 00011d90: 535f 434f 4e54 524f 4c5f 5245 5155 4553  S_CONTROL_REQUES
-00011da0: 545f 4845 4144 4552 535f 4845 4144 4552  T_HEADERS_HEADER
-00011db0: 5d20 3d20 6f70 7469 6f6e 5b27 6163 6365  ] = option['acce
-00011dc0: 7373 436f 6e74 726f 6c52 6571 7565 7374  ssControlRequest
-00011dd0: 4865 6164 6572 7327 5d0a 2020 2020 2020  Headers'].      
-00011de0: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
-00011df0: 616b 655f 6f70 7469 6f6e 735f 7265 7175  ake_options_requ
-00011e00: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
-00011e10: 6f62 6a65 6374 4b65 792c 2068 6561 6465  objectKey, heade
-00011e20: 7273 3d68 6561 6465 7273 2c20 6d65 7468  rs=headers, meth
-00011e30: 6f64 4e61 6d65 3d27 6f70 7469 6f6e 7342  odName='optionsB
-00011e40: 7563 6b65 7427 2c0a 2020 2020 2020 2020  ucket',.        
-00011e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e70: 2020 6578 7465 6e73 696f 6e48 6561 6465    extensionHeade
-00011e80: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
-00011e90: 6572 7329 0a0a 2020 2020 4066 756e 6343  ers)..    @funcC
-00011ea0: 6163 6865 0a20 2020 2064 6566 2067 6574  ache.    def get
-00011eb0: 4f62 6a65 6374 4d65 7461 6461 7461 2873  ObjectMetadata(s
-00011ec0: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
-00011ed0: 206f 626a 6563 744b 6579 2c20 7665 7273   objectKey, vers
-00011ee0: 696f 6e49 643d 4e6f 6e65 2c20 7373 6548  ionId=None, sseH
-00011ef0: 6561 6465 723d 4e6f 6e65 2c20 6f72 6967  eader=None, orig
-00011f00: 696e 3d4e 6f6e 652c 2072 6571 7565 7374  in=None, request
-00011f10: 4865 6164 6572 733d 4e6f 6e65 2c0a 2020  Headers=None,.  
-00011f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f30: 2020 2020 2020 2020 6578 7465 6e73 696f          extensio
-00011f40: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
-00011f50: 2020 2020 2020 2020 7061 7468 4172 6773          pathArgs
-00011f60: 203d 207b 7d0a 2020 2020 2020 2020 6966   = {}.        if
-00011f70: 2076 6572 7369 6f6e 4964 3a0a 2020 2020   versionId:.    
-00011f80: 2020 2020 2020 2020 7061 7468 4172 6773          pathArgs
-00011f90: 5b63 6f6e 7374 2e56 4552 5349 4f4e 5f49  [const.VERSION_I
-00011fa0: 445f 5041 5241 4d5d 203d 2075 7469 6c2e  D_PARAM] = util.
-00011fb0: 746f 5f73 7472 696e 6728 7665 7273 696f  to_string(versio
-00011fc0: 6e49 6429 0a20 2020 2020 2020 2068 6561  nId).        hea
-00011fd0: 6465 7273 203d 207b 7d0a 2020 2020 2020  ders = {}.      
-00011fe0: 2020 6966 206f 7269 6769 6e3a 0a20 2020    if origin:.   
-00011ff0: 2020 2020 2020 2020 2068 6561 6465 7273           headers
-00012000: 5b63 6f6e 7374 2e4f 5249 4749 4e5f 4845  [const.ORIGIN_HE
-00012010: 4144 4552 5d20 3d20 7574 696c 2e74 6f5f  ADER] = util.to_
-00012020: 7374 7269 6e67 286f 7269 6769 6e29 0a20  string(origin). 
-00012030: 2020 2020 2020 205f 7265 7175 6573 7448         _requestH
-00012040: 6561 6465 7273 203d 2072 6571 7565 7374  eaders = request
-00012050: 4865 6164 6572 735b 305d 2069 6620 6973  Headers[0] if is
-00012060: 696e 7374 616e 6365 2872 6571 7565 7374  instance(request
-00012070: 4865 6164 6572 732c 206c 6973 7429 2061  Headers, list) a
-00012080: 6e64 206c 656e 280a 2020 2020 2020 2020  nd len(.        
-00012090: 2020 2020 7265 7175 6573 7448 6561 6465      requestHeade
-000120a0: 7273 2920 3d3d 2031 2065 6c73 6520 7265  rs) == 1 else re
-000120b0: 7175 6573 7448 6561 6465 7273 0a20 2020  questHeaders.   
-000120c0: 2020 2020 2069 6620 5f72 6571 7565 7374       if _request
-000120d0: 4865 6164 6572 733a 0a20 2020 2020 2020  Headers:.       
-000120e0: 2020 2020 2068 6561 6465 7273 5b63 6f6e       headers[con
-000120f0: 7374 2e41 4343 4553 535f 434f 4e54 524f  st.ACCESS_CONTRO
-00012100: 4c5f 5245 5155 4553 545f 4845 4144 4552  L_REQUEST_HEADER
-00012110: 535f 4845 4144 4552 5d20 3d20 7574 696c  S_HEADER] = util
-00012120: 2e74 6f5f 7374 7269 6e67 285f 7265 7175  .to_string(_requ
-00012130: 6573 7448 6561 6465 7273 290a 2020 2020  estHeaders).    
-00012140: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00012150: 5f6d 616b 655f 6865 6164 5f72 6571 7565  _make_head_reque
-00012160: 7374 2862 7563 6b65 744e 616d 652c 206f  st(bucketName, o
-00012170: 626a 6563 744b 6579 2c20 7061 7468 4172  bjectKey, pathAr
-00012180: 6773 3d70 6174 6841 7267 732c 0a20 2020  gs=pathArgs,.   
-00012190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121b0: 2020 2020 6865 6164 6572 733d 7365 6c66      headers=self
-000121c0: 2e63 6f6e 7665 7274 6f72 2e5f 7365 745f  .convertor._set_
-000121d0: 7373 655f 6865 6164 6572 2873 7365 4865  sse_header(sseHe
-000121e0: 6164 6572 2c20 6865 6164 6572 733d 6865  ader, headers=he
-000121f0: 6164 6572 732c 0a20 2020 2020 2020 2020  aders,.         
-00012200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012240: 2020 2020 206f 6e6c 7953 7365 4348 6561       onlySseCHea
-00012250: 6465 723d 5472 7565 292c 0a20 2020 2020  der=True),.     
-00012260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012280: 2020 6d65 7468 6f64 4e61 6d65 3d27 6765    methodName='ge
-00012290: 744f 626a 6563 744d 6574 6164 6174 6127  tObjectMetadata'
-000122a0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
-000122b0: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
-000122c0: 6572 7329 0a0a 2020 2020 4066 756e 6343  ers)..    @funcC
-000122d0: 6163 6865 0a20 2020 2064 6566 2073 6574  ache.    def set
-000122e0: 4f62 6a65 6374 4d65 7461 6461 7461 2873  ObjectMetadata(s
-000122f0: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
-00012300: 206f 626a 6563 744b 6579 2c20 6d65 7461   objectKey, meta
-00012310: 6461 7461 3d4e 6f6e 652c 2068 6561 6465  data=None, heade
-00012320: 7273 3d4e 6f6e 652c 2076 6572 7369 6f6e  rs=None, version
-00012330: 4964 3d4e 6f6e 652c 0a20 2020 2020 2020  Id=None,.       
-00012340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012350: 2020 2065 7874 656e 7369 6f6e 4865 6164     extensionHead
-00012360: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
-00012370: 2020 2069 6620 6865 6164 6572 7320 6973     if headers is
-00012380: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00012390: 2020 2068 6561 6465 7273 203d 2053 6574     headers = Set
-000123a0: 4f62 6a65 6374 4d65 7461 6461 7461 4865  ObjectMetadataHe
-000123b0: 6164 6572 2829 0a0a 2020 2020 2020 2020  ader()..        
-000123c0: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
-000123d0: 655f 7075 745f 7265 7175 6573 7428 6275  e_put_request(bu
-000123e0: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
-000123f0: 4b65 792c 206d 6574 686f 644e 616d 653d  Key, methodName=
-00012400: 2773 6574 4f62 6a65 6374 4d65 7461 6461  'setObjectMetada
-00012410: 7461 272c 0a20 2020 2020 2020 2020 2020  ta',.           
-00012420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012430: 2020 2020 2020 2020 2020 2065 7874 656e             exten
-00012440: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
-00012450: 6e73 696f 6e48 6561 6465 7273 2c0a 2020  nsionHeaders,.  
-00012460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012480: 2020 2020 2a2a 7365 6c66 2e63 6f6e 7665      **self.conve
-00012490: 7274 6f72 2e74 7261 6e73 5f73 6574 5f6f  rtor.trans_set_o
-000124a0: 626a 6563 745f 6d65 7461 6461 7461 286d  bject_metadata(m
-000124b0: 6574 6164 6174 613d 6d65 7461 6461 7461  etadata=metadata
-000124c0: 2c20 6865 6164 6572 733d 6865 6164 6572  , headers=header
-000124d0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-000124e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000124f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011da0: 545f 4d45 5448 4f44 5f48 4541 4445 525d  T_METHOD_HEADER]
+00011db0: 203d 206f 7074 696f 6e5b 2761 6363 6573   = option['acces
+00011dc0: 7343 6f6e 7472 6f6c 5265 7175 6573 744d  sControlRequestM
+00011dd0: 6574 686f 6473 275d 0a20 2020 2020 2020  ethods'].       
+00011de0: 2020 2020 2069 6620 6f70 7469 6f6e 2e67       if option.g
+00011df0: 6574 2827 6163 6365 7373 436f 6e74 726f  et('accessContro
+00011e00: 6c52 6571 7565 7374 4865 6164 6572 7327  lRequestHeaders'
+00011e10: 2920 6973 206e 6f74 204e 6f6e 653a 0a20  ) is not None:. 
+00011e20: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00011e30: 6561 6465 7273 5b63 6f6e 7374 2e41 4343  eaders[const.ACC
+00011e40: 4553 535f 434f 4e54 524f 4c5f 5245 5155  ESS_CONTROL_REQU
+00011e50: 4553 545f 4845 4144 4552 535f 4845 4144  EST_HEADERS_HEAD
+00011e60: 4552 5d20 3d20 6f70 7469 6f6e 5b27 6163  ER] = option['ac
+00011e70: 6365 7373 436f 6e74 726f 6c52 6571 7565  cessControlReque
+00011e80: 7374 4865 6164 6572 7327 5d0a 2020 2020  stHeaders'].    
+00011e90: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00011ea0: 5f6d 616b 655f 6f70 7469 6f6e 735f 7265  _make_options_re
+00011eb0: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
+00011ec0: 2c20 6f62 6a65 6374 4b65 792c 2068 6561  , objectKey, hea
+00011ed0: 6465 7273 3d68 6561 6465 7273 2c20 6d65  ders=headers, me
+00011ee0: 7468 6f64 4e61 6d65 3d27 6f70 7469 6f6e  thodName='option
+00011ef0: 7342 7563 6b65 7427 2c0a 2020 2020 2020  sBucket',.      
+00011f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f20: 2020 2020 6578 7465 6e73 696f 6e48 6561      extensionHea
+00011f30: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
+00011f40: 6164 6572 7329 0a0a 2020 2020 4066 756e  aders)..    @fun
+00011f50: 6343 6163 6865 0a20 2020 2064 6566 2067  cCache.    def g
+00011f60: 6574 4f62 6a65 6374 4d65 7461 6461 7461  etObjectMetadata
+00011f70: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
+00011f80: 652c 206f 626a 6563 744b 6579 2c20 7665  e, objectKey, ve
+00011f90: 7273 696f 6e49 643d 4e6f 6e65 2c20 7373  rsionId=None, ss
+00011fa0: 6548 6561 6465 723d 4e6f 6e65 2c20 6f72  eHeader=None, or
+00011fb0: 6967 696e 3d4e 6f6e 652c 2072 6571 7565  igin=None, reque
+00011fc0: 7374 4865 6164 6572 733d 4e6f 6e65 2c0a  stHeaders=None,.
+00011fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011fe0: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
+00011ff0: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
+00012000: 3a0a 2020 2020 2020 2020 7061 7468 4172  :.        pathAr
+00012010: 6773 203d 207b 7d0a 2020 2020 2020 2020  gs = {}.        
+00012020: 6966 2076 6572 7369 6f6e 4964 3a0a 2020  if versionId:.  
+00012030: 2020 2020 2020 2020 2020 7061 7468 4172            pathAr
+00012040: 6773 5b63 6f6e 7374 2e56 4552 5349 4f4e  gs[const.VERSION
+00012050: 5f49 445f 5041 5241 4d5d 203d 2075 7469  _ID_PARAM] = uti
+00012060: 6c2e 746f 5f73 7472 696e 6728 7665 7273  l.to_string(vers
+00012070: 696f 6e49 6429 0a20 2020 2020 2020 2068  ionId).        h
+00012080: 6561 6465 7273 203d 207b 7d0a 2020 2020  eaders = {}.    
+00012090: 2020 2020 6966 206f 7269 6769 6e3a 0a20      if origin:. 
+000120a0: 2020 2020 2020 2020 2020 2068 6561 6465             heade
+000120b0: 7273 5b63 6f6e 7374 2e4f 5249 4749 4e5f  rs[const.ORIGIN_
+000120c0: 4845 4144 4552 5d20 3d20 7574 696c 2e74  HEADER] = util.t
+000120d0: 6f5f 7374 7269 6e67 286f 7269 6769 6e29  o_string(origin)
+000120e0: 0a20 2020 2020 2020 205f 7265 7175 6573  .        _reques
+000120f0: 7448 6561 6465 7273 203d 2072 6571 7565  tHeaders = reque
+00012100: 7374 4865 6164 6572 735b 305d 2069 6620  stHeaders[0] if 
+00012110: 6973 696e 7374 616e 6365 2872 6571 7565  isinstance(reque
+00012120: 7374 4865 6164 6572 732c 206c 6973 7429  stHeaders, list)
+00012130: 2061 6e64 206c 656e 280a 2020 2020 2020   and len(.      
+00012140: 2020 2020 2020 7265 7175 6573 7448 6561        requestHea
+00012150: 6465 7273 2920 3d3d 2031 2065 6c73 6520  ders) == 1 else 
+00012160: 7265 7175 6573 7448 6561 6465 7273 0a20  requestHeaders. 
+00012170: 2020 2020 2020 2069 6620 5f72 6571 7565         if _reque
+00012180: 7374 4865 6164 6572 733a 0a20 2020 2020  stHeaders:.     
+00012190: 2020 2020 2020 2068 6561 6465 7273 5b63         headers[c
+000121a0: 6f6e 7374 2e41 4343 4553 535f 434f 4e54  onst.ACCESS_CONT
+000121b0: 524f 4c5f 5245 5155 4553 545f 4845 4144  ROL_REQUEST_HEAD
+000121c0: 4552 535f 4845 4144 4552 5d20 3d20 7574  ERS_HEADER] = ut
+000121d0: 696c 2e74 6f5f 7374 7269 6e67 285f 7265  il.to_string(_re
+000121e0: 7175 6573 7448 6561 6465 7273 290a 2020  questHeaders).  
+000121f0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00012200: 662e 5f6d 616b 655f 6865 6164 5f72 6571  f._make_head_req
+00012210: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
+00012220: 206f 626a 6563 744b 6579 2c20 7061 7468   objectKey, path
+00012230: 4172 6773 3d70 6174 6841 7267 732c 0a20  Args=pathArgs,. 
+00012240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012260: 2020 2020 2020 6865 6164 6572 733d 7365        headers=se
+00012270: 6c66 2e63 6f6e 7665 7274 6f72 2e5f 7365  lf.convertor._se
+00012280: 745f 7373 655f 6865 6164 6572 2873 7365  t_sse_header(sse
+00012290: 4865 6164 6572 2c20 6865 6164 6572 733d  Header, headers=
+000122a0: 6865 6164 6572 732c 0a20 2020 2020 2020  headers,.       
+000122b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122f0: 2020 2020 2020 206f 6e6c 7953 7365 4348         onlySseCH
+00012300: 6561 6465 723d 5472 7565 292c 0a20 2020  eader=True),.   
+00012310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012330: 2020 2020 6d65 7468 6f64 4e61 6d65 3d27      methodName='
+00012340: 6765 744f 626a 6563 744d 6574 6164 6174  getObjectMetadat
+00012350: 6127 2c20 6578 7465 6e73 696f 6e48 6561  a', extensionHea
+00012360: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
+00012370: 6164 6572 7329 0a0a 2020 2020 4066 756e  aders)..    @fun
+00012380: 6343 6163 6865 0a20 2020 2064 6566 2073  cCache.    def s
+00012390: 6574 4f62 6a65 6374 4d65 7461 6461 7461  etObjectMetadata
+000123a0: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
+000123b0: 652c 206f 626a 6563 744b 6579 2c20 6d65  e, objectKey, me
+000123c0: 7461 6461 7461 3d4e 6f6e 652c 2068 6561  tadata=None, hea
+000123d0: 6465 7273 3d4e 6f6e 652c 2076 6572 7369  ders=None, versi
+000123e0: 6f6e 4964 3d4e 6f6e 652c 0a20 2020 2020  onId=None,.     
+000123f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012400: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
+00012410: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
+00012420: 2020 2020 2069 6620 6865 6164 6572 7320       if headers 
+00012430: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00012440: 2020 2020 2068 6561 6465 7273 203d 2053       headers = S
+00012450: 6574 4f62 6a65 6374 4d65 7461 6461 7461  etObjectMetadata
+00012460: 4865 6164 6572 2829 0a0a 2020 2020 2020  Header()..      
+00012470: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+00012480: 616b 655f 7075 745f 7265 7175 6573 7428  ake_put_request(
+00012490: 6275 636b 6574 4e61 6d65 2c20 6f62 6a65  bucketName, obje
+000124a0: 6374 4b65 792c 206d 6574 686f 644e 616d  ctKey, methodNam
+000124b0: 653d 2773 6574 4f62 6a65 6374 4d65 7461  e='setObjectMeta
+000124c0: 6461 7461 272c 0a20 2020 2020 2020 2020  data',.         
+000124d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000124e0: 2020 2020 2020 2020 2020 2020 2065 7874               ext
+000124f0: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+00012500: 7465 6e73 696f 6e48 6561 6465 7273 2c0a  tensionHeaders,.
 00012510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012520: 2020 2020 7665 7273 696f 6e49 643d 7665      versionId=ve
-00012530: 7273 696f 6e49 6429 290a 0a20 2020 2040  rsionId))..    @
-00012540: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
-00012550: 6620 6765 744f 626a 6563 7428 7365 6c66  f getObject(self
-00012560: 2c20 6275 636b 6574 4e61 6d65 2c20 6f62  , bucketName, ob
-00012570: 6a65 6374 4b65 792c 2064 6f77 6e6c 6f61  jectKey, downloa
-00012580: 6450 6174 683d 4e6f 6e65 2c20 6765 744f  dPath=None, getO
-00012590: 626a 6563 7452 6571 7565 7374 3d4e 6f6e  bjectRequest=Non
-000125a0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-000125b0: 2020 2020 2068 6561 6465 7273 3d4e 6f6e       headers=Non
-000125c0: 652c 206c 6f61 6453 7472 6561 6d49 6e4d  e, loadStreamInM
-000125d0: 656d 6f72 793d 4661 6c73 652c 2070 726f  emory=False, pro
-000125e0: 6772 6573 7343 616c 6c62 6163 6b3d 4e6f  gressCallback=No
-000125f0: 6e65 2c20 6578 7465 6e73 696f 6e48 6561  ne, extensionHea
-00012600: 6465 7273 3d4e 6f6e 652c 206e 6f74 6966  ders=None, notif
-00012610: 6965 723d 4e6f 6e65 293a 0a20 2020 2020  ier=None):.     
-00012620: 2020 2069 6620 6765 744f 626a 6563 7452     if getObjectR
-00012630: 6571 7565 7374 2069 7320 4e6f 6e65 3a0a  equest is None:.
-00012640: 2020 2020 2020 2020 2020 2020 6765 744f              getO
-00012650: 626a 6563 7452 6571 7565 7374 203d 2047  bjectRequest = G
-00012660: 6574 4f62 6a65 6374 5265 7175 6573 7428  etObjectRequest(
-00012670: 290a 2020 2020 2020 2020 6966 2068 6561  ).        if hea
-00012680: 6465 7273 2069 7320 4e6f 6e65 3a0a 2020  ders is None:.  
-00012690: 2020 2020 2020 2020 2020 6865 6164 6572            header
-000126a0: 7320 3d20 4765 744f 626a 6563 7448 6561  s = GetObjectHea
-000126b0: 6465 7228 290a 2020 2020 2020 2020 5f70  der().        _p
-000126c0: 6172 7365 5f63 6f6e 7465 6e74 203d 2073  arse_content = s
-000126d0: 656c 662e 5f70 6172 7365 5f63 6f6e 7465  elf._parse_conte
-000126e0: 6e74 0a20 2020 2020 2020 2043 4855 4e4b  nt.        CHUNK
-000126f0: 5f53 495a 4520 3d20 7365 6c66 2e63 6875  _SIZE = self.chu
-00012700: 6e6b 5f73 697a 650a 2020 2020 2020 2020  nk_size.        
-00012710: 7265 6164 6162 6c65 203d 2046 616c 7365  readable = False
-00012720: 2069 6620 7072 6f67 7265 7373 4361 6c6c   if progressCall
-00012730: 6261 636b 2069 7320 4e6f 6e65 2065 6c73  back is None els
-00012740: 6520 5472 7565 0a0a 2020 2020 2020 2020  e True..        
-00012750: 6465 6620 7061 7273 654d 6574 686f 6428  def parseMethod(
-00012760: 636f 6e6e 293a 0a20 2020 2020 2020 2020  conn):.         
-00012770: 2020 2072 6573 756c 7420 3d20 636f 6e6e     result = conn
-00012780: 2e67 6574 7265 7370 6f6e 7365 2829 0a20  .getresponse(). 
-00012790: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000127a0: 6e20 5f70 6172 7365 5f63 6f6e 7465 6e74  n _parse_content
-000127b0: 286f 626a 6563 744b 6579 2c20 636f 6e6e  (objectKey, conn
-000127c0: 2c20 7265 7375 6c74 2c20 646f 776e 6c6f  , result, downlo
-000127d0: 6164 5f73 7461 7274 3d68 6561 6465 7273  ad_start=headers
-000127e0: 2e72 616e 6765 2c20 646f 776e 6c6f 6164  .range, download
-000127f0: 5061 7468 3d64 6f77 6e6c 6f61 6450 6174  Path=downloadPat
-00012800: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
+00012520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012530: 2020 2020 2020 2a2a 7365 6c66 2e63 6f6e        **self.con
+00012540: 7665 7274 6f72 2e74 7261 6e73 5f73 6574  vertor.trans_set
+00012550: 5f6f 626a 6563 745f 6d65 7461 6461 7461  _object_metadata
+00012560: 286d 6574 6164 6174 613d 6d65 7461 6461  (metadata=metada
+00012570: 7461 2c20 6865 6164 6572 733d 6865 6164  ta, headers=head
+00012580: 6572 732c 0a20 2020 2020 2020 2020 2020  ers,.           
+00012590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000125a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000125b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000125c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000125d0: 2020 2020 2020 7665 7273 696f 6e49 643d        versionId=
+000125e0: 7665 7273 696f 6e49 6429 290a 0a20 2020  versionId))..   
+000125f0: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
+00012600: 6465 6620 7365 7441 6363 6573 734c 6162  def setAccessLab
+00012610: 656c 2873 656c 662c 2062 7563 6b65 744e  el(self, bucketN
+00012620: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
+00012630: 6163 6365 7373 6c61 6265 6c2c 2065 7874  accesslabel, ext
+00012640: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
+00012650: 6e65 293a 0a20 2020 2020 2020 2072 6574  ne):.        ret
+00012660: 7572 6e20 7365 6c66 2e5f 6d61 6b65 5f70  urn self._make_p
+00012670: 7574 5f72 6571 7565 7374 2862 7563 6b65  ut_request(bucke
+00012680: 744e 616d 652c 206f 626a 6563 744b 6579  tName, objectKey
+00012690: 2c20 7061 7468 4172 6773 3d7b 2778 2d6f  , pathArgs={'x-o
+000126a0: 6273 2d61 6363 6573 736c 6162 656c 273a  bs-accesslabel':
+000126b0: 204e 6f6e 657d 2c0a 2020 2020 2020 2020   None},.        
+000126c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000126d0: 2020 2020 2020 2020 2020 2020 2020 656e                en
+000126e0: 7469 7479 3d7b 2761 6363 6573 736c 6162  tity={'accesslab
+000126f0: 656c 273a 2061 6363 6573 736c 6162 656c  el': accesslabel
+00012700: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
+00012710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012720: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
+00012730: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
+00012740: 696f 6e48 6561 6465 7273 290a 0a20 2020  ionHeaders)..   
+00012750: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
+00012760: 6465 6620 6765 7441 6363 6573 734c 6162  def getAccessLab
+00012770: 656c 2873 656c 662c 2062 7563 6b65 744e  el(self, bucketN
+00012780: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
+00012790: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+000127a0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+000127b0: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
+000127c0: 655f 6765 745f 7265 7175 6573 7428 6275  e_get_request(bu
+000127d0: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
+000127e0: 4b65 792c 2070 6174 6841 7267 733d 7b27  Key, pathArgs={'
+000127f0: 782d 6f62 732d 6163 6365 7373 6c61 6265  x-obs-accesslabe
+00012800: 6c27 3a20 4e6f 6e65 7d2c 0a20 2020 2020  l': None},.     
 00012810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012820: 2020 2020 2063 6875 636b 5369 7a65 3d43       chuckSize=C
-00012830: 4855 4e4b 5f53 495a 452c 206c 6f61 6453  HUNK_SIZE, loadS
-00012840: 7472 6561 6d49 6e4d 656d 6f72 793d 6c6f  treamInMemory=lo
-00012850: 6164 5374 7265 616d 496e 4d65 6d6f 7279  adStreamInMemory
-00012860: 2c20 6e6f 7469 6669 6572 3d6e 6f74 6966  , notifier=notif
-00012870: 6965 722c 0a20 2020 2020 2020 2020 2020  ier,.           
-00012880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012890: 2020 2020 2020 2070 726f 6772 6573 7343         progressC
-000128a0: 616c 6c62 6163 6b3d 7072 6f67 7265 7373  allback=progress
-000128b0: 4361 6c6c 6261 636b 290a 0a20 2020 2020  Callback)..     
-000128c0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-000128d0: 6d61 6b65 5f67 6574 5f72 6571 7565 7374  make_get_request
-000128e0: 2862 7563 6b65 744e 616d 652c 206f 626a  (bucketName, obj
-000128f0: 6563 744b 6579 2c20 7061 7273 654d 6574  ectKey, parseMet
-00012900: 686f 643d 7061 7273 654d 6574 686f 642c  hod=parseMethod,
-00012910: 2072 6561 6461 626c 653d 7265 6164 6162   readable=readab
-00012920: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-00012930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012940: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
-00012950: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-00012960: 7369 6f6e 4865 6164 6572 732c 0a20 2020  sionHeaders,.   
+00012820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012830: 206d 6574 686f 644e 616d 653d 2767 6574   methodName='get
+00012840: 4163 6365 7373 4c61 6265 6c27 2c0a 2020  AccessLabel',.  
+00012850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012870: 2020 2020 6578 7465 6e73 696f 6e48 6561      extensionHea
+00012880: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
+00012890: 6164 6572 7329 0a0a 2020 2020 4066 756e  aders)..    @fun
+000128a0: 6343 6163 6865 0a20 2020 2064 6566 2064  cCache.    def d
+000128b0: 656c 6574 6541 6363 6573 734c 6162 656c  eleteAccessLabel
+000128c0: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
+000128d0: 652c 206f 626a 6563 744b 6579 2c20 6578  e, objectKey, ex
+000128e0: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
+000128f0: 6f6e 6529 3a0a 2020 2020 2020 2020 7265  one):.        re
+00012900: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
+00012910: 6465 6c65 7465 5f72 6571 7565 7374 2862  delete_request(b
+00012920: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
+00012930: 744b 6579 2c20 7061 7468 4172 6773 3d7b  tKey, pathArgs={
+00012940: 2778 2d6f 6273 2d61 6363 6573 736c 6162  'x-obs-accesslab
+00012950: 656c 273a 204e 6f6e 657d 2c0a 2020 2020  el': None},.    
+00012960: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00012970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012990: 2020 202a 2a73 656c 662e 636f 6e76 6572     **self.conver
-000129a0: 746f 722e 7472 616e 735f 6765 745f 6f62  tor.trans_get_ob
-000129b0: 6a65 6374 2867 6574 4f62 6a65 6374 5265  ject(getObjectRe
-000129c0: 7175 6573 743d 6765 744f 626a 6563 7452  quest=getObjectR
-000129d0: 6571 7565 7374 2c0a 2020 2020 2020 2020  equest,.        
-000129e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a20: 6865 6164 6572 733d 6865 6164 6572 7329  headers=headers)
-00012a30: 290a 0a20 2020 2040 7374 6174 6963 6d65  )..    @staticme
-00012a40: 7468 6f64 0a20 2020 2064 6566 205f 7072  thod.    def _pr
-00012a50: 6570 6172 655f 6170 7065 6e64 5f6f 626a  epare_append_obj
-00012a60: 6563 745f 696e 7075 7428 6f62 6a65 6374  ect_input(object
-00012a70: 4b65 792c 2068 6561 6465 7273 2c20 636f  Key, headers, co
-00012a80: 6e74 656e 7429 3a0a 2020 2020 2020 2020  ntent):.        
-00012a90: 6f62 6a65 6374 4b65 7920 3d20 7574 696c  objectKey = util
-00012aa0: 2e73 6166 655f 656e 636f 6465 286f 626a  .safe_encode(obj
-00012ab0: 6563 744b 6579 290a 2020 2020 2020 2020  ectKey).        
-00012ac0: 6966 206f 626a 6563 744b 6579 2069 7320  if objectKey is 
-00012ad0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00012ae0: 2020 6f62 6a65 6374 4b65 7920 3d20 2727    objectKey = ''
-00012af0: 0a0a 2020 2020 2020 2020 6966 2068 6561  ..        if hea
-00012b00: 6465 7273 2069 7320 4e6f 6e65 3a0a 2020  ders is None:.  
-00012b10: 2020 2020 2020 2020 2020 6865 6164 6572            header
-00012b20: 7320 3d20 4170 7065 6e64 4f62 6a65 6374  s = AppendObject
-00012b30: 4865 6164 6572 2829 0a0a 2020 2020 2020  Header()..      
-00012b40: 2020 6966 2063 6f6e 7465 6e74 2069 7320    if content is 
-00012b50: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00012b60: 2020 636f 6e74 656e 7420 3d20 4170 7065    content = Appe
-00012b70: 6e64 4f62 6a65 6374 436f 6e74 656e 7428  ndObjectContent(
-00012b80: 290a 0a20 2020 2020 2020 2069 6620 6865  )..        if he
-00012b90: 6164 6572 732e 6765 7428 2763 6f6e 7465  aders.get('conte
-00012ba0: 6e74 5479 7065 2729 2069 7320 4e6f 6e65  ntType') is None
-00012bb0: 3a0a 2020 2020 2020 2020 2020 2020 6865  :.            he
-00012bc0: 6164 6572 735b 2763 6f6e 7465 6e74 5479  aders['contentTy
-00012bd0: 7065 275d 203d 2063 6f6e 7374 2e4d 494d  pe'] = const.MIM
-00012be0: 455f 5459 5045 532e 6765 7428 6f62 6a65  E_TYPES.get(obje
-00012bf0: 6374 4b65 795b 6f62 6a65 6374 4b65 792e  ctKey[objectKey.
-00012c00: 7266 696e 6428 272e 2729 202b 2031 3a5d  rfind('.') + 1:]
-00012c10: 2e6c 6f77 6572 2829 290a 0a20 2020 2020  .lower())..     
-00012c20: 2020 2072 6574 7572 6e20 6f62 6a65 6374     return object
-00012c30: 4b65 792c 2068 6561 6465 7273 2c20 636f  Key, headers, co
-00012c40: 6e74 656e 740a 0a20 2020 2064 6566 205f  ntent..    def _
-00012c50: 7072 6570 6172 655f 6669 6c65 5f6e 6f74  prepare_file_not
-00012c60: 6966 6965 725f 616e 645f 656e 7469 7479  ifier_and_entity
-00012c70: 2873 656c 662c 206f 6666 7365 742c 2066  (self, offset, f
-00012c80: 696c 655f 7369 7a65 2c20 6865 6164 6572  ile_size, header
-00012c90: 732c 2070 726f 6772 6573 7343 616c 6c62  s, progressCallb
-00012ca0: 6163 6b2c 2066 696c 655f 7061 7468 2c20  ack, file_path, 
-00012cb0: 7265 6164 6162 6c65 293a 0a20 2020 2020  readable):.     
-00012cc0: 2020 2069 6620 6f66 6673 6574 2069 7320     if offset is 
-00012cd0: 6e6f 7420 4e6f 6e65 2061 6e64 2030 203c  not None and 0 <
-00012ce0: 206f 6666 7365 7420 3c20 6669 6c65 5f73   offset < file_s
-00012cf0: 697a 653a 0a20 2020 2020 2020 2020 2020  ize:.           
-00012d00: 2068 6561 6465 7273 5b27 636f 6e74 656e   headers['conten
-00012d10: 744c 656e 6774 6827 5d20 3d20 6865 6164  tLength'] = head
-00012d20: 6572 735b 2763 6f6e 7465 6e74 4c65 6e67  ers['contentLeng
-00012d30: 7468 275d 2069 6620 3020 3c20 6865 6164  th'] if 0 < head
-00012d40: 6572 735b 2763 6f6e 7465 6e74 4c65 6e67  ers['contentLeng
-00012d50: 7468 275d 203c 3d20 280a 2020 2020 2020  th'] <= (.      
-00012d60: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00012d70: 6c65 5f73 697a 6520 2d20 6f66 6673 6574  le_size - offset
-00012d80: 2920 656c 7365 2066 696c 655f 7369 7a65  ) else file_size
-00012d90: 202d 206f 6666 7365 740a 2020 2020 2020   - offset.      
-00012da0: 2020 2020 2020 746f 7461 6c43 6f75 6e74        totalCount
-00012db0: 203d 2068 6561 6465 7273 5b27 636f 6e74   = headers['cont
-00012dc0: 656e 744c 656e 6774 6827 5d0a 2020 2020  entLength'].    
-00012dd0: 2020 2020 2020 2020 6966 2074 6f74 616c          if total
-00012de0: 436f 756e 7420 3e20 3020 616e 6420 7072  Count > 0 and pr
-00012df0: 6f67 7265 7373 4361 6c6c 6261 636b 2069  ogressCallback i
-00012e00: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00012e10: 2020 2020 2020 2020 2020 2020 7265 6164              read
-00012e20: 6162 6c65 203d 2054 7275 650a 2020 2020  able = True.    
-00012e30: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
-00012e40: 6669 6572 203d 2070 726f 6772 6573 732e  fier = progress.
-00012e50: 5072 6f67 7265 7373 4e6f 7469 6669 6572  ProgressNotifier
-00012e60: 2870 726f 6772 6573 7343 616c 6c62 6163  (progressCallbac
-00012e70: 6b2c 2074 6f74 616c 436f 756e 7429 0a20  k, totalCount). 
-00012e80: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00012e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012ea0: 206e 6f74 6966 6965 7220 3d20 7072 6f67   notifier = prog
-00012eb0: 7265 7373 2e4e 4f4e 455f 4e4f 5449 4649  ress.NONE_NOTIFI
-00012ec0: 4552 0a20 2020 2020 2020 2020 2020 2065  ER.            e
-00012ed0: 6e74 6974 7920 3d20 7574 696c 2e67 6574  ntity = util.get
-00012ee0: 5f65 6e74 6974 795f 666f 725f 7365 6e64  _entity_for_send
-00012ef0: 5f77 6974 685f 746f 7461 6c5f 636f 756e  _with_total_coun
-00012f00: 7428 6669 6c65 5f70 6174 682c 2074 6f74  t(file_path, tot
-00012f10: 616c 436f 756e 742c 206f 6666 7365 742c  alCount, offset,
-00012f20: 2073 656c 662e 6368 756e 6b5f 7369 7a65   self.chunk_size
-00012f30: 2c20 6e6f 7469 6669 6572 290a 2020 2020  , notifier).    
-00012f40: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00012f50: 2020 2020 2020 746f 7461 6c43 6f75 6e74        totalCount
-00012f60: 203d 2068 6561 6465 7273 5b27 636f 6e74   = headers['cont
-00012f70: 656e 744c 656e 6774 6827 5d0a 2020 2020  entLength'].    
-00012f80: 2020 2020 2020 2020 6966 2074 6f74 616c          if total
-00012f90: 436f 756e 7420 3e20 3020 616e 6420 7072  Count > 0 and pr
-00012fa0: 6f67 7265 7373 4361 6c6c 6261 636b 2069  ogressCallback i
-00012fb0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00012fc0: 2020 2020 2020 2020 2020 2020 7265 6164              read
-00012fd0: 6162 6c65 203d 2054 7275 650a 2020 2020  able = True.    
-00012fe0: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
-00012ff0: 6669 6572 203d 2070 726f 6772 6573 732e  fier = progress.
-00013000: 5072 6f67 7265 7373 4e6f 7469 6669 6572  ProgressNotifier
-00013010: 2870 726f 6772 6573 7343 616c 6c62 6163  (progressCallbac
-00013020: 6b2c 2074 6f74 616c 436f 756e 7429 0a20  k, totalCount). 
-00013030: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00013040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013050: 206e 6f74 6966 6965 7220 3d20 7072 6f67   notifier = prog
-00013060: 7265 7373 2e4e 4f4e 455f 4e4f 5449 4649  ress.NONE_NOTIFI
-00013070: 4552 0a20 2020 2020 2020 2020 2020 2065  ER.            e
-00013080: 6e74 6974 7920 3d20 7574 696c 2e67 6574  ntity = util.get
-00013090: 5f65 6e74 6974 795f 666f 725f 7365 6e64  _entity_for_send
-000130a0: 5f77 6974 685f 746f 7461 6c5f 636f 756e  _with_total_coun
-000130b0: 7428 6669 6c65 5f70 6174 682c 2074 6f74  t(file_path, tot
-000130c0: 616c 436f 756e 742c 204e 6f6e 652c 2073  alCount, None, s
-000130d0: 656c 662e 6368 756e 6b5f 7369 7a65 2c20  elf.chunk_size, 
-000130e0: 6e6f 7469 6669 6572 290a 0a20 2020 2020  notifier)..     
-000130f0: 2020 2072 6574 7572 6e20 6865 6164 6572     return header
-00013100: 732c 2072 6561 6461 626c 652c 206e 6f74  s, readable, not
-00013110: 6966 6965 722c 2065 6e74 6974 790a 0a20  ifier, entity.. 
-00013120: 2020 2064 6566 205f 7072 6570 6172 655f     def _prepare_
-00013130: 636f 6e74 656e 745f 6e6f 7469 6669 6572  content_notifier
-00013140: 5f61 6e64 5f65 6e74 6974 7928 7365 6c66  _and_entity(self
-00013150: 2c20 656e 7469 7479 2c20 6865 6164 6572  , entity, header
-00013160: 732c 2070 726f 6772 6573 7343 616c 6c62  s, progressCallb
-00013170: 6163 6b2c 2061 7574 6f43 6c6f 7365 2c20  ack, autoClose, 
-00013180: 7265 6164 6162 6c65 2c20 6368 756e 6b65  readable, chunke
-00013190: 644d 6f64 652c 0a20 2020 2020 2020 2020  dMode,.         
-000131a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000131b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000131c0: 2020 2020 6e6f 7469 6669 6572 293a 0a20      notifier):. 
-000131d0: 2020 2020 2020 2069 6620 656e 7469 7479         if entity
-000131e0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-000131f0: 2020 2020 2020 656e 7469 7479 203d 2027        entity = '
-00013200: 270a 2020 2020 2020 2020 656c 6966 2068  '.        elif h
-00013210: 6173 6174 7472 2865 6e74 6974 792c 2027  asattr(entity, '
-00013220: 7265 6164 2729 2061 6e64 2063 616c 6c61  read') and calla
-00013230: 626c 6528 656e 7469 7479 2e72 6561 6429  ble(entity.read)
-00013240: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00013250: 6164 6162 6c65 203d 2054 7275 650a 2020  adable = True.  
-00013260: 2020 2020 2020 2020 2020 6966 2068 6561            if hea
-00013270: 6465 7273 2e67 6574 2827 636f 6e74 656e  ders.get('conten
-00013280: 744c 656e 6774 6827 2920 6973 204e 6f6e  tLength') is Non
-00013290: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000132a0: 2020 2063 6875 6e6b 6564 4d6f 6465 203d     chunkedMode =
-000132b0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-000132c0: 2020 2020 2020 6e6f 7469 6669 6572 203d        notifier =
-000132d0: 2070 726f 6772 6573 732e 5072 6f67 7265   progress.Progre
-000132e0: 7373 4e6f 7469 6669 6572 2870 726f 6772  ssNotifier(progr
-000132f0: 6573 7343 616c 6c62 6163 6b2c 0a20 2020  essCallback,.   
-00013300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013330: 2020 2d31 2920 6966 2070 726f 6772 6573    -1) if progres
-00013340: 7343 616c 6c62 6163 6b20 6973 206e 6f74  sCallback is not
-00013350: 204e 6f6e 6520 656c 7365 2070 726f 6772   None else progr
-00013360: 6573 732e 4e4f 4e45 5f4e 4f54 4946 4945  ess.NONE_NOTIFIE
-00013370: 520a 2020 2020 2020 2020 2020 2020 2020  R.              
-00013380: 2020 656e 7469 7479 203d 2075 7469 6c2e    entity = util.
-00013390: 6765 745f 7265 6164 6162 6c65 5f65 6e74  get_readable_ent
-000133a0: 6974 7928 656e 7469 7479 2c20 7365 6c66  ity(entity, self
-000133b0: 2e63 6875 6e6b 5f73 697a 652c 206e 6f74  .chunk_size, not
-000133c0: 6966 6965 722c 2061 7574 6f43 6c6f 7365  ifier, autoClose
-000133d0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-000133e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000133f0: 2020 2020 746f 7461 6c43 6f75 6e74 203d      totalCount =
-00013400: 2075 7469 6c2e 746f 5f6c 6f6e 6728 6865   util.to_long(he
-00013410: 6164 6572 732e 6765 7428 2763 6f6e 7465  aders.get('conte
-00013420: 6e74 4c65 6e67 7468 2729 290a 2020 2020  ntLength')).    
-00013430: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
-00013440: 6669 6572 203d 2070 726f 6772 6573 732e  fier = progress.
-00013450: 5072 6f67 7265 7373 4e6f 7469 6669 6572  ProgressNotifier
-00013460: 2870 726f 6772 6573 7343 616c 6c62 6163  (progressCallbac
-00013470: 6b2c 0a20 2020 2020 2020 2020 2020 2020  k,.             
-00013480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134a0: 2020 2020 2020 2020 746f 7461 6c43 6f75          totalCou
-000134b0: 6e74 2920 6966 2074 6f74 616c 436f 756e  nt) if totalCoun
-000134c0: 7420 3e20 3020 616e 6420 7072 6f67 7265  t > 0 and progre
-000134d0: 7373 4361 6c6c 6261 636b 2069 7320 6e6f  ssCallback is no
-000134e0: 7420 4e6f 6e65 205c 0a20 2020 2020 2020  t None \.       
-000134f0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00013500: 6520 7072 6f67 7265 7373 2e4e 4f4e 455f  e progress.NONE_
-00013510: 4e4f 5449 4649 4552 0a20 2020 2020 2020  NOTIFIER.       
-00013520: 2020 2020 2020 2020 2065 6e74 6974 7920           entity 
-00013530: 3d20 7574 696c 2e67 6574 5f65 6e74 6974  = util.get_entit
-00013540: 795f 666f 725f 7365 6e64 5f77 6974 685f  y_for_send_with_
-00013550: 746f 7461 6c5f 636f 756e 7428 7265 6164  total_count(read
-00013560: 5f61 626c 653d 656e 7469 7479 2c20 746f  _able=entity, to
-00013570: 7461 6c43 6f75 6e74 3d74 6f74 616c 436f  talCount=totalCo
-00013580: 756e 742c 2063 6875 6e6b 5f73 697a 653d  unt, chunk_size=
-00013590: 7365 6c66 2e63 6875 6e6b 5f73 697a 652c  self.chunk_size,
-000135a0: 206e 6f74 6966 6965 723d 6e6f 7469 6669   notifier=notifi
-000135b0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-000135c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135f0: 2020 2020 2020 2061 7574 6f5f 636c 6f73         auto_clos
-00013600: 653d 6175 746f 436c 6f73 6529 0a0a 2020  e=autoClose)..  
-00013610: 2020 2020 2020 7265 7475 726e 2065 6e74        return ent
-00013620: 6974 792c 2072 6561 6461 626c 652c 2063  ity, readable, c
-00013630: 6875 6e6b 6564 4d6f 6465 2c20 6e6f 7469  hunkedMode, noti
-00013640: 6669 6572 0a0a 2020 2020 4066 756e 6343  fier..    @funcC
-00013650: 6163 6865 0a20 2020 2064 6566 2061 7070  ache.    def app
-00013660: 656e 644f 626a 6563 7428 7365 6c66 2c20  endObject(self, 
-00013670: 6275 636b 6574 4e61 6d65 2c20 6f62 6a65  bucketName, obje
-00013680: 6374 4b65 792c 2063 6f6e 7465 6e74 3d4e  ctKey, content=N
-00013690: 6f6e 652c 206d 6574 6164 6174 613d 4e6f  one, metadata=No
-000136a0: 6e65 2c20 6865 6164 6572 733d 4e6f 6e65  ne, headers=None
-000136b0: 2c20 7072 6f67 7265 7373 4361 6c6c 6261  , progressCallba
-000136c0: 636b 3d4e 6f6e 652c 0a20 2020 2020 2020  ck=None,.       
-000136d0: 2020 2020 2020 2020 2020 2020 2020 6175                au
-000136e0: 746f 436c 6f73 653d 5472 7565 2c20 6578  toClose=True, ex
-000136f0: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
-00013700: 6f6e 6529 3a0a 2020 2020 2020 2020 6f62  one):.        ob
-00013710: 6a65 6374 4b65 792c 2068 6561 6465 7273  jectKey, headers
-00013720: 2c20 636f 6e74 656e 7420 3d20 7365 6c66  , content = self
-00013730: 2e5f 7072 6570 6172 655f 6170 7065 6e64  ._prepare_append
-00013740: 5f6f 626a 6563 745f 696e 7075 7428 6f62  _object_input(ob
-00013750: 6a65 6374 4b65 792c 2068 6561 6465 7273  jectKey, headers
-00013760: 2c20 636f 6e74 656e 7429 0a0a 2020 2020  , content)..    
-00013770: 2020 2020 6368 756e 6b65 644d 6f64 6520      chunkedMode 
-00013780: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00013790: 7265 6164 6162 6c65 203d 2046 616c 7365  readable = False
-000137a0: 0a20 2020 2020 2020 206e 6f74 6966 6965  .        notifie
-000137b0: 7220 3d20 4e6f 6e65 0a20 2020 2020 2020  r = None.       
-000137c0: 2069 6620 636f 6e74 656e 742e 6765 7428   if content.get(
-000137d0: 2769 7346 696c 6527 293a 0a20 2020 2020  'isFile'):.     
-000137e0: 2020 2020 2020 2066 696c 655f 7061 7468         file_path
-000137f0: 203d 2073 656c 662e 6368 6563 6b5f 6669   = self.check_fi
-00013800: 6c65 5f70 6174 6828 636f 6e74 656e 742e  le_path(content.
-00013810: 6765 7428 2763 6f6e 7465 6e74 2729 290a  get('content')).
-00013820: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00013830: 6865 6164 6572 732e 6765 7428 2763 6f6e  headers.get('con
-00013840: 7465 6e74 5479 7065 2729 2069 7320 4e6f  tentType') is No
-00013850: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00013860: 2020 2020 6865 6164 6572 735b 2763 6f6e      headers['con
-00013870: 7465 6e74 5479 7065 275d 203d 2063 6f6e  tentType'] = con
-00013880: 7374 2e4d 494d 455f 5459 5045 532e 6765  st.MIME_TYPES.ge
-00013890: 7428 6669 6c65 5f70 6174 685b 6669 6c65  t(file_path[file
-000138a0: 5f70 6174 682e 7266 696e 6428 272e 2729  _path.rfind('.')
-000138b0: 202b 2031 3a5d 2e6c 6f77 6572 2829 290a   + 1:].lower()).
-000138c0: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-000138d0: 655f 7369 7a65 203d 2075 7469 6c2e 746f  e_size = util.to
-000138e0: 5f6c 6f6e 6728 6f73 2e70 6174 682e 6765  _long(os.path.ge
-000138f0: 7473 697a 6528 6669 6c65 5f70 6174 6829  tsize(file_path)
-00013900: 290a 2020 2020 2020 2020 2020 2020 6865  ).            he
-00013910: 6164 6572 735b 2763 6f6e 7465 6e74 4c65  aders['contentLe
-00013920: 6e67 7468 275d 203d 2075 7469 6c2e 746f  ngth'] = util.to
-00013930: 5f6c 6f6e 6728 6865 6164 6572 732e 6765  _long(headers.ge
-00013940: 7428 2763 6f6e 7465 6e74 4c65 6e67 7468  t('contentLength
-00013950: 2729 290a 2020 2020 2020 2020 2020 2020  ')).            
-00013960: 6865 6164 6572 735b 2763 6f6e 7465 6e74  headers['content
-00013970: 4c65 6e67 7468 275d 203d 2068 6561 6465  Length'] = heade
-00013980: 7273 5b27 636f 6e74 656e 744c 656e 6774  rs['contentLengt
-00013990: 6827 5d20 6966 2068 6561 6465 7273 2e67  h'] if headers.g
-000139a0: 6574 2827 636f 6e74 656e 744c 656e 6774  et('contentLengt
-000139b0: 6827 2920 6973 206e 6f74 204e 6f6e 6520  h') is not None 
-000139c0: 616e 6420 6865 6164 6572 735b 0a20 2020  and headers[.   
-000139d0: 2020 2020 2020 2020 2020 2020 2027 636f               'co
-000139e0: 6e74 656e 744c 656e 6774 6827 5d20 3c3d  ntentLength'] <=
-000139f0: 2066 696c 655f 7369 7a65 2065 6c73 6520   file_size else 
-00013a00: 6669 6c65 5f73 697a 650a 2020 2020 2020  file_size.      
-00013a10: 2020 2020 2020 6f66 6673 6574 203d 2075        offset = u
-00013a20: 7469 6c2e 746f 5f6c 6f6e 6728 636f 6e74  til.to_long(cont
-00013a30: 656e 742e 6765 7428 276f 6666 7365 7427  ent.get('offset'
-00013a40: 2929 0a20 2020 2020 2020 2020 2020 2068  )).            h
-00013a50: 6561 6465 7273 2c20 7265 6164 6162 6c65  eaders, readable
-00013a60: 2c20 6e6f 7469 6669 6572 2c20 656e 7469  , notifier, enti
-00013a70: 7479 203d 2073 656c 662e 5f70 7265 7061  ty = self._prepa
-00013a80: 7265 5f66 696c 655f 6e6f 7469 6669 6572  re_file_notifier
-00013a90: 5f61 6e64 5f65 6e74 6974 7928 6f66 6673  _and_entity(offs
-00013aa0: 6574 2c20 6669 6c65 5f73 697a 652c 2068  et, file_size, h
-00013ab0: 6561 6465 7273 2c0a 2020 2020 2020 2020  eaders,.        
-00013ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b10: 2070 726f 6772 6573 7343 616c 6c62 6163   progressCallbac
-00013b20: 6b2c 2066 696c 655f 7061 7468 2c0a 2020  k, file_path,.  
-00013b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b80: 2020 2020 2020 2072 6561 6461 626c 6529         readable)
-00013b90: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
-00013ba0: 6465 7273 203d 2073 656c 662e 636f 6e76  ders = self.conv
-00013bb0: 6572 746f 722e 7472 616e 735f 7075 745f  ertor.trans_put_
-00013bc0: 6f62 6a65 6374 286d 6574 6164 6174 613d  object(metadata=
-00013bd0: 6d65 7461 6461 7461 2c20 6865 6164 6572  metadata, header
-00013be0: 733d 6865 6164 6572 7329 0a20 2020 2020  s=headers).     
-00013bf0: 2020 2020 2020 2073 656c 662e 6c6f 675f         self.log_
-00013c00: 636c 6965 6e74 2e6c 6f67 2844 4542 5547  client.log(DEBUG
-00013c10: 2c20 2773 656e 6420 5061 7468 3a25 7327  , 'send Path:%s'
-00013c20: 2025 2066 696c 655f 7061 7468 290a 2020   % file_path).  
-00013c30: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00013c40: 2020 2020 2020 2020 656e 7469 7479 203d          entity =
-00013c50: 2063 6f6e 7465 6e74 2e67 6574 2827 636f   content.get('co
-00013c60: 6e74 656e 7427 290a 2020 2020 2020 2020  ntent').        
-00013c70: 2020 2020 656e 7469 7479 2c20 7265 6164      entity, read
-00013c80: 6162 6c65 2c20 6368 756e 6b65 644d 6f64  able, chunkedMod
-00013c90: 652c 206e 6f74 6966 6965 7220 3d20 7365  e, notifier = se
-00013ca0: 6c66 2e5f 7072 6570 6172 655f 636f 6e74  lf._prepare_cont
-00013cb0: 656e 745f 6e6f 7469 6669 6572 5f61 6e64  ent_notifier_and
-00013cc0: 5f65 6e74 6974 7928 656e 7469 7479 2c20  _entity(entity, 
-00013cd0: 6865 6164 6572 732c 0a20 2020 2020 2020  headers,.       
-00013ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d30: 2020 2020 2020 2020 2070 726f 6772 6573           progres
-00013d40: 7343 616c 6c62 6163 6b2c 0a20 2020 2020  sCallback,.     
-00013d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013da0: 2020 2020 2020 2020 2020 2061 7574 6f43             autoC
-00013db0: 6c6f 7365 2c20 7265 6164 6162 6c65 2c0a  lose, readable,.
-00013dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e20: 6368 756e 6b65 644d 6f64 652c 206e 6f74  chunkedMode, not
-00013e30: 6966 6965 7229 0a0a 2020 2020 2020 2020  ifier)..        
-00013e40: 2020 2020 6865 6164 6572 7320 3d20 7365      headers = se
-00013e50: 6c66 2e63 6f6e 7665 7274 6f72 2e74 7261  lf.convertor.tra
-00013e60: 6e73 5f70 7574 5f6f 626a 6563 7428 6d65  ns_put_object(me
-00013e70: 7461 6461 7461 3d6d 6574 6164 6174 612c  tadata=metadata,
-00013e80: 2068 6561 6465 7273 3d68 6561 6465 7273   headers=headers
-00013e90: 290a 0a20 2020 2020 2020 2074 7279 3a0a  )..        try:.
-00013ea0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00013eb0: 6f74 6966 6965 7220 6973 206e 6f74 204e  otifier is not N
-00013ec0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00013ed0: 2020 2020 206e 6f74 6966 6965 722e 7374       notifier.st
-00013ee0: 6172 7428 290a 2020 2020 2020 2020 2020  art().          
-00013ef0: 2020 7265 7420 3d20 7365 6c66 2e5f 6d61    ret = self._ma
-00013f00: 6b65 5f70 6f73 745f 7265 7175 6573 7428  ke_post_request(
-00013f10: 6275 636b 6574 4e61 6d65 2c20 6f62 6a65  bucketName, obje
-00013f20: 6374 4b65 792c 2070 6174 6841 7267 733d  ctKey, pathArgs=
-00013f30: 7b27 6170 7065 6e64 273a 204e 6f6e 652c  {'append': None,
-00013f40: 2027 706f 7369 7469 6f6e 273a 2075 7469   'position': uti
-00013f50: 6c2e 746f 5f73 7472 696e 6728 0a20 2020  l.to_string(.   
-00013f60: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00013f70: 7465 6e74 5b27 706f 7369 7469 6f6e 275d  tent['position']
-00013f80: 2920 6966 2063 6f6e 7465 6e74 2e67 6574  ) if content.get
-00013f90: 2827 706f 7369 7469 6f6e 2729 2069 7320  ('position') is 
-00013fa0: 6e6f 7420 4e6f 6e65 2065 6c73 6520 307d  not None else 0}
-00013fb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00012980: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
+00012990: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+000129a0: 6561 6465 7273 290a 0a20 2020 2040 6675  eaders)..    @fu
+000129b0: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
+000129c0: 6765 744f 626a 6563 7428 7365 6c66 2c20  getObject(self, 
+000129d0: 6275 636b 6574 4e61 6d65 2c20 6f62 6a65  bucketName, obje
+000129e0: 6374 4b65 792c 2064 6f77 6e6c 6f61 6450  ctKey, downloadP
+000129f0: 6174 683d 4e6f 6e65 2c20 6765 744f 626a  ath=None, getObj
+00012a00: 6563 7452 6571 7565 7374 3d4e 6f6e 652c  ectRequest=None,
+00012a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012a20: 2020 2068 6561 6465 7273 3d4e 6f6e 652c     headers=None,
+00012a30: 206c 6f61 6453 7472 6561 6d49 6e4d 656d   loadStreamInMem
+00012a40: 6f72 793d 4661 6c73 652c 2070 726f 6772  ory=False, progr
+00012a50: 6573 7343 616c 6c62 6163 6b3d 4e6f 6e65  essCallback=None
+00012a60: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+00012a70: 7273 3d4e 6f6e 652c 206e 6f74 6966 6965  rs=None, notifie
+00012a80: 723d 4e6f 6e65 293a 0a20 2020 2020 2020  r=None):.       
+00012a90: 2069 6620 6765 744f 626a 6563 7452 6571   if getObjectReq
+00012aa0: 7565 7374 2069 7320 4e6f 6e65 3a0a 2020  uest is None:.  
+00012ab0: 2020 2020 2020 2020 2020 6765 744f 626a            getObj
+00012ac0: 6563 7452 6571 7565 7374 203d 2047 6574  ectRequest = Get
+00012ad0: 4f62 6a65 6374 5265 7175 6573 7428 290a  ObjectRequest().
+00012ae0: 2020 2020 2020 2020 6966 2068 6561 6465          if heade
+00012af0: 7273 2069 7320 4e6f 6e65 3a0a 2020 2020  rs is None:.    
+00012b00: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
+00012b10: 3d20 4765 744f 626a 6563 7448 6561 6465  = GetObjectHeade
+00012b20: 7228 290a 2020 2020 2020 2020 5f70 6172  r().        _par
+00012b30: 7365 5f63 6f6e 7465 6e74 203d 2073 656c  se_content = sel
+00012b40: 662e 5f70 6172 7365 5f63 6f6e 7465 6e74  f._parse_content
+00012b50: 0a20 2020 2020 2020 2043 4855 4e4b 5f53  .        CHUNK_S
+00012b60: 495a 4520 3d20 7365 6c66 2e63 6875 6e6b  IZE = self.chunk
+00012b70: 5f73 697a 650a 2020 2020 2020 2020 7265  _size.        re
+00012b80: 6164 6162 6c65 203d 2046 616c 7365 2069  adable = False i
+00012b90: 6620 7072 6f67 7265 7373 4361 6c6c 6261  f progressCallba
+00012ba0: 636b 2069 7320 4e6f 6e65 2065 6c73 6520  ck is None else 
+00012bb0: 5472 7565 0a0a 2020 2020 2020 2020 6465  True..        de
+00012bc0: 6620 7061 7273 654d 6574 686f 6428 636f  f parseMethod(co
+00012bd0: 6e6e 293a 0a20 2020 2020 2020 2020 2020  nn):.           
+00012be0: 2072 6573 756c 7420 3d20 636f 6e6e 2e67   result = conn.g
+00012bf0: 6574 7265 7370 6f6e 7365 2829 0a20 2020  etresponse().   
+00012c00: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00012c10: 5f70 6172 7365 5f63 6f6e 7465 6e74 286f  _parse_content(o
+00012c20: 626a 6563 744b 6579 2c20 636f 6e6e 2c20  bjectKey, conn, 
+00012c30: 7265 7375 6c74 2c20 646f 776e 6c6f 6164  result, download
+00012c40: 5f73 7461 7274 3d68 6561 6465 7273 2e72  _start=headers.r
+00012c50: 616e 6765 2c20 646f 776e 6c6f 6164 5061  ange, downloadPa
+00012c60: 7468 3d64 6f77 6e6c 6f61 6450 6174 682c  th=downloadPath,
+00012c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c90: 2020 2063 6875 636b 5369 7a65 3d43 4855     chuckSize=CHU
+00012ca0: 4e4b 5f53 495a 452c 206c 6f61 6453 7472  NK_SIZE, loadStr
+00012cb0: 6561 6d49 6e4d 656d 6f72 793d 6c6f 6164  eamInMemory=load
+00012cc0: 5374 7265 616d 496e 4d65 6d6f 7279 2c20  StreamInMemory, 
+00012cd0: 6e6f 7469 6669 6572 3d6e 6f74 6966 6965  notifier=notifie
+00012ce0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00012cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d00: 2020 2020 2070 726f 6772 6573 7343 616c       progressCal
+00012d10: 6c62 6163 6b3d 7072 6f67 7265 7373 4361  lback=progressCa
+00012d20: 6c6c 6261 636b 290a 0a20 2020 2020 2020  llback)..       
+00012d30: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
+00012d40: 6b65 5f67 6574 5f72 6571 7565 7374 2862  ke_get_request(b
+00012d50: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
+00012d60: 744b 6579 2c20 7061 7273 654d 6574 686f  tKey, parseMetho
+00012d70: 643d 7061 7273 654d 6574 686f 642c 2072  d=parseMethod, r
+00012d80: 6561 6461 626c 653d 7265 6164 6162 6c65  eadable=readable
+00012d90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00012da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012db0: 2020 2020 2020 2020 6578 7465 6e73 696f          extensio
+00012dc0: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
+00012dd0: 6f6e 4865 6164 6572 732c 0a20 2020 2020  onHeaders,.     
+00012de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e00: 202a 2a73 656c 662e 636f 6e76 6572 746f   **self.converto
+00012e10: 722e 7472 616e 735f 6765 745f 6f62 6a65  r.trans_get_obje
+00012e20: 6374 2867 6574 4f62 6a65 6374 5265 7175  ct(getObjectRequ
+00012e30: 6573 743d 6765 744f 626a 6563 7452 6571  est=getObjectReq
+00012e40: 7565 7374 2c0a 2020 2020 2020 2020 2020  uest,.          
+00012e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e80: 2020 2020 2020 2020 2020 2020 2020 6865                he
+00012e90: 6164 6572 733d 6865 6164 6572 7329 290a  aders=headers)).
+00012ea0: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
+00012eb0: 6f64 0a20 2020 2064 6566 205f 7072 6570  od.    def _prep
+00012ec0: 6172 655f 6170 7065 6e64 5f6f 626a 6563  are_append_objec
+00012ed0: 745f 696e 7075 7428 6f62 6a65 6374 4b65  t_input(objectKe
+00012ee0: 792c 2068 6561 6465 7273 2c20 636f 6e74  y, headers, cont
+00012ef0: 656e 7429 3a0a 2020 2020 2020 2020 6f62  ent):.        ob
+00012f00: 6a65 6374 4b65 7920 3d20 7574 696c 2e73  jectKey = util.s
+00012f10: 6166 655f 656e 636f 6465 286f 626a 6563  afe_encode(objec
+00012f20: 744b 6579 290a 2020 2020 2020 2020 6966  tKey).        if
+00012f30: 206f 626a 6563 744b 6579 2069 7320 4e6f   objectKey is No
+00012f40: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00012f50: 6f62 6a65 6374 4b65 7920 3d20 2727 0a0a  objectKey = ''..
+00012f60: 2020 2020 2020 2020 6966 2068 6561 6465          if heade
+00012f70: 7273 2069 7320 4e6f 6e65 3a0a 2020 2020  rs is None:.    
+00012f80: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
+00012f90: 3d20 4170 7065 6e64 4f62 6a65 6374 4865  = AppendObjectHe
+00012fa0: 6164 6572 2829 0a0a 2020 2020 2020 2020  ader()..        
+00012fb0: 6966 2063 6f6e 7465 6e74 2069 7320 4e6f  if content is No
+00012fc0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00012fd0: 636f 6e74 656e 7420 3d20 4170 7065 6e64  content = Append
+00012fe0: 4f62 6a65 6374 436f 6e74 656e 7428 290a  ObjectContent().
+00012ff0: 0a20 2020 2020 2020 2069 6620 6865 6164  .        if head
+00013000: 6572 732e 6765 7428 2763 6f6e 7465 6e74  ers.get('content
+00013010: 5479 7065 2729 2069 7320 4e6f 6e65 3a0a  Type') is None:.
+00013020: 2020 2020 2020 2020 2020 2020 6865 6164              head
+00013030: 6572 735b 2763 6f6e 7465 6e74 5479 7065  ers['contentType
+00013040: 275d 203d 2063 6f6e 7374 2e4d 494d 455f  '] = const.MIME_
+00013050: 5459 5045 532e 6765 7428 6f62 6a65 6374  TYPES.get(object
+00013060: 4b65 795b 6f62 6a65 6374 4b65 792e 7266  Key[objectKey.rf
+00013070: 696e 6428 272e 2729 202b 2031 3a5d 2e6c  ind('.') + 1:].l
+00013080: 6f77 6572 2829 290a 0a20 2020 2020 2020  ower())..       
+00013090: 2072 6574 7572 6e20 6f62 6a65 6374 4b65   return objectKe
+000130a0: 792c 2068 6561 6465 7273 2c20 636f 6e74  y, headers, cont
+000130b0: 656e 740a 0a20 2020 2064 6566 205f 7072  ent..    def _pr
+000130c0: 6570 6172 655f 6669 6c65 5f6e 6f74 6966  epare_file_notif
+000130d0: 6965 725f 616e 645f 656e 7469 7479 2873  ier_and_entity(s
+000130e0: 656c 662c 206f 6666 7365 742c 2066 696c  elf, offset, fil
+000130f0: 655f 7369 7a65 2c20 6865 6164 6572 732c  e_size, headers,
+00013100: 2070 726f 6772 6573 7343 616c 6c62 6163   progressCallbac
+00013110: 6b2c 2066 696c 655f 7061 7468 2c20 7265  k, file_path, re
+00013120: 6164 6162 6c65 293a 0a20 2020 2020 2020  adable):.       
+00013130: 2069 6620 6f66 6673 6574 2069 7320 6e6f   if offset is no
+00013140: 7420 4e6f 6e65 2061 6e64 2030 203c 206f  t None and 0 < o
+00013150: 6666 7365 7420 3c20 6669 6c65 5f73 697a  ffset < file_siz
+00013160: 653a 0a20 2020 2020 2020 2020 2020 2068  e:.            h
+00013170: 6561 6465 7273 5b27 636f 6e74 656e 744c  eaders['contentL
+00013180: 656e 6774 6827 5d20 3d20 6865 6164 6572  ength'] = header
+00013190: 735b 2763 6f6e 7465 6e74 4c65 6e67 7468  s['contentLength
+000131a0: 275d 2069 6620 3020 3c20 6865 6164 6572  '] if 0 < header
+000131b0: 735b 2763 6f6e 7465 6e74 4c65 6e67 7468  s['contentLength
+000131c0: 275d 203c 3d20 280a 2020 2020 2020 2020  '] <= (.        
+000131d0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+000131e0: 5f73 697a 6520 2d20 6f66 6673 6574 2920  _size - offset) 
+000131f0: 656c 7365 2066 696c 655f 7369 7a65 202d  else file_size -
+00013200: 206f 6666 7365 740a 2020 2020 2020 2020   offset.        
+00013210: 2020 2020 746f 7461 6c43 6f75 6e74 203d      totalCount =
+00013220: 2068 6561 6465 7273 5b27 636f 6e74 656e   headers['conten
+00013230: 744c 656e 6774 6827 5d0a 2020 2020 2020  tLength'].      
+00013240: 2020 2020 2020 6966 2074 6f74 616c 436f        if totalCo
+00013250: 756e 7420 3e20 3020 616e 6420 7072 6f67  unt > 0 and prog
+00013260: 7265 7373 4361 6c6c 6261 636b 2069 7320  ressCallback is 
+00013270: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00013280: 2020 2020 2020 2020 2020 7265 6164 6162            readab
+00013290: 6c65 203d 2054 7275 650a 2020 2020 2020  le = True.      
+000132a0: 2020 2020 2020 2020 2020 6e6f 7469 6669            notifi
+000132b0: 6572 203d 2070 726f 6772 6573 732e 5072  er = progress.Pr
+000132c0: 6f67 7265 7373 4e6f 7469 6669 6572 2870  ogressNotifier(p
+000132d0: 726f 6772 6573 7343 616c 6c62 6163 6b2c  rogressCallback,
+000132e0: 2074 6f74 616c 436f 756e 7429 0a20 2020   totalCount).   
+000132f0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00013300: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00013310: 6f74 6966 6965 7220 3d20 7072 6f67 7265  otifier = progre
+00013320: 7373 2e4e 4f4e 455f 4e4f 5449 4649 4552  ss.NONE_NOTIFIER
+00013330: 0a20 2020 2020 2020 2020 2020 2065 6e74  .            ent
+00013340: 6974 7920 3d20 7574 696c 2e67 6574 5f65  ity = util.get_e
+00013350: 6e74 6974 795f 666f 725f 7365 6e64 5f77  ntity_for_send_w
+00013360: 6974 685f 746f 7461 6c5f 636f 756e 7428  ith_total_count(
+00013370: 6669 6c65 5f70 6174 682c 2074 6f74 616c  file_path, total
+00013380: 436f 756e 742c 206f 6666 7365 742c 2073  Count, offset, s
+00013390: 656c 662e 6368 756e 6b5f 7369 7a65 2c20  elf.chunk_size, 
+000133a0: 6e6f 7469 6669 6572 290a 2020 2020 2020  notifier).      
+000133b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000133c0: 2020 2020 746f 7461 6c43 6f75 6e74 203d      totalCount =
+000133d0: 2068 6561 6465 7273 5b27 636f 6e74 656e   headers['conten
+000133e0: 744c 656e 6774 6827 5d0a 2020 2020 2020  tLength'].      
+000133f0: 2020 2020 2020 6966 2074 6f74 616c 436f        if totalCo
+00013400: 756e 7420 3e20 3020 616e 6420 7072 6f67  unt > 0 and prog
+00013410: 7265 7373 4361 6c6c 6261 636b 2069 7320  ressCallback is 
+00013420: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00013430: 2020 2020 2020 2020 2020 7265 6164 6162            readab
+00013440: 6c65 203d 2054 7275 650a 2020 2020 2020  le = True.      
+00013450: 2020 2020 2020 2020 2020 6e6f 7469 6669            notifi
+00013460: 6572 203d 2070 726f 6772 6573 732e 5072  er = progress.Pr
+00013470: 6f67 7265 7373 4e6f 7469 6669 6572 2870  ogressNotifier(p
+00013480: 726f 6772 6573 7343 616c 6c62 6163 6b2c  rogressCallback,
+00013490: 2074 6f74 616c 436f 756e 7429 0a20 2020   totalCount).   
+000134a0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000134b0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000134c0: 6f74 6966 6965 7220 3d20 7072 6f67 7265  otifier = progre
+000134d0: 7373 2e4e 4f4e 455f 4e4f 5449 4649 4552  ss.NONE_NOTIFIER
+000134e0: 0a20 2020 2020 2020 2020 2020 2065 6e74  .            ent
+000134f0: 6974 7920 3d20 7574 696c 2e67 6574 5f65  ity = util.get_e
+00013500: 6e74 6974 795f 666f 725f 7365 6e64 5f77  ntity_for_send_w
+00013510: 6974 685f 746f 7461 6c5f 636f 756e 7428  ith_total_count(
+00013520: 6669 6c65 5f70 6174 682c 2074 6f74 616c  file_path, total
+00013530: 436f 756e 742c 204e 6f6e 652c 2073 656c  Count, None, sel
+00013540: 662e 6368 756e 6b5f 7369 7a65 2c20 6e6f  f.chunk_size, no
+00013550: 7469 6669 6572 290a 0a20 2020 2020 2020  tifier)..       
+00013560: 2072 6574 7572 6e20 6865 6164 6572 732c   return headers,
+00013570: 2072 6561 6461 626c 652c 206e 6f74 6966   readable, notif
+00013580: 6965 722c 2065 6e74 6974 790a 0a20 2020  ier, entity..   
+00013590: 2064 6566 205f 7072 6570 6172 655f 636f   def _prepare_co
+000135a0: 6e74 656e 745f 6e6f 7469 6669 6572 5f61  ntent_notifier_a
+000135b0: 6e64 5f65 6e74 6974 7928 7365 6c66 2c20  nd_entity(self, 
+000135c0: 656e 7469 7479 2c20 6865 6164 6572 732c  entity, headers,
+000135d0: 2070 726f 6772 6573 7343 616c 6c62 6163   progressCallbac
+000135e0: 6b2c 2061 7574 6f43 6c6f 7365 2c20 7265  k, autoClose, re
+000135f0: 6164 6162 6c65 2c20 6368 756e 6b65 644d  adable, chunkedM
+00013600: 6f64 652c 0a20 2020 2020 2020 2020 2020  ode,.           
+00013610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013630: 2020 6e6f 7469 6669 6572 293a 0a20 2020    notifier):.   
+00013640: 2020 2020 2069 6620 656e 7469 7479 2069       if entity i
+00013650: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00013660: 2020 2020 656e 7469 7479 203d 2027 270a      entity = ''.
+00013670: 2020 2020 2020 2020 656c 6966 2068 6173          elif has
+00013680: 6174 7472 2865 6e74 6974 792c 2027 7265  attr(entity, 're
+00013690: 6164 2729 2061 6e64 2063 616c 6c61 626c  ad') and callabl
+000136a0: 6528 656e 7469 7479 2e72 6561 6429 3a0a  e(entity.read):.
+000136b0: 2020 2020 2020 2020 2020 2020 7265 6164              read
+000136c0: 6162 6c65 203d 2054 7275 650a 2020 2020  able = True.    
+000136d0: 2020 2020 2020 2020 6966 2068 6561 6465          if heade
+000136e0: 7273 2e67 6574 2827 636f 6e74 656e 744c  rs.get('contentL
+000136f0: 656e 6774 6827 2920 6973 204e 6f6e 653a  ength') is None:
+00013700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013710: 2063 6875 6e6b 6564 4d6f 6465 203d 2054   chunkedMode = T
+00013720: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00013730: 2020 2020 6e6f 7469 6669 6572 203d 2070      notifier = p
+00013740: 726f 6772 6573 732e 5072 6f67 7265 7373  rogress.Progress
+00013750: 4e6f 7469 6669 6572 2870 726f 6772 6573  Notifier(progres
+00013760: 7343 616c 6c62 6163 6b2c 0a20 2020 2020  sCallback,.     
+00013770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000137a0: 2d31 2920 6966 2070 726f 6772 6573 7343  -1) if progressC
+000137b0: 616c 6c62 6163 6b20 6973 206e 6f74 204e  allback is not N
+000137c0: 6f6e 6520 656c 7365 2070 726f 6772 6573  one else progres
+000137d0: 732e 4e4f 4e45 5f4e 4f54 4946 4945 520a  s.NONE_NOTIFIER.
+000137e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000137f0: 656e 7469 7479 203d 2075 7469 6c2e 6765  entity = util.ge
+00013800: 745f 7265 6164 6162 6c65 5f65 6e74 6974  t_readable_entit
+00013810: 7928 656e 7469 7479 2c20 7365 6c66 2e63  y(entity, self.c
+00013820: 6875 6e6b 5f73 697a 652c 206e 6f74 6966  hunk_size, notif
+00013830: 6965 722c 2061 7574 6f43 6c6f 7365 290a  ier, autoClose).
+00013840: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00013850: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013860: 2020 746f 7461 6c43 6f75 6e74 203d 2075    totalCount = u
+00013870: 7469 6c2e 746f 5f6c 6f6e 6728 6865 6164  til.to_long(head
+00013880: 6572 732e 6765 7428 2763 6f6e 7465 6e74  ers.get('content
+00013890: 4c65 6e67 7468 2729 290a 2020 2020 2020  Length')).      
+000138a0: 2020 2020 2020 2020 2020 6e6f 7469 6669            notifi
+000138b0: 6572 203d 2070 726f 6772 6573 732e 5072  er = progress.Pr
+000138c0: 6f67 7265 7373 4e6f 7469 6669 6572 2870  ogressNotifier(p
+000138d0: 726f 6772 6573 7343 616c 6c62 6163 6b2c  rogressCallback,
+000138e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000138f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013910: 2020 2020 2020 746f 7461 6c43 6f75 6e74        totalCount
+00013920: 2920 6966 2074 6f74 616c 436f 756e 7420  ) if totalCount 
+00013930: 3e20 3020 616e 6420 7072 6f67 7265 7373  > 0 and progress
+00013940: 4361 6c6c 6261 636b 2069 7320 6e6f 7420  Callback is not 
+00013950: 4e6f 6e65 205c 0a20 2020 2020 2020 2020  None \.         
+00013960: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
+00013970: 7072 6f67 7265 7373 2e4e 4f4e 455f 4e4f  progress.NONE_NO
+00013980: 5449 4649 4552 0a20 2020 2020 2020 2020  TIFIER.         
+00013990: 2020 2020 2020 2065 6e74 6974 7920 3d20         entity = 
+000139a0: 7574 696c 2e67 6574 5f65 6e74 6974 795f  util.get_entity_
+000139b0: 666f 725f 7365 6e64 5f77 6974 685f 746f  for_send_with_to
+000139c0: 7461 6c5f 636f 756e 7428 7265 6164 5f61  tal_count(read_a
+000139d0: 626c 653d 656e 7469 7479 2c20 746f 7461  ble=entity, tota
+000139e0: 6c43 6f75 6e74 3d74 6f74 616c 436f 756e  lCount=totalCoun
+000139f0: 742c 2063 6875 6e6b 5f73 697a 653d 7365  t, chunk_size=se
+00013a00: 6c66 2e63 6875 6e6b 5f73 697a 652c 206e  lf.chunk_size, n
+00013a10: 6f74 6966 6965 723d 6e6f 7469 6669 6572  otifier=notifier
+00013a20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00013a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a60: 2020 2020 2061 7574 6f5f 636c 6f73 653d       auto_close=
+00013a70: 6175 746f 436c 6f73 6529 0a0a 2020 2020  autoClose)..    
+00013a80: 2020 2020 7265 7475 726e 2065 6e74 6974      return entit
+00013a90: 792c 2072 6561 6461 626c 652c 2063 6875  y, readable, chu
+00013aa0: 6e6b 6564 4d6f 6465 2c20 6e6f 7469 6669  nkedMode, notifi
+00013ab0: 6572 0a0a 2020 2020 4066 756e 6343 6163  er..    @funcCac
+00013ac0: 6865 0a20 2020 2064 6566 2061 7070 656e  he.    def appen
+00013ad0: 644f 626a 6563 7428 7365 6c66 2c20 6275  dObject(self, bu
+00013ae0: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
+00013af0: 4b65 792c 2063 6f6e 7465 6e74 3d4e 6f6e  Key, content=Non
+00013b00: 652c 206d 6574 6164 6174 613d 4e6f 6e65  e, metadata=None
+00013b10: 2c20 6865 6164 6572 733d 4e6f 6e65 2c20  , headers=None, 
+00013b20: 7072 6f67 7265 7373 4361 6c6c 6261 636b  progressCallback
+00013b30: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
+00013b40: 2020 2020 2020 2020 2020 2020 6175 746f              auto
+00013b50: 436c 6f73 653d 5472 7565 2c20 6578 7465  Close=True, exte
+00013b60: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
+00013b70: 6529 3a0a 2020 2020 2020 2020 6f62 6a65  e):.        obje
+00013b80: 6374 4b65 792c 2068 6561 6465 7273 2c20  ctKey, headers, 
+00013b90: 636f 6e74 656e 7420 3d20 7365 6c66 2e5f  content = self._
+00013ba0: 7072 6570 6172 655f 6170 7065 6e64 5f6f  prepare_append_o
+00013bb0: 626a 6563 745f 696e 7075 7428 6f62 6a65  bject_input(obje
+00013bc0: 6374 4b65 792c 2068 6561 6465 7273 2c20  ctKey, headers, 
+00013bd0: 636f 6e74 656e 7429 0a0a 2020 2020 2020  content)..      
+00013be0: 2020 6368 756e 6b65 644d 6f64 6520 3d20    chunkedMode = 
+00013bf0: 4661 6c73 650a 2020 2020 2020 2020 7265  False.        re
+00013c00: 6164 6162 6c65 203d 2046 616c 7365 0a20  adable = False. 
+00013c10: 2020 2020 2020 206e 6f74 6966 6965 7220         notifier 
+00013c20: 3d20 4e6f 6e65 0a20 2020 2020 2020 2069  = None.        i
+00013c30: 6620 636f 6e74 656e 742e 6765 7428 2769  f content.get('i
+00013c40: 7346 696c 6527 293a 0a20 2020 2020 2020  sFile'):.       
+00013c50: 2020 2020 2066 696c 655f 7061 7468 203d       file_path =
+00013c60: 2073 656c 662e 6368 6563 6b5f 6669 6c65   self.check_file
+00013c70: 5f70 6174 6828 636f 6e74 656e 742e 6765  _path(content.ge
+00013c80: 7428 2763 6f6e 7465 6e74 2729 290a 0a20  t('content')).. 
+00013c90: 2020 2020 2020 2020 2020 2069 6620 6865             if he
+00013ca0: 6164 6572 732e 6765 7428 2763 6f6e 7465  aders.get('conte
+00013cb0: 6e74 5479 7065 2729 2069 7320 4e6f 6e65  ntType') is None
+00013cc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013cd0: 2020 6865 6164 6572 735b 2763 6f6e 7465    headers['conte
+00013ce0: 6e74 5479 7065 275d 203d 2063 6f6e 7374  ntType'] = const
+00013cf0: 2e4d 494d 455f 5459 5045 532e 6765 7428  .MIME_TYPES.get(
+00013d00: 6669 6c65 5f70 6174 685b 6669 6c65 5f70  file_path[file_p
+00013d10: 6174 682e 7266 696e 6428 272e 2729 202b  ath.rfind('.') +
+00013d20: 2031 3a5d 2e6c 6f77 6572 2829 290a 0a20   1:].lower()).. 
+00013d30: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+00013d40: 7369 7a65 203d 2075 7469 6c2e 746f 5f6c  size = util.to_l
+00013d50: 6f6e 6728 6f73 2e70 6174 682e 6765 7473  ong(os.path.gets
+00013d60: 697a 6528 6669 6c65 5f70 6174 6829 290a  ize(file_path)).
+00013d70: 2020 2020 2020 2020 2020 2020 6865 6164              head
+00013d80: 6572 735b 2763 6f6e 7465 6e74 4c65 6e67  ers['contentLeng
+00013d90: 7468 275d 203d 2075 7469 6c2e 746f 5f6c  th'] = util.to_l
+00013da0: 6f6e 6728 6865 6164 6572 732e 6765 7428  ong(headers.get(
+00013db0: 2763 6f6e 7465 6e74 4c65 6e67 7468 2729  'contentLength')
+00013dc0: 290a 2020 2020 2020 2020 2020 2020 6865  ).            he
+00013dd0: 6164 6572 735b 2763 6f6e 7465 6e74 4c65  aders['contentLe
+00013de0: 6e67 7468 275d 203d 2068 6561 6465 7273  ngth'] = headers
+00013df0: 5b27 636f 6e74 656e 744c 656e 6774 6827  ['contentLength'
+00013e00: 5d20 6966 2068 6561 6465 7273 2e67 6574  ] if headers.get
+00013e10: 2827 636f 6e74 656e 744c 656e 6774 6827  ('contentLength'
+00013e20: 2920 6973 206e 6f74 204e 6f6e 6520 616e  ) is not None an
+00013e30: 6420 6865 6164 6572 735b 0a20 2020 2020  d headers[.     
+00013e40: 2020 2020 2020 2020 2020 2027 636f 6e74             'cont
+00013e50: 656e 744c 656e 6774 6827 5d20 3c3d 2066  entLength'] <= f
+00013e60: 696c 655f 7369 7a65 2065 6c73 6520 6669  ile_size else fi
+00013e70: 6c65 5f73 697a 650a 2020 2020 2020 2020  le_size.        
+00013e80: 2020 2020 6f66 6673 6574 203d 2075 7469      offset = uti
+00013e90: 6c2e 746f 5f6c 6f6e 6728 636f 6e74 656e  l.to_long(conten
+00013ea0: 742e 6765 7428 276f 6666 7365 7427 2929  t.get('offset'))
+00013eb0: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
+00013ec0: 6465 7273 2c20 7265 6164 6162 6c65 2c20  ders, readable, 
+00013ed0: 6e6f 7469 6669 6572 2c20 656e 7469 7479  notifier, entity
+00013ee0: 203d 2073 656c 662e 5f70 7265 7061 7265   = self._prepare
+00013ef0: 5f66 696c 655f 6e6f 7469 6669 6572 5f61  _file_notifier_a
+00013f00: 6e64 5f65 6e74 6974 7928 6f66 6673 6574  nd_entity(offset
+00013f10: 2c20 6669 6c65 5f73 697a 652c 2068 6561  , file_size, hea
+00013f20: 6465 7273 2c0a 2020 2020 2020 2020 2020  ders,.          
+00013f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f70: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00013f80: 726f 6772 6573 7343 616c 6c62 6163 6b2c  rogressCallback,
+00013f90: 2066 696c 655f 7061 7468 2c0a 2020 2020   file_path,.    
+00013fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00013fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013fd0: 2020 2020 2020 2020 2020 2020 6865 6164              head
-00013fe0: 6572 733d 6865 6164 6572 732c 2065 6e74  ers=headers, ent
-00013ff0: 6974 793d 656e 7469 7479 2c20 6368 756e  ity=entity, chun
-00014000: 6b65 644d 6f64 653d 6368 756e 6b65 644d  kedMode=chunkedM
-00014010: 6f64 652c 0a20 2020 2020 2020 2020 2020  ode,.           
-00014020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014030: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00014040: 6574 686f 644e 616d 653d 2761 7070 656e  ethodName='appen
-00014050: 644f 626a 6563 7427 2c20 7265 6164 6162  dObject', readab
-00014060: 6c65 3d72 6561 6461 626c 652c 0a20 2020  le=readable,.   
-00014070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014090: 2020 2020 2020 2065 7874 656e 7369 6f6e         extension
-000140a0: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
-000140b0: 6e48 6561 6465 7273 290a 2020 2020 2020  nHeaders).      
-000140c0: 2020 6669 6e61 6c6c 793a 0a20 2020 2020    finally:.     
-000140d0: 2020 2020 2020 2069 6620 6e6f 7469 6669         if notifi
-000140e0: 6572 2069 7320 6e6f 7420 4e6f 6e65 3a0a  er is not None:.
-000140f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014100: 6e6f 7469 6669 6572 2e65 6e64 2829 0a20  notifier.end(). 
-00014110: 2020 2020 2020 2073 656c 662e 5f67 656e         self._gen
-00014120: 6572 6174 655f 6f62 6a65 6374 5f75 726c  erate_object_url
-00014130: 2872 6574 2c20 6275 636b 6574 4e61 6d65  (ret, bucketName
-00014140: 2c20 6f62 6a65 6374 4b65 7929 0a20 2020  , objectKey).   
-00014150: 2020 2020 2072 6574 7572 6e20 7265 740a       return ret.
-00014160: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
-00014170: 2020 2020 6465 6620 7075 7443 6f6e 7465      def putConte
-00014180: 6e74 2873 656c 662c 2062 7563 6b65 744e  nt(self, bucketN
-00014190: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
-000141a0: 636f 6e74 656e 743d 4e6f 6e65 2c20 6d65  content=None, me
-000141b0: 7461 6461 7461 3d4e 6f6e 652c 2068 6561  tadata=None, hea
-000141c0: 6465 7273 3d4e 6f6e 652c 2070 726f 6772  ders=None, progr
-000141d0: 6573 7343 616c 6c62 6163 6b3d 4e6f 6e65  essCallback=None
-000141e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000141f0: 2020 2020 2061 7574 6f43 6c6f 7365 3d54       autoClose=T
-00014200: 7275 652c 2065 7874 656e 7369 6f6e 4865  rue, extensionHe
-00014210: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
-00014220: 2020 2020 206f 626a 6563 744b 6579 203d       objectKey =
-00014230: 2075 7469 6c2e 7361 6665 5f65 6e63 6f64   util.safe_encod
-00014240: 6528 6f62 6a65 6374 4b65 7929 0a20 2020  e(objectKey).   
-00014250: 2020 2020 2069 6620 6f62 6a65 6374 4b65       if objectKe
-00014260: 7920 6973 204e 6f6e 653a 0a20 2020 2020  y is None:.     
-00014270: 2020 2020 2020 206f 626a 6563 744b 6579         objectKey
-00014280: 203d 2027 270a 2020 2020 2020 2020 6966   = ''.        if
-00014290: 2068 6561 6465 7273 2069 7320 4e6f 6e65   headers is None
-000142a0: 3a0a 2020 2020 2020 2020 2020 2020 6865  :.            he
-000142b0: 6164 6572 7320 3d20 5075 744f 626a 6563  aders = PutObjec
-000142c0: 7448 6561 6465 7228 290a 2020 2020 2020  tHeader().      
-000142d0: 2020 6966 2068 6561 6465 7273 2e67 6574    if headers.get
-000142e0: 2827 636f 6e74 656e 7454 7970 6527 2920  ('contentType') 
-000142f0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00014300: 2020 2020 2068 6561 6465 7273 5b27 636f       headers['co
-00014310: 6e74 656e 7454 7970 6527 5d20 3d20 636f  ntentType'] = co
-00014320: 6e73 742e 4d49 4d45 5f54 5950 4553 2e67  nst.MIME_TYPES.g
-00014330: 6574 286f 626a 6563 744b 6579 5b6f 626a  et(objectKey[obj
-00014340: 6563 744b 6579 2e72 6669 6e64 2827 2e27  ectKey.rfind('.'
-00014350: 2920 2b20 313a 5d2e 6c6f 7765 7228 2929  ) + 1:].lower())
-00014360: 0a20 2020 2020 2020 205f 6865 6164 6572  .        _header
-00014370: 7320 3d20 7365 6c66 2e63 6f6e 7665 7274  s = self.convert
-00014380: 6f72 2e74 7261 6e73 5f70 7574 5f6f 626a  or.trans_put_obj
-00014390: 6563 7428 6d65 7461 6461 7461 3d6d 6574  ect(metadata=met
-000143a0: 6164 6174 612c 2068 6561 6465 7273 3d68  adata, headers=h
-000143b0: 6561 6465 7273 290a 0a20 2020 2020 2020  eaders)..       
-000143c0: 2072 6561 6461 626c 6520 3d20 4661 6c73   readable = Fals
-000143d0: 650a 2020 2020 2020 2020 6368 756e 6b65  e.        chunke
-000143e0: 644d 6f64 6520 3d20 4661 6c73 650a 2020  dMode = False.  
-000143f0: 2020 2020 2020 6e6f 7469 6669 6572 203d        notifier =
-00014400: 204e 6f6e 650a 0a20 2020 2020 2020 2074   None..        t
-00014410: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00014420: 656e 7469 7479 203d 2063 6f6e 7465 6e74  entity = content
-00014430: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00014440: 656e 7469 7479 2069 7320 4e6f 6e65 3a0a  entity is None:.
-00014450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014460: 656e 7469 7479 203d 2027 270a 2020 2020  entity = ''.    
-00014470: 2020 2020 2020 2020 656c 6966 2068 6173          elif has
-00014480: 6174 7472 2865 6e74 6974 792c 2027 7265  attr(entity, 're
-00014490: 6164 2729 2061 6e64 2063 616c 6c61 626c  ad') and callabl
-000144a0: 6528 656e 7469 7479 2e72 6561 6429 3a0a  e(entity.read):.
-000144b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144c0: 7265 6164 6162 6c65 203d 2054 7275 650a  readable = True.
-000144d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144e0: 6966 2068 6561 6465 7273 2e67 6574 2827  if headers.get('
-000144f0: 636f 6e74 656e 744c 656e 6774 6827 2920  contentLength') 
-00014500: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00014510: 2020 2020 2020 2020 2020 2020 2063 6875               chu
-00014520: 6e6b 6564 4d6f 6465 203d 2054 7275 650a  nkedMode = True.
-00014530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014540: 2020 2020 6e6f 7469 6669 6572 203d 2070      notifier = p
-00014550: 726f 6772 6573 732e 5072 6f67 7265 7373  rogress.Progress
-00014560: 4e6f 7469 6669 6572 2870 726f 6772 6573  Notifier(progres
-00014570: 7343 616c 6c62 6163 6b2c 0a20 2020 2020  sCallback,.     
-00014580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145b0: 2020 2020 2d31 2920 6966 2070 726f 6772      -1) if progr
-000145c0: 6573 7343 616c 6c62 6163 6b20 6973 206e  essCallback is n
-000145d0: 6f74 204e 6f6e 6520 656c 7365 2070 726f  ot None else pro
-000145e0: 6772 6573 732e 4e4f 4e45 5f4e 4f54 4946  gress.NONE_NOTIF
-000145f0: 4945 520a 2020 2020 2020 2020 2020 2020  IER.            
-00014600: 2020 2020 2020 2020 656e 7469 7479 203d          entity =
-00014610: 2075 7469 6c2e 6765 745f 7265 6164 6162   util.get_readab
-00014620: 6c65 5f65 6e74 6974 7928 656e 7469 7479  le_entity(entity
-00014630: 2c20 7365 6c66 2e63 6875 6e6b 5f73 697a  , self.chunk_siz
-00014640: 652c 206e 6f74 6966 6965 722c 2061 7574  e, notifier, aut
-00014650: 6f43 6c6f 7365 290a 2020 2020 2020 2020  oClose).        
-00014660: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00014670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014680: 2020 746f 7461 6c43 6f75 6e74 203d 2075    totalCount = u
-00014690: 7469 6c2e 746f 5f6c 6f6e 6728 6865 6164  til.to_long(head
-000146a0: 6572 732e 6765 7428 2763 6f6e 7465 6e74  ers.get('content
-000146b0: 4c65 6e67 7468 2729 290a 2020 2020 2020  Length')).      
-000146c0: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-000146d0: 7469 6669 6572 203d 2070 726f 6772 6573  tifier = progres
-000146e0: 732e 5072 6f67 7265 7373 4e6f 7469 6669  s.ProgressNotifi
-000146f0: 6572 2870 726f 6772 6573 7343 616c 6c62  er(progressCallb
-00014700: 6163 6b2c 0a20 2020 2020 2020 2020 2020  ack,.           
-00014710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014730: 2020 2020 2020 2020 2020 2020 2020 746f                to
-00014740: 7461 6c43 6f75 6e74 2920 6966 2074 6f74  talCount) if tot
-00014750: 616c 436f 756e 7420 3e20 3020 616e 6420  alCount > 0 and 
-00014760: 7072 6f67 7265 7373 4361 6c6c 6261 636b  progressCallback
-00014770: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-00014780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147b0: 2020 2020 2020 2020 2020 2069 7320 6e6f             is no
-000147c0: 7420 4e6f 6e65 2065 6c73 6520 7072 6f67  t None else prog
-000147d0: 7265 7373 2e4e 4f4e 455f 4e4f 5449 4649  ress.NONE_NOTIFI
-000147e0: 4552 0a20 2020 2020 2020 2020 2020 2020  ER.             
-000147f0: 2020 2020 2020 2065 6e74 6974 7920 3d20         entity = 
-00014800: 7574 696c 2e67 6574 5f65 6e74 6974 795f  util.get_entity_
-00014810: 666f 725f 7365 6e64 5f77 6974 685f 746f  for_send_with_to
-00014820: 7461 6c5f 636f 756e 7428 7265 6164 5f61  tal_count(read_a
-00014830: 626c 653d 656e 7469 7479 2c20 746f 7461  ble=entity, tota
-00014840: 6c43 6f75 6e74 3d74 6f74 616c 436f 756e  lCount=totalCoun
-00014850: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-00014860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014890: 2020 2020 2020 2020 2020 6368 756e 6b5f            chunk_
-000148a0: 7369 7a65 3d73 656c 662e 6368 756e 6b5f  size=self.chunk_
-000148b0: 7369 7a65 2c20 6e6f 7469 6669 6572 3d6e  size, notifier=n
-000148c0: 6f74 6966 6965 722c 0a20 2020 2020 2020  otifier,.       
-000148d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014910: 6175 746f 5f63 6c6f 7365 3d61 7574 6f43  auto_close=autoC
-00014920: 6c6f 7365 290a 0a20 2020 2020 2020 2020  lose)..         
-00014930: 2020 2020 2020 206e 6f74 6966 6965 722e         notifier.
-00014940: 7374 6172 7428 290a 2020 2020 2020 2020  start().        
-00014950: 2020 2020 7265 7420 3d20 7365 6c66 2e5f      ret = self._
-00014960: 6d61 6b65 5f70 7574 5f72 6571 7565 7374  make_put_request
-00014970: 2862 7563 6b65 744e 616d 652c 206f 626a  (bucketName, obj
-00014980: 6563 744b 6579 2c20 6865 6164 6572 733d  ectKey, headers=
-00014990: 5f68 6561 6465 7273 2c20 656e 7469 7479  _headers, entity
-000149a0: 3d65 6e74 6974 792c 0a20 2020 2020 2020  =entity,.       
-000149b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149d0: 2020 6368 756e 6b65 644d 6f64 653d 6368    chunkedMode=ch
-000149e0: 756e 6b65 644d 6f64 652c 206d 6574 686f  unkedMode, metho
-000149f0: 644e 616d 653d 2770 7574 436f 6e74 656e  dName='putConten
-00014a00: 7427 2c20 7265 6164 6162 6c65 3d72 6561  t', readable=rea
-00014a10: 6461 626c 652c 0a20 2020 2020 2020 2020  dable,.         
-00014a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a40: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-00014a50: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
-00014a60: 7329 0a20 2020 2020 2020 2066 696e 616c  s).        final
-00014a70: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
-00014a80: 6966 206e 6f74 6966 6965 7220 6973 206e  if notifier is n
-00014a90: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00014aa0: 2020 2020 2020 2020 206e 6f74 6966 6965           notifie
-00014ab0: 722e 656e 6428 290a 2020 2020 2020 2020  r.end().        
-00014ac0: 7365 6c66 2e5f 6765 6e65 7261 7465 5f6f  self._generate_o
-00014ad0: 626a 6563 745f 7572 6c28 7265 742c 2062  bject_url(ret, b
-00014ae0: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
-00014af0: 744b 6579 290a 2020 2020 2020 2020 7265  tKey).        re
-00014b00: 7475 726e 2072 6574 0a0a 2020 2020 6465  turn ret..    de
-00014b10: 6620 7075 744f 626a 6563 7428 7365 6c66  f putObject(self
-00014b20: 2c20 6275 636b 6574 4e61 6d65 2c20 6f62  , bucketName, ob
-00014b30: 6a65 6374 4b65 792c 2063 6f6e 7465 6e74  jectKey, content
-00014b40: 2c20 6d65 7461 6461 7461 3d4e 6f6e 652c  , metadata=None,
-00014b50: 2068 6561 6465 7273 3d4e 6f6e 652c 2070   headers=None, p
-00014b60: 726f 6772 6573 7343 616c 6c62 6163 6b3d  rogressCallback=
-00014b70: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-00014b80: 2020 2020 2020 2020 6175 746f 436c 6f73          autoClos
-00014b90: 653d 5472 7565 2c20 6578 7465 6e73 696f  e=True, extensio
-00014ba0: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
-00014bb0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00014bc0: 656c 662e 7075 7443 6f6e 7465 6e74 2862  elf.putContent(b
-00014bd0: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
-00014be0: 744b 6579 2c20 636f 6e74 656e 742c 206d  tKey, content, m
-00014bf0: 6574 6164 6174 612c 2068 6561 6465 7273  etadata, headers
-00014c00: 2c20 7072 6f67 7265 7373 4361 6c6c 6261  , progressCallba
-00014c10: 636b 2c20 6175 746f 436c 6f73 652c 0a20  ck, autoClose,. 
-00014c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c30: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00014c40: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
-00014c50: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
-00014c60: 0a0a 2020 2020 4066 756e 6343 6163 6865  ..    @funcCache
-00014c70: 0a20 2020 2064 6566 2070 7574 4669 6c65  .    def putFile
-00014c80: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
-00014c90: 652c 206f 626a 6563 744b 6579 2c20 6669  e, objectKey, fi
-00014ca0: 6c65 5f70 6174 682c 206d 6574 6164 6174  le_path, metadat
-00014cb0: 613d 4e6f 6e65 2c20 6865 6164 6572 733d  a=None, headers=
-00014cc0: 4e6f 6e65 2c20 7072 6f67 7265 7373 4361  None, progressCa
-00014cd0: 6c6c 6261 636b 3d4e 6f6e 652c 0a20 2020  llback=None,.   
-00014ce0: 2020 2020 2020 2020 2020 2020 2065 7874               ext
-00014cf0: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
-00014d00: 6e65 293a 0a20 2020 2020 2020 2066 696c  ne):.        fil
-00014d10: 655f 7061 7468 203d 2073 656c 662e 6368  e_path = self.ch
-00014d20: 6563 6b5f 6669 6c65 5f70 6174 6828 6669  eck_file_path(fi
-00014d30: 6c65 5f70 6174 6829 0a20 2020 2020 2020  le_path).       
-00014d40: 205f 666c 6167 203d 206f 732e 7061 7468   _flag = os.path
-00014d50: 2e69 7364 6972 2866 696c 655f 7061 7468  .isdir(file_path
-00014d60: 290a 0a20 2020 2020 2020 2069 6620 6865  )..        if he
-00014d70: 6164 6572 7320 6973 204e 6f6e 653a 0a20  aders is None:. 
-00014d80: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-00014d90: 7273 203d 2050 7574 4f62 6a65 6374 4865  rs = PutObjectHe
-00014da0: 6164 6572 2829 0a20 2020 2020 2020 2069  ader().        i
-00014db0: 6620 6d65 7461 6461 7461 2069 7320 4e6f  f metadata is No
-00014dc0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00014dd0: 6d65 7461 6461 7461 203d 2064 6963 7428  metadata = dict(
-00014de0: 290a 0a20 2020 2020 2020 2069 6620 5f66  )..        if _f
-00014df0: 6c61 673a 0a20 2020 2020 2020 2020 2020  lag:.           
-00014e00: 2068 6561 6465 7273 5b27 636f 6e74 656e   headers['conten
-00014e10: 744c 656e 6774 6827 5d20 3d20 4e6f 6e65  tLength'] = None
-00014e20: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
-00014e30: 6465 7273 5b27 6d64 3527 5d20 3d20 4e6f  ders['md5'] = No
-00014e40: 6e65 0a20 2020 2020 2020 2020 2020 2068  ne.            h
-00014e50: 6561 6465 7273 5b27 636f 6e74 656e 7454  eaders['contentT
-00014e60: 7970 6527 5d20 3d20 4e6f 6e65 0a0a 2020  ype'] = None..  
-00014e70: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00014e80: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
-00014e90: 2020 2066 6f72 2066 2069 6e20 6f73 2e6c     for f in os.l
-00014ea0: 6973 7464 6972 2866 696c 655f 7061 7468  istdir(file_path
-00014eb0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00014ec0: 2020 2066 203d 2075 7469 6c2e 7361 6665     f = util.safe
-00014ed0: 5f65 6e63 6f64 6528 6629 0a20 2020 2020  _encode(f).     
-00014ee0: 2020 2020 2020 2020 2020 205f 5f66 696c             __fil
-00014ef0: 655f 7061 7468 203d 206f 732e 7061 7468  e_path = os.path
-00014f00: 2e6a 6f69 6e28 6669 6c65 5f70 6174 682c  .join(file_path,
-00014f10: 2066 290a 2020 2020 2020 2020 2020 2020   f).            
-00014f20: 2020 2020 6966 206e 6f74 2063 6f6e 7374      if not const
-00014f30: 2e49 535f 5059 5448 4f4e 323a 0a20 2020  .IS_PYTHON2:.   
-00014f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f50: 2069 6620 6e6f 7420 6f62 6a65 6374 4b65   if not objectKe
-00014f60: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00014f70: 2020 2020 2020 2020 2020 206b 6579 203d             key =
-00014f80: 2075 7469 6c2e 7361 6665 5f74 7261 6e73   util.safe_trans
-00014f90: 5f74 6f5f 6762 3233 3132 2827 7b30 7d2f  _to_gb2312('{0}/
-00014fa0: 272e 666f 726d 6174 286f 732e 7061 7468  '.format(os.path
-00014fb0: 2e73 706c 6974 2866 696c 655f 7061 7468  .split(file_path
-00014fc0: 295b 315d 2920 2b20 6629 0a20 2020 2020  )[1]) + f).     
-00014fd0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00014fe0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00014ff0: 2020 2020 2020 2020 2020 2020 206b 6579               key
-00015000: 203d 2027 7b30 7d2f 272e 666f 726d 6174   = '{0}/'.format
-00015010: 286f 626a 6563 744b 6579 2920 2b20 7574  (objectKey) + ut
-00015020: 696c 2e73 6166 655f 7472 616e 735f 746f  il.safe_trans_to
-00015030: 5f67 6232 3331 3228 6629 0a20 2020 2020  _gb2312(f).     
-00015040: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00015050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015060: 2020 2020 2069 6620 6e6f 7420 6f62 6a65       if not obje
-00015070: 6374 4b65 793a 0a20 2020 2020 2020 2020  ctKey:.         
-00015080: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00015090: 6579 203d 2075 7469 6c2e 7361 6665 5f74  ey = util.safe_t
-000150a0: 7261 6e73 5f74 6f5f 6762 3233 3132 2827  rans_to_gb2312('
-000150b0: 7b30 7d2f 272e 666f 726d 6174 286f 732e  {0}/'.format(os.
-000150c0: 7061 7468 2e73 706c 6974 2866 696c 655f  path.split(file_
-000150d0: 7061 7468 295b 315d 2920 2b20 6629 2e64  path)[1]) + f).d
-000150e0: 6563 6f64 6528 0a20 2020 2020 2020 2020  ecode(.         
-000150f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015100: 2020 2027 4742 3233 3132 2729 2e65 6e63     'GB2312').enc
-00015110: 6f64 6528 2755 5446 2d38 2729 0a20 2020  ode('UTF-8').   
-00015120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015130: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00015140: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00015150: 6579 203d 2027 7b30 7d2f 272e 666f 726d  ey = '{0}/'.form
-00015160: 6174 286f 626a 6563 744b 6579 2920 2b20  at(objectKey) + 
-00015170: 7574 696c 2e73 6166 655f 7472 616e 735f  util.safe_trans_
-00015180: 746f 5f67 6232 3331 3228 6629 2e64 6563  to_gb2312(f).dec
-00015190: 6f64 6528 2747 4232 3331 3227 292e 656e  ode('GB2312').en
-000151a0: 636f 6465 2827 5554 462d 3827 290a 2020  code('UTF-8').  
-000151b0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000151c0: 7375 6c74 203d 2073 656c 662e 7075 7446  sult = self.putF
-000151d0: 696c 6528 6275 636b 6574 4e61 6d65 2c20  ile(bucketName, 
-000151e0: 6b65 792c 205f 5f66 696c 655f 7061 7468  key, __file_path
-000151f0: 2c20 6d65 7461 6461 7461 2c20 6865 6164  , metadata, head
-00015200: 6572 732c 0a20 2020 2020 2020 2020 2020  ers,.           
-00015210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015220: 2020 2020 2020 2020 2020 2065 7874 656e             exten
-00015230: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
-00015240: 6e73 696f 6e48 6561 6465 7273 290a 2020  nsionHeaders).  
-00015250: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00015260: 7375 6c74 732e 6170 7065 6e64 2828 6b65  sults.append((ke
-00015270: 792c 2072 6573 756c 7429 290a 2020 2020  y, result)).    
-00015280: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00015290: 6573 756c 7473 0a0a 2020 2020 2020 2020  esults..        
-000152a0: 6966 206e 6f74 206f 626a 6563 744b 6579  if not objectKey
-000152b0: 3a0a 2020 2020 2020 2020 2020 2020 6f62  :.            ob
-000152c0: 6a65 6374 4b65 7920 3d20 6f73 2e70 6174  jectKey = os.pat
-000152d0: 682e 7370 6c69 7428 6669 6c65 5f70 6174  h.split(file_pat
-000152e0: 6829 5b31 5d0a 0a20 2020 2020 2020 2073  h)[1]..        s
-000152f0: 697a 6520 3d20 7574 696c 2e74 6f5f 6c6f  ize = util.to_lo
-00015300: 6e67 286f 732e 7061 7468 2e67 6574 7369  ng(os.path.getsi
-00015310: 7a65 2866 696c 655f 7061 7468 2929 0a0a  ze(file_path))..
-00015320: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
-00015330: 3d20 7365 6c66 2e5f 7075 7446 696c 6548  = self._putFileH
-00015340: 616e 646c 6548 6561 6465 7228 6865 6164  andleHeader(head
-00015350: 6572 732c 2073 697a 652c 206f 626a 6563  ers, size, objec
-00015360: 744b 6579 2c20 6669 6c65 5f70 6174 6829  tKey, file_path)
-00015370: 0a0a 2020 2020 2020 2020 5f68 6561 6465  ..        _heade
-00015380: 7273 203d 2073 656c 662e 636f 6e76 6572  rs = self.conver
-00015390: 746f 722e 7472 616e 735f 7075 745f 6f62  tor.trans_put_ob
-000153a0: 6a65 6374 286d 6574 6164 6174 613d 6d65  ject(metadata=me
-000153b0: 7461 6461 7461 2c20 6865 6164 6572 733d  tadata, headers=
-000153c0: 6865 6164 6572 7329 0a20 2020 2020 2020  headers).       
-000153d0: 2069 6620 636f 6e73 742e 434f 4e54 454e   if const.CONTEN
-000153e0: 545f 4c45 4e47 5448 5f48 4541 4445 5220  T_LENGTH_HEADER 
-000153f0: 6e6f 7420 696e 205f 6865 6164 6572 733a  not in _headers:
-00015400: 0a20 2020 2020 2020 2020 2020 205f 6865  .            _he
-00015410: 6164 6572 735b 636f 6e73 742e 434f 4e54  aders[const.CONT
-00015420: 454e 545f 4c45 4e47 5448 5f48 4541 4445  ENT_LENGTH_HEADE
-00015430: 525d 203d 2075 7469 6c2e 746f 5f73 7472  R] = util.to_str
-00015440: 696e 6728 7369 7a65 290a 2020 2020 2020  ing(size).      
-00015450: 2020 7365 6c66 2e6c 6f67 5f63 6c69 656e    self.log_clien
-00015460: 742e 6c6f 6728 4445 4255 472c 2027 7365  t.log(DEBUG, 'se
-00015470: 6e64 2050 6174 683a 2573 2720 2520 6669  nd Path:%s' % fi
-00015480: 6c65 5f70 6174 6829 0a0a 2020 2020 2020  le_path)..      
-00015490: 2020 746f 7461 6c43 6f75 6e74 203d 2075    totalCount = u
-000154a0: 7469 6c2e 746f 5f6c 6f6e 6728 6865 6164  til.to_long(head
-000154b0: 6572 735b 2763 6f6e 7465 6e74 4c65 6e67  ers['contentLeng
-000154c0: 7468 275d 2920 6966 2068 6561 6465 7273  th']) if headers
-000154d0: 2e67 6574 2827 636f 6e74 656e 744c 656e  .get('contentLen
-000154e0: 6774 6827 2920 6973 206e 6f74 204e 6f6e  gth') is not Non
-000154f0: 6520 5c0a 2020 2020 2020 2020 2020 2020  e \.            
-00015500: 656c 7365 206f 732e 7061 7468 2e67 6574  else os.path.get
-00015510: 7369 7a65 2866 696c 655f 7061 7468 290a  size(file_path).
-00015520: 2020 2020 2020 2020 6966 2074 6f74 616c          if total
-00015530: 436f 756e 7420 3e20 3020 616e 6420 7072  Count > 0 and pr
-00015540: 6f67 7265 7373 4361 6c6c 6261 636b 2069  ogressCallback i
-00015550: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00015560: 2020 2020 2020 2020 6e6f 7469 6669 6572          notifier
-00015570: 203d 2070 726f 6772 6573 732e 5072 6f67   = progress.Prog
-00015580: 7265 7373 4e6f 7469 6669 6572 2870 726f  ressNotifier(pro
-00015590: 6772 6573 7343 616c 6c62 6163 6b2c 2074  gressCallback, t
-000155a0: 6f74 616c 436f 756e 7429 0a20 2020 2020  otalCount).     
-000155b0: 2020 2020 2020 2072 6561 6461 626c 6520         readable 
-000155c0: 3d20 5472 7565 0a20 2020 2020 2020 2065  = True.        e
-000155d0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000155e0: 206e 6f74 6966 6965 7220 3d20 7072 6f67   notifier = prog
-000155f0: 7265 7373 2e4e 4f4e 455f 4e4f 5449 4649  ress.NONE_NOTIFI
-00015600: 4552 0a20 2020 2020 2020 2020 2020 2072  ER.            r
-00015610: 6561 6461 626c 6520 3d20 4661 6c73 650a  eadable = False.
-00015620: 0a20 2020 2020 2020 2065 6e74 6974 7920  .        entity 
-00015630: 3d20 7574 696c 2e67 6574 5f65 6e74 6974  = util.get_entit
-00015640: 795f 666f 725f 7365 6e64 5f77 6974 685f  y_for_send_with_
-00015650: 746f 7461 6c5f 636f 756e 7428 6669 6c65  total_count(file
-00015660: 5f70 6174 682c 2074 6f74 616c 436f 756e  _path, totalCoun
-00015670: 742c 204e 6f6e 652c 2073 656c 662e 6368  t, None, self.ch
-00015680: 756e 6b5f 7369 7a65 2c20 6e6f 7469 6669  unk_size, notifi
-00015690: 6572 290a 2020 2020 2020 2020 7472 793a  er).        try:
-000156a0: 0a20 2020 2020 2020 2020 2020 206e 6f74  .            not
-000156b0: 6966 6965 722e 7374 6172 7428 290a 2020  ifier.start().  
-000156c0: 2020 2020 2020 2020 2020 7265 7420 3d20            ret = 
-000156d0: 7365 6c66 2e5f 6d61 6b65 5f70 7574 5f72  self._make_put_r
-000156e0: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
-000156f0: 652c 206f 626a 6563 744b 6579 2c20 6865  e, objectKey, he
-00015700: 6164 6572 733d 5f68 6561 6465 7273 2c20  aders=_headers, 
-00015710: 656e 7469 7479 3d65 6e74 6974 792c 0a20  entity=entity,. 
-00015720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015740: 2020 2020 2020 2020 6d65 7468 6f64 4e61          methodNa
-00015750: 6d65 3d27 7075 7443 6f6e 7465 6e74 272c  me='putContent',
-00015760: 2072 6561 6461 626c 653d 7265 6164 6162   readable=readab
-00015770: 6c65 2c20 6578 7465 6e73 696f 6e48 6561  le, extensionHea
-00015780: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
-00015790: 6164 6572 7329 0a20 2020 2020 2020 2066  aders).        f
-000157a0: 696e 616c 6c79 3a0a 2020 2020 2020 2020  inally:.        
-000157b0: 2020 2020 6e6f 7469 6669 6572 2e65 6e64      notifier.end
-000157c0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-000157d0: 5f67 656e 6572 6174 655f 6f62 6a65 6374  _generate_object
-000157e0: 5f75 726c 2872 6574 2c20 6275 636b 6574  _url(ret, bucket
-000157f0: 4e61 6d65 2c20 6f62 6a65 6374 4b65 7929  Name, objectKey)
-00015800: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00015810: 7265 740a 0a20 2020 2040 7374 6174 6963  ret..    @static
-00015820: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
-00015830: 7075 7446 696c 6548 616e 646c 6548 6561  putFileHandleHea
-00015840: 6465 7228 6865 6164 6572 732c 2073 697a  der(headers, siz
-00015850: 652c 206f 626a 6563 744b 6579 2c20 6669  e, objectKey, fi
-00015860: 6c65 5f70 6174 6829 3a0a 2020 2020 2020  le_path):.      
-00015870: 2020 6865 6164 6572 735b 2763 6f6e 7465    headers['conte
-00015880: 6e74 4c65 6e67 7468 275d 203d 2075 7469  ntLength'] = uti
-00015890: 6c2e 746f 5f6c 6f6e 6728 6865 6164 6572  l.to_long(header
-000158a0: 732e 6765 7428 2763 6f6e 7465 6e74 4c65  s.get('contentLe
-000158b0: 6e67 7468 2729 290a 2020 2020 2020 2020  ngth')).        
-000158c0: 6966 2068 6561 6465 7273 2e67 6574 2827  if headers.get('
-000158d0: 636f 6e74 656e 744c 656e 6774 6827 2920  contentLength') 
-000158e0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-000158f0: 2020 2020 2020 2020 2068 6561 6465 7273           headers
-00015900: 5b27 636f 6e74 656e 744c 656e 6774 6827  ['contentLength'
-00015910: 5d20 3d20 7369 7a65 2069 6620 6865 6164  ] = size if head
-00015920: 6572 735b 2763 6f6e 7465 6e74 4c65 6e67  ers['contentLeng
-00015930: 7468 275d 203e 2073 697a 6520 656c 7365  th'] > size else
-00015940: 2068 6561 6465 7273 5b27 636f 6e74 656e   headers['conten
-00015950: 744c 656e 6774 6827 5d0a 0a20 2020 2020  tLength']..     
-00015960: 2020 2069 6620 6865 6164 6572 732e 6765     if headers.ge
-00015970: 7428 2763 6f6e 7465 6e74 5479 7065 2729  t('contentType')
-00015980: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00015990: 2020 2020 2020 6865 6164 6572 735b 2763        headers['c
-000159a0: 6f6e 7465 6e74 5479 7065 275d 203d 2063  ontentType'] = c
-000159b0: 6f6e 7374 2e4d 494d 455f 5459 5045 532e  onst.MIME_TYPES.
-000159c0: 6765 7428 6f62 6a65 6374 4b65 795b 6f62  get(objectKey[ob
-000159d0: 6a65 6374 4b65 792e 7266 696e 6428 272e  jectKey.rfind('.
-000159e0: 2729 202b 2031 3a5d 2e6c 6f77 6572 2829  ') + 1:].lower()
-000159f0: 290a 0a20 2020 2020 2020 2069 6620 6865  )..        if he
-00015a00: 6164 6572 732e 6765 7428 2763 6f6e 7465  aders.get('conte
-00015a10: 6e74 5479 7065 2729 2069 7320 4e6f 6e65  ntType') is None
-00015a20: 3a0a 2020 2020 2020 2020 2020 2020 6865  :.            he
-00015a30: 6164 6572 735b 2763 6f6e 7465 6e74 5479  aders['contentTy
-00015a40: 7065 275d 203d 2063 6f6e 7374 2e4d 494d  pe'] = const.MIM
-00015a50: 455f 5459 5045 532e 6765 7428 6669 6c65  E_TYPES.get(file
-00015a60: 5f70 6174 685b 6669 6c65 5f70 6174 682e  _path[file_path.
-00015a70: 7266 696e 6428 272e 2729 202b 2031 3a5d  rfind('.') + 1:]
-00015a80: 2e6c 6f77 6572 2829 290a 2020 2020 2020  .lower()).      
-00015a90: 2020 7265 7475 726e 2068 6561 6465 7273    return headers
-00015aa0: 0a0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
-00015ab0: 686f 640a 2020 2020 6465 6620 5f67 6574  hod.    def _get
-00015ac0: 5f6f 6666 7365 7428 6f66 6673 6574 2c20  _offset(offset, 
-00015ad0: 6669 6c65 5f73 697a 6529 3a0a 2020 2020  file_size):.    
-00015ae0: 2020 2020 6f66 6673 6574 203d 206f 6666      offset = off
-00015af0: 7365 7420 6966 206f 6666 7365 7420 6973  set if offset is
-00015b00: 206e 6f74 204e 6f6e 6520 616e 6420 3020   not None and 0 
-00015b10: 3c3d 206f 6666 7365 7420 3c20 6669 6c65  <= offset < file
-00015b20: 5f73 697a 6520 656c 7365 2030 0a20 2020  _size else 0.   
-00015b30: 2020 2020 2072 6574 7572 6e20 6f66 6673       return offs
-00015b40: 6574 0a0a 2020 2020 4073 7461 7469 636d  et..    @staticm
-00015b50: 6574 686f 640a 2020 2020 6465 6620 5f67  ethod.    def _g
-00015b60: 6574 5f70 6172 745f 7369 7a65 2870 6172  et_part_size(par
-00015b70: 7453 697a 652c 2066 696c 655f 7369 7a65  tSize, file_size
-00015b80: 2c20 6f66 6673 6574 293a 0a20 2020 2020  , offset):.     
-00015b90: 2020 2070 6172 7453 697a 6520 3d20 7061     partSize = pa
-00015ba0: 7274 5369 7a65 2069 6620 7061 7274 5369  rtSize if partSi
-00015bb0: 7a65 2069 7320 6e6f 7420 4e6f 6e65 2061  ze is not None a
-00015bc0: 6e64 2030 203c 2070 6172 7453 697a 6520  nd 0 < partSize 
-00015bd0: 3c3d 2028 6669 6c65 5f73 697a 6520 2d20  <= (file_size - 
-00015be0: 6f66 6673 6574 2920 656c 7365 2066 696c  offset) else fil
-00015bf0: 655f 7369 7a65 202d 206f 6666 7365 740a  e_size - offset.
-00015c00: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-00015c10: 6172 7453 697a 650a 0a20 2020 2064 6566  artSize..    def
-00015c20: 205f 7072 6570 6172 655f 6865 6164 6572   _prepare_header
-00015c30: 7328 7365 6c66 2c20 6d64 352c 2069 7341  s(self, md5, isA
-00015c40: 7474 6163 684d 6435 2c20 6669 6c65 5f70  ttachMd5, file_p
-00015c50: 6174 682c 2070 6172 7453 697a 652c 206f  ath, partSize, o
-00015c60: 6666 7365 742c 2073 7365 4865 6164 6572  ffset, sseHeader
-00015c70: 2c20 6865 6164 6572 7329 3a0a 2020 2020  , headers):.    
-00015c80: 2020 2020 6966 206d 6435 3a0a 2020 2020      if md5:.    
-00015c90: 2020 2020 2020 2020 6865 6164 6572 735b          headers[
-00015ca0: 636f 6e73 742e 434f 4e54 454e 545f 4d44  const.CONTENT_MD
-00015cb0: 355f 4845 4144 4552 5d20 3d20 6d64 350a  5_HEADER] = md5.
-00015cc0: 2020 2020 2020 2020 656c 6966 2069 7341          elif isA
-00015cd0: 7474 6163 684d 6435 3a0a 2020 2020 2020  ttachMd5:.      
-00015ce0: 2020 2020 2020 6865 6164 6572 735b 636f        headers[co
-00015cf0: 6e73 742e 434f 4e54 454e 545f 4d44 355f  nst.CONTENT_MD5_
-00015d00: 4845 4144 4552 5d20 3d20 7574 696c 2e62  HEADER] = util.b
-00015d10: 6173 6536 345f 656e 636f 6465 280a 2020  ase64_encode(.  
-00015d20: 2020 2020 2020 2020 2020 2020 2020 7574                ut
-00015d30: 696c 2e6d 6435 5f66 696c 655f 656e 636f  il.md5_file_enco
-00015d40: 6465 5f62 795f 7369 7a65 5f6f 6666 7365  de_by_size_offse
-00015d50: 7428 6669 6c65 5f70 6174 682c 2070 6172  t(file_path, par
-00015d60: 7453 697a 652c 206f 6666 7365 742c 2073  tSize, offset, s
-00015d70: 656c 662e 6368 756e 6b5f 7369 7a65 2929  elf.chunk_size))
-00015d80: 0a0a 2020 2020 2020 2020 6966 2073 7365  ..        if sse
-00015d90: 4865 6164 6572 2069 7320 6e6f 7420 4e6f  Header is not No
-00015da0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00015db0: 7365 6c66 2e63 6f6e 7665 7274 6f72 2e5f  self.convertor._
-00015dc0: 7365 745f 7373 655f 6865 6164 6572 2873  set_sse_header(s
-00015dd0: 7365 4865 6164 6572 2c20 6865 6164 6572  seHeader, header
-00015de0: 732c 2054 7275 6529 0a0a 2020 2020 2020  s, True)..      
-00015df0: 2020 7265 7475 726e 2068 6561 6465 7273    return headers
-00015e00: 0a0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
-00015e10: 686f 640a 2020 2020 6465 6620 5f70 7265  hod.    def _pre
-00015e20: 7061 7265 5f75 706c 6f61 645f 7061 7274  pare_upload_part
-00015e30: 5f6e 6f74 6966 6965 7228 7061 7274 5369  _notifier(partSi
-00015e40: 7a65 2c20 7072 6f67 7265 7373 4361 6c6c  ze, progressCall
-00015e50: 6261 636b 2c20 7265 6164 6162 6c65 293a  back, readable):
-00015e60: 0a20 2020 2020 2020 2069 6620 7061 7274  .        if part
-00015e70: 5369 7a65 203e 2030 2061 6e64 2070 726f  Size > 0 and pro
-00015e80: 6772 6573 7343 616c 6c62 6163 6b20 6973  gressCallback is
-00015e90: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00015ea0: 2020 2020 2020 2072 6561 6461 626c 6520         readable 
-00015eb0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-00015ec0: 2020 206e 6f74 6966 6965 7220 3d20 7072     notifier = pr
-00015ed0: 6f67 7265 7373 2e50 726f 6772 6573 734e  ogress.ProgressN
-00015ee0: 6f74 6966 6965 7228 7072 6f67 7265 7373  otifier(progress
-00015ef0: 4361 6c6c 6261 636b 2c20 7061 7274 5369  Callback, partSi
-00015f00: 7a65 290a 2020 2020 2020 2020 656c 7365  ze).        else
-00015f10: 3a0a 2020 2020 2020 2020 2020 2020 6e6f  :.            no
-00015f20: 7469 6669 6572 203d 2070 726f 6772 6573  tifier = progres
-00015f30: 732e 4e4f 4e45 5f4e 4f54 4946 4945 520a  s.NONE_NOTIFIER.
-00015f40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00015f50: 7265 6164 6162 6c65 2c20 6e6f 7469 6669  readable, notifi
-00015f60: 6572 0a0a 2020 2020 6465 6620 5f67 6574  er..    def _get
-00015f70: 5f68 6561 6465 7273 2873 656c 662c 206d  _headers(self, m
-00015f80: 6435 2c20 7373 6548 6561 6465 722c 2068  d5, sseHeader, h
-00015f90: 6561 6465 7273 293a 0a20 2020 2020 2020  eaders):.       
-00015fa0: 2069 6620 6d64 353a 0a20 2020 2020 2020   if md5:.       
-00015fb0: 2020 2020 2068 6561 6465 7273 5b63 6f6e       headers[con
-00015fc0: 7374 2e43 4f4e 5445 4e54 5f4d 4435 5f48  st.CONTENT_MD5_H
-00015fd0: 4541 4445 525d 203d 206d 6435 0a20 2020  EADER] = md5.   
-00015fe0: 2020 2020 2069 6620 7373 6548 6561 6465       if sseHeade
-00015ff0: 7220 6973 206e 6f74 204e 6f6e 653a 0a20  r is not None:. 
-00016000: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00016010: 636f 6e76 6572 746f 722e 5f73 6574 5f73  convertor._set_s
-00016020: 7365 5f68 6561 6465 7228 7373 6548 6561  se_header(sseHea
-00016030: 6465 722c 2068 6561 6465 7273 2c20 5472  der, headers, Tr
-00016040: 7565 290a 0a20 2020 2020 2020 2072 6574  ue)..        ret
-00016050: 7572 6e20 6865 6164 6572 730a 0a20 2020  urn headers..   
-00016060: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
-00016070: 2020 2064 6566 205f 6765 745f 6e6f 7469     def _get_noti
-00016080: 6669 6572 5f77 6974 686f 7574 5f73 697a  fier_without_siz
-00016090: 6528 7072 6f67 7265 7373 4361 6c6c 6261  e(progressCallba
-000160a0: 636b 293a 0a20 2020 2020 2020 2072 6574  ck):.        ret
-000160b0: 7572 6e20 7072 6f67 7265 7373 2e50 726f  urn progress.Pro
-000160c0: 6772 6573 734e 6f74 6966 6965 7228 7072  gressNotifier(pr
-000160d0: 6f67 7265 7373 4361 6c6c 6261 636b 2c0a  ogressCallback,.
-000160e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000160f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016100: 2020 2020 2020 2020 202d 3129 2069 6620           -1) if 
-00016110: 7072 6f67 7265 7373 4361 6c6c 6261 636b  progressCallback
-00016120: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
-00016130: 6520 7072 6f67 7265 7373 2e4e 4f4e 455f  e progress.NONE_
-00016140: 4e4f 5449 4649 4552 0a0a 2020 2020 4073  NOTIFIER..    @s
-00016150: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-00016160: 6465 6620 5f67 6574 5f6e 6f74 6966 6965  def _get_notifie
-00016170: 725f 7769 7468 5f73 697a 6528 7072 6f67  r_with_size(prog
-00016180: 7265 7373 4361 6c6c 6261 636b 2c20 746f  ressCallback, to
-00016190: 7461 6c43 6f75 6e74 293a 0a20 2020 2020  talCount):.     
-000161a0: 2020 2072 6574 7572 6e20 7072 6f67 7265     return progre
-000161b0: 7373 2e50 726f 6772 6573 734e 6f74 6966  ss.ProgressNotif
-000161c0: 6965 7228 7072 6f67 7265 7373 4361 6c6c  ier(progressCall
-000161d0: 6261 636b 2c0a 2020 2020 2020 2020 2020  back,.          
-000161e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161f0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00016200: 6f74 616c 436f 756e 7429 2069 6620 746f  otalCount) if to
-00016210: 7461 6c43 6f75 6e74 203e 2030 2061 6e64  talCount > 0 and
-00016220: 2070 726f 6772 6573 7343 616c 6c62 6163   progressCallbac
-00016230: 6b20 6973 206e 6f74 204e 6f6e 6520 5c0a  k is not None \.
-00016240: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00016250: 2070 726f 6772 6573 732e 4e4f 4e45 5f4e   progress.NONE_N
-00016260: 4f54 4946 4945 520a 0a20 2020 2064 6566  OTIFIER..    def
-00016270: 205f 6368 6563 6b5f 6669 6c65 5f70 6172   _check_file_par
-00016280: 745f 696e 666f 2873 656c 662c 2066 696c  t_info(self, fil
-00016290: 655f 7061 7468 2c20 6f66 6673 6574 2c20  e_path, offset, 
-000162a0: 7061 7274 5369 7a65 293a 0a20 2020 2020  partSize):.     
-000162b0: 2020 2066 696c 655f 7061 7274 5f69 6e66     file_part_inf
-000162c0: 6f20 3d20 6469 6374 2829 0a20 2020 2020  o = dict().     
-000162d0: 2020 2066 696c 655f 7061 7274 5f69 6e66     file_part_inf
-000162e0: 6f5b 2266 696c 655f 7061 7468 225d 203d  o["file_path"] =
-000162f0: 2073 656c 662e 6368 6563 6b5f 6669 6c65   self.check_file
-00016300: 5f70 6174 6828 6669 6c65 5f70 6174 6829  _path(file_path)
-00016310: 0a20 2020 2020 2020 2066 696c 655f 7369  .        file_si
-00016320: 7a65 203d 2075 7469 6c2e 746f 5f6c 6f6e  ze = util.to_lon
-00016330: 6728 6f73 2e70 6174 682e 6765 7473 697a  g(os.path.getsiz
-00016340: 6528 6669 6c65 5f70 6174 6829 290a 2020  e(file_path)).  
-00016350: 2020 2020 2020 6f66 6673 6574 203d 2075        offset = u
-00016360: 7469 6c2e 746f 5f6c 6f6e 6728 6f66 6673  til.to_long(offs
-00016370: 6574 290a 2020 2020 2020 2020 6669 6c65  et).        file
-00016380: 5f70 6172 745f 696e 666f 5b22 6f66 6673  _part_info["offs
-00016390: 6574 225d 203d 2073 656c 662e 5f67 6574  et"] = self._get
-000163a0: 5f6f 6666 7365 7428 6f66 6673 6574 2c20  _offset(offset, 
-000163b0: 6669 6c65 5f73 697a 6529 0a20 2020 2020  file_size).     
-000163c0: 2020 2070 6172 7453 697a 6520 3d20 7574     partSize = ut
-000163d0: 696c 2e74 6f5f 6c6f 6e67 2870 6172 7453  il.to_long(partS
-000163e0: 697a 6529 0a20 2020 2020 2020 2066 696c  ize).        fil
-000163f0: 655f 7061 7274 5f69 6e66 6f5b 2270 6172  e_part_info["par
-00016400: 7453 697a 6522 5d20 3d20 7365 6c66 2e5f  tSize"] = self._
-00016410: 6765 745f 7061 7274 5f73 697a 6528 7061  get_part_size(pa
-00016420: 7274 5369 7a65 2c20 6669 6c65 5f73 697a  rtSize, file_siz
-00016430: 652c 206f 6666 7365 7429 0a20 2020 2020  e, offset).     
-00016440: 2020 2072 6574 7572 6e20 6669 6c65 5f70     return file_p
-00016450: 6172 745f 696e 666f 0a0a 2020 2020 4066  art_info..    @f
-00016460: 756e 6343 6163 6865 0a20 2020 2064 6566  uncCache.    def
-00016470: 2075 706c 6f61 6450 6172 7428 7365 6c66   uploadPart(self
-00016480: 2c20 6275 636b 6574 4e61 6d65 2c20 6f62  , bucketName, ob
-00016490: 6a65 6374 4b65 792c 2070 6172 744e 756d  jectKey, partNum
-000164a0: 6265 722c 2075 706c 6f61 6449 642c 206f  ber, uploadId, o
-000164b0: 626a 6563 743d 4e6f 6e65 2c20 6973 4669  bject=None, isFi
-000164c0: 6c65 3d46 616c 7365 2c20 7061 7274 5369  le=False, partSi
-000164d0: 7a65 3d4e 6f6e 652c 0a20 2020 2020 2020  ze=None,.       
-000164e0: 2020 2020 2020 2020 2020 2020 6f66 6673              offs
-000164f0: 6574 3d30 2c20 7373 6548 6561 6465 723d  et=0, sseHeader=
-00016500: 4e6f 6e65 2c20 6973 4174 7461 6368 4d64  None, isAttachMd
-00016510: 353d 4661 6c73 652c 206d 6435 3d4e 6f6e  5=False, md5=Non
-00016520: 652c 2063 6f6e 7465 6e74 3d4e 6f6e 652c  e, content=None,
-00016530: 2070 726f 6772 6573 7343 616c 6c62 6163   progressCallbac
-00016540: 6b3d 4e6f 6e65 2c0a 2020 2020 2020 2020  k=None,.        
-00016550: 2020 2020 2020 2020 2020 2061 7574 6f43             autoC
-00016560: 6c6f 7365 3d54 7275 652c 2065 7874 656e  lose=True, exten
-00016570: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
-00016580: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-00016590: 5f61 7373 6572 745f 6e6f 745f 6e75 6c6c  _assert_not_null
-000165a0: 2870 6172 744e 756d 6265 722c 2027 7061  (partNumber, 'pa
-000165b0: 7274 4e75 6d62 6572 2069 7320 656d 7074  rtNumber is empt
-000165c0: 7927 290a 2020 2020 2020 2020 7365 6c66  y').        self
-000165d0: 2e5f 6173 7365 7274 5f6e 6f74 5f6e 756c  ._assert_not_nul
-000165e0: 6c28 7570 6c6f 6164 4964 2c20 2775 706c  l(uploadId, 'upl
-000165f0: 6f61 6449 6420 6973 2065 6d70 7479 2729  oadId is empty')
-00016600: 0a0a 2020 2020 2020 2020 6368 756e 6b65  ..        chunke
-00016610: 644d 6f64 6520 3d20 4661 6c73 650a 2020  dMode = False.  
-00016620: 2020 2020 2020 7265 6164 6162 6c65 203d        readable =
-00016630: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
-00016640: 6966 2063 6f6e 7465 6e74 2069 7320 4e6f  if content is No
-00016650: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00016660: 636f 6e74 656e 7420 3d20 6f62 6a65 6374  content = object
-00016670: 0a0a 2020 2020 2020 2020 6e6f 7469 6669  ..        notifi
-00016680: 6572 203d 204e 6f6e 650a 2020 2020 2020  er = None.      
-00016690: 2020 6966 2069 7346 696c 653a 0a20 2020    if isFile:.   
-000166a0: 2020 2020 2020 2020 2063 6865 636b 6564           checked
-000166b0: 5f66 696c 655f 7061 7274 5f69 6e66 6f20  _file_part_info 
-000166c0: 3d20 7365 6c66 2e5f 6368 6563 6b5f 6669  = self._check_fi
-000166d0: 6c65 5f70 6172 745f 696e 666f 2863 6f6e  le_part_info(con
-000166e0: 7465 6e74 2c20 6f66 6673 6574 2c20 7061  tent, offset, pa
-000166f0: 7274 5369 7a65 290a 0a20 2020 2020 2020  rtSize)..       
-00016700: 2020 2020 2068 6561 6465 7273 203d 207b       headers = {
-00016710: 636f 6e73 742e 434f 4e54 454e 545f 4c45  const.CONTENT_LE
-00016720: 4e47 5448 5f48 4541 4445 523a 2075 7469  NGTH_HEADER: uti
-00016730: 6c2e 746f 5f73 7472 696e 6728 6368 6563  l.to_string(chec
-00016740: 6b65 645f 6669 6c65 5f70 6172 745f 696e  ked_file_part_in
-00016750: 666f 5b22 7061 7274 5369 7a65 225d 297d  fo["partSize"])}
-00016760: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
-00016770: 6465 7273 203d 2073 656c 662e 5f70 7265  ders = self._pre
-00016780: 7061 7265 5f68 6561 6465 7273 286d 6435  pare_headers(md5
-00016790: 2c20 6973 4174 7461 6368 4d64 352c 2063  , isAttachMd5, c
-000167a0: 6865 636b 6564 5f66 696c 655f 7061 7274  hecked_file_part
-000167b0: 5f69 6e66 6f5b 2266 696c 655f 7061 7468  _info["file_path
-000167c0: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-000167d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000167e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000167f0: 6368 6563 6b65 645f 6669 6c65 5f70 6172  checked_file_par
-00016800: 745f 696e 666f 5b22 7061 7274 5369 7a65  t_info["partSize
-00016810: 225d 2c20 6368 6563 6b65 645f 6669 6c65  "], checked_file
-00016820: 5f70 6172 745f 696e 666f 5b22 6f66 6673  _part_info["offs
-00016830: 6574 225d 2c0a 2020 2020 2020 2020 2020  et"],.          
-00016840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016860: 2020 7373 6548 6561 6465 722c 2068 6561    sseHeader, hea
-00016870: 6465 7273 290a 0a20 2020 2020 2020 2020  ders)..         
-00016880: 2020 2072 6561 6461 626c 652c 206e 6f74     readable, not
-00016890: 6966 6965 7220 3d20 7365 6c66 2e5f 7072  ifier = self._pr
-000168a0: 6570 6172 655f 7570 6c6f 6164 5f70 6172  epare_upload_par
-000168b0: 745f 6e6f 7469 6669 6572 2863 6865 636b  t_notifier(check
-000168c0: 6564 5f66 696c 655f 7061 7274 5f69 6e66  ed_file_part_inf
-000168d0: 6f5b 2270 6172 7453 697a 6522 5d2c 0a20  o["partSize"],. 
-000168e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000168f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016920: 2020 2070 726f 6772 6573 7343 616c 6c62     progressCallb
-00016930: 6163 6b2c 2072 6561 6461 626c 6529 0a20  ack, readable). 
-00016940: 2020 2020 2020 2020 2020 2065 6e74 6974             entit
-00016950: 7920 3d20 7574 696c 2e67 6574 5f65 6e74  y = util.get_ent
-00016960: 6974 795f 666f 725f 7365 6e64 5f77 6974  ity_for_send_wit
-00016970: 685f 746f 7461 6c5f 636f 756e 7428 6368  h_total_count(ch
-00016980: 6563 6b65 645f 6669 6c65 5f70 6172 745f  ecked_file_part_
-00016990: 696e 666f 5b22 6669 6c65 5f70 6174 6822  info["file_path"
-000169a0: 5d2c 2063 6865 636b 6564 5f66 696c 655f  ], checked_file_
-000169b0: 7061 7274 5f69 6e66 6f5b 2270 6172 7453  part_info["partS
-000169c0: 697a 6522 5d2c 2063 6865 636b 6564 5f66  ize"], checked_f
-000169d0: 696c 655f 7061 7274 5f69 6e66 6f5b 226f  ile_part_info["o
-000169e0: 6666 7365 7422 5d2c 0a20 2020 2020 2020  ffset"],.       
-000169f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a20: 2020 2020 2020 2020 7365 6c66 2e63 6875          self.chu
-00016a30: 6e6b 5f73 697a 652c 206e 6f74 6966 6965  nk_size, notifie
-00016a40: 7229 0a20 2020 2020 2020 2065 6c73 653a  r).        else:
-00016a50: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
-00016a60: 6465 7273 203d 207b 7d0a 2020 2020 2020  ders = {}.      
-00016a70: 2020 2020 2020 6966 2063 6f6e 7465 6e74        if content
-00016a80: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00016a90: 2068 6173 6174 7472 2863 6f6e 7465 6e74   hasattr(content
-00016aa0: 2c20 2772 6561 6427 2920 616e 6420 6361  , 'read') and ca
-00016ab0: 6c6c 6162 6c65 2863 6f6e 7465 6e74 2e72  llable(content.r
-00016ac0: 6561 6429 3a0a 2020 2020 2020 2020 2020  ead):.          
-00016ad0: 2020 2020 2020 7265 6164 6162 6c65 203d        readable =
-00016ae0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00016af0: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
-00016b00: 7365 6c66 2e5f 6765 745f 6865 6164 6572  self._get_header
-00016b10: 7328 6d64 352c 2073 7365 4865 6164 6572  s(md5, sseHeader
-00016b20: 2c20 6865 6164 6572 7329 0a0a 2020 2020  , headers)..    
-00016b30: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00016b40: 6172 7453 697a 6520 6973 204e 6f6e 653a  artSize is None:
-00016b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016b60: 2020 2020 2073 656c 662e 6c6f 675f 636c       self.log_cl
-00016b70: 6965 6e74 2e6c 6f67 2844 4542 5547 2c20  ient.log(DEBUG, 
-00016b80: 276d 6973 7369 6e67 2070 6172 7453 697a  'missing partSiz
-00016b90: 6520 7768 656e 2075 706c 6f61 6469 6e67  e when uploading
-00016ba0: 2061 2072 6561 6461 626c 6520 7374 7265   a readable stre
-00016bb0: 616d 2729 0a20 2020 2020 2020 2020 2020  am').           
-00016bc0: 2020 2020 2020 2020 2063 6875 6e6b 6564           chunked
-00016bd0: 4d6f 6465 203d 2054 7275 650a 2020 2020  Mode = True.    
-00016be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016bf0: 6e6f 7469 6669 6572 203d 2073 656c 662e  notifier = self.
-00016c00: 5f67 6574 5f6e 6f74 6966 6965 725f 7769  _get_notifier_wi
-00016c10: 7468 6f75 745f 7369 7a65 2870 726f 6772  thout_size(progr
-00016c20: 6573 7343 616c 6c62 6163 6b29 0a20 2020  essCallback).   
-00016c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c40: 2065 6e74 6974 7920 3d20 7574 696c 2e67   entity = util.g
-00016c50: 6574 5f72 6561 6461 626c 655f 656e 7469  et_readable_enti
-00016c60: 7479 2863 6f6e 7465 6e74 2c20 7365 6c66  ty(content, self
-00016c70: 2e63 6875 6e6b 5f73 697a 652c 206e 6f74  .chunk_size, not
-00016c80: 6966 6965 722c 2061 7574 6f43 6c6f 7365  ifier, autoClose
-00016c90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00016ca0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00016cb0: 2020 2020 2020 2020 2020 2020 6865 6164              head
-00016cc0: 6572 735b 636f 6e73 742e 434f 4e54 454e  ers[const.CONTEN
-00016cd0: 545f 4c45 4e47 5448 5f48 4541 4445 525d  T_LENGTH_HEADER]
-00016ce0: 203d 2075 7469 6c2e 746f 5f73 7472 696e   = util.to_strin
-00016cf0: 6728 7061 7274 5369 7a65 290a 2020 2020  g(partSize).    
-00016d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d10: 746f 7461 6c43 6f75 6e74 203d 2075 7469  totalCount = uti
-00016d20: 6c2e 746f 5f6c 6f6e 6728 7061 7274 5369  l.to_long(partSi
-00016d30: 7a65 290a 2020 2020 2020 2020 2020 2020  ze).            
-00016d40: 2020 2020 2020 2020 6e6f 7469 6669 6572          notifier
-00016d50: 203d 2073 656c 662e 5f67 6574 5f6e 6f74   = self._get_not
-00016d60: 6966 6965 725f 7769 7468 5f73 697a 6528  ifier_with_size(
-00016d70: 7072 6f67 7265 7373 4361 6c6c 6261 636b  progressCallback
-00016d80: 2c20 746f 7461 6c43 6f75 6e74 290a 2020  , totalCount).  
-00016d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016da0: 2020 656e 7469 7479 203d 2075 7469 6c2e    entity = util.
-00016db0: 6765 745f 656e 7469 7479 5f66 6f72 5f73  get_entity_for_s
-00016dc0: 656e 645f 7769 7468 5f74 6f74 616c 5f63  end_with_total_c
-00016dd0: 6f75 6e74 2872 6561 645f 6162 6c65 3d63  ount(read_able=c
-00016de0: 6f6e 7465 6e74 2c20 746f 7461 6c43 6f75  ontent, totalCou
-00016df0: 6e74 3d74 6f74 616c 436f 756e 742c 0a20  nt=totalCount,. 
-00016e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e40: 2020 2020 2020 6368 756e 6b5f 7369 7a65        chunk_size
-00016e50: 3d73 656c 662e 6368 756e 6b5f 7369 7a65  =self.chunk_size
-00016e60: 2c20 6e6f 7469 6669 6572 3d6e 6f74 6966  , notifier=notif
-00016e70: 6965 722c 0a20 2020 2020 2020 2020 2020  ier,.           
+00013fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ff0: 2020 2020 2072 6561 6461 626c 6529 0a20       readable). 
+00014000: 2020 2020 2020 2020 2020 2068 6561 6465             heade
+00014010: 7273 203d 2073 656c 662e 636f 6e76 6572  rs = self.conver
+00014020: 746f 722e 7472 616e 735f 7075 745f 6f62  tor.trans_put_ob
+00014030: 6a65 6374 286d 6574 6164 6174 613d 6d65  ject(metadata=me
+00014040: 7461 6461 7461 2c20 6865 6164 6572 733d  tadata, headers=
+00014050: 6865 6164 6572 7329 0a20 2020 2020 2020  headers).       
+00014060: 2020 2020 2073 656c 662e 6c6f 675f 636c       self.log_cl
+00014070: 6965 6e74 2e6c 6f67 2844 4542 5547 2c20  ient.log(DEBUG, 
+00014080: 2773 656e 6420 5061 7468 3a25 7327 2025  'send Path:%s' %
+00014090: 2066 696c 655f 7061 7468 290a 2020 2020   file_path).    
+000140a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000140b0: 2020 2020 2020 656e 7469 7479 203d 2063        entity = c
+000140c0: 6f6e 7465 6e74 2e67 6574 2827 636f 6e74  ontent.get('cont
+000140d0: 656e 7427 290a 2020 2020 2020 2020 2020  ent').          
+000140e0: 2020 656e 7469 7479 2c20 7265 6164 6162    entity, readab
+000140f0: 6c65 2c20 6368 756e 6b65 644d 6f64 652c  le, chunkedMode,
+00014100: 206e 6f74 6966 6965 7220 3d20 7365 6c66   notifier = self
+00014110: 2e5f 7072 6570 6172 655f 636f 6e74 656e  ._prepare_conten
+00014120: 745f 6e6f 7469 6669 6572 5f61 6e64 5f65  t_notifier_and_e
+00014130: 6e74 6974 7928 656e 7469 7479 2c20 6865  ntity(entity, he
+00014140: 6164 6572 732c 0a20 2020 2020 2020 2020  aders,.         
+00014150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141a0: 2020 2020 2020 2070 726f 6772 6573 7343         progressC
+000141b0: 616c 6c62 6163 6b2c 0a20 2020 2020 2020  allback,.       
+000141c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014210: 2020 2020 2020 2020 2061 7574 6f43 6c6f           autoClo
+00014220: 7365 2c20 7265 6164 6162 6c65 2c0a 2020  se, readable,.  
+00014230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014280: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00014290: 756e 6b65 644d 6f64 652c 206e 6f74 6966  unkedMode, notif
+000142a0: 6965 7229 0a0a 2020 2020 2020 2020 2020  ier)..          
+000142b0: 2020 6865 6164 6572 7320 3d20 7365 6c66    headers = self
+000142c0: 2e63 6f6e 7665 7274 6f72 2e74 7261 6e73  .convertor.trans
+000142d0: 5f70 7574 5f6f 626a 6563 7428 6d65 7461  _put_object(meta
+000142e0: 6461 7461 3d6d 6574 6164 6174 612c 2068  data=metadata, h
+000142f0: 6561 6465 7273 3d68 6561 6465 7273 290a  eaders=headers).
+00014300: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00014310: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00014320: 6966 6965 7220 6973 206e 6f74 204e 6f6e  ifier is not Non
+00014330: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00014340: 2020 206e 6f74 6966 6965 722e 7374 6172     notifier.star
+00014350: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+00014360: 7265 7420 3d20 7365 6c66 2e5f 6d61 6b65  ret = self._make
+00014370: 5f70 6f73 745f 7265 7175 6573 7428 6275  _post_request(bu
+00014380: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
+00014390: 4b65 792c 2070 6174 6841 7267 733d 7b27  Key, pathArgs={'
+000143a0: 6170 7065 6e64 273a 204e 6f6e 652c 2027  append': None, '
+000143b0: 706f 7369 7469 6f6e 273a 2075 7469 6c2e  position': util.
+000143c0: 746f 5f73 7472 696e 6728 0a20 2020 2020  to_string(.     
+000143d0: 2020 2020 2020 2020 2020 2063 6f6e 7465             conte
+000143e0: 6e74 5b27 706f 7369 7469 6f6e 275d 2920  nt['position']) 
+000143f0: 6966 2063 6f6e 7465 6e74 2e67 6574 2827  if content.get('
+00014400: 706f 7369 7469 6f6e 2729 2069 7320 6e6f  position') is no
+00014410: 7420 4e6f 6e65 2065 6c73 6520 307d 2c0a  t None else 0},.
+00014420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014440: 2020 2020 2020 2020 2020 6865 6164 6572            header
+00014450: 733d 6865 6164 6572 732c 2065 6e74 6974  s=headers, entit
+00014460: 793d 656e 7469 7479 2c20 6368 756e 6b65  y=entity, chunke
+00014470: 644d 6f64 653d 6368 756e 6b65 644d 6f64  dMode=chunkedMod
+00014480: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00014490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144a0: 2020 2020 2020 2020 2020 2020 206d 6574               met
+000144b0: 686f 644e 616d 653d 2761 7070 656e 644f  hodName='appendO
+000144c0: 626a 6563 7427 2c20 7265 6164 6162 6c65  bject', readable
+000144d0: 3d72 6561 6461 626c 652c 0a20 2020 2020  =readable,.     
+000144e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014500: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
+00014510: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+00014520: 6561 6465 7273 290a 2020 2020 2020 2020  eaders).        
+00014530: 6669 6e61 6c6c 793a 0a20 2020 2020 2020  finally:.       
+00014540: 2020 2020 2069 6620 6e6f 7469 6669 6572       if notifier
+00014550: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00014560: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+00014570: 7469 6669 6572 2e65 6e64 2829 0a20 2020  tifier.end().   
+00014580: 2020 2020 2073 656c 662e 5f67 656e 6572       self._gener
+00014590: 6174 655f 6f62 6a65 6374 5f75 726c 2872  ate_object_url(r
+000145a0: 6574 2c20 6275 636b 6574 4e61 6d65 2c20  et, bucketName, 
+000145b0: 6f62 6a65 6374 4b65 7929 0a20 2020 2020  objectKey).     
+000145c0: 2020 2072 6574 7572 6e20 7265 740a 0a20     return ret.. 
+000145d0: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
+000145e0: 2020 6465 6620 7075 7443 6f6e 7465 6e74    def putContent
+000145f0: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
+00014600: 652c 206f 626a 6563 744b 6579 2c20 636f  e, objectKey, co
+00014610: 6e74 656e 743d 4e6f 6e65 2c20 6d65 7461  ntent=None, meta
+00014620: 6461 7461 3d4e 6f6e 652c 2068 6561 6465  data=None, heade
+00014630: 7273 3d4e 6f6e 652c 2070 726f 6772 6573  rs=None, progres
+00014640: 7343 616c 6c62 6163 6b3d 4e6f 6e65 2c0a  sCallback=None,.
+00014650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014660: 2020 2061 7574 6f43 6c6f 7365 3d54 7275     autoClose=Tru
+00014670: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
+00014680: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
+00014690: 2020 206f 626a 6563 744b 6579 203d 2075     objectKey = u
+000146a0: 7469 6c2e 7361 6665 5f65 6e63 6f64 6528  til.safe_encode(
+000146b0: 6f62 6a65 6374 4b65 7929 0a20 2020 2020  objectKey).     
+000146c0: 2020 2069 6620 6f62 6a65 6374 4b65 7920     if objectKey 
+000146d0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+000146e0: 2020 2020 206f 626a 6563 744b 6579 203d       objectKey =
+000146f0: 2027 270a 2020 2020 2020 2020 6966 2068   ''.        if h
+00014700: 6561 6465 7273 2069 7320 4e6f 6e65 3a0a  eaders is None:.
+00014710: 2020 2020 2020 2020 2020 2020 6865 6164              head
+00014720: 6572 7320 3d20 5075 744f 626a 6563 7448  ers = PutObjectH
+00014730: 6561 6465 7228 290a 2020 2020 2020 2020  eader().        
+00014740: 6966 2068 6561 6465 7273 2e67 6574 2827  if headers.get('
+00014750: 636f 6e74 656e 7454 7970 6527 2920 6973  contentType') is
+00014760: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00014770: 2020 2068 6561 6465 7273 5b27 636f 6e74     headers['cont
+00014780: 656e 7454 7970 6527 5d20 3d20 636f 6e73  entType'] = cons
+00014790: 742e 4d49 4d45 5f54 5950 4553 2e67 6574  t.MIME_TYPES.get
+000147a0: 286f 626a 6563 744b 6579 5b6f 626a 6563  (objectKey[objec
+000147b0: 744b 6579 2e72 6669 6e64 2827 2e27 2920  tKey.rfind('.') 
+000147c0: 2b20 313a 5d2e 6c6f 7765 7228 2929 0a20  + 1:].lower()). 
+000147d0: 2020 2020 2020 205f 6865 6164 6572 7320         _headers 
+000147e0: 3d20 7365 6c66 2e63 6f6e 7665 7274 6f72  = self.convertor
+000147f0: 2e74 7261 6e73 5f70 7574 5f6f 626a 6563  .trans_put_objec
+00014800: 7428 6d65 7461 6461 7461 3d6d 6574 6164  t(metadata=metad
+00014810: 6174 612c 2068 6561 6465 7273 3d68 6561  ata, headers=hea
+00014820: 6465 7273 290a 0a20 2020 2020 2020 2072  ders)..        r
+00014830: 6561 6461 626c 6520 3d20 4661 6c73 650a  eadable = False.
+00014840: 2020 2020 2020 2020 6368 756e 6b65 644d          chunkedM
+00014850: 6f64 6520 3d20 4661 6c73 650a 2020 2020  ode = False.    
+00014860: 2020 2020 6e6f 7469 6669 6572 203d 204e      notifier = N
+00014870: 6f6e 650a 0a20 2020 2020 2020 2074 7279  one..        try
+00014880: 3a0a 2020 2020 2020 2020 2020 2020 656e  :.            en
+00014890: 7469 7479 203d 2063 6f6e 7465 6e74 0a20  tity = content. 
+000148a0: 2020 2020 2020 2020 2020 2069 6620 656e             if en
+000148b0: 7469 7479 2069 7320 4e6f 6e65 3a0a 2020  tity is None:.  
+000148c0: 2020 2020 2020 2020 2020 2020 2020 656e                en
+000148d0: 7469 7479 203d 2027 270a 2020 2020 2020  tity = ''.      
+000148e0: 2020 2020 2020 656c 6966 2068 6173 6174        elif hasat
+000148f0: 7472 2865 6e74 6974 792c 2027 7265 6164  tr(entity, 'read
+00014900: 2729 2061 6e64 2063 616c 6c61 626c 6528  ') and callable(
+00014910: 656e 7469 7479 2e72 6561 6429 3a0a 2020  entity.read):.  
+00014920: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00014930: 6164 6162 6c65 203d 2054 7275 650a 2020  adable = True.  
+00014940: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00014950: 2068 6561 6465 7273 2e67 6574 2827 636f   headers.get('co
+00014960: 6e74 656e 744c 656e 6774 6827 2920 6973  ntentLength') is
+00014970: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00014980: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
+00014990: 6564 4d6f 6465 203d 2054 7275 650a 2020  edMode = True.  
+000149a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000149b0: 2020 6e6f 7469 6669 6572 203d 2070 726f    notifier = pro
+000149c0: 6772 6573 732e 5072 6f67 7265 7373 4e6f  gress.ProgressNo
+000149d0: 7469 6669 6572 2870 726f 6772 6573 7343  tifier(progressC
+000149e0: 616c 6c62 6163 6b2c 0a20 2020 2020 2020  allback,.       
+000149f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a20: 2020 2d31 2920 6966 2070 726f 6772 6573    -1) if progres
+00014a30: 7343 616c 6c62 6163 6b20 6973 206e 6f74  sCallback is not
+00014a40: 204e 6f6e 6520 656c 7365 2070 726f 6772   None else progr
+00014a50: 6573 732e 4e4f 4e45 5f4e 4f54 4946 4945  ess.NONE_NOTIFIE
+00014a60: 520a 2020 2020 2020 2020 2020 2020 2020  R.              
+00014a70: 2020 2020 2020 656e 7469 7479 203d 2075        entity = u
+00014a80: 7469 6c2e 6765 745f 7265 6164 6162 6c65  til.get_readable
+00014a90: 5f65 6e74 6974 7928 656e 7469 7479 2c20  _entity(entity, 
+00014aa0: 7365 6c66 2e63 6875 6e6b 5f73 697a 652c  self.chunk_size,
+00014ab0: 206e 6f74 6966 6965 722c 2061 7574 6f43   notifier, autoC
+00014ac0: 6c6f 7365 290a 2020 2020 2020 2020 2020  lose).          
+00014ad0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00014ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014af0: 746f 7461 6c43 6f75 6e74 203d 2075 7469  totalCount = uti
+00014b00: 6c2e 746f 5f6c 6f6e 6728 6865 6164 6572  l.to_long(header
+00014b10: 732e 6765 7428 2763 6f6e 7465 6e74 4c65  s.get('contentLe
+00014b20: 6e67 7468 2729 290a 2020 2020 2020 2020  ngth')).        
+00014b30: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
+00014b40: 6669 6572 203d 2070 726f 6772 6573 732e  fier = progress.
+00014b50: 5072 6f67 7265 7373 4e6f 7469 6669 6572  ProgressNotifier
+00014b60: 2870 726f 6772 6573 7343 616c 6c62 6163  (progressCallbac
+00014b70: 6b2c 0a20 2020 2020 2020 2020 2020 2020  k,.             
+00014b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ba0: 2020 2020 2020 2020 2020 2020 746f 7461              tota
+00014bb0: 6c43 6f75 6e74 2920 6966 2074 6f74 616c  lCount) if total
+00014bc0: 436f 756e 7420 3e20 3020 616e 6420 7072  Count > 0 and pr
+00014bd0: 6f67 7265 7373 4361 6c6c 6261 636b 205c  ogressCallback \
+00014be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c20: 2020 2020 2020 2020 2069 7320 6e6f 7420           is not 
+00014c30: 4e6f 6e65 2065 6c73 6520 7072 6f67 7265  None else progre
+00014c40: 7373 2e4e 4f4e 455f 4e4f 5449 4649 4552  ss.NONE_NOTIFIER
+00014c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014c60: 2020 2020 2065 6e74 6974 7920 3d20 7574       entity = ut
+00014c70: 696c 2e67 6574 5f65 6e74 6974 795f 666f  il.get_entity_fo
+00014c80: 725f 7365 6e64 5f77 6974 685f 746f 7461  r_send_with_tota
+00014c90: 6c5f 636f 756e 7428 7265 6164 5f61 626c  l_count(read_abl
+00014ca0: 653d 656e 7469 7479 2c20 746f 7461 6c43  e=entity, totalC
+00014cb0: 6f75 6e74 3d74 6f74 616c 436f 756e 742c  ount=totalCount,
+00014cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d00: 2020 2020 2020 2020 6368 756e 6b5f 7369          chunk_si
+00014d10: 7a65 3d73 656c 662e 6368 756e 6b5f 7369  ze=self.chunk_si
+00014d20: 7a65 2c20 6e6f 7469 6669 6572 3d6e 6f74  ze, notifier=not
+00014d30: 6966 6965 722c 0a20 2020 2020 2020 2020  ifier,.         
+00014d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d70: 2020 2020 2020 2020 2020 2020 2020 6175                au
+00014d80: 746f 5f63 6c6f 7365 3d61 7574 6f43 6c6f  to_close=autoClo
+00014d90: 7365 290a 0a20 2020 2020 2020 2020 2020  se)..           
+00014da0: 2020 2020 206e 6f74 6966 6965 722e 7374       notifier.st
+00014db0: 6172 7428 290a 2020 2020 2020 2020 2020  art().          
+00014dc0: 2020 7265 7420 3d20 7365 6c66 2e5f 6d61    ret = self._ma
+00014dd0: 6b65 5f70 7574 5f72 6571 7565 7374 2862  ke_put_request(b
+00014de0: 7563 6b65 744e 616d 652c 206f 626a 6563  ucketName, objec
+00014df0: 744b 6579 2c20 6865 6164 6572 733d 5f68  tKey, headers=_h
+00014e00: 6561 6465 7273 2c20 656e 7469 7479 3d65  eaders, entity=e
+00014e10: 6e74 6974 792c 0a20 2020 2020 2020 2020  ntity,.         
+00014e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e40: 6368 756e 6b65 644d 6f64 653d 6368 756e  chunkedMode=chun
+00014e50: 6b65 644d 6f64 652c 206d 6574 686f 644e  kedMode, methodN
+00014e60: 616d 653d 2770 7574 436f 6e74 656e 7427  ame='putContent'
+00014e70: 2c20 7265 6164 6162 6c65 3d72 6561 6461  , readable=reada
+00014e80: 626c 652c 0a20 2020 2020 2020 2020 2020  ble,.           
+00014e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ea0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00014eb0: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
+00014ec0: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
+00014ed0: 0a20 2020 2020 2020 2066 696e 616c 6c79  .        finally
+00014ee0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00014ef0: 206e 6f74 6966 6965 7220 6973 206e 6f74   notifier is not
+00014f00: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00014f10: 2020 2020 2020 206e 6f74 6966 6965 722e         notifier.
+00014f20: 656e 6428 290a 2020 2020 2020 2020 7365  end().        se
+00014f30: 6c66 2e5f 6765 6e65 7261 7465 5f6f 626a  lf._generate_obj
+00014f40: 6563 745f 7572 6c28 7265 742c 2062 7563  ect_url(ret, buc
+00014f50: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
+00014f60: 6579 290a 2020 2020 2020 2020 7265 7475  ey).        retu
+00014f70: 726e 2072 6574 0a0a 2020 2020 6465 6620  rn ret..    def 
+00014f80: 7075 744f 626a 6563 7428 7365 6c66 2c20  putObject(self, 
+00014f90: 6275 636b 6574 4e61 6d65 2c20 6f62 6a65  bucketName, obje
+00014fa0: 6374 4b65 792c 2063 6f6e 7465 6e74 2c20  ctKey, content, 
+00014fb0: 6d65 7461 6461 7461 3d4e 6f6e 652c 2068  metadata=None, h
+00014fc0: 6561 6465 7273 3d4e 6f6e 652c 2070 726f  eaders=None, pro
+00014fd0: 6772 6573 7343 616c 6c62 6163 6b3d 4e6f  gressCallback=No
+00014fe0: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+00014ff0: 2020 2020 2020 6175 746f 436c 6f73 653d        autoClose=
+00015000: 5472 7565 2c20 6578 7465 6e73 696f 6e48  True, extensionH
+00015010: 6561 6465 7273 3d4e 6f6e 6529 3a0a 2020  eaders=None):.  
+00015020: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00015030: 662e 7075 7443 6f6e 7465 6e74 2862 7563  f.putContent(buc
+00015040: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
+00015050: 6579 2c20 636f 6e74 656e 742c 206d 6574  ey, content, met
+00015060: 6164 6174 612c 2068 6561 6465 7273 2c20  adata, headers, 
+00015070: 7072 6f67 7265 7373 4361 6c6c 6261 636b  progressCallback
+00015080: 2c20 6175 746f 436c 6f73 652c 0a20 2020  , autoClose,.   
+00015090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150a0: 2020 2020 2020 2020 2020 2020 6578 7465              exte
+000150b0: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
+000150c0: 656e 7369 6f6e 4865 6164 6572 7329 0a0a  ensionHeaders)..
+000150d0: 2020 2020 4066 756e 6343 6163 6865 0a20      @funcCache. 
+000150e0: 2020 2064 6566 2070 7574 4669 6c65 2873     def putFile(s
+000150f0: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+00015100: 206f 626a 6563 744b 6579 2c20 6669 6c65   objectKey, file
+00015110: 5f70 6174 682c 206d 6574 6164 6174 613d  _path, metadata=
+00015120: 4e6f 6e65 2c20 6865 6164 6572 733d 4e6f  None, headers=No
+00015130: 6e65 2c20 7072 6f67 7265 7373 4361 6c6c  ne, progressCall
+00015140: 6261 636b 3d4e 6f6e 652c 0a20 2020 2020  back=None,.     
+00015150: 2020 2020 2020 2020 2020 2065 7874 656e             exten
+00015160: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
+00015170: 293a 0a20 2020 2020 2020 2066 696c 655f  ):.        file_
+00015180: 7061 7468 203d 2073 656c 662e 6368 6563  path = self.chec
+00015190: 6b5f 6669 6c65 5f70 6174 6828 6669 6c65  k_file_path(file
+000151a0: 5f70 6174 6829 0a20 2020 2020 2020 205f  _path).        _
+000151b0: 666c 6167 203d 206f 732e 7061 7468 2e69  flag = os.path.i
+000151c0: 7364 6972 2866 696c 655f 7061 7468 290a  sdir(file_path).
+000151d0: 0a20 2020 2020 2020 2069 6620 6865 6164  .        if head
+000151e0: 6572 7320 6973 204e 6f6e 653a 0a20 2020  ers is None:.   
+000151f0: 2020 2020 2020 2020 2068 6561 6465 7273           headers
+00015200: 203d 2050 7574 4f62 6a65 6374 4865 6164   = PutObjectHead
+00015210: 6572 2829 0a20 2020 2020 2020 2069 6620  er().        if 
+00015220: 6d65 7461 6461 7461 2069 7320 4e6f 6e65  metadata is None
+00015230: 3a0a 2020 2020 2020 2020 2020 2020 6d65  :.            me
+00015240: 7461 6461 7461 203d 2064 6963 7428 290a  tadata = dict().
+00015250: 0a20 2020 2020 2020 2069 6620 5f66 6c61  .        if _fla
+00015260: 673a 0a20 2020 2020 2020 2020 2020 2072  g:.            r
+00015270: 6573 756c 7473 203d 205b 5d0a 2020 2020  esults = [].    
+00015280: 2020 2020 2020 2020 666f 7220 6620 696e          for f in
+00015290: 206f 732e 6c69 7374 6469 7228 6669 6c65   os.listdir(file
+000152a0: 5f70 6174 6829 3a0a 2020 2020 2020 2020  _path):.        
+000152b0: 2020 2020 2020 2020 6865 6164 6572 735b          headers[
+000152c0: 2763 6f6e 7465 6e74 4c65 6e67 7468 275d  'contentLength']
+000152d0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+000152e0: 2020 2020 2020 2020 6865 6164 6572 735b          headers[
+000152f0: 276d 6435 275d 203d 204e 6f6e 650a 2020  'md5'] = None.  
+00015300: 2020 2020 2020 2020 2020 2020 2020 6865                he
+00015310: 6164 6572 735b 2763 6f6e 7465 6e74 5479  aders['contentTy
+00015320: 7065 275d 203d 204e 6f6e 650a 2020 2020  pe'] = None.    
+00015330: 2020 2020 2020 2020 2020 2020 6620 3d20              f = 
+00015340: 7574 696c 2e73 6166 655f 656e 636f 6465  util.safe_encode
+00015350: 2866 290a 2020 2020 2020 2020 2020 2020  (f).            
+00015360: 2020 2020 5f5f 6669 6c65 5f70 6174 6820      __file_path 
+00015370: 3d20 6f73 2e70 6174 682e 6a6f 696e 2866  = os.path.join(f
+00015380: 696c 655f 7061 7468 2c20 6629 0a20 2020  ile_path, f).   
+00015390: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000153a0: 6e6f 7420 636f 6e73 742e 4953 5f50 5954  not const.IS_PYT
+000153b0: 484f 4e32 3a0a 2020 2020 2020 2020 2020  HON2:.          
+000153c0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+000153d0: 206f 626a 6563 744b 6579 3a0a 2020 2020   objectKey:.    
+000153e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153f0: 2020 2020 6b65 7920 3d20 7574 696c 2e73      key = util.s
+00015400: 6166 655f 7472 616e 735f 746f 5f67 6232  afe_trans_to_gb2
+00015410: 3331 3228 277b 307d 2f27 2e66 6f72 6d61  312('{0}/'.forma
+00015420: 7428 6f73 2e70 6174 682e 7370 6c69 7428  t(os.path.split(
+00015430: 6669 6c65 5f70 6174 6829 5b31 5d29 202b  file_path)[1]) +
+00015440: 2066 290a 2020 2020 2020 2020 2020 2020   f).            
+00015450: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00015460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015470: 2020 2020 2020 6b65 7920 3d20 277b 307d        key = '{0}
+00015480: 2f27 2e66 6f72 6d61 7428 6f62 6a65 6374  /'.format(object
+00015490: 4b65 7929 202b 2075 7469 6c2e 7361 6665  Key) + util.safe
+000154a0: 5f74 7261 6e73 5f74 6f5f 6762 3233 3132  _trans_to_gb2312
+000154b0: 2866 290a 2020 2020 2020 2020 2020 2020  (f).            
+000154c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000154d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000154e0: 206e 6f74 206f 626a 6563 744b 6579 3a0a   not objectKey:.
+000154f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015500: 2020 2020 2020 2020 6b65 7920 3d20 7574          key = ut
+00015510: 696c 2e73 6166 655f 7472 616e 735f 746f  il.safe_trans_to
+00015520: 5f67 6232 3331 3228 277b 307d 2f27 2e66  _gb2312('{0}/'.f
+00015530: 6f72 6d61 7428 6f73 2e70 6174 682e 7370  ormat(os.path.sp
+00015540: 6c69 7428 6669 6c65 5f70 6174 6829 5b31  lit(file_path)[1
+00015550: 5d29 202b 2066 292e 6465 636f 6465 280a  ]) + f).decode(.
+00015560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015570: 2020 2020 2020 2020 2020 2020 2747 4232              'GB2
+00015580: 3331 3227 292e 656e 636f 6465 2827 5554  312').encode('UT
+00015590: 462d 3827 290a 2020 2020 2020 2020 2020  F-8').          
+000155a0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000155b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155c0: 2020 2020 2020 2020 6b65 7920 3d20 277b          key = '{
+000155d0: 307d 2f27 2e66 6f72 6d61 7428 6f62 6a65  0}/'.format(obje
+000155e0: 6374 4b65 7929 202b 2075 7469 6c2e 7361  ctKey) + util.sa
+000155f0: 6665 5f74 7261 6e73 5f74 6f5f 6762 3233  fe_trans_to_gb23
+00015600: 3132 2866 292e 6465 636f 6465 2827 4742  12(f).decode('GB
+00015610: 3233 3132 2729 2e65 6e63 6f64 6528 2755  2312').encode('U
+00015620: 5446 2d38 2729 0a20 2020 2020 2020 2020  TF-8').         
+00015630: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00015640: 7365 6c66 2e70 7574 4669 6c65 2862 7563  self.putFile(buc
+00015650: 6b65 744e 616d 652c 206b 6579 2c20 5f5f  ketName, key, __
+00015660: 6669 6c65 5f70 6174 682c 206d 6574 6164  file_path, metad
+00015670: 6174 612c 2068 6561 6465 7273 2c0a 2020  ata, headers,.  
+00015680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000156a0: 2020 2020 6578 7465 6e73 696f 6e48 6561      extensionHea
+000156b0: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
+000156c0: 6164 6572 7329 0a20 2020 2020 2020 2020  aders).         
+000156d0: 2020 2020 2020 2072 6573 756c 7473 2e61         results.a
+000156e0: 7070 656e 6428 286b 6579 2c20 7265 7375  ppend((key, resu
+000156f0: 6c74 2929 0a20 2020 2020 2020 2020 2020  lt)).           
+00015700: 2072 6574 7572 6e20 7265 7375 6c74 730a   return results.
+00015710: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00015720: 6f62 6a65 6374 4b65 793a 0a20 2020 2020  objectKey:.     
+00015730: 2020 2020 2020 206f 626a 6563 744b 6579         objectKey
+00015740: 203d 206f 732e 7061 7468 2e73 706c 6974   = os.path.split
+00015750: 2866 696c 655f 7061 7468 295b 315d 0a0a  (file_path)[1]..
+00015760: 2020 2020 2020 2020 7369 7a65 203d 2075          size = u
+00015770: 7469 6c2e 746f 5f6c 6f6e 6728 6f73 2e70  til.to_long(os.p
+00015780: 6174 682e 6765 7473 697a 6528 6669 6c65  ath.getsize(file
+00015790: 5f70 6174 6829 290a 0a20 2020 2020 2020  _path))..       
+000157a0: 2068 6561 6465 7273 203d 2073 656c 662e   headers = self.
+000157b0: 5f70 7574 4669 6c65 4861 6e64 6c65 4865  _putFileHandleHe
+000157c0: 6164 6572 2868 6561 6465 7273 2c20 7369  ader(headers, si
+000157d0: 7a65 2c20 6f62 6a65 6374 4b65 792c 2066  ze, objectKey, f
+000157e0: 696c 655f 7061 7468 290a 0a20 2020 2020  ile_path)..     
+000157f0: 2020 205f 6865 6164 6572 7320 3d20 7365     _headers = se
+00015800: 6c66 2e63 6f6e 7665 7274 6f72 2e74 7261  lf.convertor.tra
+00015810: 6e73 5f70 7574 5f6f 626a 6563 7428 6d65  ns_put_object(me
+00015820: 7461 6461 7461 3d6d 6574 6164 6174 612c  tadata=metadata,
+00015830: 2068 6561 6465 7273 3d68 6561 6465 7273   headers=headers
+00015840: 290a 2020 2020 2020 2020 6966 2063 6f6e  ).        if con
+00015850: 7374 2e43 4f4e 5445 4e54 5f4c 454e 4754  st.CONTENT_LENGT
+00015860: 485f 4845 4144 4552 206e 6f74 2069 6e20  H_HEADER not in 
+00015870: 5f68 6561 6465 7273 3a0a 2020 2020 2020  _headers:.      
+00015880: 2020 2020 2020 5f68 6561 6465 7273 5b63        _headers[c
+00015890: 6f6e 7374 2e43 4f4e 5445 4e54 5f4c 454e  onst.CONTENT_LEN
+000158a0: 4754 485f 4845 4144 4552 5d20 3d20 7574  GTH_HEADER] = ut
+000158b0: 696c 2e74 6f5f 7374 7269 6e67 2873 697a  il.to_string(siz
+000158c0: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
+000158d0: 6c6f 675f 636c 6965 6e74 2e6c 6f67 2844  log_client.log(D
+000158e0: 4542 5547 2c20 2773 656e 6420 5061 7468  EBUG, 'send Path
+000158f0: 3a25 7327 2025 2066 696c 655f 7061 7468  :%s' % file_path
+00015900: 290a 0a20 2020 2020 2020 2074 6f74 616c  )..        total
+00015910: 436f 756e 7420 3d20 7574 696c 2e74 6f5f  Count = util.to_
+00015920: 6c6f 6e67 2868 6561 6465 7273 5b27 636f  long(headers['co
+00015930: 6e74 656e 744c 656e 6774 6827 5d29 2069  ntentLength']) i
+00015940: 6620 6865 6164 6572 732e 6765 7428 2763  f headers.get('c
+00015950: 6f6e 7465 6e74 4c65 6e67 7468 2729 2069  ontentLength') i
+00015960: 7320 6e6f 7420 4e6f 6e65 205c 0a20 2020  s not None \.   
+00015970: 2020 2020 2020 2020 2065 6c73 6520 6f73           else os
+00015980: 2e70 6174 682e 6765 7473 697a 6528 6669  .path.getsize(fi
+00015990: 6c65 5f70 6174 6829 0a20 2020 2020 2020  le_path).       
+000159a0: 2069 6620 746f 7461 6c43 6f75 6e74 203e   if totalCount >
+000159b0: 2030 2061 6e64 2070 726f 6772 6573 7343   0 and progressC
+000159c0: 616c 6c62 6163 6b20 6973 206e 6f74 204e  allback is not N
+000159d0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000159e0: 206e 6f74 6966 6965 7220 3d20 7072 6f67   notifier = prog
+000159f0: 7265 7373 2e50 726f 6772 6573 734e 6f74  ress.ProgressNot
+00015a00: 6966 6965 7228 7072 6f67 7265 7373 4361  ifier(progressCa
+00015a10: 6c6c 6261 636b 2c20 746f 7461 6c43 6f75  llback, totalCou
+00015a20: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
+00015a30: 7265 6164 6162 6c65 203d 2054 7275 650a  readable = True.
+00015a40: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00015a50: 2020 2020 2020 2020 2020 6e6f 7469 6669            notifi
+00015a60: 6572 203d 2070 726f 6772 6573 732e 4e4f  er = progress.NO
+00015a70: 4e45 5f4e 4f54 4946 4945 520a 2020 2020  NE_NOTIFIER.    
+00015a80: 2020 2020 2020 2020 7265 6164 6162 6c65          readable
+00015a90: 203d 2046 616c 7365 0a0a 2020 2020 2020   = False..      
+00015aa0: 2020 656e 7469 7479 203d 2075 7469 6c2e    entity = util.
+00015ab0: 6765 745f 656e 7469 7479 5f66 6f72 5f73  get_entity_for_s
+00015ac0: 656e 645f 7769 7468 5f74 6f74 616c 5f63  end_with_total_c
+00015ad0: 6f75 6e74 2866 696c 655f 7061 7468 2c20  ount(file_path, 
+00015ae0: 746f 7461 6c43 6f75 6e74 2c20 4e6f 6e65  totalCount, None
+00015af0: 2c20 7365 6c66 2e63 6875 6e6b 5f73 697a  , self.chunk_siz
+00015b00: 652c 206e 6f74 6966 6965 7229 0a20 2020  e, notifier).   
+00015b10: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00015b20: 2020 2020 2020 6e6f 7469 6669 6572 2e73        notifier.s
+00015b30: 7461 7274 2829 0a20 2020 2020 2020 2020  tart().         
+00015b40: 2020 2072 6574 203d 2073 656c 662e 5f6d     ret = self._m
+00015b50: 616b 655f 7075 745f 7265 7175 6573 7428  ake_put_request(
+00015b60: 6275 636b 6574 4e61 6d65 2c20 6f62 6a65  bucketName, obje
+00015b70: 6374 4b65 792c 2068 6561 6465 7273 3d5f  ctKey, headers=_
+00015b80: 6865 6164 6572 732c 2065 6e74 6974 793d  headers, entity=
+00015b90: 656e 7469 7479 2c0a 2020 2020 2020 2020  entity,.        
+00015ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015bc0: 206d 6574 686f 644e 616d 653d 2770 7574   methodName='put
+00015bd0: 436f 6e74 656e 7427 2c20 7265 6164 6162  Content', readab
+00015be0: 6c65 3d72 6561 6461 626c 652c 2065 7874  le=readable, ext
+00015bf0: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+00015c00: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
+00015c10: 2020 2020 2020 2020 6669 6e61 6c6c 793a          finally:
+00015c20: 0a20 2020 2020 2020 2020 2020 206e 6f74  .            not
+00015c30: 6966 6965 722e 656e 6428 290a 2020 2020  ifier.end().    
+00015c40: 2020 2020 7365 6c66 2e5f 6765 6e65 7261      self._genera
+00015c50: 7465 5f6f 626a 6563 745f 7572 6c28 7265  te_object_url(re
+00015c60: 742c 2062 7563 6b65 744e 616d 652c 206f  t, bucketName, o
+00015c70: 626a 6563 744b 6579 290a 2020 2020 2020  bjectKey).      
+00015c80: 2020 7265 7475 726e 2072 6574 0a0a 2020    return ret..  
+00015c90: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
+00015ca0: 2020 2020 6465 6620 5f70 7574 4669 6c65      def _putFile
+00015cb0: 4861 6e64 6c65 4865 6164 6572 2868 6561  HandleHeader(hea
+00015cc0: 6465 7273 2c20 7369 7a65 2c20 6f62 6a65  ders, size, obje
+00015cd0: 6374 4b65 792c 2066 696c 655f 7061 7468  ctKey, file_path
+00015ce0: 293a 0a20 2020 2020 2020 2068 6561 6465  ):.        heade
+00015cf0: 7273 5b27 636f 6e74 656e 744c 656e 6774  rs['contentLengt
+00015d00: 6827 5d20 3d20 7574 696c 2e74 6f5f 6c6f  h'] = util.to_lo
+00015d10: 6e67 2868 6561 6465 7273 2e67 6574 2827  ng(headers.get('
+00015d20: 636f 6e74 656e 744c 656e 6774 6827 2929  contentLength'))
+00015d30: 0a20 2020 2020 2020 2069 6620 6865 6164  .        if head
+00015d40: 6572 732e 6765 7428 2763 6f6e 7465 6e74  ers.get('content
+00015d50: 4c65 6e67 7468 2729 2069 7320 6e6f 7420  Length') is not 
+00015d60: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00015d70: 2020 6865 6164 6572 735b 2763 6f6e 7465    headers['conte
+00015d80: 6e74 4c65 6e67 7468 275d 203d 2073 697a  ntLength'] = siz
+00015d90: 6520 6966 2068 6561 6465 7273 5b27 636f  e if headers['co
+00015da0: 6e74 656e 744c 656e 6774 6827 5d20 3e20  ntentLength'] > 
+00015db0: 7369 7a65 2065 6c73 6520 6865 6164 6572  size else header
+00015dc0: 735b 2763 6f6e 7465 6e74 4c65 6e67 7468  s['contentLength
+00015dd0: 275d 0a0a 2020 2020 2020 2020 6966 2068  ']..        if h
+00015de0: 6561 6465 7273 2e67 6574 2827 636f 6e74  eaders.get('cont
+00015df0: 656e 7454 7970 6527 2920 6973 204e 6f6e  entType') is Non
+00015e00: 653a 0a20 2020 2020 2020 2020 2020 2068  e:.            h
+00015e10: 6561 6465 7273 5b27 636f 6e74 656e 7454  eaders['contentT
+00015e20: 7970 6527 5d20 3d20 636f 6e73 742e 4d49  ype'] = const.MI
+00015e30: 4d45 5f54 5950 4553 2e67 6574 286f 626a  ME_TYPES.get(obj
+00015e40: 6563 744b 6579 5b6f 626a 6563 744b 6579  ectKey[objectKey
+00015e50: 2e72 6669 6e64 2827 2e27 2920 2b20 313a  .rfind('.') + 1:
+00015e60: 5d2e 6c6f 7765 7228 2929 0a0a 2020 2020  ].lower())..    
+00015e70: 2020 2020 6966 2068 6561 6465 7273 2e67      if headers.g
+00015e80: 6574 2827 636f 6e74 656e 7454 7970 6527  et('contentType'
+00015e90: 2920 6973 204e 6f6e 653a 0a20 2020 2020  ) is None:.     
+00015ea0: 2020 2020 2020 2068 6561 6465 7273 5b27         headers['
+00015eb0: 636f 6e74 656e 7454 7970 6527 5d20 3d20  contentType'] = 
+00015ec0: 636f 6e73 742e 4d49 4d45 5f54 5950 4553  const.MIME_TYPES
+00015ed0: 2e67 6574 2866 696c 655f 7061 7468 5b66  .get(file_path[f
+00015ee0: 696c 655f 7061 7468 2e72 6669 6e64 2827  ile_path.rfind('
+00015ef0: 2e27 2920 2b20 313a 5d2e 6c6f 7765 7228  .') + 1:].lower(
+00015f00: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
+00015f10: 6e20 6865 6164 6572 730a 0a20 2020 2040  n headers..    @
+00015f20: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+00015f30: 2064 6566 205f 6765 745f 6f66 6673 6574   def _get_offset
+00015f40: 286f 6666 7365 742c 2066 696c 655f 7369  (offset, file_si
+00015f50: 7a65 293a 0a20 2020 2020 2020 206f 6666  ze):.        off
+00015f60: 7365 7420 3d20 6f66 6673 6574 2069 6620  set = offset if 
+00015f70: 6f66 6673 6574 2069 7320 6e6f 7420 4e6f  offset is not No
+00015f80: 6e65 2061 6e64 2030 203c 3d20 6f66 6673  ne and 0 <= offs
+00015f90: 6574 203c 2066 696c 655f 7369 7a65 2065  et < file_size e
+00015fa0: 6c73 6520 300a 2020 2020 2020 2020 7265  lse 0.        re
+00015fb0: 7475 726e 206f 6666 7365 740a 0a20 2020  turn offset..   
+00015fc0: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
+00015fd0: 2020 2064 6566 205f 6765 745f 7061 7274     def _get_part
+00015fe0: 5f73 697a 6528 7061 7274 5369 7a65 2c20  _size(partSize, 
+00015ff0: 6669 6c65 5f73 697a 652c 206f 6666 7365  file_size, offse
+00016000: 7429 3a0a 2020 2020 2020 2020 7061 7274  t):.        part
+00016010: 5369 7a65 203d 2070 6172 7453 697a 6520  Size = partSize 
+00016020: 6966 2070 6172 7453 697a 6520 6973 206e  if partSize is n
+00016030: 6f74 204e 6f6e 6520 616e 6420 3020 3c20  ot None and 0 < 
+00016040: 7061 7274 5369 7a65 203c 3d20 2866 696c  partSize <= (fil
+00016050: 655f 7369 7a65 202d 206f 6666 7365 7429  e_size - offset)
+00016060: 2065 6c73 6520 6669 6c65 5f73 697a 6520   else file_size 
+00016070: 2d20 6f66 6673 6574 0a20 2020 2020 2020  - offset.       
+00016080: 2072 6574 7572 6e20 7061 7274 5369 7a65   return partSize
+00016090: 0a0a 2020 2020 6465 6620 5f70 7265 7061  ..    def _prepa
+000160a0: 7265 5f68 6561 6465 7273 2873 656c 662c  re_headers(self,
+000160b0: 206d 6435 2c20 6973 4174 7461 6368 4d64   md5, isAttachMd
+000160c0: 352c 2066 696c 655f 7061 7468 2c20 7061  5, file_path, pa
+000160d0: 7274 5369 7a65 2c20 6f66 6673 6574 2c20  rtSize, offset, 
+000160e0: 7373 6548 6561 6465 722c 2068 6561 6465  sseHeader, heade
+000160f0: 7273 293a 0a20 2020 2020 2020 2069 6620  rs):.        if 
+00016100: 6d64 353a 0a20 2020 2020 2020 2020 2020  md5:.           
+00016110: 2068 6561 6465 7273 5b63 6f6e 7374 2e43   headers[const.C
+00016120: 4f4e 5445 4e54 5f4d 4435 5f48 4541 4445  ONTENT_MD5_HEADE
+00016130: 525d 203d 206d 6435 0a20 2020 2020 2020  R] = md5.       
+00016140: 2065 6c69 6620 6973 4174 7461 6368 4d64   elif isAttachMd
+00016150: 353a 0a20 2020 2020 2020 2020 2020 2068  5:.            h
+00016160: 6561 6465 7273 5b63 6f6e 7374 2e43 4f4e  eaders[const.CON
+00016170: 5445 4e54 5f4d 4435 5f48 4541 4445 525d  TENT_MD5_HEADER]
+00016180: 203d 2075 7469 6c2e 6261 7365 3634 5f65   = util.base64_e
+00016190: 6e63 6f64 6528 0a20 2020 2020 2020 2020  ncode(.         
+000161a0: 2020 2020 2020 2075 7469 6c2e 6d64 355f         util.md5_
+000161b0: 6669 6c65 5f65 6e63 6f64 655f 6279 5f73  file_encode_by_s
+000161c0: 697a 655f 6f66 6673 6574 2866 696c 655f  ize_offset(file_
+000161d0: 7061 7468 2c20 7061 7274 5369 7a65 2c20  path, partSize, 
+000161e0: 6f66 6673 6574 2c20 7365 6c66 2e63 6875  offset, self.chu
+000161f0: 6e6b 5f73 697a 6529 290a 0a20 2020 2020  nk_size))..     
+00016200: 2020 2069 6620 7373 6548 6561 6465 7220     if sseHeader 
+00016210: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00016220: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
+00016230: 6e76 6572 746f 722e 5f73 6574 5f73 7365  nvertor._set_sse
+00016240: 5f68 6561 6465 7228 7373 6548 6561 6465  _header(sseHeade
+00016250: 722c 2068 6561 6465 7273 2c20 5472 7565  r, headers, True
+00016260: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00016270: 6e20 6865 6164 6572 730a 0a20 2020 2040  n headers..    @
+00016280: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+00016290: 2064 6566 205f 7072 6570 6172 655f 7570   def _prepare_up
+000162a0: 6c6f 6164 5f70 6172 745f 6e6f 7469 6669  load_part_notifi
+000162b0: 6572 2870 6172 7453 697a 652c 2070 726f  er(partSize, pro
+000162c0: 6772 6573 7343 616c 6c62 6163 6b2c 2072  gressCallback, r
+000162d0: 6561 6461 626c 6529 3a0a 2020 2020 2020  eadable):.      
+000162e0: 2020 6966 2070 6172 7453 697a 6520 3e20    if partSize > 
+000162f0: 3020 616e 6420 7072 6f67 7265 7373 4361  0 and progressCa
+00016300: 6c6c 6261 636b 2069 7320 6e6f 7420 4e6f  llback is not No
+00016310: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00016320: 7265 6164 6162 6c65 203d 2054 7275 650a  readable = True.
+00016330: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
+00016340: 6669 6572 203d 2070 726f 6772 6573 732e  fier = progress.
+00016350: 5072 6f67 7265 7373 4e6f 7469 6669 6572  ProgressNotifier
+00016360: 2870 726f 6772 6573 7343 616c 6c62 6163  (progressCallbac
+00016370: 6b2c 2070 6172 7453 697a 6529 0a20 2020  k, partSize).   
+00016380: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00016390: 2020 2020 2020 206e 6f74 6966 6965 7220         notifier 
+000163a0: 3d20 7072 6f67 7265 7373 2e4e 4f4e 455f  = progress.NONE_
+000163b0: 4e4f 5449 4649 4552 0a0a 2020 2020 2020  NOTIFIER..      
+000163c0: 2020 7265 7475 726e 2072 6561 6461 626c    return readabl
+000163d0: 652c 206e 6f74 6966 6965 720a 0a20 2020  e, notifier..   
+000163e0: 2064 6566 205f 6765 745f 6865 6164 6572   def _get_header
+000163f0: 7328 7365 6c66 2c20 6d64 352c 2073 7365  s(self, md5, sse
+00016400: 4865 6164 6572 2c20 6865 6164 6572 7329  Header, headers)
+00016410: 3a0a 2020 2020 2020 2020 6966 206d 6435  :.        if md5
+00016420: 3a0a 2020 2020 2020 2020 2020 2020 6865  :.            he
+00016430: 6164 6572 735b 636f 6e73 742e 434f 4e54  aders[const.CONT
+00016440: 454e 545f 4d44 355f 4845 4144 4552 5d20  ENT_MD5_HEADER] 
+00016450: 3d20 6d64 350a 2020 2020 2020 2020 6966  = md5.        if
+00016460: 2073 7365 4865 6164 6572 2069 7320 6e6f   sseHeader is no
+00016470: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00016480: 2020 2020 7365 6c66 2e63 6f6e 7665 7274      self.convert
+00016490: 6f72 2e5f 7365 745f 7373 655f 6865 6164  or._set_sse_head
+000164a0: 6572 2873 7365 4865 6164 6572 2c20 6865  er(sseHeader, he
+000164b0: 6164 6572 732c 2054 7275 6529 0a0a 2020  aders, True)..  
+000164c0: 2020 2020 2020 7265 7475 726e 2068 6561        return hea
+000164d0: 6465 7273 0a0a 2020 2020 4073 7461 7469  ders..    @stati
+000164e0: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+000164f0: 5f67 6574 5f6e 6f74 6966 6965 725f 7769  _get_notifier_wi
+00016500: 7468 6f75 745f 7369 7a65 2870 726f 6772  thout_size(progr
+00016510: 6573 7343 616c 6c62 6163 6b29 3a0a 2020  essCallback):.  
+00016520: 2020 2020 2020 7265 7475 726e 2070 726f        return pro
+00016530: 6772 6573 732e 5072 6f67 7265 7373 4e6f  gress.ProgressNo
+00016540: 7469 6669 6572 2870 726f 6772 6573 7343  tifier(progressC
+00016550: 616c 6c62 6163 6b2c 0a20 2020 2020 2020  allback,.       
+00016560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016580: 2020 2d31 2920 6966 2070 726f 6772 6573    -1) if progres
+00016590: 7343 616c 6c62 6163 6b20 6973 206e 6f74  sCallback is not
+000165a0: 204e 6f6e 6520 656c 7365 2070 726f 6772   None else progr
+000165b0: 6573 732e 4e4f 4e45 5f4e 4f54 4946 4945  ess.NONE_NOTIFIE
+000165c0: 520a 0a20 2020 2040 7374 6174 6963 6d65  R..    @staticme
+000165d0: 7468 6f64 0a20 2020 2064 6566 205f 6765  thod.    def _ge
+000165e0: 745f 6e6f 7469 6669 6572 5f77 6974 685f  t_notifier_with_
+000165f0: 7369 7a65 2870 726f 6772 6573 7343 616c  size(progressCal
+00016600: 6c62 6163 6b2c 2074 6f74 616c 436f 756e  lback, totalCoun
+00016610: 7429 3a0a 2020 2020 2020 2020 7265 7475  t):.        retu
+00016620: 726e 2070 726f 6772 6573 732e 5072 6f67  rn progress.Prog
+00016630: 7265 7373 4e6f 7469 6669 6572 2870 726f  ressNotifier(pro
+00016640: 6772 6573 7343 616c 6c62 6163 6b2c 0a20  gressCallback,. 
+00016650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016670: 2020 2020 2020 2020 746f 7461 6c43 6f75          totalCou
+00016680: 6e74 2920 6966 2074 6f74 616c 436f 756e  nt) if totalCoun
+00016690: 7420 3e20 3020 616e 6420 7072 6f67 7265  t > 0 and progre
+000166a0: 7373 4361 6c6c 6261 636b 2069 7320 6e6f  ssCallback is no
+000166b0: 7420 4e6f 6e65 205c 0a20 2020 2020 2020  t None \.       
+000166c0: 2020 2020 2065 6c73 6520 7072 6f67 7265       else progre
+000166d0: 7373 2e4e 4f4e 455f 4e4f 5449 4649 4552  ss.NONE_NOTIFIER
+000166e0: 0a0a 2020 2020 6465 6620 5f63 6865 636b  ..    def _check
+000166f0: 5f66 696c 655f 7061 7274 5f69 6e66 6f28  _file_part_info(
+00016700: 7365 6c66 2c20 6669 6c65 5f70 6174 682c  self, file_path,
+00016710: 206f 6666 7365 742c 2070 6172 7453 697a   offset, partSiz
+00016720: 6529 3a0a 2020 2020 2020 2020 6669 6c65  e):.        file
+00016730: 5f70 6172 745f 696e 666f 203d 2064 6963  _part_info = dic
+00016740: 7428 290a 2020 2020 2020 2020 6669 6c65  t().        file
+00016750: 5f70 6172 745f 696e 666f 5b22 6669 6c65  _part_info["file
+00016760: 5f70 6174 6822 5d20 3d20 7365 6c66 2e63  _path"] = self.c
+00016770: 6865 636b 5f66 696c 655f 7061 7468 2866  heck_file_path(f
+00016780: 696c 655f 7061 7468 290a 2020 2020 2020  ile_path).      
+00016790: 2020 6669 6c65 5f73 697a 6520 3d20 7574    file_size = ut
+000167a0: 696c 2e74 6f5f 6c6f 6e67 286f 732e 7061  il.to_long(os.pa
+000167b0: 7468 2e67 6574 7369 7a65 2866 696c 655f  th.getsize(file_
+000167c0: 7061 7468 2929 0a20 2020 2020 2020 206f  path)).        o
+000167d0: 6666 7365 7420 3d20 7574 696c 2e74 6f5f  ffset = util.to_
+000167e0: 6c6f 6e67 286f 6666 7365 7429 0a20 2020  long(offset).   
+000167f0: 2020 2020 2066 696c 655f 7061 7274 5f69       file_part_i
+00016800: 6e66 6f5b 226f 6666 7365 7422 5d20 3d20  nfo["offset"] = 
+00016810: 7365 6c66 2e5f 6765 745f 6f66 6673 6574  self._get_offset
+00016820: 286f 6666 7365 742c 2066 696c 655f 7369  (offset, file_si
+00016830: 7a65 290a 2020 2020 2020 2020 7061 7274  ze).        part
+00016840: 5369 7a65 203d 2075 7469 6c2e 746f 5f6c  Size = util.to_l
+00016850: 6f6e 6728 7061 7274 5369 7a65 290a 2020  ong(partSize).  
+00016860: 2020 2020 2020 6669 6c65 5f70 6172 745f        file_part_
+00016870: 696e 666f 5b22 7061 7274 5369 7a65 225d  info["partSize"]
+00016880: 203d 2073 656c 662e 5f67 6574 5f70 6172   = self._get_par
+00016890: 745f 7369 7a65 2870 6172 7453 697a 652c  t_size(partSize,
+000168a0: 2066 696c 655f 7369 7a65 2c20 6f66 6673   file_size, offs
+000168b0: 6574 290a 2020 2020 2020 2020 7265 7475  et).        retu
+000168c0: 726e 2066 696c 655f 7061 7274 5f69 6e66  rn file_part_inf
+000168d0: 6f0a 0a20 2020 2040 6675 6e63 4361 6368  o..    @funcCach
+000168e0: 650a 2020 2020 6465 6620 7570 6c6f 6164  e.    def upload
+000168f0: 5061 7274 2873 656c 662c 2062 7563 6b65  Part(self, bucke
+00016900: 744e 616d 652c 206f 626a 6563 744b 6579  tName, objectKey
+00016910: 2c20 7061 7274 4e75 6d62 6572 2c20 7570  , partNumber, up
+00016920: 6c6f 6164 4964 2c20 6f62 6a65 6374 3d4e  loadId, object=N
+00016930: 6f6e 652c 2069 7346 696c 653d 4661 6c73  one, isFile=Fals
+00016940: 652c 2070 6172 7453 697a 653d 4e6f 6e65  e, partSize=None
+00016950: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00016960: 2020 2020 206f 6666 7365 743d 302c 2073       offset=0, s
+00016970: 7365 4865 6164 6572 3d4e 6f6e 652c 2069  seHeader=None, i
+00016980: 7341 7474 6163 684d 6435 3d46 616c 7365  sAttachMd5=False
+00016990: 2c20 6d64 353d 4e6f 6e65 2c20 636f 6e74  , md5=None, cont
+000169a0: 656e 743d 4e6f 6e65 2c20 7072 6f67 7265  ent=None, progre
+000169b0: 7373 4361 6c6c 6261 636b 3d4e 6f6e 652c  ssCallback=None,
+000169c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000169d0: 2020 2020 6175 746f 436c 6f73 653d 5472      autoClose=Tr
+000169e0: 7565 2c20 6578 7465 6e73 696f 6e48 6561  ue, extensionHea
+000169f0: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
+00016a00: 2020 2020 7365 6c66 2e5f 6173 7365 7274      self._assert
+00016a10: 5f6e 6f74 5f6e 756c 6c28 7061 7274 4e75  _not_null(partNu
+00016a20: 6d62 6572 2c20 2770 6172 744e 756d 6265  mber, 'partNumbe
+00016a30: 7220 6973 2065 6d70 7479 2729 0a20 2020  r is empty').   
+00016a40: 2020 2020 2073 656c 662e 5f61 7373 6572       self._asser
+00016a50: 745f 6e6f 745f 6e75 6c6c 2875 706c 6f61  t_not_null(uploa
+00016a60: 6449 642c 2027 7570 6c6f 6164 4964 2069  dId, 'uploadId i
+00016a70: 7320 656d 7074 7927 290a 0a20 2020 2020  s empty')..     
+00016a80: 2020 2063 6875 6e6b 6564 4d6f 6465 203d     chunkedMode =
+00016a90: 2046 616c 7365 0a20 2020 2020 2020 2072   False.        r
+00016aa0: 6561 6461 626c 6520 3d20 4661 6c73 650a  eadable = False.
+00016ab0: 0a20 2020 2020 2020 2069 6620 636f 6e74  .        if cont
+00016ac0: 656e 7420 6973 204e 6f6e 653a 0a20 2020  ent is None:.   
+00016ad0: 2020 2020 2020 2020 2063 6f6e 7465 6e74           content
+00016ae0: 203d 206f 626a 6563 740a 0a20 2020 2020   = object..     
+00016af0: 2020 206e 6f74 6966 6965 7220 3d20 4e6f     notifier = No
+00016b00: 6e65 0a20 2020 2020 2020 2069 6620 6973  ne.        if is
+00016b10: 4669 6c65 3a0a 2020 2020 2020 2020 2020  File:.          
+00016b20: 2020 6368 6563 6b65 645f 6669 6c65 5f70    checked_file_p
+00016b30: 6172 745f 696e 666f 203d 2073 656c 662e  art_info = self.
+00016b40: 5f63 6865 636b 5f66 696c 655f 7061 7274  _check_file_part
+00016b50: 5f69 6e66 6f28 636f 6e74 656e 742c 206f  _info(content, o
+00016b60: 6666 7365 742c 2070 6172 7453 697a 6529  ffset, partSize)
+00016b70: 0a0a 2020 2020 2020 2020 2020 2020 6865  ..            he
+00016b80: 6164 6572 7320 3d20 7b63 6f6e 7374 2e43  aders = {const.C
+00016b90: 4f4e 5445 4e54 5f4c 454e 4754 485f 4845  ONTENT_LENGTH_HE
+00016ba0: 4144 4552 3a20 7574 696c 2e74 6f5f 7374  ADER: util.to_st
+00016bb0: 7269 6e67 2863 6865 636b 6564 5f66 696c  ring(checked_fil
+00016bc0: 655f 7061 7274 5f69 6e66 6f5b 2270 6172  e_part_info["par
+00016bd0: 7453 697a 6522 5d29 7d0a 2020 2020 2020  tSize"])}.      
+00016be0: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
+00016bf0: 7365 6c66 2e5f 7072 6570 6172 655f 6865  self._prepare_he
+00016c00: 6164 6572 7328 6d64 352c 2069 7341 7474  aders(md5, isAtt
+00016c10: 6163 684d 6435 2c20 6368 6563 6b65 645f  achMd5, checked_
+00016c20: 6669 6c65 5f70 6172 745f 696e 666f 5b22  file_part_info["
+00016c30: 6669 6c65 5f70 6174 6822 5d2c 0a20 2020  file_path"],.   
+00016c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c60: 2020 2020 2020 2020 2063 6865 636b 6564           checked
+00016c70: 5f66 696c 655f 7061 7274 5f69 6e66 6f5b  _file_part_info[
+00016c80: 2270 6172 7453 697a 6522 5d2c 2063 6865  "partSize"], che
+00016c90: 636b 6564 5f66 696c 655f 7061 7274 5f69  cked_file_part_i
+00016ca0: 6e66 6f5b 226f 6666 7365 7422 5d2c 0a20  nfo["offset"],. 
+00016cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016cd0: 2020 2020 2020 2020 2020 2073 7365 4865             sseHe
+00016ce0: 6164 6572 2c20 6865 6164 6572 7329 0a0a  ader, headers)..
+00016cf0: 2020 2020 2020 2020 2020 2020 7265 6164              read
+00016d00: 6162 6c65 2c20 6e6f 7469 6669 6572 203d  able, notifier =
+00016d10: 2073 656c 662e 5f70 7265 7061 7265 5f75   self._prepare_u
+00016d20: 706c 6f61 645f 7061 7274 5f6e 6f74 6966  pload_part_notif
+00016d30: 6965 7228 6368 6563 6b65 645f 6669 6c65  ier(checked_file
+00016d40: 5f70 6172 745f 696e 666f 5b22 7061 7274  _part_info["part
+00016d50: 5369 7a65 225d 2c0a 2020 2020 2020 2020  Size"],.        
+00016d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d90: 2020 2020 2020 2020 2020 2020 7072 6f67              prog
+00016da0: 7265 7373 4361 6c6c 6261 636b 2c20 7265  ressCallback, re
+00016db0: 6164 6162 6c65 290a 2020 2020 2020 2020  adable).        
+00016dc0: 2020 2020 656e 7469 7479 203d 2075 7469      entity = uti
+00016dd0: 6c2e 6765 745f 656e 7469 7479 5f66 6f72  l.get_entity_for
+00016de0: 5f73 656e 645f 7769 7468 5f74 6f74 616c  _send_with_total
+00016df0: 5f63 6f75 6e74 2863 6865 636b 6564 5f66  _count(checked_f
+00016e00: 696c 655f 7061 7274 5f69 6e66 6f5b 2266  ile_part_info["f
+00016e10: 696c 655f 7061 7468 225d 2c20 6368 6563  ile_path"], chec
+00016e20: 6b65 645f 6669 6c65 5f70 6172 745f 696e  ked_file_part_in
+00016e30: 666f 5b22 7061 7274 5369 7a65 225d 2c20  fo["partSize"], 
+00016e40: 6368 6563 6b65 645f 6669 6c65 5f70 6172  checked_file_par
+00016e50: 745f 696e 666f 5b22 6f66 6673 6574 225d  t_info["offset"]
+00016e60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00016e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00016e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00016e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016eb0: 2020 2020 2020 2020 2020 2020 6175 746f              auto
-00016ec0: 5f63 6c6f 7365 3d61 7574 6f43 6c6f 7365  _close=autoClose
-00016ed0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00016ee0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00016ef0: 2020 2020 656e 7469 7479 203d 2063 6f6e      entity = con
-00016f00: 7465 6e74 0a20 2020 2020 2020 2020 2020  tent.           
-00016f10: 2020 2020 2069 6620 656e 7469 7479 2069       if entity i
-00016f20: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00016f30: 2020 2020 2020 2020 2020 2020 656e 7469              enti
-00016f40: 7479 203d 2027 270a 2020 2020 2020 2020  ty = ''.        
-00016f50: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
-00016f60: 3d20 7365 6c66 2e5f 6765 745f 6865 6164  = self._get_head
-00016f70: 6572 7328 6d64 352c 2073 7365 4865 6164  ers(md5, sseHead
-00016f80: 6572 2c20 6865 6164 6572 7329 0a0a 2020  er, headers)..  
-00016f90: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00016fa0: 2020 2020 2020 2069 6620 6e6f 7469 6669         if notifi
-00016fb0: 6572 2069 7320 6e6f 7420 4e6f 6e65 3a0a  er is not None:.
-00016fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016fd0: 6e6f 7469 6669 6572 2e73 7461 7274 2829  notifier.start()
-00016fe0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00016ff0: 203d 2073 656c 662e 5f6d 616b 655f 7075   = self._make_pu
-00017000: 745f 7265 7175 6573 7428 6275 636b 6574  t_request(bucket
-00017010: 4e61 6d65 2c20 6f62 6a65 6374 4b65 792c  Name, objectKey,
-00017020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016ea0: 2073 656c 662e 6368 756e 6b5f 7369 7a65   self.chunk_size
+00016eb0: 2c20 6e6f 7469 6669 6572 290a 2020 2020  , notifier).    
+00016ec0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00016ed0: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
+00016ee0: 7b7d 0a20 2020 2020 2020 2020 2020 2069  {}.            i
+00016ef0: 6620 636f 6e74 656e 7420 6973 206e 6f74  f content is not
+00016f00: 204e 6f6e 6520 616e 6420 6861 7361 7474   None and hasatt
+00016f10: 7228 636f 6e74 656e 742c 2027 7265 6164  r(content, 'read
+00016f20: 2729 2061 6e64 2063 616c 6c61 626c 6528  ') and callable(
+00016f30: 636f 6e74 656e 742e 7265 6164 293a 0a20  content.read):. 
+00016f40: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00016f50: 6561 6461 626c 6520 3d20 5472 7565 0a20  eadable = True. 
+00016f60: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00016f70: 6561 6465 7273 203d 2073 656c 662e 5f67  eaders = self._g
+00016f80: 6574 5f68 6561 6465 7273 286d 6435 2c20  et_headers(md5, 
+00016f90: 7373 6548 6561 6465 722c 2068 6561 6465  sseHeader, heade
+00016fa0: 7273 290a 0a20 2020 2020 2020 2020 2020  rs)..           
+00016fb0: 2020 2020 2069 6620 7061 7274 5369 7a65       if partSize
+00016fc0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00016fd0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00016fe0: 6c66 2e6c 6f67 5f63 6c69 656e 742e 6c6f  lf.log_client.lo
+00016ff0: 6728 4445 4255 472c 2027 6d69 7373 696e  g(DEBUG, 'missin
+00017000: 6720 7061 7274 5369 7a65 2077 6865 6e20  g partSize when 
+00017010: 7570 6c6f 6164 696e 6720 6120 7265 6164  uploading a read
+00017020: 6162 6c65 2073 7472 6561 6d27 290a 2020  able stream').  
 00017030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017040: 2020 2020 2020 2020 2020 7061 7468 4172            pathAr
-00017050: 6773 3d7b 2770 6172 744e 756d 6265 7227  gs={'partNumber'
-00017060: 3a20 7061 7274 4e75 6d62 6572 2c20 2775  : partNumber, 'u
-00017070: 706c 6f61 6449 6427 3a20 7570 6c6f 6164  ploadId': upload
-00017080: 4964 7d2c 0a20 2020 2020 2020 2020 2020  Id},.           
-00017090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000170a0: 2020 2020 2020 2020 2020 2020 2020 6865                he
-000170b0: 6164 6572 733d 6865 6164 6572 732c 2065  aders=headers, e
-000170c0: 6e74 6974 793d 656e 7469 7479 2c20 6368  ntity=entity, ch
-000170d0: 756e 6b65 644d 6f64 653d 6368 756e 6b65  unkedMode=chunke
-000170e0: 644d 6f64 652c 0a20 2020 2020 2020 2020  dMode,.         
-000170f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017110: 6d65 7468 6f64 4e61 6d65 3d27 7570 6c6f  methodName='uplo
-00017120: 6164 5061 7274 272c 2072 6561 6461 626c  adPart', readabl
-00017130: 653d 7265 6164 6162 6c65 2c20 6578 7465  e=readable, exte
-00017140: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
-00017150: 656e 7369 6f6e 4865 6164 6572 7329 0a20  ensionHeaders). 
-00017160: 2020 2020 2020 2066 696e 616c 6c79 3a0a         finally:.
-00017170: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00017180: 6f74 6966 6965 7220 6973 206e 6f74 204e  otifier is not N
-00017190: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000171a0: 2020 2020 206e 6f74 6966 6965 722e 656e       notifier.en
-000171b0: 6428 290a 2020 2020 2020 2020 7265 7475  d().        retu
-000171c0: 726e 2072 6574 0a0a 2020 2020 4073 7461  rn ret..    @sta
-000171d0: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
-000171e0: 6620 6368 6563 6b5f 6669 6c65 5f70 6174  f check_file_pat
-000171f0: 6828 6669 6c65 5f70 6174 6829 3a0a 2020  h(file_path):.  
-00017200: 2020 2020 2020 6669 6c65 5f70 6174 6820        file_path 
-00017210: 3d20 7574 696c 2e73 6166 655f 656e 636f  = util.safe_enco
-00017220: 6465 2866 696c 655f 7061 7468 290a 2020  de(file_path).  
-00017230: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
-00017240: 7061 7468 2e65 7869 7374 7328 6669 6c65  path.exists(file
-00017250: 5f70 6174 6829 3a0a 2020 2020 2020 2020  _path):.        
-00017260: 2020 2020 6669 6c65 5f70 6174 6820 3d20      file_path = 
-00017270: 7574 696c 2e73 6166 655f 7472 616e 735f  util.safe_trans_
-00017280: 746f 5f67 6232 3331 3228 6669 6c65 5f70  to_gb2312(file_p
-00017290: 6174 6829 0a20 2020 2020 2020 2020 2020  ath).           
-000172a0: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
-000172b0: 6578 6973 7473 2866 696c 655f 7061 7468  exists(file_path
-000172c0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000172d0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-000172e0: 6f6e 2827 6669 6c65 205b 2573 5d20 646f  on('file [%s] do
-000172f0: 6573 206e 6f74 2065 7869 7374 2720 2520  es not exist' % 
-00017300: 6669 6c65 5f70 6174 6829 0a20 2020 2020  file_path).     
-00017310: 2020 2072 6574 7572 6e20 6669 6c65 5f70     return file_p
-00017320: 6174 680a 0a20 2020 2040 6675 6e63 4361  ath..    @funcCa
-00017330: 6368 650a 2020 2020 6465 6620 5f75 706c  che.    def _upl
-00017340: 6f61 6450 6172 7457 6974 684e 6f74 6966  oadPartWithNotif
-00017350: 6965 7228 7365 6c66 2c20 6275 636b 6574  ier(self, bucket
-00017360: 4e61 6d65 2c20 6f62 6a65 6374 4b65 792c  Name, objectKey,
-00017370: 2070 6172 744e 756d 6265 722c 2075 706c   partNumber, upl
-00017380: 6f61 6449 642c 2063 6f6e 7465 6e74 3d4e  oadId, content=N
-00017390: 6f6e 652c 2069 7346 696c 653d 4661 6c73  one, isFile=Fals
-000173a0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-000173b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173c0: 2020 2070 6172 7453 697a 653d 4e6f 6e65     partSize=None
-000173d0: 2c20 6f66 6673 6574 3d30 2c20 7373 6548  , offset=0, sseH
-000173e0: 6561 6465 723d 4e6f 6e65 2c20 6973 4174  eader=None, isAt
-000173f0: 7461 6368 4d64 353d 4661 6c73 652c 206d  tachMd5=False, m
-00017400: 6435 3d4e 6f6e 652c 206e 6f74 6966 6965  d5=None, notifie
-00017410: 723d 4e6f 6e65 2c0a 2020 2020 2020 2020  r=None,.        
-00017420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017430: 2020 2020 2020 2020 6578 7465 6e73 696f          extensio
-00017440: 6e48 6561 6465 7273 3d4e 6f6e 652c 2068  nHeaders=None, h
-00017450: 6561 6465 7273 3d4e 6f6e 6529 3a0a 2020  eaders=None):.  
-00017460: 2020 2020 2020 7365 6c66 2e5f 6173 7365        self._asse
-00017470: 7274 5f6e 6f74 5f6e 756c 6c28 7061 7274  rt_not_null(part
-00017480: 4e75 6d62 6572 2c20 2770 6172 744e 756d  Number, 'partNum
-00017490: 6265 7220 6973 2065 6d70 7479 2729 0a20  ber is empty'). 
-000174a0: 2020 2020 2020 2073 656c 662e 5f61 7373         self._ass
-000174b0: 6572 745f 6e6f 745f 6e75 6c6c 2875 706c  ert_not_null(upl
-000174c0: 6f61 6449 642c 2027 7570 6c6f 6164 4964  oadId, 'uploadId
-000174d0: 2069 7320 656d 7074 7927 290a 0a20 2020   is empty')..   
-000174e0: 2020 2020 2063 6875 6e6b 6564 4d6f 6465       chunkedMode
-000174f0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00017500: 2072 6561 6461 626c 6520 3d20 4661 6c73   readable = Fals
-00017510: 650a 2020 2020 2020 2020 6966 2068 6561  e.        if hea
-00017520: 6465 7273 2069 7320 4e6f 6e65 3a0a 2020  ders is None:.  
-00017530: 2020 2020 2020 2020 2020 6865 6164 6572            header
-00017540: 7320 3d20 6469 6374 2829 0a20 2020 2020  s = dict().     
-00017550: 2020 2069 6620 6973 4669 6c65 3a0a 2020     if isFile:.  
-00017560: 2020 2020 2020 2020 2020 6368 6563 6b65            checke
-00017570: 645f 6669 6c65 5f70 6172 745f 696e 666f  d_file_part_info
-00017580: 203d 2073 656c 662e 5f63 6865 636b 5f66   = self._check_f
-00017590: 696c 655f 7061 7274 5f69 6e66 6f28 636f  ile_part_info(co
-000175a0: 6e74 656e 742c 206f 6666 7365 742c 2070  ntent, offset, p
-000175b0: 6172 7453 697a 6529 0a0a 2020 2020 2020  artSize)..      
-000175c0: 2020 2020 2020 6865 6164 6572 735b 636f        headers[co
-000175d0: 6e73 742e 434f 4e54 454e 545f 4c45 4e47  nst.CONTENT_LENG
-000175e0: 5448 5f48 4541 4445 525d 203d 2075 7469  TH_HEADER] = uti
-000175f0: 6c2e 746f 5f73 7472 696e 6728 6368 6563  l.to_string(chec
-00017600: 6b65 645f 6669 6c65 5f70 6172 745f 696e  ked_file_part_in
-00017610: 666f 5b22 7061 7274 5369 7a65 225d 290a  fo["partSize"]).
-00017620: 2020 2020 2020 2020 2020 2020 6865 6164              head
-00017630: 6572 7320 3d20 7365 6c66 2e5f 7072 6570  ers = self._prep
-00017640: 6172 655f 6865 6164 6572 7328 6d64 352c  are_headers(md5,
-00017650: 2069 7341 7474 6163 684d 6435 2c20 6368   isAttachMd5, ch
-00017660: 6563 6b65 645f 6669 6c65 5f70 6172 745f  ecked_file_part_
-00017670: 696e 666f 5b22 6669 6c65 5f70 6174 6822  info["file_path"
-00017680: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00017690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000176a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000176b0: 6865 636b 6564 5f66 696c 655f 7061 7274  hecked_file_part
-000176c0: 5f69 6e66 6f5b 2270 6172 7453 697a 6522  _info["partSize"
-000176d0: 5d2c 2063 6865 636b 6564 5f66 696c 655f  ], checked_file_
-000176e0: 7061 7274 5f69 6e66 6f5b 226f 6666 7365  part_info["offse
-000176f0: 7422 5d2c 0a20 2020 2020 2020 2020 2020  t"],.           
-00017700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017720: 2073 7365 4865 6164 6572 2c20 6865 6164   sseHeader, head
-00017730: 6572 7329 0a0a 2020 2020 2020 2020 2020  ers)..          
-00017740: 2020 6966 206e 6f74 6966 6965 7220 6973    if notifier is
-00017750: 206e 6f74 204e 6f6e 6520 616e 6420 6e6f   not None and no
-00017760: 7420 6973 696e 7374 616e 6365 286e 6f74  t isinstance(not
-00017770: 6966 6965 722c 2070 726f 6772 6573 732e  ifier, progress.
-00017780: 4e6f 6e65 4e6f 7469 6669 6572 293a 0a20  NoneNotifier):. 
-00017790: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000177a0: 6561 6461 626c 6520 3d20 5472 7565 0a20  eadable = True. 
-000177b0: 2020 2020 2020 2020 2020 2065 6e74 6974             entit
-000177c0: 7920 3d20 7574 696c 2e67 6574 5f65 6e74  y = util.get_ent
-000177d0: 6974 795f 666f 725f 7365 6e64 5f77 6974  ity_for_send_wit
-000177e0: 685f 746f 7461 6c5f 636f 756e 7428 6368  h_total_count(ch
-000177f0: 6563 6b65 645f 6669 6c65 5f70 6172 745f  ecked_file_part_
-00017800: 696e 666f 5b22 6669 6c65 5f70 6174 6822  info["file_path"
-00017810: 5d2c 2070 6172 7453 697a 652c 2063 6865  ], partSize, che
-00017820: 636b 6564 5f66 696c 655f 7061 7274 5f69  cked_file_part_i
-00017830: 6e66 6f5b 226f 6666 7365 7422 5d2c 0a20  nfo["offset"],. 
-00017840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017870: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00017880: 6c66 2e63 6875 6e6b 5f73 697a 652c 206e  lf.chunk_size, n
-00017890: 6f74 6966 6965 7229 0a20 2020 2020 2020  otifier).       
-000178a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000178b0: 2020 2069 6620 636f 6e74 656e 7420 6973     if content is
-000178c0: 206e 6f74 204e 6f6e 6520 616e 6420 6861   not None and ha
-000178d0: 7361 7474 7228 636f 6e74 656e 742c 2027  sattr(content, '
-000178e0: 7265 6164 2729 2061 6e64 2063 616c 6c61  read') and calla
-000178f0: 626c 6528 636f 6e74 656e 742e 7265 6164  ble(content.read
-00017900: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00017910: 2020 2072 6561 6461 626c 6520 3d20 5472     readable = Tr
-00017920: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00017930: 2020 2068 6561 6465 7273 203d 2073 656c     headers = sel
-00017940: 662e 5f67 6574 5f68 6561 6465 7273 286d  f._get_headers(m
-00017950: 6435 2c20 7373 6548 6561 6465 722c 2068  d5, sseHeader, h
-00017960: 6561 6465 7273 290a 0a20 2020 2020 2020  eaders)..       
-00017970: 2020 2020 2020 2020 2069 6620 7061 7274           if part
-00017980: 5369 7a65 2069 7320 4e6f 6e65 3a0a 2020  Size is None:.  
-00017990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000179a0: 2020 6368 756e 6b65 644d 6f64 6520 3d20    chunkedMode = 
-000179b0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-000179c0: 2020 2020 2020 2020 2065 6e74 6974 7920           entity 
-000179d0: 3d20 7574 696c 2e67 6574 5f72 6561 6461  = util.get_reada
-000179e0: 626c 655f 656e 7469 7479 2863 6f6e 7465  ble_entity(conte
-000179f0: 6e74 2c20 7365 6c66 2e63 6875 6e6b 5f73  nt, self.chunk_s
-00017a00: 697a 652c 206e 6f74 6966 6965 7229 0a20  ize, notifier). 
-00017a10: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00017a20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00017a30: 2020 2020 2020 2020 2068 6561 6465 7273           headers
-00017a40: 5b63 6f6e 7374 2e43 4f4e 5445 4e54 5f4c  [const.CONTENT_L
-00017a50: 454e 4754 485f 4845 4144 4552 5d20 3d20  ENGTH_HEADER] = 
-00017a60: 7574 696c 2e74 6f5f 7374 7269 6e67 2870  util.to_string(p
-00017a70: 6172 7453 697a 6529 0a20 2020 2020 2020  artSize).       
-00017a80: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
-00017a90: 6974 7920 3d20 7574 696c 2e67 6574 5f65  ity = util.get_e
-00017aa0: 6e74 6974 795f 666f 725f 7365 6e64 5f77  ntity_for_send_w
-00017ab0: 6974 685f 746f 7461 6c5f 636f 756e 7428  ith_total_count(
-00017ac0: 7265 6164 5f61 626c 653d 636f 6e74 656e  read_able=conten
-00017ad0: 742c 2074 6f74 616c 436f 756e 743d 7574  t, totalCount=ut
-00017ae0: 696c 2e74 6f5f 6c6f 6e67 2870 6172 7453  il.to_long(partS
-00017af0: 697a 6529 2c0a 2020 2020 2020 2020 2020  ize),.          
+00017040: 2020 6368 756e 6b65 644d 6f64 6520 3d20    chunkedMode = 
+00017050: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00017060: 2020 2020 2020 2020 206e 6f74 6966 6965           notifie
+00017070: 7220 3d20 7365 6c66 2e5f 6765 745f 6e6f  r = self._get_no
+00017080: 7469 6669 6572 5f77 6974 686f 7574 5f73  tifier_without_s
+00017090: 697a 6528 7072 6f67 7265 7373 4361 6c6c  ize(progressCall
+000170a0: 6261 636b 290a 2020 2020 2020 2020 2020  back).          
+000170b0: 2020 2020 2020 2020 2020 656e 7469 7479            entity
+000170c0: 203d 2075 7469 6c2e 6765 745f 7265 6164   = util.get_read
+000170d0: 6162 6c65 5f65 6e74 6974 7928 636f 6e74  able_entity(cont
+000170e0: 656e 742c 2073 656c 662e 6368 756e 6b5f  ent, self.chunk_
+000170f0: 7369 7a65 2c20 6e6f 7469 6669 6572 2c20  size, notifier, 
+00017100: 6175 746f 436c 6f73 6529 0a20 2020 2020  autoClose).     
+00017110: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00017120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017130: 2020 2020 2068 6561 6465 7273 5b63 6f6e       headers[con
+00017140: 7374 2e43 4f4e 5445 4e54 5f4c 454e 4754  st.CONTENT_LENGT
+00017150: 485f 4845 4144 4552 5d20 3d20 7574 696c  H_HEADER] = util
+00017160: 2e74 6f5f 7374 7269 6e67 2870 6172 7453  .to_string(partS
+00017170: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
+00017180: 2020 2020 2020 2020 2074 6f74 616c 436f           totalCo
+00017190: 756e 7420 3d20 7574 696c 2e74 6f5f 6c6f  unt = util.to_lo
+000171a0: 6e67 2870 6172 7453 697a 6529 0a20 2020  ng(partSize).   
+000171b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000171c0: 206e 6f74 6966 6965 7220 3d20 7365 6c66   notifier = self
+000171d0: 2e5f 6765 745f 6e6f 7469 6669 6572 5f77  ._get_notifier_w
+000171e0: 6974 685f 7369 7a65 2870 726f 6772 6573  ith_size(progres
+000171f0: 7343 616c 6c62 6163 6b2c 2074 6f74 616c  sCallback, total
+00017200: 436f 756e 7429 0a20 2020 2020 2020 2020  Count).         
+00017210: 2020 2020 2020 2020 2020 2065 6e74 6974             entit
+00017220: 7920 3d20 7574 696c 2e67 6574 5f65 6e74  y = util.get_ent
+00017230: 6974 795f 666f 725f 7365 6e64 5f77 6974  ity_for_send_wit
+00017240: 685f 746f 7461 6c5f 636f 756e 7428 7265  h_total_count(re
+00017250: 6164 5f61 626c 653d 636f 6e74 656e 742c  ad_able=content,
+00017260: 2074 6f74 616c 436f 756e 743d 746f 7461   totalCount=tota
+00017270: 6c43 6f75 6e74 2c0a 2020 2020 2020 2020  lCount,.        
+00017280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000172c0: 6875 6e6b 5f73 697a 653d 7365 6c66 2e63  hunk_size=self.c
+000172d0: 6875 6e6b 5f73 697a 652c 206e 6f74 6966  hunk_size, notif
+000172e0: 6965 723d 6e6f 7469 6669 6572 2c0a 2020  ier=notifier,.  
+000172f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017330: 2020 2020 2061 7574 6f5f 636c 6f73 653d       auto_close=
+00017340: 6175 746f 436c 6f73 6529 0a20 2020 2020  autoClose).     
+00017350: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00017360: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
+00017370: 6974 7920 3d20 636f 6e74 656e 740a 2020  ity = content.  
+00017380: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00017390: 2065 6e74 6974 7920 6973 204e 6f6e 653a   entity is None:
+000173a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000173b0: 2020 2020 2065 6e74 6974 7920 3d20 2727       entity = ''
+000173c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000173d0: 2068 6561 6465 7273 203d 2073 656c 662e   headers = self.
+000173e0: 5f67 6574 5f68 6561 6465 7273 286d 6435  _get_headers(md5
+000173f0: 2c20 7373 6548 6561 6465 722c 2068 6561  , sseHeader, hea
+00017400: 6465 7273 290a 0a20 2020 2020 2020 2074  ders)..        t
+00017410: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00017420: 6966 206e 6f74 6966 6965 7220 6973 206e  if notifier is n
+00017430: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00017440: 2020 2020 2020 2020 206e 6f74 6966 6965           notifie
+00017450: 722e 7374 6172 7428 290a 2020 2020 2020  r.start().      
+00017460: 2020 2020 2020 7265 7420 3d20 7365 6c66        ret = self
+00017470: 2e5f 6d61 6b65 5f70 7574 5f72 6571 7565  ._make_put_reque
+00017480: 7374 2862 7563 6b65 744e 616d 652c 206f  st(bucketName, o
+00017490: 626a 6563 744b 6579 2c0a 2020 2020 2020  bjectKey,.      
+000174a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174c0: 2020 2070 6174 6841 7267 733d 7b27 7061     pathArgs={'pa
+000174d0: 7274 4e75 6d62 6572 273a 2070 6172 744e  rtNumber': partN
+000174e0: 756d 6265 722c 2027 7570 6c6f 6164 4964  umber, 'uploadId
+000174f0: 273a 2075 706c 6f61 6449 647d 2c0a 2020  ': uploadId},.  
+00017500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017520: 2020 2020 2020 2068 6561 6465 7273 3d68         headers=h
+00017530: 6561 6465 7273 2c20 656e 7469 7479 3d65  eaders, entity=e
+00017540: 6e74 6974 792c 2063 6875 6e6b 6564 4d6f  ntity, chunkedMo
+00017550: 6465 3d63 6875 6e6b 6564 4d6f 6465 2c0a  de=chunkedMode,.
+00017560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017580: 2020 2020 2020 2020 206d 6574 686f 644e           methodN
+00017590: 616d 653d 2775 706c 6f61 6450 6172 7427  ame='uploadPart'
+000175a0: 2c20 7265 6164 6162 6c65 3d72 6561 6461  , readable=reada
+000175b0: 626c 652c 2065 7874 656e 7369 6f6e 4865  ble, extensionHe
+000175c0: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+000175d0: 6561 6465 7273 290a 2020 2020 2020 2020  eaders).        
+000175e0: 6669 6e61 6c6c 793a 0a20 2020 2020 2020  finally:.       
+000175f0: 2020 2020 2069 6620 6e6f 7469 6669 6572       if notifier
+00017600: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00017610: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+00017620: 7469 6669 6572 2e65 6e64 2829 0a20 2020  tifier.end().   
+00017630: 2020 2020 2072 6574 7572 6e20 7265 740a       return ret.
+00017640: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
+00017650: 6f64 0a20 2020 2064 6566 2063 6865 636b  od.    def check
+00017660: 5f66 696c 655f 7061 7468 2866 696c 655f  _file_path(file_
+00017670: 7061 7468 293a 0a20 2020 2020 2020 2066  path):.        f
+00017680: 696c 655f 7061 7468 203d 2075 7469 6c2e  ile_path = util.
+00017690: 7361 6665 5f65 6e63 6f64 6528 6669 6c65  safe_encode(file
+000176a0: 5f70 6174 6829 0a20 2020 2020 2020 2069  _path).        i
+000176b0: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
+000176c0: 6973 7473 2866 696c 655f 7061 7468 293a  ists(file_path):
+000176d0: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+000176e0: 655f 7061 7468 203d 2075 7469 6c2e 7361  e_path = util.sa
+000176f0: 6665 5f74 7261 6e73 5f74 6f5f 6762 3233  fe_trans_to_gb23
+00017700: 3132 2866 696c 655f 7061 7468 290a 2020  12(file_path).  
+00017710: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00017720: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+00017730: 6669 6c65 5f70 6174 6829 3a0a 2020 2020  file_path):.    
+00017740: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00017750: 6520 4578 6365 7074 696f 6e28 2766 696c  e Exception('fil
+00017760: 6520 5b25 735d 2064 6f65 7320 6e6f 7420  e [%s] does not 
+00017770: 6578 6973 7427 2025 2066 696c 655f 7061  exist' % file_pa
+00017780: 7468 290a 2020 2020 2020 2020 7265 7475  th).        retu
+00017790: 726e 2066 696c 655f 7061 7468 0a0a 2020  rn file_path..  
+000177a0: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
+000177b0: 2064 6566 205f 7570 6c6f 6164 5061 7274   def _uploadPart
+000177c0: 5769 7468 4e6f 7469 6669 6572 2873 656c  WithNotifier(sel
+000177d0: 662c 2062 7563 6b65 744e 616d 652c 206f  f, bucketName, o
+000177e0: 626a 6563 744b 6579 2c20 7061 7274 4e75  bjectKey, partNu
+000177f0: 6d62 6572 2c20 7570 6c6f 6164 4964 2c20  mber, uploadId, 
+00017800: 636f 6e74 656e 743d 4e6f 6e65 2c20 6973  content=None, is
+00017810: 4669 6c65 3d46 616c 7365 2c0a 2020 2020  File=False,.    
+00017820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017830: 2020 2020 2020 2020 2020 2020 7061 7274              part
+00017840: 5369 7a65 3d4e 6f6e 652c 206f 6666 7365  Size=None, offse
+00017850: 743d 302c 2073 7365 4865 6164 6572 3d4e  t=0, sseHeader=N
+00017860: 6f6e 652c 2069 7341 7474 6163 684d 6435  one, isAttachMd5
+00017870: 3d46 616c 7365 2c20 6d64 353d 4e6f 6e65  =False, md5=None
+00017880: 2c20 6e6f 7469 6669 6572 3d4e 6f6e 652c  , notifier=None,
+00017890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000178a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000178b0: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+000178c0: 733d 4e6f 6e65 2c20 6865 6164 6572 733d  s=None, headers=
+000178d0: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
+000178e0: 656c 662e 5f61 7373 6572 745f 6e6f 745f  elf._assert_not_
+000178f0: 6e75 6c6c 2870 6172 744e 756d 6265 722c  null(partNumber,
+00017900: 2027 7061 7274 4e75 6d62 6572 2069 7320   'partNumber is 
+00017910: 656d 7074 7927 290a 2020 2020 2020 2020  empty').        
+00017920: 7365 6c66 2e5f 6173 7365 7274 5f6e 6f74  self._assert_not
+00017930: 5f6e 756c 6c28 7570 6c6f 6164 4964 2c20  _null(uploadId, 
+00017940: 2775 706c 6f61 6449 6420 6973 2065 6d70  'uploadId is emp
+00017950: 7479 2729 0a0a 2020 2020 2020 2020 6368  ty')..        ch
+00017960: 756e 6b65 644d 6f64 6520 3d20 4661 6c73  unkedMode = Fals
+00017970: 650a 2020 2020 2020 2020 7265 6164 6162  e.        readab
+00017980: 6c65 203d 2046 616c 7365 0a20 2020 2020  le = False.     
+00017990: 2020 2069 6620 6865 6164 6572 7320 6973     if headers is
+000179a0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000179b0: 2020 2068 6561 6465 7273 203d 2064 6963     headers = dic
+000179c0: 7428 290a 2020 2020 2020 2020 6966 2069  t().        if i
+000179d0: 7346 696c 653a 0a20 2020 2020 2020 2020  sFile:.         
+000179e0: 2020 2063 6865 636b 6564 5f66 696c 655f     checked_file_
+000179f0: 7061 7274 5f69 6e66 6f20 3d20 7365 6c66  part_info = self
+00017a00: 2e5f 6368 6563 6b5f 6669 6c65 5f70 6172  ._check_file_par
+00017a10: 745f 696e 666f 2863 6f6e 7465 6e74 2c20  t_info(content, 
+00017a20: 6f66 6673 6574 2c20 7061 7274 5369 7a65  offset, partSize
+00017a30: 290a 0a20 2020 2020 2020 2020 2020 2068  )..            h
+00017a40: 6561 6465 7273 5b63 6f6e 7374 2e43 4f4e  eaders[const.CON
+00017a50: 5445 4e54 5f4c 454e 4754 485f 4845 4144  TENT_LENGTH_HEAD
+00017a60: 4552 5d20 3d20 7574 696c 2e74 6f5f 7374  ER] = util.to_st
+00017a70: 7269 6e67 2863 6865 636b 6564 5f66 696c  ring(checked_fil
+00017a80: 655f 7061 7274 5f69 6e66 6f5b 2270 6172  e_part_info["par
+00017a90: 7453 697a 6522 5d29 0a20 2020 2020 2020  tSize"]).       
+00017aa0: 2020 2020 2068 6561 6465 7273 203d 2073       headers = s
+00017ab0: 656c 662e 5f70 7265 7061 7265 5f68 6561  elf._prepare_hea
+00017ac0: 6465 7273 286d 6435 2c20 6973 4174 7461  ders(md5, isAtta
+00017ad0: 6368 4d64 352c 2063 6865 636b 6564 5f66  chMd5, checked_f
+00017ae0: 696c 655f 7061 7274 5f69 6e66 6f5b 2266  ile_part_info["f
+00017af0: 696c 655f 7061 7468 225d 2c0a 2020 2020  ile_path"],.    
 00017b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00017b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b30: 2020 2020 2020 2020 2020 2020 2063 6875               chu
-00017b40: 6e6b 5f73 697a 653d 7365 6c66 2e63 6875  nk_size=self.chu
-00017b50: 6e6b 5f73 697a 652c 206e 6f74 6966 6965  nk_size, notifie
-00017b60: 723d 6e6f 7469 6669 6572 290a 2020 2020  r=notifier).    
-00017b70: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00017b80: 2020 2020 2020 2020 2020 2020 2020 656e                en
-00017b90: 7469 7479 203d 2063 6f6e 7465 6e74 0a20  tity = content. 
-00017ba0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00017bb0: 6620 656e 7469 7479 2069 7320 4e6f 6e65  f entity is None
-00017bc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017bd0: 2020 2020 2020 656e 7469 7479 203d 2027        entity = '
-00017be0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00017bf0: 2020 6865 6164 6572 7320 3d20 7365 6c66    headers = self
-00017c00: 2e5f 6765 745f 6865 6164 6572 7328 6d64  ._get_headers(md
-00017c10: 352c 2073 7365 4865 6164 6572 2c20 6865  5, sseHeader, he
-00017c20: 6164 6572 7329 0a0a 2020 2020 2020 2020  aders)..        
-00017c30: 7265 7420 3d20 7365 6c66 2e5f 6d61 6b65  ret = self._make
-00017c40: 5f70 7574 5f72 6571 7565 7374 2862 7563  _put_request(buc
-00017c50: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
-00017c60: 6579 2c20 7061 7468 4172 6773 3d7b 2770  ey, pathArgs={'p
-00017c70: 6172 744e 756d 6265 7227 3a20 7061 7274  artNumber': part
-00017c80: 4e75 6d62 6572 2c20 2775 706c 6f61 6449  Number, 'uploadI
-00017c90: 6427 3a20 7570 6c6f 6164 4964 7d2c 0a20  d': uploadId},. 
-00017ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017cc0: 2020 2020 6865 6164 6572 733d 6865 6164      headers=head
-00017cd0: 6572 732c 2065 6e74 6974 793d 656e 7469  ers, entity=enti
-00017ce0: 7479 2c20 6368 756e 6b65 644d 6f64 653d  ty, chunkedMode=
-00017cf0: 6368 756e 6b65 644d 6f64 652c 206d 6574  chunkedMode, met
-00017d00: 686f 644e 616d 653d 2775 706c 6f61 6450  hodName='uploadP
-00017d10: 6172 7427 2c0a 2020 2020 2020 2020 2020  art',.          
-00017d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d30: 2020 2020 2020 2020 2020 2072 6561 6461             reada
-00017d40: 626c 653d 7265 6164 6162 6c65 2c20 6578  ble=readable, ex
-00017d50: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
-00017d60: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
-00017d70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00017d80: 7265 740a 0a20 2020 2040 6675 6e63 4361  ret..    @funcCa
-00017d90: 6368 650a 2020 2020 6465 6620 636f 7079  che.    def copy
-00017da0: 4f62 6a65 6374 2873 656c 662c 2073 6f75  Object(self, sou
-00017db0: 7263 6542 7563 6b65 744e 616d 652c 2073  rceBucketName, s
-00017dc0: 6f75 7263 654f 626a 6563 744b 6579 2c20  ourceObjectKey, 
-00017dd0: 6465 7374 4275 636b 6574 4e61 6d65 2c20  destBucketName, 
-00017de0: 6465 7374 4f62 6a65 6374 4b65 792c 206d  destObjectKey, m
-00017df0: 6574 6164 6174 613d 4e6f 6e65 2c20 6865  etadata=None, he
-00017e00: 6164 6572 733d 4e6f 6e65 2c0a 2020 2020  aders=None,.    
-00017e10: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00017e20: 6572 7369 6f6e 4964 3d4e 6f6e 652c 2065  ersionId=None, e
-00017e30: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-00017e40: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
-00017e50: 656c 662e 5f61 7373 6572 745f 6e6f 745f  elf._assert_not_
-00017e60: 6e75 6c6c 2873 6f75 7263 6542 7563 6b65  null(sourceBucke
-00017e70: 744e 616d 652c 2027 736f 7572 6365 4275  tName, 'sourceBu
-00017e80: 636b 6574 4e61 6d65 2069 7320 656d 7074  cketName is empt
-00017e90: 7927 290a 2020 2020 2020 2020 736f 7572  y').        sour
-00017ea0: 6365 4f62 6a65 6374 4b65 7920 3d20 7574  ceObjectKey = ut
-00017eb0: 696c 2e73 6166 655f 656e 636f 6465 2873  il.safe_encode(s
-00017ec0: 6f75 7263 654f 626a 6563 744b 6579 290a  ourceObjectKey).
-00017ed0: 2020 2020 2020 2020 6966 2073 6f75 7263          if sourc
-00017ee0: 654f 626a 6563 744b 6579 2069 7320 4e6f  eObjectKey is No
-00017ef0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00017f00: 736f 7572 6365 4f62 6a65 6374 4b65 7920  sourceObjectKey 
-00017f10: 3d20 2727 0a20 2020 2020 2020 2064 6573  = ''.        des
-00017f20: 744f 626a 6563 744b 6579 203d 2075 7469  tObjectKey = uti
-00017f30: 6c2e 7361 6665 5f65 6e63 6f64 6528 6465  l.safe_encode(de
-00017f40: 7374 4f62 6a65 6374 4b65 7929 0a20 2020  stObjectKey).   
-00017f50: 2020 2020 2069 6620 6465 7374 4f62 6a65       if destObje
-00017f60: 6374 4b65 7920 6973 204e 6f6e 653a 0a20  ctKey is None:. 
-00017f70: 2020 2020 2020 2020 2020 2064 6573 744f             destO
-00017f80: 626a 6563 744b 6579 203d 2027 270a 0a20  bjectKey = ''.. 
-00017f90: 2020 2020 2020 2069 6620 6865 6164 6572         if header
-00017fa0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-00017fb0: 2020 2020 2020 2068 6561 6465 7273 203d         headers =
-00017fc0: 2043 6f70 794f 626a 6563 7448 6561 6465   CopyObjectHeade
-00017fd0: 7228 290a 0a20 2020 2020 2020 2072 6574  r()..        ret
-00017fe0: 7572 6e20 7365 6c66 2e5f 6d61 6b65 5f70  urn self._make_p
-00017ff0: 7574 5f72 6571 7565 7374 2864 6573 7442  ut_request(destB
-00018000: 7563 6b65 744e 616d 652c 2064 6573 744f  ucketName, destO
-00018010: 626a 6563 744b 6579 2c0a 2020 2020 2020  bjectKey,.      
-00018020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018040: 6d65 7468 6f64 4e61 6d65 3d27 636f 7079  methodName='copy
-00018050: 4f62 6a65 6374 272c 2065 7874 656e 7369  Object', extensi
-00018060: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
-00018070: 696f 6e48 6561 6465 7273 2c0a 2020 2020  ionHeaders,.    
-00018080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000180a0: 2020 2a2a 7365 6c66 2e63 6f6e 7665 7274    **self.convert
-000180b0: 6f72 2e74 7261 6e73 5f63 6f70 795f 6f62  or.trans_copy_ob
-000180c0: 6a65 6374 286d 6574 6164 6174 613d 6d65  ject(metadata=me
-000180d0: 7461 6461 7461 2c20 6865 6164 6572 733d  tadata, headers=
-000180e0: 6865 6164 6572 732c 0a20 2020 2020 2020  headers,.       
-000180f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b20: 2020 2020 2020 2020 6368 6563 6b65 645f          checked_
+00017b30: 6669 6c65 5f70 6172 745f 696e 666f 5b22  file_part_info["
+00017b40: 7061 7274 5369 7a65 225d 2c20 6368 6563  partSize"], chec
+00017b50: 6b65 645f 6669 6c65 5f70 6172 745f 696e  ked_file_part_in
+00017b60: 666f 5b22 6f66 6673 6574 225d 2c0a 2020  fo["offset"],.  
+00017b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b90: 2020 2020 2020 2020 2020 7373 6548 6561            sseHea
+00017ba0: 6465 722c 2068 6561 6465 7273 290a 0a20  der, headers).. 
+00017bb0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00017bc0: 7469 6669 6572 2069 7320 6e6f 7420 4e6f  tifier is not No
+00017bd0: 6e65 2061 6e64 206e 6f74 2069 7369 6e73  ne and not isins
+00017be0: 7461 6e63 6528 6e6f 7469 6669 6572 2c20  tance(notifier, 
+00017bf0: 7072 6f67 7265 7373 2e4e 6f6e 654e 6f74  progress.NoneNot
+00017c00: 6966 6965 7229 3a0a 2020 2020 2020 2020  ifier):.        
+00017c10: 2020 2020 2020 2020 7265 6164 6162 6c65          readable
+00017c20: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00017c30: 2020 2020 656e 7469 7479 203d 2075 7469      entity = uti
+00017c40: 6c2e 6765 745f 656e 7469 7479 5f66 6f72  l.get_entity_for
+00017c50: 5f73 656e 645f 7769 7468 5f74 6f74 616c  _send_with_total
+00017c60: 5f63 6f75 6e74 2863 6865 636b 6564 5f66  _count(checked_f
+00017c70: 696c 655f 7061 7274 5f69 6e66 6f5b 2266  ile_part_info["f
+00017c80: 696c 655f 7061 7468 225d 2c20 7061 7274  ile_path"], part
+00017c90: 5369 7a65 2c20 6368 6563 6b65 645f 6669  Size, checked_fi
+00017ca0: 6c65 5f70 6172 745f 696e 666f 5b22 6f66  le_part_info["of
+00017cb0: 6673 6574 225d 2c0a 2020 2020 2020 2020  fset"],.        
+00017cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017cf0: 2020 2020 2020 2073 656c 662e 6368 756e         self.chun
+00017d00: 6b5f 7369 7a65 2c20 6e6f 7469 6669 6572  k_size, notifier
+00017d10: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00017d20: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00017d30: 6f6e 7465 6e74 2069 7320 6e6f 7420 4e6f  ontent is not No
+00017d40: 6e65 2061 6e64 2068 6173 6174 7472 2863  ne and hasattr(c
+00017d50: 6f6e 7465 6e74 2c20 2772 6561 6427 2920  ontent, 'read') 
+00017d60: 616e 6420 6361 6c6c 6162 6c65 2863 6f6e  and callable(con
+00017d70: 7465 6e74 2e72 6561 6429 3a0a 2020 2020  tent.read):.    
+00017d80: 2020 2020 2020 2020 2020 2020 7265 6164              read
+00017d90: 6162 6c65 203d 2054 7275 650a 2020 2020  able = True.    
+00017da0: 2020 2020 2020 2020 2020 2020 6865 6164              head
+00017db0: 6572 7320 3d20 7365 6c66 2e5f 6765 745f  ers = self._get_
+00017dc0: 6865 6164 6572 7328 6d64 352c 2073 7365  headers(md5, sse
+00017dd0: 4865 6164 6572 2c20 6865 6164 6572 7329  Header, headers)
+00017de0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017df0: 2020 6966 2070 6172 7453 697a 6520 6973    if partSize is
+00017e00: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00017e10: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
+00017e20: 6564 4d6f 6465 203d 2054 7275 650a 2020  edMode = True.  
+00017e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e40: 2020 656e 7469 7479 203d 2075 7469 6c2e    entity = util.
+00017e50: 6765 745f 7265 6164 6162 6c65 5f65 6e74  get_readable_ent
+00017e60: 6974 7928 636f 6e74 656e 742c 2073 656c  ity(content, sel
+00017e70: 662e 6368 756e 6b5f 7369 7a65 2c20 6e6f  f.chunk_size, no
+00017e80: 7469 6669 6572 290a 2020 2020 2020 2020  tifier).        
+00017e90: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00017ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017eb0: 2020 6865 6164 6572 735b 636f 6e73 742e    headers[const.
+00017ec0: 434f 4e54 454e 545f 4c45 4e47 5448 5f48  CONTENT_LENGTH_H
+00017ed0: 4541 4445 525d 203d 2075 7469 6c2e 746f  EADER] = util.to
+00017ee0: 5f73 7472 696e 6728 7061 7274 5369 7a65  _string(partSize
+00017ef0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017f00: 2020 2020 2020 656e 7469 7479 203d 2075        entity = u
+00017f10: 7469 6c2e 6765 745f 656e 7469 7479 5f66  til.get_entity_f
+00017f20: 6f72 5f73 656e 645f 7769 7468 5f74 6f74  or_send_with_tot
+00017f30: 616c 5f63 6f75 6e74 2872 6561 645f 6162  al_count(read_ab
+00017f40: 6c65 3d63 6f6e 7465 6e74 2c20 746f 7461  le=content, tota
+00017f50: 6c43 6f75 6e74 3d75 7469 6c2e 746f 5f6c  lCount=util.to_l
+00017f60: 6f6e 6728 7061 7274 5369 7a65 292c 0a20  ong(partSize),. 
+00017f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017fb0: 2020 2020 2020 6368 756e 6b5f 7369 7a65        chunk_size
+00017fc0: 3d73 656c 662e 6368 756e 6b5f 7369 7a65  =self.chunk_size
+00017fd0: 2c20 6e6f 7469 6669 6572 3d6e 6f74 6966  , notifier=notif
+00017fe0: 6965 7229 0a20 2020 2020 2020 2020 2020  ier).           
+00017ff0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00018000: 2020 2020 2020 2065 6e74 6974 7920 3d20         entity = 
+00018010: 636f 6e74 656e 740a 2020 2020 2020 2020  content.        
+00018020: 2020 2020 2020 2020 6966 2065 6e74 6974          if entit
+00018030: 7920 6973 204e 6f6e 653a 0a20 2020 2020  y is None:.     
+00018040: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00018050: 6e74 6974 7920 3d20 2727 0a20 2020 2020  ntity = ''.     
+00018060: 2020 2020 2020 2020 2020 2068 6561 6465             heade
+00018070: 7273 203d 2073 656c 662e 5f67 6574 5f68  rs = self._get_h
+00018080: 6561 6465 7273 286d 6435 2c20 7373 6548  eaders(md5, sseH
+00018090: 6561 6465 722c 2068 6561 6465 7273 290a  eader, headers).
+000180a0: 0a20 2020 2020 2020 2072 6574 203d 2073  .        ret = s
+000180b0: 656c 662e 5f6d 616b 655f 7075 745f 7265  elf._make_put_re
+000180c0: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
+000180d0: 2c20 6f62 6a65 6374 4b65 792c 2070 6174  , objectKey, pat
+000180e0: 6841 7267 733d 7b27 7061 7274 4e75 6d62  hArgs={'partNumb
+000180f0: 6572 273a 2070 6172 744e 756d 6265 722c  er': partNumber,
+00018100: 2027 7570 6c6f 6164 4964 273a 2075 706c   'uploadId': upl
+00018110: 6f61 6449 647d 2c0a 2020 2020 2020 2020  oadId},.        
 00018120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018130: 2020 7665 7273 696f 6e49 643d 7665 7273    versionId=vers
-00018140: 696f 6e49 642c 0a20 2020 2020 2020 2020  ionId,.         
-00018150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018190: 736f 7572 6365 4275 636b 6574 4e61 6d65  sourceBucketName
-000181a0: 3d73 6f75 7263 6542 7563 6b65 744e 616d  =sourceBucketNam
-000181b0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-000181c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000181d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000181e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000181f0: 2020 2020 2020 2020 2020 2020 736f 7572              sour
-00018200: 6365 4f62 6a65 6374 4b65 793d 736f 7572  ceObjectKey=sour
-00018210: 6365 4f62 6a65 6374 4b65 7929 290a 0a20  ceObjectKey)).. 
-00018220: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
-00018230: 2020 6465 6620 7365 744f 626a 6563 7441    def setObjectA
-00018240: 636c 2873 656c 662c 2062 7563 6b65 744e  cl(self, bucketN
-00018250: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
-00018260: 6163 6c3d 4e6f 6e65 2c20 7665 7273 696f  acl=None, versio
-00018270: 6e49 643d 4e6f 6e65 2c20 6163 6c43 6f6e  nId=None, aclCon
-00018280: 7472 6f6c 3d4e 6f6e 652c 2065 7874 656e  trol=None, exten
-00018290: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
-000182a0: 293a 0a20 2020 2020 2020 2069 6620 6163  ):.        if ac
-000182b0: 6c20 6973 204e 6f6e 653a 0a20 2020 2020  l is None:.     
-000182c0: 2020 2020 2020 2061 636c 203d 2041 434c         acl = ACL
-000182d0: 2829 0a20 2020 2020 2020 2069 6620 6163  ().        if ac
-000182e0: 6c20 6973 206e 6f74 204e 6f6e 6520 616e  l is not None an
-000182f0: 6420 6c65 6e28 6163 6c29 203e 2030 2061  d len(acl) > 0 a
-00018300: 6e64 2061 636c 436f 6e74 726f 6c20 6973  nd aclControl is
-00018310: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00018320: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-00018330: 6570 7469 6f6e 2827 426f 7468 2061 636c  eption('Both acl
-00018340: 2061 6e64 2061 636c 436f 6e74 726f 6c20   and aclControl 
-00018350: 6172 6520 7365 7427 290a 2020 2020 2020  are set').      
-00018360: 2020 6966 206e 6f74 2061 636c 2061 6e64    if not acl and
-00018370: 206e 6f74 2061 636c 436f 6e74 726f 6c3a   not aclControl:
-00018380: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00018390: 7365 2045 7863 6570 7469 6f6e 2827 426f  se Exception('Bo
-000183a0: 7468 2061 636c 2061 6e64 2061 636c 436f  th acl and aclCo
-000183b0: 6e74 726f 6c20 6172 6520 6e6f 7420 7365  ntrol are not se
-000183c0: 7427 290a 2020 2020 2020 2020 7265 7475  t').        retu
-000183d0: 726e 2073 656c 662e 5f6d 616b 655f 7075  rn self._make_pu
-000183e0: 745f 7265 7175 6573 7428 6275 636b 6574  t_request(bucket
-000183f0: 4e61 6d65 2c20 6f62 6a65 6374 4b65 792c  Name, objectKey,
-00018400: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-00018410: 733d 6578 7465 6e73 696f 6e48 6561 6465  s=extensionHeade
-00018420: 7273 2c0a 2020 2020 2020 2020 2020 2020  rs,.            
-00018430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018440: 2020 2020 2020 2020 2020 2a2a 7365 6c66            **self
-00018450: 2e63 6f6e 7665 7274 6f72 2e74 7261 6e73  .convertor.trans
-00018460: 5f73 6574 5f6f 626a 6563 745f 6163 6c28  _set_object_acl(
-00018470: 6163 6c3d 6163 6c2c 2076 6572 7369 6f6e  acl=acl, version
-00018480: 4964 3d76 6572 7369 6f6e 4964 2c0a 2020  Id=versionId,.  
-00018490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018130: 2020 2020 2020 2020 2020 2020 2068 6561               hea
+00018140: 6465 7273 3d68 6561 6465 7273 2c20 656e  ders=headers, en
+00018150: 7469 7479 3d65 6e74 6974 792c 2063 6875  tity=entity, chu
+00018160: 6e6b 6564 4d6f 6465 3d63 6875 6e6b 6564  nkedMode=chunked
+00018170: 4d6f 6465 2c20 6d65 7468 6f64 4e61 6d65  Mode, methodName
+00018180: 3d27 7570 6c6f 6164 5061 7274 272c 0a20  ='uploadPart',. 
+00018190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000181a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000181b0: 2020 2020 7265 6164 6162 6c65 3d72 6561      readable=rea
+000181c0: 6461 626c 652c 2065 7874 656e 7369 6f6e  dable, extension
+000181d0: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
+000181e0: 6e48 6561 6465 7273 290a 2020 2020 2020  nHeaders).      
+000181f0: 2020 7265 7475 726e 2072 6574 0a0a 2020    return ret..  
+00018200: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
+00018210: 2064 6566 2063 6f70 794f 626a 6563 7428   def copyObject(
+00018220: 7365 6c66 2c20 736f 7572 6365 4275 636b  self, sourceBuck
+00018230: 6574 4e61 6d65 2c20 736f 7572 6365 4f62  etName, sourceOb
+00018240: 6a65 6374 4b65 792c 2064 6573 7442 7563  jectKey, destBuc
+00018250: 6b65 744e 616d 652c 2064 6573 744f 626a  ketName, destObj
+00018260: 6563 744b 6579 2c20 6d65 7461 6461 7461  ectKey, metadata
+00018270: 3d4e 6f6e 652c 2068 6561 6465 7273 3d4e  =None, headers=N
+00018280: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00018290: 2020 2020 2020 2020 7665 7273 696f 6e49          versionI
+000182a0: 643d 4e6f 6e65 2c20 6578 7465 6e73 696f  d=None, extensio
+000182b0: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
+000182c0: 2020 2020 2020 2020 7365 6c66 2e5f 6173          self._as
+000182d0: 7365 7274 5f6e 6f74 5f6e 756c 6c28 736f  sert_not_null(so
+000182e0: 7572 6365 4275 636b 6574 4e61 6d65 2c20  urceBucketName, 
+000182f0: 2773 6f75 7263 6542 7563 6b65 744e 616d  'sourceBucketNam
+00018300: 6520 6973 2065 6d70 7479 2729 0a20 2020  e is empty').   
+00018310: 2020 2020 2073 6f75 7263 654f 626a 6563       sourceObjec
+00018320: 744b 6579 203d 2075 7469 6c2e 7361 6665  tKey = util.safe
+00018330: 5f65 6e63 6f64 6528 736f 7572 6365 4f62  _encode(sourceOb
+00018340: 6a65 6374 4b65 7929 0a20 2020 2020 2020  jectKey).       
+00018350: 2069 6620 736f 7572 6365 4f62 6a65 6374   if sourceObject
+00018360: 4b65 7920 6973 204e 6f6e 653a 0a20 2020  Key is None:.   
+00018370: 2020 2020 2020 2020 2073 6f75 7263 654f           sourceO
+00018380: 626a 6563 744b 6579 203d 2027 270a 2020  bjectKey = ''.  
+00018390: 2020 2020 2020 6465 7374 4f62 6a65 6374        destObject
+000183a0: 4b65 7920 3d20 7574 696c 2e73 6166 655f  Key = util.safe_
+000183b0: 656e 636f 6465 2864 6573 744f 626a 6563  encode(destObjec
+000183c0: 744b 6579 290a 2020 2020 2020 2020 6966  tKey).        if
+000183d0: 2064 6573 744f 626a 6563 744b 6579 2069   destObjectKey i
+000183e0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+000183f0: 2020 2020 6465 7374 4f62 6a65 6374 4b65      destObjectKe
+00018400: 7920 3d20 2727 0a0a 2020 2020 2020 2020  y = ''..        
+00018410: 6966 2068 6561 6465 7273 2069 7320 4e6f  if headers is No
+00018420: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00018430: 6865 6164 6572 7320 3d20 436f 7079 4f62  headers = CopyOb
+00018440: 6a65 6374 4865 6164 6572 2829 0a0a 2020  jectHeader()..  
+00018450: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00018460: 662e 5f6d 616b 655f 7075 745f 7265 7175  f._make_put_requ
+00018470: 6573 7428 6465 7374 4275 636b 6574 4e61  est(destBucketNa
+00018480: 6d65 2c20 6465 7374 4f62 6a65 6374 4b65  me, destObjectKe
+00018490: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
 000184a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184d0: 2020 2020 2020 2020 2020 6163 6c43 6f6e            aclCon
-000184e0: 7472 6f6c 3d61 636c 436f 6e74 726f 6c29  trol=aclControl)
-000184f0: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
-00018500: 650a 2020 2020 6465 6620 6765 744f 626a  e.    def getObj
-00018510: 6563 7441 636c 2873 656c 662c 2062 7563  ectAcl(self, buc
-00018520: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
-00018530: 6579 2c20 7665 7273 696f 6e49 643d 4e6f  ey, versionId=No
-00018540: 6e65 2c20 6578 7465 6e73 696f 6e48 6561  ne, extensionHea
-00018550: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
-00018560: 2020 2020 7061 7468 4172 6773 203d 207b      pathArgs = {
-00018570: 2761 636c 273a 204e 6f6e 657d 0a20 2020  'acl': None}.   
-00018580: 2020 2020 2069 6620 7665 7273 696f 6e49       if versionI
-00018590: 643a 0a20 2020 2020 2020 2020 2020 2070  d:.            p
-000185a0: 6174 6841 7267 735b 636f 6e73 742e 5645  athArgs[const.VE
-000185b0: 5253 494f 4e5f 4944 5f50 4152 414d 5d20  RSION_ID_PARAM] 
-000185c0: 3d20 7574 696c 2e74 6f5f 7374 7269 6e67  = util.to_string
-000185d0: 2876 6572 7369 6f6e 4964 290a 0a20 2020  (versionId)..   
-000185e0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-000185f0: 2e5f 6d61 6b65 5f67 6574 5f72 6571 7565  ._make_get_reque
-00018600: 7374 2862 7563 6b65 744e 616d 652c 206f  st(bucketName, o
-00018610: 626a 6563 744b 6579 2c20 7061 7468 4172  bjectKey, pathAr
-00018620: 6773 3d70 6174 6841 7267 732c 206d 6574  gs=pathArgs, met
-00018630: 686f 644e 616d 653d 2767 6574 4f62 6a65  hodName='getObje
-00018640: 6374 4163 6c27 2c0a 2020 2020 2020 2020  ctAcl',.        
+000184b0: 2020 2020 2020 2020 206d 6574 686f 644e           methodN
+000184c0: 616d 653d 2763 6f70 794f 626a 6563 7427  ame='copyObject'
+000184d0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+000184e0: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
+000184f0: 6572 732c 0a20 2020 2020 2020 2020 2020  ers,.           
+00018500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018510: 2020 2020 2020 2020 2020 202a 2a73 656c             **sel
+00018520: 662e 636f 6e76 6572 746f 722e 7472 616e  f.convertor.tran
+00018530: 735f 636f 7079 5f6f 626a 6563 7428 6d65  s_copy_object(me
+00018540: 7461 6461 7461 3d6d 6574 6164 6174 612c  tadata=metadata,
+00018550: 2068 6561 6465 7273 3d68 6561 6465 7273   headers=headers
+00018560: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00018570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185a0: 2020 2020 2020 2020 2020 2076 6572 7369             versi
+000185b0: 6f6e 4964 3d76 6572 7369 6f6e 4964 2c0a  onId=versionId,.
+000185c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018600: 2020 2020 2020 2020 2073 6f75 7263 6542           sourceB
+00018610: 7563 6b65 744e 616d 653d 736f 7572 6365  ucketName=source
+00018620: 4275 636b 6574 4e61 6d65 2c0a 2020 2020  BucketName,.    
+00018630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018640: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00018650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018660: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00018670: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
-00018680: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
-00018690: 0a0a 2020 2020 4066 756e 6343 6163 6865  ..    @funcCache
-000186a0: 0a20 2020 2064 6566 2064 656c 6574 654f  .    def deleteO
-000186b0: 626a 6563 7428 7365 6c66 2c20 6275 636b  bject(self, buck
-000186c0: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
-000186d0: 792c 2076 6572 7369 6f6e 4964 3d4e 6f6e  y, versionId=Non
-000186e0: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
-000186f0: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
-00018700: 2020 2070 6174 685f 6172 6773 203d 207b     path_args = {
-00018710: 7d0a 2020 2020 2020 2020 6966 2076 6572  }.        if ver
-00018720: 7369 6f6e 4964 3a0a 2020 2020 2020 2020  sionId:.        
-00018730: 2020 2020 7061 7468 5f61 7267 735b 636f      path_args[co
-00018740: 6e73 742e 5645 5253 494f 4e5f 4944 5f50  nst.VERSION_ID_P
-00018750: 4152 414d 5d20 3d20 7574 696c 2e74 6f5f  ARAM] = util.to_
-00018760: 7374 7269 6e67 2876 6572 7369 6f6e 4964  string(versionId
-00018770: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00018780: 2073 656c 662e 5f6d 616b 655f 6465 6c65   self._make_dele
-00018790: 7465 5f72 6571 7565 7374 2862 7563 6b65  te_request(bucke
-000187a0: 744e 616d 652c 206f 626a 6563 744b 6579  tName, objectKey
-000187b0: 2c20 7061 7468 4172 6773 3d70 6174 685f  , pathArgs=path_
-000187c0: 6172 6773 2c20 6d65 7468 6f64 4e61 6d65  args, methodName
-000187d0: 3d27 6465 6c65 7465 4f62 6a65 6374 272c  ='deleteObject',
-000187e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000187f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018800: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
-00018810: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-00018820: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
-00018830: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
-00018840: 2064 6566 2064 656c 6574 654f 626a 6563   def deleteObjec
-00018850: 7473 2873 656c 662c 2062 7563 6b65 744e  ts(self, bucketN
-00018860: 616d 652c 2064 656c 6574 654f 626a 6563  ame, deleteObjec
-00018870: 7473 5265 7175 6573 742c 2065 7874 656e  tsRequest, exten
-00018880: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
-00018890: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-000188a0: 5f61 7373 6572 745f 6e6f 745f 6e75 6c6c  _assert_not_null
-000188b0: 2864 656c 6574 654f 626a 6563 7473 5265  (deleteObjectsRe
-000188c0: 7175 6573 742c 2027 6465 6c65 7465 4f62  quest, 'deleteOb
-000188d0: 6a65 6374 7352 6571 7565 7374 2069 7320  jectsRequest is 
-000188e0: 656d 7074 7927 290a 2020 2020 2020 2020  empty').        
-000188f0: 7265 7475 726e 2073 656c 662e 5f6d 616b  return self._mak
-00018900: 655f 706f 7374 5f72 6571 7565 7374 2862  e_post_request(b
-00018910: 7563 6b65 744e 616d 652c 206d 6574 686f  ucketName, metho
-00018920: 644e 616d 653d 2764 656c 6574 654f 626a  dName='deleteObj
-00018930: 6563 7473 272c 2065 7874 656e 7369 6f6e  ects', extension
-00018940: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
-00018950: 6e48 6561 6465 7273 2c0a 2020 2020 2020  nHeaders,.      
-00018960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018980: 202a 2a73 656c 662e 636f 6e76 6572 746f   **self.converto
-00018990: 722e 7472 616e 735f 6465 6c65 7465 5f6f  r.trans_delete_o
-000189a0: 626a 6563 7473 2864 656c 6574 654f 626a  bjects(deleteObj
-000189b0: 6563 7473 5265 7175 6573 743d 6465 6c65  ectsRequest=dele
-000189c0: 7465 4f62 6a65 6374 7352 6571 7565 7374  teObjectsRequest
-000189d0: 2929 0a0a 2020 2020 6465 6620 6465 6c65  ))..    def dele
-000189e0: 7465 506f 7369 7846 6c6f 6465 7228 7365  tePosixFloder(se
-000189f0: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
-00018a00: 666f 6c64 6572 4e61 6d65 293a 0a20 2020  folderName):.   
-00018a10: 2020 2020 2073 656c 662e 6c6f 675f 636c       self.log_cl
-00018a20: 6965 6e74 2e6c 6f67 2849 4e46 4f2c 2027  ient.log(INFO, '
-00018a30: 656e 7465 7220 7265 7375 6d65 2064 656c  enter resume del
-00018a40: 6574 6520 706f 7369 7820 666c 6f64 6572  ete posix floder
-00018a50: 2e2e 2e27 290a 2020 2020 2020 2020 7265  ...').        re
-00018a60: 7475 726e 205f 7265 7375 6d65 5f64 656c  turn _resume_del
-00018a70: 6574 6528 6275 636b 6574 4e61 6d65 2c20  ete(bucketName, 
-00018a80: 666f 6c64 6572 4e61 6d65 2c20 7365 6c66  folderName, self
-00018a90: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
-00018aa0: 650a 2020 2020 6465 6620 7265 7374 6f72  e.    def restor
-00018ab0: 654f 626a 6563 7428 7365 6c66 2c20 6275  eObject(self, bu
-00018ac0: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
-00018ad0: 4b65 792c 2064 6179 732c 2074 6965 723d  Key, days, tier=
-00018ae0: 4e6f 6e65 2c20 7665 7273 696f 6e49 643d  None, versionId=
-00018af0: 4e6f 6e65 2c20 6578 7465 6e73 696f 6e48  None, extensionH
-00018b00: 6561 6465 7273 3d4e 6f6e 6529 3a0a 2020  eaders=None):.  
-00018b10: 2020 2020 2020 7365 6c66 2e5f 6173 7365        self._asse
-00018b20: 7274 5f6e 6f74 5f6e 756c 6c28 6461 7973  rt_not_null(days
-00018b30: 2c20 2764 6179 7320 6973 2065 6d70 7479  , 'days is empty
-00018b40: 2729 0a20 2020 2020 2020 2072 6574 7572  ').        retur
-00018b50: 6e20 7365 6c66 2e5f 6d61 6b65 5f70 6f73  n self._make_pos
-00018b60: 745f 7265 7175 6573 7428 6275 636b 6574  t_request(bucket
-00018b70: 4e61 6d65 2c20 6f62 6a65 6374 4b65 792c  Name, objectKey,
-00018b80: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-00018b90: 733d 6578 7465 6e73 696f 6e48 6561 6465  s=extensionHeade
-00018ba0: 7273 2c0a 2020 2020 2020 2020 2020 2020  rs,.            
-00018bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018bc0: 2020 2020 2020 2020 2020 202a 2a73 656c             **sel
-00018bd0: 662e 636f 6e76 6572 746f 722e 7472 616e  f.convertor.tran
-00018be0: 735f 7265 7374 6f72 655f 6f62 6a65 6374  s_restore_object
-00018bf0: 2864 6179 733d 6461 7973 2c20 7469 6572  (days=days, tier
-00018c00: 3d74 6965 722c 2076 6572 7369 6f6e 4964  =tier, versionId
-00018c10: 3d76 6572 7369 6f6e 4964 2929 0a0a 2020  =versionId))..  
-00018c20: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
-00018c30: 2064 6566 2069 6e69 7469 6174 654d 756c   def initiateMul
-00018c40: 7469 7061 7274 5570 6c6f 6164 2873 656c  tipartUpload(sel
-00018c50: 662c 2062 7563 6b65 744e 616d 652c 206f  f, bucketName, o
-00018c60: 626a 6563 744b 6579 2c20 6163 6c3d 4e6f  bjectKey, acl=No
-00018c70: 6e65 2c20 7374 6f72 6167 6543 6c61 7373  ne, storageClass
-00018c80: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
-00018c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ca0: 2020 2020 2020 206d 6574 6164 6174 613d         metadata=
-00018cb0: 4e6f 6e65 2c20 7765 6273 6974 6552 6564  None, websiteRed
-00018cc0: 6972 6563 744c 6f63 6174 696f 6e3d 4e6f  irectLocation=No
-00018cd0: 6e65 2c20 636f 6e74 656e 7454 7970 653d  ne, contentType=
-00018ce0: 4e6f 6e65 2c20 7373 6548 6561 6465 723d  None, sseHeader=
-00018cf0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-00018d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d10: 2020 2020 2020 6578 7069 7265 733d 4e6f        expires=No
-00018d20: 6e65 2c20 6578 7465 6e73 696f 6e47 7261  ne, extensionGra
-00018d30: 6e74 733d 4e6f 6e65 2c20 6578 7465 6e73  nts=None, extens
-00018d40: 696f 6e48 6561 6465 7273 3d4e 6f6e 652c  ionHeaders=None,
-00018d50: 2065 6e63 6f64 696e 675f 7479 7065 3d4e   encoding_type=N
-00018d60: 6f6e 6529 3a0a 2020 2020 2020 2020 6f62  one):.        ob
-00018d70: 6a65 6374 4b65 7920 3d20 7574 696c 2e73  jectKey = util.s
-00018d80: 6166 655f 656e 636f 6465 286f 626a 6563  afe_encode(objec
-00018d90: 744b 6579 290a 2020 2020 2020 2020 6966  tKey).        if
-00018da0: 206f 626a 6563 744b 6579 2069 7320 4e6f   objectKey is No
-00018db0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00018dc0: 6f62 6a65 6374 4b65 7920 3d20 2727 0a0a  objectKey = ''..
-00018dd0: 2020 2020 2020 2020 6966 2063 6f6e 7465          if conte
-00018de0: 6e74 5479 7065 2069 7320 4e6f 6e65 3a0a  ntType is None:.
-00018df0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00018e00: 656e 7454 7970 6520 3d20 636f 6e73 742e  entType = const.
-00018e10: 4d49 4d45 5f54 5950 4553 2e67 6574 286f  MIME_TYPES.get(o
-00018e20: 626a 6563 744b 6579 5b6f 626a 6563 744b  bjectKey[objectK
-00018e30: 6579 2e72 6669 6e64 2827 2e27 2920 2b20  ey.rfind('.') + 
-00018e40: 313a 5d2e 6c6f 7765 7228 2929 0a0a 2020  1:].lower())..  
-00018e50: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00018e60: 662e 5f6d 616b 655f 706f 7374 5f72 6571  f._make_post_req
-00018e70: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
-00018e80: 206f 626a 6563 744b 6579 2c20 6d65 7468   objectKey, meth
-00018e90: 6f64 4e61 6d65 3d27 696e 6974 6961 7465  odName='initiate
-00018ea0: 4d75 6c74 6970 6172 7455 706c 6f61 6427  MultipartUpload'
-00018eb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00018ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ed0: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
-00018ee0: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
-00018ef0: 696f 6e48 6561 6465 7273 2c0a 2020 2020  ionHeaders,.    
-00018f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f20: 2020 202a 2a73 656c 662e 636f 6e76 6572     **self.conver
-00018f30: 746f 722e 0a20 2020 2020 2020 2020 2020  tor..           
-00018f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f50: 2020 2020 2020 2020 2020 2020 7472 616e              tran
-00018f60: 735f 696e 6974 6961 7465 5f6d 756c 7469  s_initiate_multi
-00018f70: 7061 7274 5f75 706c 6f61 6428 6163 6c3d  part_upload(acl=
-00018f80: 6163 6c2c 0a20 2020 2020 2020 2020 2020  acl,.           
-00018f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018fc0: 2020 2020 2020 2020 2020 2020 7374 6f72              stor
-00018fd0: 6167 6543 6c61 7373 3d73 746f 7261 6765  ageClass=storage
-00018fe0: 436c 6173 732c 0a20 2020 2020 2020 2020  Class,.         
-00018ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019020: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-00019030: 7461 6461 7461 3d6d 6574 6164 6174 612c  tadata=metadata,
-00019040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019080: 2020 2020 2020 2020 7765 6273 6974 6552          websiteR
-00019090: 6564 6972 6563 744c 6f63 6174 696f 6e3d  edirectLocation=
-000190a0: 7765 6273 6974 6552 6564 6972 6563 744c  websiteRedirectL
-000190b0: 6f63 6174 696f 6e2c 0a20 2020 2020 2020  ocation,.       
-000190c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019100: 636f 6e74 656e 7454 7970 653d 636f 6e74  contentType=cont
-00019110: 656e 7454 7970 652c 0a20 2020 2020 2020  entType,.       
-00019120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019160: 7373 6548 6561 6465 723d 7373 6548 6561  sseHeader=sseHea
-00019170: 6465 722c 0a20 2020 2020 2020 2020 2020  der,.           
-00019180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191b0: 2020 2020 2020 2020 2020 2020 6578 7069              expi
-000191c0: 7265 733d 6578 7069 7265 732c 0a20 2020  res=expires,.   
-000191d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019210: 2020 2020 6578 7465 6e73 696f 6e47 7261      extensionGra
-00019220: 6e74 733d 6578 7465 6e73 696f 6e47 7261  nts=extensionGra
-00019230: 6e74 732c 0a20 2020 2020 2020 2020 2020  nts,.           
-00019240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019270: 2020 2020 2020 2020 2020 2020 656e 636f              enco
-00019280: 6469 6e67 5f74 7970 653d 656e 636f 6469  ding_type=encodi
-00019290: 6e67 5f74 7970 6529 0a20 2020 2020 2020  ng_type).       
-000192a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192c0: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
-000192d0: 650a 2020 2020 6465 6620 636f 7079 5061  e.    def copyPa
-000192e0: 7274 2873 656c 662c 2062 7563 6b65 744e  rt(self, bucketN
-000192f0: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
-00019300: 7061 7274 4e75 6d62 6572 2c20 7570 6c6f  partNumber, uplo
-00019310: 6164 4964 2c20 636f 7079 536f 7572 6365  adId, copySource
-00019320: 2c20 636f 7079 536f 7572 6365 5261 6e67  , copySourceRang
-00019330: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
-00019340: 2020 2020 2020 2020 2064 6573 7453 7365           destSse
-00019350: 4865 6164 6572 3d4e 6f6e 652c 2073 6f75  Header=None, sou
-00019360: 7263 6553 7365 4865 6164 6572 3d4e 6f6e  rceSseHeader=Non
-00019370: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
-00019380: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
-00019390: 2020 2073 656c 662e 5f61 7373 6572 745f     self._assert_
-000193a0: 6e6f 745f 6e75 6c6c 2870 6172 744e 756d  not_null(partNum
-000193b0: 6265 722c 2027 7061 7274 4e75 6d62 6572  ber, 'partNumber
-000193c0: 2069 7320 656d 7074 7927 290a 2020 2020   is empty').    
-000193d0: 2020 2020 7365 6c66 2e5f 6173 7365 7274      self._assert
-000193e0: 5f6e 6f74 5f6e 756c 6c28 7570 6c6f 6164  _not_null(upload
-000193f0: 4964 2c20 2775 706c 6f61 6449 6420 6973  Id, 'uploadId is
-00019400: 2065 6d70 7479 2729 0a20 2020 2020 2020   empty').       
-00019410: 2073 656c 662e 5f61 7373 6572 745f 6e6f   self._assert_no
-00019420: 745f 6e75 6c6c 2863 6f70 7953 6f75 7263  t_null(copySourc
-00019430: 652c 2027 636f 7079 536f 7572 6365 2069  e, 'copySource i
-00019440: 7320 656d 7074 7927 290a 0a20 2020 2020  s empty')..     
-00019450: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00019460: 6d61 6b65 5f70 7574 5f72 6571 7565 7374  make_put_request
-00019470: 2862 7563 6b65 744e 616d 652c 206f 626a  (bucketName, obj
-00019480: 6563 744b 6579 2c20 6d65 7468 6f64 4e61  ectKey, methodNa
-00019490: 6d65 3d27 636f 7079 5061 7274 272c 2065  me='copyPart', e
-000194a0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-000194b0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-000194c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00018660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018670: 2020 2020 2073 6f75 7263 654f 626a 6563       sourceObjec
+00018680: 744b 6579 3d73 6f75 7263 654f 626a 6563  tKey=sourceObjec
+00018690: 744b 6579 2929 0a0a 2020 2020 4066 756e  tKey))..    @fun
+000186a0: 6343 6163 6865 0a20 2020 2064 6566 2073  cCache.    def s
+000186b0: 6574 4f62 6a65 6374 4163 6c28 7365 6c66  etObjectAcl(self
+000186c0: 2c20 6275 636b 6574 4e61 6d65 2c20 6f62  , bucketName, ob
+000186d0: 6a65 6374 4b65 792c 2061 636c 3d4e 6f6e  jectKey, acl=Non
+000186e0: 652c 2076 6572 7369 6f6e 4964 3d4e 6f6e  e, versionId=Non
+000186f0: 652c 2061 636c 436f 6e74 726f 6c3d 4e6f  e, aclControl=No
+00018700: 6e65 2c20 6578 7465 6e73 696f 6e48 6561  ne, extensionHea
+00018710: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
+00018720: 2020 2020 6966 2061 636c 2069 7320 4e6f      if acl is No
+00018730: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00018740: 6163 6c20 3d20 4143 4c28 290a 2020 2020  acl = ACL().    
+00018750: 2020 2020 6966 2061 636c 2069 7320 6e6f      if acl is no
+00018760: 7420 4e6f 6e65 2061 6e64 206c 656e 2861  t None and len(a
+00018770: 636c 2920 3e20 3020 616e 6420 6163 6c43  cl) > 0 and aclC
+00018780: 6f6e 7472 6f6c 2069 7320 6e6f 7420 4e6f  ontrol is not No
+00018790: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000187a0: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+000187b0: 2742 6f74 6820 6163 6c20 616e 6420 6163  'Both acl and ac
+000187c0: 6c43 6f6e 7472 6f6c 2061 7265 2073 6574  lControl are set
+000187d0: 2729 0a20 2020 2020 2020 2069 6620 6e6f  ').        if no
+000187e0: 7420 6163 6c20 616e 6420 6e6f 7420 6163  t acl and not ac
+000187f0: 6c43 6f6e 7472 6f6c 3a0a 2020 2020 2020  lControl:.      
+00018800: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+00018810: 7074 696f 6e28 2742 6f74 6820 6163 6c20  ption('Both acl 
+00018820: 616e 6420 6163 6c43 6f6e 7472 6f6c 2061  and aclControl a
+00018830: 7265 206e 6f74 2073 6574 2729 0a20 2020  re not set').   
+00018840: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00018850: 2e5f 6d61 6b65 5f70 7574 5f72 6571 7565  ._make_put_reque
+00018860: 7374 2862 7563 6b65 744e 616d 652c 206f  st(bucketName, o
+00018870: 626a 6563 744b 6579 2c20 6578 7465 6e73  bjectKey, extens
+00018880: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
+00018890: 7369 6f6e 4865 6164 6572 732c 0a20 2020  sionHeaders,.   
+000188a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188c0: 2020 202a 2a73 656c 662e 636f 6e76 6572     **self.conver
+000188d0: 746f 722e 7472 616e 735f 7365 745f 6f62  tor.trans_set_ob
+000188e0: 6a65 6374 5f61 636c 2861 636c 3d61 636c  ject_acl(acl=acl
+000188f0: 2c20 7665 7273 696f 6e49 643d 7665 7273  , versionId=vers
+00018900: 696f 6e49 642c 0a20 2020 2020 2020 2020  ionId,.         
+00018910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018950: 2020 2061 636c 436f 6e74 726f 6c3d 6163     aclControl=ac
+00018960: 6c43 6f6e 7472 6f6c 2929 0a0a 2020 2020  lControl))..    
+00018970: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
+00018980: 6566 2067 6574 4f62 6a65 6374 4163 6c28  ef getObjectAcl(
+00018990: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
+000189a0: 2c20 6f62 6a65 6374 4b65 792c 2076 6572  , objectKey, ver
+000189b0: 7369 6f6e 4964 3d4e 6f6e 652c 2065 7874  sionId=None, ext
+000189c0: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
+000189d0: 6e65 293a 0a20 2020 2020 2020 2070 6174  ne):.        pat
+000189e0: 6841 7267 7320 3d20 7b27 6163 6c27 3a20  hArgs = {'acl': 
+000189f0: 4e6f 6e65 7d0a 2020 2020 2020 2020 6966  None}.        if
+00018a00: 2076 6572 7369 6f6e 4964 3a0a 2020 2020   versionId:.    
+00018a10: 2020 2020 2020 2020 7061 7468 4172 6773          pathArgs
+00018a20: 5b63 6f6e 7374 2e56 4552 5349 4f4e 5f49  [const.VERSION_I
+00018a30: 445f 5041 5241 4d5d 203d 2075 7469 6c2e  D_PARAM] = util.
+00018a40: 746f 5f73 7472 696e 6728 7665 7273 696f  to_string(versio
+00018a50: 6e49 6429 0a0a 2020 2020 2020 2020 7265  nId)..        re
+00018a60: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
+00018a70: 6765 745f 7265 7175 6573 7428 6275 636b  get_request(buck
+00018a80: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
+00018a90: 792c 2070 6174 6841 7267 733d 7061 7468  y, pathArgs=path
+00018aa0: 4172 6773 2c20 6d65 7468 6f64 4e61 6d65  Args, methodName
+00018ab0: 3d27 6765 744f 626a 6563 7441 636c 272c  ='getObjectAcl',
+00018ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ae0: 2020 2020 2020 2065 7874 656e 7369 6f6e         extension
+00018af0: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
+00018b00: 6e48 6561 6465 7273 290a 0a20 2020 2040  nHeaders)..    @
+00018b10: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
+00018b20: 6620 6465 6c65 7465 4f62 6a65 6374 2873  f deleteObject(s
+00018b30: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+00018b40: 206f 626a 6563 744b 6579 2c20 7665 7273   objectKey, vers
+00018b50: 696f 6e49 643d 4e6f 6e65 2c20 6578 7465  ionId=None, exte
+00018b60: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
+00018b70: 6529 3a0a 2020 2020 2020 2020 7061 7468  e):.        path
+00018b80: 5f61 7267 7320 3d20 7b7d 0a20 2020 2020  _args = {}.     
+00018b90: 2020 2069 6620 7665 7273 696f 6e49 643a     if versionId:
+00018ba0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+00018bb0: 685f 6172 6773 5b63 6f6e 7374 2e56 4552  h_args[const.VER
+00018bc0: 5349 4f4e 5f49 445f 5041 5241 4d5d 203d  SION_ID_PARAM] =
+00018bd0: 2075 7469 6c2e 746f 5f73 7472 696e 6728   util.to_string(
+00018be0: 7665 7273 696f 6e49 6429 0a20 2020 2020  versionId).     
+00018bf0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00018c00: 6d61 6b65 5f64 656c 6574 655f 7265 7175  make_delete_requ
+00018c10: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
+00018c20: 6f62 6a65 6374 4b65 792c 2070 6174 6841  objectKey, pathA
+00018c30: 7267 733d 7061 7468 5f61 7267 732c 206d  rgs=path_args, m
+00018c40: 6574 686f 644e 616d 653d 2764 656c 6574  ethodName='delet
+00018c50: 654f 626a 6563 7427 2c0a 2020 2020 2020  eObject',.      
+00018c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c80: 2020 2065 7874 656e 7369 6f6e 4865 6164     extensionHead
+00018c90: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
+00018ca0: 6465 7273 290a 0a20 2020 2040 6675 6e63  ders)..    @func
+00018cb0: 4361 6368 650a 2020 2020 6465 6620 6465  Cache.    def de
+00018cc0: 6c65 7465 4f62 6a65 6374 7328 7365 6c66  leteObjects(self
+00018cd0: 2c20 6275 636b 6574 4e61 6d65 2c20 6465  , bucketName, de
+00018ce0: 6c65 7465 4f62 6a65 6374 7352 6571 7565  leteObjectsReque
+00018cf0: 7374 2c20 6578 7465 6e73 696f 6e48 6561  st, extensionHea
+00018d00: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
+00018d10: 2020 2020 7365 6c66 2e5f 6173 7365 7274      self._assert
+00018d20: 5f6e 6f74 5f6e 756c 6c28 6465 6c65 7465  _not_null(delete
+00018d30: 4f62 6a65 6374 7352 6571 7565 7374 2c20  ObjectsRequest, 
+00018d40: 2764 656c 6574 654f 626a 6563 7473 5265  'deleteObjectsRe
+00018d50: 7175 6573 7420 6973 2065 6d70 7479 2729  quest is empty')
+00018d60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00018d70: 7365 6c66 2e5f 6d61 6b65 5f70 6f73 745f  self._make_post_
+00018d80: 7265 7175 6573 7428 6275 636b 6574 4e61  request(bucketNa
+00018d90: 6d65 2c20 6d65 7468 6f64 4e61 6d65 3d27  me, methodName='
+00018da0: 6465 6c65 7465 4f62 6a65 6374 7327 2c20  deleteObjects', 
+00018db0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+00018dc0: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
+00018dd0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00018de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018df0: 2020 2020 2020 2020 2020 2a2a 7365 6c66            **self
+00018e00: 2e63 6f6e 7665 7274 6f72 2e74 7261 6e73  .convertor.trans
+00018e10: 5f64 656c 6574 655f 6f62 6a65 6374 7328  _delete_objects(
+00018e20: 6465 6c65 7465 4f62 6a65 6374 7352 6571  deleteObjectsReq
+00018e30: 7565 7374 3d64 656c 6574 654f 626a 6563  uest=deleteObjec
+00018e40: 7473 5265 7175 6573 7429 290a 0a20 2020  tsRequest))..   
+00018e50: 2064 6566 2064 656c 6574 6550 6f73 6978   def deletePosix
+00018e60: 466c 6f64 6572 2873 656c 662c 2062 7563  Floder(self, buc
+00018e70: 6b65 744e 616d 652c 2066 6f6c 6465 724e  ketName, folderN
+00018e80: 616d 6529 3a0a 2020 2020 2020 2020 7365  ame):.        se
+00018e90: 6c66 2e6c 6f67 5f63 6c69 656e 742e 6c6f  lf.log_client.lo
+00018ea0: 6728 494e 464f 2c20 2765 6e74 6572 2072  g(INFO, 'enter r
+00018eb0: 6573 756d 6520 6465 6c65 7465 2070 6f73  esume delete pos
+00018ec0: 6978 2066 6c6f 6465 722e 2e2e 2729 0a20  ix floder...'). 
+00018ed0: 2020 2020 2020 2072 6574 7572 6e20 5f72         return _r
+00018ee0: 6573 756d 655f 6465 6c65 7465 2862 7563  esume_delete(buc
+00018ef0: 6b65 744e 616d 652c 2066 6f6c 6465 724e  ketName, folderN
+00018f00: 616d 652c 2073 656c 6629 0a0a 2020 2020  ame, self)..    
+00018f10: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
+00018f20: 6566 2072 6573 746f 7265 4f62 6a65 6374  ef restoreObject
+00018f30: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
+00018f40: 652c 206f 626a 6563 744b 6579 2c20 6461  e, objectKey, da
+00018f50: 7973 2c20 7469 6572 3d4e 6f6e 652c 2076  ys, tier=None, v
+00018f60: 6572 7369 6f6e 4964 3d4e 6f6e 652c 2065  ersionId=None, e
+00018f70: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+00018f80: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
+00018f90: 656c 662e 5f61 7373 6572 745f 6e6f 745f  elf._assert_not_
+00018fa0: 6e75 6c6c 2864 6179 732c 2027 6461 7973  null(days, 'days
+00018fb0: 2069 7320 656d 7074 7927 290a 2020 2020   is empty').    
+00018fc0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00018fd0: 5f6d 616b 655f 706f 7374 5f72 6571 7565  _make_post_reque
+00018fe0: 7374 2862 7563 6b65 744e 616d 652c 206f  st(bucketName, o
+00018ff0: 626a 6563 744b 6579 2c20 6578 7465 6e73  bjectKey, extens
+00019000: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
+00019010: 7369 6f6e 4865 6164 6572 732c 0a20 2020  sionHeaders,.   
+00019020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019040: 2020 2020 2a2a 7365 6c66 2e63 6f6e 7665      **self.conve
+00019050: 7274 6f72 2e74 7261 6e73 5f72 6573 746f  rtor.trans_resto
+00019060: 7265 5f6f 626a 6563 7428 6461 7973 3d64  re_object(days=d
+00019070: 6179 732c 2074 6965 723d 7469 6572 2c20  ays, tier=tier, 
+00019080: 7665 7273 696f 6e49 643d 7665 7273 696f  versionId=versio
+00019090: 6e49 6429 290a 0a20 2020 2040 6675 6e63  nId))..    @func
+000190a0: 4361 6368 650a 2020 2020 6465 6620 696e  Cache.    def in
+000190b0: 6974 6961 7465 4d75 6c74 6970 6172 7455  itiateMultipartU
+000190c0: 706c 6f61 6428 7365 6c66 2c20 6275 636b  pload(self, buck
+000190d0: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
+000190e0: 792c 2061 636c 3d4e 6f6e 652c 2073 746f  y, acl=None, sto
+000190f0: 7261 6765 436c 6173 733d 4e6f 6e65 2c0a  rageClass=None,.
+00019100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019120: 6d65 7461 6461 7461 3d4e 6f6e 652c 2077  metadata=None, w
+00019130: 6562 7369 7465 5265 6469 7265 6374 4c6f  ebsiteRedirectLo
+00019140: 6361 7469 6f6e 3d4e 6f6e 652c 2063 6f6e  cation=None, con
+00019150: 7465 6e74 5479 7065 3d4e 6f6e 652c 2073  tentType=None, s
+00019160: 7365 4865 6164 6572 3d4e 6f6e 652c 0a20  seHeader=None,. 
+00019170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019180: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00019190: 7870 6972 6573 3d4e 6f6e 652c 2065 7874  xpires=None, ext
+000191a0: 656e 7369 6f6e 4772 616e 7473 3d4e 6f6e  ensionGrants=Non
+000191b0: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
+000191c0: 6572 733d 4e6f 6e65 2c20 656e 636f 6469  ers=None, encodi
+000191d0: 6e67 5f74 7970 653d 4e6f 6e65 293a 0a20  ng_type=None):. 
+000191e0: 2020 2020 2020 206f 626a 6563 744b 6579         objectKey
+000191f0: 203d 2075 7469 6c2e 7361 6665 5f65 6e63   = util.safe_enc
+00019200: 6f64 6528 6f62 6a65 6374 4b65 7929 0a20  ode(objectKey). 
+00019210: 2020 2020 2020 2069 6620 6f62 6a65 6374         if object
+00019220: 4b65 7920 6973 204e 6f6e 653a 0a20 2020  Key is None:.   
+00019230: 2020 2020 2020 2020 206f 626a 6563 744b           objectK
+00019240: 6579 203d 2027 270a 0a20 2020 2020 2020  ey = ''..       
+00019250: 2069 6620 636f 6e74 656e 7454 7970 6520   if contentType 
+00019260: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00019270: 2020 2020 2063 6f6e 7465 6e74 5479 7065       contentType
+00019280: 203d 2063 6f6e 7374 2e4d 494d 455f 5459   = const.MIME_TY
+00019290: 5045 532e 6765 7428 6f62 6a65 6374 4b65  PES.get(objectKe
+000192a0: 795b 6f62 6a65 6374 4b65 792e 7266 696e  y[objectKey.rfin
+000192b0: 6428 272e 2729 202b 2031 3a5d 2e6c 6f77  d('.') + 1:].low
+000192c0: 6572 2829 290a 0a20 2020 2020 2020 2072  er())..        r
+000192d0: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
+000192e0: 5f70 6f73 745f 7265 7175 6573 7428 6275  _post_request(bu
+000192f0: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
+00019300: 4b65 792c 206d 6574 686f 644e 616d 653d  Key, methodName=
+00019310: 2769 6e69 7469 6174 654d 756c 7469 7061  'initiateMultipa
+00019320: 7274 5570 6c6f 6164 272c 0a20 2020 2020  rtUpload',.     
+00019330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019350: 2020 6578 7465 6e73 696f 6e48 6561 6465    extensionHeade
+00019360: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
+00019370: 6572 732c 0a20 2020 2020 2020 2020 2020  ers,.           
+00019380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019390: 2020 2020 2020 2020 2020 2020 2a2a 7365              **se
+000193a0: 6c66 2e63 6f6e 7665 7274 6f72 2e0a 2020  lf.convertor..  
+000193b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000193c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000193d0: 2020 2020 2074 7261 6e73 5f69 6e69 7469       trans_initi
+000193e0: 6174 655f 6d75 6c74 6970 6172 745f 7570  ate_multipart_up
+000193f0: 6c6f 6164 2861 636c 3d61 636c 2c0a 2020  load(acl=acl,.  
+00019400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019440: 2020 2020 2073 746f 7261 6765 436c 6173       storageClas
+00019450: 733d 7374 6f72 6167 6543 6c61 7373 2c0a  s=storageClass,.
+00019460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194a0: 2020 2020 2020 206d 6574 6164 6174 613d         metadata=
+000194b0: 6d65 7461 6461 7461 2c0a 2020 2020 2020  metadata,.      
+000194c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000194d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194e0: 2020 2020 2020 2020 2a2a 7365 6c66 2e63          **self.c
-000194f0: 6f6e 7665 7274 6f72 2e74 7261 6e73 5f63  onvertor.trans_c
-00019500: 6f70 795f 7061 7274 2870 6172 744e 756d  opy_part(partNum
-00019510: 6265 723d 7061 7274 4e75 6d62 6572 2c20  ber=partNumber, 
-00019520: 7570 6c6f 6164 4964 3d75 706c 6f61 6449  uploadId=uploadI
-00019530: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+000194e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019500: 2077 6562 7369 7465 5265 6469 7265 6374   websiteRedirect
+00019510: 4c6f 6361 7469 6f6e 3d77 6562 7369 7465  Location=website
+00019520: 5265 6469 7265 6374 4c6f 6361 7469 6f6e  RedirectLocation
+00019530: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 00019540: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019550: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019570: 2020 2020 2020 2020 2020 636f 7079 536f            copySo
-00019580: 7572 6365 3d63 6f70 7953 6f75 7263 652c  urce=copySource,
-00019590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019570: 2020 2020 2020 2020 2063 6f6e 7465 6e74           content
+00019580: 5479 7065 3d63 6f6e 7465 6e74 5479 7065  Type=contentType
+00019590: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 000195a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000195b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000195c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195d0: 2020 2020 2020 2020 636f 7079 536f 7572          copySour
-000195e0: 6365 5261 6e67 653d 636f 7079 536f 7572  ceRange=copySour
-000195f0: 6365 5261 6e67 652c 0a20 2020 2020 2020  ceRange,.       
+000195d0: 2020 2020 2020 2020 2073 7365 4865 6164           sseHead
+000195e0: 6572 3d73 7365 4865 6164 6572 2c0a 2020  er=sseHeader,.  
+000195f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019600: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019610: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019640: 6465 7374 5373 6548 6561 6465 723d 6465  destSseHeader=de
-00019650: 7374 5373 6548 6561 6465 722c 0a20 2020  stSseHeader,.   
+00019630: 2020 2020 2065 7870 6972 6573 3d65 7870       expires=exp
+00019640: 6972 6573 2c0a 2020 2020 2020 2020 2020  ires,.          
+00019650: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019660: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196a0: 2020 2020 736f 7572 6365 5373 6548 6561      sourceSseHea
-000196b0: 6465 723d 736f 7572 6365 5373 6548 6561  der=sourceSseHea
-000196c0: 6465 7229 290a 0a20 2020 2040 6675 6e63  der))..    @func
-000196d0: 4361 6368 650a 2020 2020 6465 6620 636f  Cache.    def co
-000196e0: 6d70 6c65 7465 4d75 6c74 6970 6172 7455  mpleteMultipartU
-000196f0: 706c 6f61 6428 7365 6c66 2c20 6275 636b  pload(self, buck
-00019700: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
-00019710: 792c 2075 706c 6f61 6449 642c 2063 6f6d  y, uploadId, com
-00019720: 706c 6574 654d 756c 7469 7061 7274 5570  pleteMultipartUp
-00019730: 6c6f 6164 5265 7175 6573 742c 0a20 2020  loadRequest,.   
-00019740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019750: 2020 2020 2020 2020 2020 2020 2065 7874               ext
-00019760: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
-00019770: 6e65 2c20 656e 636f 6469 6e67 5f74 7970  ne, encoding_typ
-00019780: 653d 4e6f 6e65 293a 0a20 2020 2020 2020  e=None):.       
-00019790: 2073 656c 662e 5f61 7373 6572 745f 6e6f   self._assert_no
-000197a0: 745f 6e75 6c6c 2875 706c 6f61 6449 642c  t_null(uploadId,
-000197b0: 2027 7570 6c6f 6164 4964 2069 7320 656d   'uploadId is em
-000197c0: 7074 7927 290a 2020 2020 2020 2020 7365  pty').        se
-000197d0: 6c66 2e5f 6173 7365 7274 5f6e 6f74 5f6e  lf._assert_not_n
-000197e0: 756c 6c28 636f 6d70 6c65 7465 4d75 6c74  ull(completeMult
-000197f0: 6970 6172 7455 706c 6f61 6452 6571 7565  ipartUploadReque
-00019800: 7374 2c20 2763 6f6d 706c 6574 654d 756c  st, 'completeMul
-00019810: 7469 7061 7274 5570 6c6f 6164 5265 7175  tipartUploadRequ
-00019820: 6573 7420 6973 2065 6d70 7479 2729 0a20  est is empty'). 
-00019830: 2020 2020 2020 2070 6174 6841 7267 7320         pathArgs 
-00019840: 3d20 7b27 7570 6c6f 6164 4964 273a 2075  = {'uploadId': u
-00019850: 706c 6f61 6449 647d 0a20 2020 2020 2020  ploadId}.       
-00019860: 2069 6620 656e 636f 6469 6e67 5f74 7970   if encoding_typ
-00019870: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-00019880: 2020 2020 2020 2020 2020 2070 6174 6841             pathA
-00019890: 7267 735b 2265 6e63 6f64 696e 672d 7479  rgs["encoding-ty
-000198a0: 7065 225d 203d 2065 6e63 6f64 696e 675f  pe"] = encoding_
-000198b0: 7479 7065 0a20 2020 2020 2020 2072 6574  type.        ret
-000198c0: 203d 2073 656c 662e 5f6d 616b 655f 706f   = self._make_po
-000198d0: 7374 5f72 6571 7565 7374 2862 7563 6b65  st_request(bucke
-000198e0: 744e 616d 652c 206f 626a 6563 744b 6579  tName, objectKey
-000198f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00019900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019910: 2020 2020 2020 2020 7061 7468 4172 6773          pathArgs
-00019920: 3d70 6174 6841 7267 732c 0a20 2020 2020  =pathArgs,.     
-00019930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019680: 2020 2020 2020 2020 2020 2020 2065 7874               ext
+00019690: 656e 7369 6f6e 4772 616e 7473 3d65 7874  ensionGrants=ext
+000196a0: 656e 7369 6f6e 4772 616e 7473 2c0a 2020  ensionGrants,.  
+000196b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196f0: 2020 2020 2065 6e63 6f64 696e 675f 7479       encoding_ty
+00019700: 7065 3d65 6e63 6f64 696e 675f 7479 7065  pe=encoding_type
+00019710: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00019720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019730: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00019740: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
+00019750: 6566 2063 6f70 7950 6172 7428 7365 6c66  ef copyPart(self
+00019760: 2c20 6275 636b 6574 4e61 6d65 2c20 6f62  , bucketName, ob
+00019770: 6a65 6374 4b65 792c 2070 6172 744e 756d  jectKey, partNum
+00019780: 6265 722c 2075 706c 6f61 6449 642c 2063  ber, uploadId, c
+00019790: 6f70 7953 6f75 7263 652c 2063 6f70 7953  opySource, copyS
+000197a0: 6f75 7263 6552 616e 6765 3d4e 6f6e 652c  ourceRange=None,
+000197b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000197c0: 2020 6465 7374 5373 6548 6561 6465 723d    destSseHeader=
+000197d0: 4e6f 6e65 2c20 736f 7572 6365 5373 6548  None, sourceSseH
+000197e0: 6561 6465 723d 4e6f 6e65 2c20 6578 7465  eader=None, exte
+000197f0: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
+00019800: 6529 3a0a 2020 2020 2020 2020 7365 6c66  e):.        self
+00019810: 2e5f 6173 7365 7274 5f6e 6f74 5f6e 756c  ._assert_not_nul
+00019820: 6c28 7061 7274 4e75 6d62 6572 2c20 2770  l(partNumber, 'p
+00019830: 6172 744e 756d 6265 7220 6973 2065 6d70  artNumber is emp
+00019840: 7479 2729 0a20 2020 2020 2020 2073 656c  ty').        sel
+00019850: 662e 5f61 7373 6572 745f 6e6f 745f 6e75  f._assert_not_nu
+00019860: 6c6c 2875 706c 6f61 6449 642c 2027 7570  ll(uploadId, 'up
+00019870: 6c6f 6164 4964 2069 7320 656d 7074 7927  loadId is empty'
+00019880: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+00019890: 6173 7365 7274 5f6e 6f74 5f6e 756c 6c28  assert_not_null(
+000198a0: 636f 7079 536f 7572 6365 2c20 2763 6f70  copySource, 'cop
+000198b0: 7953 6f75 7263 6520 6973 2065 6d70 7479  ySource is empty
+000198c0: 2729 0a0a 2020 2020 2020 2020 7265 7475  ')..        retu
+000198d0: 726e 2073 656c 662e 5f6d 616b 655f 7075  rn self._make_pu
+000198e0: 745f 7265 7175 6573 7428 6275 636b 6574  t_request(bucket
+000198f0: 4e61 6d65 2c20 6f62 6a65 6374 4b65 792c  Name, objectKey,
+00019900: 206d 6574 686f 644e 616d 653d 2763 6f70   methodName='cop
+00019910: 7950 6172 7427 2c20 6578 7465 6e73 696f  yPart', extensio
+00019920: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
+00019930: 6f6e 4865 6164 6572 732c 0a20 2020 2020  onHeaders,.     
 00019940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019950: 2065 6e74 6974 793d 7365 6c66 2e63 6f6e   entity=self.con
-00019960: 7665 7274 6f72 2e74 7261 6e73 5f63 6f6d  vertor.trans_com
-00019970: 706c 6574 655f 6d75 6c74 6970 6172 745f  plete_multipart_
-00019980: 7570 6c6f 6164 5f72 6571 7565 7374 280a  upload_request(.
-00019990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000199a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000199b0: 2020 2020 2020 2020 2020 636f 6d70 6c65            comple
-000199c0: 7465 4d75 6c74 6970 6172 7455 706c 6f61  teMultipartUploa
-000199d0: 6452 6571 7565 7374 292c 206d 6574 686f  dRequest), metho
-000199e0: 644e 616d 653d 2763 6f6d 706c 6574 654d  dName='completeM
-000199f0: 756c 7469 7061 7274 5570 6c6f 6164 272c  ultipartUpload',
-00019a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019960: 202a 2a73 656c 662e 636f 6e76 6572 746f   **self.converto
+00019970: 722e 7472 616e 735f 636f 7079 5f70 6172  r.trans_copy_par
+00019980: 7428 7061 7274 4e75 6d62 6572 3d70 6172  t(partNumber=par
+00019990: 744e 756d 6265 722c 2075 706c 6f61 6449  tNumber, uploadI
+000199a0: 643d 7570 6c6f 6164 4964 2c0a 2020 2020  d=uploadId,.    
+000199b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000199c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000199d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000199e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000199f0: 2020 2063 6f70 7953 6f75 7263 653d 636f     copySource=co
+00019a00: 7079 536f 7572 6365 2c0a 2020 2020 2020  pySource,.      
 00019a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019a20: 2020 2020 2020 2065 7874 656e 7369 6f6e         extension
-00019a30: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
-00019a40: 6e48 6561 6465 7273 290a 2020 2020 2020  nHeaders).      
-00019a50: 2020 7365 6c66 2e5f 6765 6e65 7261 7465    self._generate
-00019a60: 5f6f 626a 6563 745f 7572 6c28 7265 742c  _object_url(ret,
-00019a70: 2062 7563 6b65 744e 616d 652c 206f 626a   bucketName, obj
-00019a80: 6563 744b 6579 290a 2020 2020 2020 2020  ectKey).        
-00019a90: 7265 7475 726e 2072 6574 0a0a 2020 2020  return ret..    
-00019aa0: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
-00019ab0: 6566 2061 626f 7274 4d75 6c74 6970 6172  ef abortMultipar
-00019ac0: 7455 706c 6f61 6428 7365 6c66 2c20 6275  tUpload(self, bu
-00019ad0: 636b 6574 4e61 6d65 2c20 6f62 6a65 6374  cketName, object
-00019ae0: 4b65 792c 2075 706c 6f61 6449 642c 2065  Key, uploadId, e
-00019af0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-00019b00: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
-00019b10: 656c 662e 5f61 7373 6572 745f 6e6f 745f  elf._assert_not_
-00019b20: 6e75 6c6c 2875 706c 6f61 6449 642c 2027  null(uploadId, '
-00019b30: 7570 6c6f 6164 4964 2069 7320 656d 7074  uploadId is empt
-00019b40: 7927 290a 2020 2020 2020 2020 7265 7475  y').        retu
-00019b50: 726e 2073 656c 662e 5f6d 616b 655f 6465  rn self._make_de
-00019b60: 6c65 7465 5f72 6571 7565 7374 2862 7563  lete_request(buc
-00019b70: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
-00019b80: 6579 2c20 7061 7468 4172 6773 3d7b 2775  ey, pathArgs={'u
-00019b90: 706c 6f61 6449 6427 3a20 7570 6c6f 6164  ploadId': upload
-00019ba0: 4964 7d2c 0a20 2020 2020 2020 2020 2020  Id},.           
-00019bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019bc0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00019bd0: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
-00019be0: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
-00019bf0: 0a0a 2020 2020 4066 756e 6343 6163 6865  ..    @funcCache
-00019c00: 0a20 2020 2064 6566 206c 6973 7450 6172  .    def listPar
-00019c10: 7473 2873 656c 662c 2062 7563 6b65 744e  ts(self, bucketN
-00019c20: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
-00019c30: 7570 6c6f 6164 4964 2c20 6d61 7850 6172  uploadId, maxPar
-00019c40: 7473 3d4e 6f6e 652c 2070 6172 744e 756d  ts=None, partNum
-00019c50: 6265 724d 6172 6b65 723d 4e6f 6e65 2c20  berMarker=None, 
-00019c60: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-00019c70: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
-00019c80: 2020 2020 2020 2020 2065 6e63 6f64 696e           encodin
-00019c90: 675f 7479 7065 3d4e 6f6e 6529 3a0a 2020  g_type=None):.  
-00019ca0: 2020 2020 2020 7365 6c66 2e5f 6173 7365        self._asse
-00019cb0: 7274 5f6e 6f74 5f6e 756c 6c28 7570 6c6f  rt_not_null(uplo
-00019cc0: 6164 4964 2c20 2775 706c 6f61 6449 6420  adId, 'uploadId 
-00019cd0: 6973 2065 6d70 7479 2729 0a20 2020 2020  is empty').     
-00019ce0: 2020 2070 6174 6841 7267 7320 3d20 7b27     pathArgs = {'
-00019cf0: 7570 6c6f 6164 4964 273a 2075 706c 6f61  uploadId': uploa
-00019d00: 6449 647d 0a20 2020 2020 2020 2069 6620  dId}.        if 
-00019d10: 6d61 7850 6172 7473 2069 7320 6e6f 7420  maxParts is not 
-00019d20: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00019d30: 2020 7061 7468 4172 6773 5b27 6d61 782d    pathArgs['max-
-00019d40: 7061 7274 7327 5d20 3d20 6d61 7850 6172  parts'] = maxPar
-00019d50: 7473 0a20 2020 2020 2020 2069 6620 7061  ts.        if pa
-00019d60: 7274 4e75 6d62 6572 4d61 726b 6572 2069  rtNumberMarker i
-00019d70: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00019d80: 2020 2020 2020 2020 7061 7468 4172 6773          pathArgs
-00019d90: 5b27 7061 7274 2d6e 756d 6265 722d 6d61  ['part-number-ma
-00019da0: 726b 6572 275d 203d 2070 6172 744e 756d  rker'] = partNum
-00019db0: 6265 724d 6172 6b65 720a 2020 2020 2020  berMarker.      
-00019dc0: 2020 6966 2065 6e63 6f64 696e 675f 7479    if encoding_ty
-00019dd0: 7065 2069 7320 6e6f 7420 4e6f 6e65 3a0a  pe is not None:.
-00019de0: 2020 2020 2020 2020 2020 2020 7061 7468              path
-00019df0: 4172 6773 5b27 656e 636f 6469 6e67 2d74  Args['encoding-t
-00019e00: 7970 6527 5d20 3d20 656e 636f 6469 6e67  ype'] = encoding
-00019e10: 5f74 7970 650a 2020 2020 2020 2020 7265  _type.        re
-00019e20: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
-00019e30: 6765 745f 7265 7175 6573 7428 6275 636b  get_request(buck
-00019e40: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
-00019e50: 792c 2070 6174 6841 7267 733d 7061 7468  y, pathArgs=path
-00019e60: 4172 6773 2c20 6d65 7468 6f64 4e61 6d65  Args, methodName
-00019e70: 3d27 6c69 7374 5061 7274 7327 2c0a 2020  ='listParts',.  
+00019a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a50: 2063 6f70 7953 6f75 7263 6552 616e 6765   copySourceRange
+00019a60: 3d63 6f70 7953 6f75 7263 6552 616e 6765  =copySourceRange
+00019a70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00019a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ab0: 2020 2020 2020 2020 2064 6573 7453 7365           destSse
+00019ac0: 4865 6164 6572 3d64 6573 7453 7365 4865  Header=destSseHe
+00019ad0: 6164 6572 2c0a 2020 2020 2020 2020 2020  ader,.          
+00019ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019b10: 2020 2020 2020 2020 2020 2020 2073 6f75               sou
+00019b20: 7263 6553 7365 4865 6164 6572 3d73 6f75  rceSseHeader=sou
+00019b30: 7263 6553 7365 4865 6164 6572 2929 0a0a  rceSseHeader))..
+00019b40: 2020 2020 4066 756e 6343 6163 6865 0a20      @funcCache. 
+00019b50: 2020 2064 6566 2063 6f6d 706c 6574 654d     def completeM
+00019b60: 756c 7469 7061 7274 5570 6c6f 6164 2873  ultipartUpload(s
+00019b70: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+00019b80: 206f 626a 6563 744b 6579 2c20 7570 6c6f   objectKey, uplo
+00019b90: 6164 4964 2c20 636f 6d70 6c65 7465 4d75  adId, completeMu
+00019ba0: 6c74 6970 6172 7455 706c 6f61 6452 6571  ltipartUploadReq
+00019bb0: 7565 7374 2c0a 2020 2020 2020 2020 2020  uest,.          
+00019bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019bd0: 2020 2020 2020 6578 7465 6e73 696f 6e48        extensionH
+00019be0: 6561 6465 7273 3d4e 6f6e 652c 2065 6e63  eaders=None, enc
+00019bf0: 6f64 696e 675f 7479 7065 3d4e 6f6e 6529  oding_type=None)
+00019c00: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
+00019c10: 6173 7365 7274 5f6e 6f74 5f6e 756c 6c28  assert_not_null(
+00019c20: 7570 6c6f 6164 4964 2c20 2775 706c 6f61  uploadId, 'uploa
+00019c30: 6449 6420 6973 2065 6d70 7479 2729 0a20  dId is empty'). 
+00019c40: 2020 2020 2020 2073 656c 662e 5f61 7373         self._ass
+00019c50: 6572 745f 6e6f 745f 6e75 6c6c 2863 6f6d  ert_not_null(com
+00019c60: 706c 6574 654d 756c 7469 7061 7274 5570  pleteMultipartUp
+00019c70: 6c6f 6164 5265 7175 6573 742c 2027 636f  loadRequest, 'co
+00019c80: 6d70 6c65 7465 4d75 6c74 6970 6172 7455  mpleteMultipartU
+00019c90: 706c 6f61 6452 6571 7565 7374 2069 7320  ploadRequest is 
+00019ca0: 656d 7074 7927 290a 2020 2020 2020 2020  empty').        
+00019cb0: 7061 7468 4172 6773 203d 207b 2775 706c  pathArgs = {'upl
+00019cc0: 6f61 6449 6427 3a20 7570 6c6f 6164 4964  oadId': uploadId
+00019cd0: 7d0a 2020 2020 2020 2020 6966 2065 6e63  }.        if enc
+00019ce0: 6f64 696e 675f 7479 7065 2069 7320 6e6f  oding_type is no
+00019cf0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00019d00: 2020 2020 7061 7468 4172 6773 5b22 656e      pathArgs["en
+00019d10: 636f 6469 6e67 2d74 7970 6522 5d20 3d20  coding-type"] = 
+00019d20: 656e 636f 6469 6e67 5f74 7970 650a 2020  encoding_type.  
+00019d30: 2020 2020 2020 7265 7420 3d20 7365 6c66        ret = self
+00019d40: 2e5f 6d61 6b65 5f70 6f73 745f 7265 7175  ._make_post_requ
+00019d50: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
+00019d60: 6f62 6a65 6374 4b65 792c 0a20 2020 2020  objectKey,.     
+00019d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019d90: 2070 6174 6841 7267 733d 7061 7468 4172   pathArgs=pathAr
+00019da0: 6773 2c0a 2020 2020 2020 2020 2020 2020  gs,.            
+00019db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019dc0: 2020 2020 2020 2020 2020 656e 7469 7479            entity
+00019dd0: 3d73 656c 662e 636f 6e76 6572 746f 722e  =self.convertor.
+00019de0: 7472 616e 735f 636f 6d70 6c65 7465 5f6d  trans_complete_m
+00019df0: 756c 7469 7061 7274 5f75 706c 6f61 645f  ultipart_upload_
+00019e00: 7265 7175 6573 7428 0a20 2020 2020 2020  request(.       
+00019e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019e30: 2020 2063 6f6d 706c 6574 654d 756c 7469     completeMulti
+00019e40: 7061 7274 5570 6c6f 6164 5265 7175 6573  partUploadReques
+00019e50: 7429 2c20 6d65 7468 6f64 4e61 6d65 3d27  t), methodName='
+00019e60: 636f 6d70 6c65 7465 4d75 6c74 6970 6172  completeMultipar
+00019e70: 7455 706c 6f61 6427 2c0a 2020 2020 2020  tUpload',.      
 00019e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ea0: 2020 2020 6578 7465 6e73 696f 6e48 6561      extensionHea
-00019eb0: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
-00019ec0: 6164 6572 7329 0a0a 2020 2020 4066 756e  aders)..    @fun
-00019ed0: 6343 6163 6865 0a20 2020 2064 6566 2067  cCache.    def g
-00019ee0: 6574 4275 636b 6574 5374 6f72 6167 6550  etBucketStorageP
-00019ef0: 6f6c 6963 7928 7365 6c66 2c20 6275 636b  olicy(self, buck
-00019f00: 6574 4e61 6d65 2c20 6578 7465 6e73 696f  etName, extensio
-00019f10: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
-00019f20: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00019f30: 656c 662e 5f6d 616b 655f 6765 745f 7265  elf._make_get_re
-00019f40: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
-00019f50: 2c20 6d65 7468 6f64 4e61 6d65 3d27 6765  , methodName='ge
-00019f60: 7442 7563 6b65 7453 746f 7261 6765 506f  tBucketStoragePo
-00019f70: 6c69 6379 272c 0a20 2020 2020 2020 2020  licy',.         
-00019f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f90: 2020 2020 2020 2020 2020 2020 2065 7874               ext
-00019fa0: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
-00019fb0: 7465 6e73 696f 6e48 6561 6465 7273 2c0a  tensionHeaders,.
-00019fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019fe0: 2020 2020 2020 2a2a 7365 6c66 2e63 6f6e        **self.con
-00019ff0: 7665 7274 6f72 2e74 7261 6e73 5f67 6574  vertor.trans_get
-0001a000: 5f62 7563 6b65 745f 7374 6f72 6167 655f  _bucket_storage_
-0001a010: 706f 6c69 6379 2829 290a 0a20 2020 2040  policy())..    @
-0001a020: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
-0001a030: 6620 7365 7442 7563 6b65 7453 746f 7261  f setBucketStora
-0001a040: 6765 506f 6c69 6379 2873 656c 662c 2062  gePolicy(self, b
-0001a050: 7563 6b65 744e 616d 652c 2073 746f 7261  ucketName, stora
-0001a060: 6765 436c 6173 732c 2065 7874 656e 7369  geClass, extensi
-0001a070: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
-0001a080: 0a20 2020 2020 2020 2073 656c 662e 5f61  .        self._a
-0001a090: 7373 6572 745f 6e6f 745f 6e75 6c6c 2873  ssert_not_null(s
-0001a0a0: 746f 7261 6765 436c 6173 732c 2027 7374  torageClass, 'st
-0001a0b0: 6f72 6167 6543 6c61 7373 2069 7320 656d  orageClass is em
-0001a0c0: 7074 7927 290a 2020 2020 2020 2020 7265  pty').        re
-0001a0d0: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
-0001a0e0: 7075 745f 7265 7175 6573 7428 6275 636b  put_request(buck
-0001a0f0: 6574 4e61 6d65 2c20 6578 7465 6e73 696f  etName, extensio
-0001a100: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
-0001a110: 6f6e 4865 6164 6572 732c 0a20 2020 2020  onHeaders,.     
-0001a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a140: 202a 2a73 656c 662e 636f 6e76 6572 746f   **self.converto
-0001a150: 722e 7472 616e 735f 7365 745f 6275 636b  r.trans_set_buck
-0001a160: 6574 5f73 746f 7261 6765 5f70 6f6c 6963  et_storage_polic
-0001a170: 7928 7374 6f72 6167 6543 6c61 7373 3d73  y(storageClass=s
-0001a180: 746f 7261 6765 436c 6173 7329 290a 0a20  torageClass)).. 
-0001a190: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
-0001a1a0: 2020 6465 6620 7365 7442 7563 6b65 7445    def setBucketE
-0001a1b0: 6e63 7279 7074 696f 6e28 7365 6c66 2c20  ncryption(self, 
-0001a1c0: 6275 636b 6574 4e61 6d65 2c20 656e 6372  bucketName, encr
-0001a1d0: 7970 7469 6f6e 2c20 6b65 793d 4e6f 6e65  yption, key=None
-0001a1e0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
-0001a1f0: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
-0001a200: 2020 7365 6c66 2e5f 6173 7365 7274 5f6e    self._assert_n
-0001a210: 6f74 5f6e 756c 6c28 656e 6372 7970 7469  ot_null(encrypti
-0001a220: 6f6e 2c20 2765 6e63 7279 7074 696f 6e20  on, 'encryption 
-0001a230: 6973 2065 6d70 7479 2729 0a20 2020 2020  is empty').     
-0001a240: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0001a250: 6d61 6b65 5f70 7574 5f72 6571 7565 7374  make_put_request
-0001a260: 2862 7563 6b65 744e 616d 652c 2070 6174  (bucketName, pat
-0001a270: 6841 7267 733d 7b27 656e 6372 7970 7469  hArgs={'encrypti
-0001a280: 6f6e 273a 204e 6f6e 657d 2c0a 2020 2020  on': None},.    
-0001a290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a2b0: 2020 656e 7469 7479 3d73 656c 662e 636f    entity=self.co
-0001a2c0: 6e76 6572 746f 722e 7472 616e 735f 656e  nvertor.trans_en
-0001a2d0: 6372 7970 7469 6f6e 2865 6e63 7279 7074  cryption(encrypt
-0001a2e0: 696f 6e3d 656e 6372 7970 7469 6f6e 2c20  ion=encryption, 
-0001a2f0: 6b65 793d 6b65 7929 2c0a 2020 2020 2020  key=key),.      
+00019ea0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+00019eb0: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
+00019ec0: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
+00019ed0: 5f67 656e 6572 6174 655f 6f62 6a65 6374  _generate_object
+00019ee0: 5f75 726c 2872 6574 2c20 6275 636b 6574  _url(ret, bucket
+00019ef0: 4e61 6d65 2c20 6f62 6a65 6374 4b65 7929  Name, objectKey)
+00019f00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00019f10: 7265 740a 0a20 2020 2040 6675 6e63 4361  ret..    @funcCa
+00019f20: 6368 650a 2020 2020 6465 6620 6162 6f72  che.    def abor
+00019f30: 744d 756c 7469 7061 7274 5570 6c6f 6164  tMultipartUpload
+00019f40: 2873 656c 662c 2062 7563 6b65 744e 616d  (self, bucketNam
+00019f50: 652c 206f 626a 6563 744b 6579 2c20 7570  e, objectKey, up
+00019f60: 6c6f 6164 4964 2c20 6578 7465 6e73 696f  loadId, extensio
+00019f70: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
+00019f80: 2020 2020 2020 2020 7365 6c66 2e5f 6173          self._as
+00019f90: 7365 7274 5f6e 6f74 5f6e 756c 6c28 7570  sert_not_null(up
+00019fa0: 6c6f 6164 4964 2c20 2775 706c 6f61 6449  loadId, 'uploadI
+00019fb0: 6420 6973 2065 6d70 7479 2729 0a20 2020  d is empty').   
+00019fc0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00019fd0: 2e5f 6d61 6b65 5f64 656c 6574 655f 7265  ._make_delete_re
+00019fe0: 7175 6573 7428 6275 636b 6574 4e61 6d65  quest(bucketName
+00019ff0: 2c20 6f62 6a65 6374 4b65 792c 2070 6174  , objectKey, pat
+0001a000: 6841 7267 733d 7b27 7570 6c6f 6164 4964  hArgs={'uploadId
+0001a010: 273a 2075 706c 6f61 6449 647d 2c0a 2020  ': uploadId},.  
+0001a020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a040: 2020 2020 2020 2065 7874 656e 7369 6f6e         extension
+0001a050: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
+0001a060: 6e48 6561 6465 7273 290a 0a20 2020 2040  nHeaders)..    @
+0001a070: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
+0001a080: 6620 6c69 7374 5061 7274 7328 7365 6c66  f listParts(self
+0001a090: 2c20 6275 636b 6574 4e61 6d65 2c20 6f62  , bucketName, ob
+0001a0a0: 6a65 6374 4b65 792c 2075 706c 6f61 6449  jectKey, uploadI
+0001a0b0: 642c 206d 6178 5061 7274 733d 4e6f 6e65  d, maxParts=None
+0001a0c0: 2c20 7061 7274 4e75 6d62 6572 4d61 726b  , partNumberMark
+0001a0d0: 6572 3d4e 6f6e 652c 2065 7874 656e 7369  er=None, extensi
+0001a0e0: 6f6e 4865 6164 6572 733d 4e6f 6e65 2c0a  onHeaders=None,.
+0001a0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a100: 2020 656e 636f 6469 6e67 5f74 7970 653d    encoding_type=
+0001a110: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
+0001a120: 656c 662e 5f61 7373 6572 745f 6e6f 745f  elf._assert_not_
+0001a130: 6e75 6c6c 2875 706c 6f61 6449 642c 2027  null(uploadId, '
+0001a140: 7570 6c6f 6164 4964 2069 7320 656d 7074  uploadId is empt
+0001a150: 7927 290a 2020 2020 2020 2020 7061 7468  y').        path
+0001a160: 4172 6773 203d 207b 2775 706c 6f61 6449  Args = {'uploadI
+0001a170: 6427 3a20 7570 6c6f 6164 4964 7d0a 2020  d': uploadId}.  
+0001a180: 2020 2020 2020 6966 206d 6178 5061 7274        if maxPart
+0001a190: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
+0001a1a0: 2020 2020 2020 2020 2020 2070 6174 6841             pathA
+0001a1b0: 7267 735b 276d 6178 2d70 6172 7473 275d  rgs['max-parts']
+0001a1c0: 203d 206d 6178 5061 7274 730a 2020 2020   = maxParts.    
+0001a1d0: 2020 2020 6966 2070 6172 744e 756d 6265      if partNumbe
+0001a1e0: 724d 6172 6b65 7220 6973 206e 6f74 204e  rMarker is not N
+0001a1f0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001a200: 2070 6174 6841 7267 735b 2770 6172 742d   pathArgs['part-
+0001a210: 6e75 6d62 6572 2d6d 6172 6b65 7227 5d20  number-marker'] 
+0001a220: 3d20 7061 7274 4e75 6d62 6572 4d61 726b  = partNumberMark
+0001a230: 6572 0a20 2020 2020 2020 2069 6620 656e  er.        if en
+0001a240: 636f 6469 6e67 5f74 7970 6520 6973 206e  coding_type is n
+0001a250: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0001a260: 2020 2020 2070 6174 6841 7267 735b 2765       pathArgs['e
+0001a270: 6e63 6f64 696e 672d 7479 7065 275d 203d  ncoding-type'] =
+0001a280: 2065 6e63 6f64 696e 675f 7479 7065 0a20   encoding_type. 
+0001a290: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001a2a0: 6c66 2e5f 6d61 6b65 5f67 6574 5f72 6571  lf._make_get_req
+0001a2b0: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
+0001a2c0: 206f 626a 6563 744b 6579 2c20 7061 7468   objectKey, path
+0001a2d0: 4172 6773 3d70 6174 6841 7267 732c 206d  Args=pathArgs, m
+0001a2e0: 6574 686f 644e 616d 653d 276c 6973 7450  ethodName='listP
+0001a2f0: 6172 7473 272c 0a20 2020 2020 2020 2020  arts',.         
 0001a300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a320: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0001a330: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
-0001a340: 7329 0a0a 2020 2020 4066 756e 6343 6163  s)..    @funcCac
-0001a350: 6865 0a20 2020 2064 6566 2067 6574 4275  he.    def getBu
-0001a360: 636b 6574 456e 6372 7970 7469 6f6e 2873  cketEncryption(s
+0001a310: 2020 2020 2020 2020 2020 2020 2065 7874               ext
+0001a320: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+0001a330: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
+0001a340: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
+0001a350: 2020 2020 6465 6620 6765 7442 7563 6b65      def getBucke
+0001a360: 7453 746f 7261 6765 506f 6c69 6379 2873  tStoragePolicy(s
 0001a370: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
 0001a380: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
 0001a390: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
 0001a3a0: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
 0001a3b0: 6b65 5f67 6574 5f72 6571 7565 7374 2862  ke_get_request(b
 0001a3c0: 7563 6b65 744e 616d 652c 206d 6574 686f  ucketName, metho
 0001a3d0: 644e 616d 653d 2767 6574 4275 636b 6574  dName='getBucket
-0001a3e0: 456e 6372 7970 7469 6f6e 272c 2070 6174  Encryption', pat
-0001a3f0: 6841 7267 733d 7b27 656e 6372 7970 7469  hArgs={'encrypti
-0001a400: 6f6e 273a 204e 6f6e 657d 2c0a 2020 2020  on': None},.    
-0001a410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a430: 2020 6578 7465 6e73 696f 6e48 6561 6465    extensionHeade
-0001a440: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
-0001a450: 6572 7329 0a0a 2020 2020 4066 756e 6343  ers)..    @funcC
-0001a460: 6163 6865 0a20 2020 2064 6566 2064 656c  ache.    def del
-0001a470: 6574 6542 7563 6b65 7445 6e63 7279 7074  eteBucketEncrypt
-0001a480: 696f 6e28 7365 6c66 2c20 6275 636b 6574  ion(self, bucket
-0001a490: 4e61 6d65 2c20 6578 7465 6e73 696f 6e48  Name, extensionH
-0001a4a0: 6561 6465 7273 3d4e 6f6e 6529 3a0a 2020  eaders=None):.  
-0001a4b0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001a4c0: 662e 5f6d 616b 655f 6465 6c65 7465 5f72  f._make_delete_r
-0001a4d0: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
-0001a4e0: 652c 2070 6174 6841 7267 733d 7b27 656e  e, pathArgs={'en
-0001a4f0: 6372 7970 7469 6f6e 273a 204e 6f6e 657d  cryption': None}
-0001a500: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
-0001a510: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
-0001a520: 6572 7329 0a0a 2020 2020 4066 756e 6343  ers)..    @funcC
-0001a530: 6163 6865 0a20 2020 2064 6566 2073 6574  ache.    def set
-0001a540: 4275 636b 6574 5265 706c 6963 6174 696f  BucketReplicatio
-0001a550: 6e28 7365 6c66 2c20 6275 636b 6574 4e61  n(self, bucketNa
-0001a560: 6d65 2c20 7265 706c 6963 6174 696f 6e2c  me, replication,
+0001a3e0: 5374 6f72 6167 6550 6f6c 6963 7927 2c0a  StoragePolicy',.
+0001a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a410: 2020 2020 2020 6578 7465 6e73 696f 6e48        extensionH
+0001a420: 6561 6465 7273 3d65 7874 656e 7369 6f6e  eaders=extension
+0001a430: 4865 6164 6572 732c 0a20 2020 2020 2020  Headers,.       
+0001a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a450: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+0001a460: 2a73 656c 662e 636f 6e76 6572 746f 722e  *self.convertor.
+0001a470: 7472 616e 735f 6765 745f 6275 636b 6574  trans_get_bucket
+0001a480: 5f73 746f 7261 6765 5f70 6f6c 6963 7928  _storage_policy(
+0001a490: 2929 0a0a 2020 2020 4066 756e 6343 6163  ))..    @funcCac
+0001a4a0: 6865 0a20 2020 2064 6566 2073 6574 4275  he.    def setBu
+0001a4b0: 636b 6574 5374 6f72 6167 6550 6f6c 6963  cketStoragePolic
+0001a4c0: 7928 7365 6c66 2c20 6275 636b 6574 4e61  y(self, bucketNa
+0001a4d0: 6d65 2c20 7374 6f72 6167 6543 6c61 7373  me, storageClass
+0001a4e0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+0001a4f0: 7273 3d4e 6f6e 6529 3a0a 2020 2020 2020  rs=None):.      
+0001a500: 2020 7365 6c66 2e5f 6173 7365 7274 5f6e    self._assert_n
+0001a510: 6f74 5f6e 756c 6c28 7374 6f72 6167 6543  ot_null(storageC
+0001a520: 6c61 7373 2c20 2773 746f 7261 6765 436c  lass, 'storageCl
+0001a530: 6173 7320 6973 2065 6d70 7479 2729 0a20  ass is empty'). 
+0001a540: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001a550: 6c66 2e5f 6d61 6b65 5f70 7574 5f72 6571  lf._make_put_req
+0001a560: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
 0001a570: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-0001a580: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
-0001a590: 2073 656c 662e 5f61 7373 6572 745f 6e6f   self._assert_no
-0001a5a0: 745f 6e75 6c6c 2872 6570 6c69 6361 7469  t_null(replicati
-0001a5b0: 6f6e 2c20 2772 6570 6c69 6361 7469 6f6e  on, 'replication
-0001a5c0: 2069 7320 656d 7074 7927 290a 2020 2020   is empty').    
-0001a5d0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0001a5e0: 5f6d 616b 655f 7075 745f 7265 7175 6573  _make_put_reques
-0001a5f0: 7428 6275 636b 6574 4e61 6d65 2c20 6578  t(bucketName, ex
-0001a600: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
-0001a610: 7874 656e 7369 6f6e 4865 6164 6572 732c  xtensionHeaders,
-0001a620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a640: 2020 2020 2020 202a 2a73 656c 662e 636f         **self.co
-0001a650: 6e76 6572 746f 722e 7472 616e 735f 7365  nvertor.trans_se
-0001a660: 745f 6275 636b 6574 5f72 6570 6c69 6361  t_bucket_replica
-0001a670: 7469 6f6e 2872 6570 6c69 6361 7469 6f6e  tion(replication
-0001a680: 3d72 6570 6c69 6361 7469 6f6e 2929 0a0a  =replication))..
-0001a690: 2020 2020 4066 756e 6343 6163 6865 0a20      @funcCache. 
-0001a6a0: 2020 2064 6566 2067 6574 4275 636b 6574     def getBucket
-0001a6b0: 5265 706c 6963 6174 696f 6e28 7365 6c66  Replication(self
-0001a6c0: 2c20 6275 636b 6574 4e61 6d65 2c20 6578  , bucketName, ex
-0001a6d0: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
-0001a6e0: 6f6e 6529 3a0a 2020 2020 2020 2020 7265  one):.        re
-0001a6f0: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
-0001a700: 6765 745f 7265 7175 6573 7428 6275 636b  get_request(buck
-0001a710: 6574 4e61 6d65 2c20 7061 7468 4172 6773  etName, pathArgs
-0001a720: 3d7b 2772 6570 6c69 6361 7469 6f6e 273a  ={'replication':
-0001a730: 204e 6f6e 657d 2c20 6d65 7468 6f64 4e61   None}, methodNa
-0001a740: 6d65 3d27 6765 7442 7563 6b65 7452 6570  me='getBucketRep
-0001a750: 6c69 6361 7469 6f6e 272c 0a20 2020 2020  lication',.     
-0001a760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a780: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-0001a790: 733d 6578 7465 6e73 696f 6e48 6561 6465  s=extensionHeade
-0001a7a0: 7273 290a 0a20 2020 2040 6675 6e63 4361  rs)..    @funcCa
-0001a7b0: 6368 650a 2020 2020 6465 6620 6465 6c65  che.    def dele
-0001a7c0: 7465 4275 636b 6574 5265 706c 6963 6174  teBucketReplicat
-0001a7d0: 696f 6e28 7365 6c66 2c20 6275 636b 6574  ion(self, bucket
-0001a7e0: 4e61 6d65 2c20 6578 7465 6e73 696f 6e48  Name, extensionH
-0001a7f0: 6561 6465 7273 3d4e 6f6e 6529 3a0a 2020  eaders=None):.  
-0001a800: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001a810: 662e 5f6d 616b 655f 6465 6c65 7465 5f72  f._make_delete_r
-0001a820: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
-0001a830: 652c 2070 6174 6841 7267 733d 7b27 7265  e, pathArgs={'re
-0001a840: 706c 6963 6174 696f 6e27 3a20 4e6f 6e65  plication': None
-0001a850: 7d2c 2065 7874 656e 7369 6f6e 4865 6164  }, extensionHead
-0001a860: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
-0001a870: 6465 7273 290a 0a20 2020 2040 6675 6e63  ders)..    @func
-0001a880: 4361 6368 650a 2020 2020 6465 6620 7365  Cache.    def se
-0001a890: 7442 7563 6b65 7452 6571 7565 7374 5061  tBucketRequestPa
-0001a8a0: 796d 656e 7428 7365 6c66 2c20 6275 636b  yment(self, buck
-0001a8b0: 6574 4e61 6d65 2c20 7061 7965 722c 2065  etName, payer, e
-0001a8c0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-0001a8d0: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
-0001a8e0: 656c 662e 5f61 7373 6572 745f 6e6f 745f  elf._assert_not_
-0001a8f0: 6e75 6c6c 2870 6179 6572 2c20 2770 6179  null(payer, 'pay
-0001a900: 6572 2069 7320 656d 7074 7927 290a 2020  er is empty').  
-0001a910: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001a920: 662e 5f6d 616b 655f 7075 745f 7265 7175  f._make_put_requ
-0001a930: 6573 7428 6275 636b 6574 4e61 6d65 2c20  est(bucketName, 
-0001a940: 7061 7468 4172 6773 3d7b 2772 6571 7565  pathArgs={'reque
-0001a950: 7374 5061 796d 656e 7427 3a20 4e6f 6e65  stPayment': None
-0001a960: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
-0001a970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a980: 2020 2020 2020 2020 2065 6e74 6974 793d           entity=
-0001a990: 7365 6c66 2e63 6f6e 7665 7274 6f72 2e74  self.convertor.t
-0001a9a0: 7261 6e73 5f62 7563 6b65 745f 7265 7175  rans_bucket_requ
-0001a9b0: 6573 745f 7061 796d 656e 7428 7061 7965  est_payment(paye
-0001a9c0: 723d 7061 7965 7229 2c0a 2020 2020 2020  r=payer),.      
-0001a9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9f0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0001aa00: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
-0001aa10: 7329 0a0a 2020 2020 4066 756e 6343 6163  s)..    @funcCac
-0001aa20: 6865 0a20 2020 2064 6566 2067 6574 4275  he.    def getBu
-0001aa30: 636b 6574 5265 7175 6573 7450 6179 6d65  cketRequestPayme
-0001aa40: 6e74 2873 656c 662c 2062 7563 6b65 744e  nt(self, bucketN
-0001aa50: 616d 652c 2065 7874 656e 7369 6f6e 4865  ame, extensionHe
-0001aa60: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
-0001aa70: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001aa80: 2e5f 6d61 6b65 5f67 6574 5f72 6571 7565  ._make_get_reque
-0001aa90: 7374 2862 7563 6b65 744e 616d 652c 2070  st(bucketName, p
-0001aaa0: 6174 6841 7267 733d 7b27 7265 7175 6573  athArgs={'reques
-0001aab0: 7450 6179 6d65 6e74 273a 204e 6f6e 657d  tPayment': None}
-0001aac0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aae0: 2020 2020 2020 2020 6d65 7468 6f64 4e61          methodNa
-0001aaf0: 6d65 3d27 6765 7442 7563 6b65 7452 6571  me='getBucketReq
-0001ab00: 7565 7374 5061 796d 656e 7427 2c20 6578  uestPayment', ex
-0001ab10: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
-0001ab20: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
-0001ab30: 0a0a 2020 2020 2320 6265 6769 6e20 7669  ..    # begin vi
-0001ab40: 7274 7561 6c20 6275 636b 6574 2072 656c  rtual bucket rel
-0001ab50: 6174 6564 0a20 2020 2023 2062 6567 696e  ated.    # begin
-0001ab60: 2076 6972 7475 616c 2062 7563 6b65 7420   virtual bucket 
-0001ab70: 7265 6c61 7465 640a 2020 2020 2320 6265  related.    # be
-0001ab80: 6769 6e20 7669 7274 7561 6c20 6275 636b  gin virtual buck
-0001ab90: 6574 2072 656c 6174 6564 0a0a 2020 2020  et related..    
-0001aba0: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
-0001abb0: 6566 206c 6973 7441 7661 696c 6162 6c65  ef listAvailable
-0001abc0: 5a6f 6e65 496e 666f 2873 656c 662c 2072  ZoneInfo(self, r
-0001abd0: 6567 696f 6e49 642c 2074 6f6b 656e 2c20  egionId, token, 
-0001abe0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0001abf0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0001ac00: 7365 6c66 2e5f 6173 7365 7274 5f6e 6f74  self._assert_not
-0001ac10: 5f6e 756c 6c28 7265 6769 6f6e 4964 2c20  _null(regionId, 
-0001ac20: 2772 6567 696f 6e49 6420 7368 6f75 6c64  'regionId should
-0001ac30: 206e 6f74 2062 6520 656d 7074 7927 290a   not be empty').
-0001ac40: 2020 2020 2020 2020 7365 6c66 2e5f 6173          self._as
-0001ac50: 7365 7274 5f6e 6f74 5f6e 756c 6c28 746f  sert_not_null(to
-0001ac60: 6b65 6e2c 2027 746f 6b65 6e20 7368 6f75  ken, 'token shou
-0001ac70: 6c64 206e 6f74 2062 6520 656d 7074 7927  ld not be empty'
-0001ac80: 290a 0a20 2020 2020 2020 2070 6174 6841  )..        pathA
-0001ac90: 7267 7320 3d20 7b27 7265 6769 6f6e 4964  rgs = {'regionId
-0001aca0: 273a 2072 6567 696f 6e49 647d 0a20 2020  ': regionId}.   
-0001acb0: 2020 2020 2068 6561 6465 7220 3d20 7b0a       header = {.
-0001acc0: 2020 2020 2020 2020 2020 2020 636f 6e73              cons
-0001acd0: 742e 585f 4155 5448 5f54 4f4b 454e 5f48  t.X_AUTH_TOKEN_H
-0001ace0: 4541 4445 523a 2074 6f6b 656e 2c0a 2020  EADER: token,.  
-0001acf0: 2020 2020 2020 2020 2020 636f 6e73 742e            const.
-0001ad00: 434f 4e54 454e 545f 5459 5045 5f48 4541  CONTENT_TYPE_HEA
-0001ad10: 4445 523a 2063 6f6e 7374 2e4d 494d 455f  DER: const.MIME_
-0001ad20: 5459 5045 532e 6765 7428 276a 736f 6e27  TYPES.get('json'
-0001ad30: 290a 2020 2020 2020 2020 7d0a 0a20 2020  ).        }..   
-0001ad40: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001ad50: 2e5f 6d61 6b65 5f67 6574 5f72 6571 7565  ._make_get_reque
-0001ad60: 7374 280a 2020 2020 2020 2020 2020 2020  st(.            
-0001ad70: 6f62 6a65 6374 4b65 793d 2776 312f 7365  objectKey='v1/se
-0001ad80: 7276 6963 6573 2f63 6c75 7374 6572 7327  rvices/clusters'
-0001ad90: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
-0001ada0: 7468 4172 6773 3d70 6174 6841 7267 732c  thArgs=pathArgs,
-0001adb0: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
-0001adc0: 6465 7273 3d68 6561 6465 722c 0a20 2020  ders=header,.   
-0001add0: 2020 2020 2020 2020 206d 6574 686f 644e           methodN
-0001ade0: 616d 653d 7365 6c66 2e6a 736f 6e5f 7265  ame=self.json_re
-0001adf0: 7370 6f6e 7365 5f6d 6574 686f 645f 6e61  sponse_method_na
-0001ae00: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-0001ae10: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0001ae20: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
-0001ae30: 730a 2020 2020 2020 2020 290a 0a20 2020  s.        )..   
-0001ae40: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
-0001ae50: 6465 6620 6372 6561 7465 4275 636b 6574  def createBucket
-0001ae60: 416c 6961 7328 7365 6c66 2c20 6275 636b  Alias(self, buck
-0001ae70: 6574 4e61 6d65 2c20 616c 6961 7349 6e66  etName, aliasInf
-0001ae80: 6f3d 4e6f 6e65 2c20 6578 7465 6e73 696f  o=None, extensio
-0001ae90: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
-0001aea0: 2020 2020 2020 2020 6966 2061 6c69 6173          if alias
-0001aeb0: 496e 666f 2069 7320 4e6f 6e65 3a0a 2020  Info is None:.  
-0001aec0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001aed0: 4578 6365 7074 696f 6e28 2761 6c69 6173  Exception('alias
-0001aee0: 496e 666f 2069 7320 4e6f 6e65 2729 0a20  Info is None'). 
-0001aef0: 2020 2020 2020 2073 656c 662e 5f61 7373         self._ass
-0001af00: 6572 745f 6e6f 745f 6e75 6c6c 2861 6c69  ert_not_null(ali
-0001af10: 6173 496e 666f 2e67 6574 2827 6275 636b  asInfo.get('buck
-0001af20: 6574 3127 292c 2027 6275 636b 6574 3120  et1'), 'bucket1 
-0001af30: 7368 6f75 6c64 206e 6f74 2062 6520 656d  should not be em
-0001af40: 7074 7927 290a 2020 2020 2020 2020 7365  pty').        se
-0001af50: 6c66 2e5f 6173 7365 7274 5f6e 6f74 5f6e  lf._assert_not_n
-0001af60: 756c 6c28 616c 6961 7349 6e66 6f2e 6765  ull(aliasInfo.ge
-0001af70: 7428 2762 7563 6b65 7432 2729 2c20 2762  t('bucket2'), 'b
-0001af80: 7563 6b65 7432 2073 686f 756c 6420 6e6f  ucket2 should no
-0001af90: 7420 6265 2065 6d70 7479 2729 0a20 2020  t be empty').   
-0001afa0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001afb0: 2e5f 6d61 6b65 5f70 7574 5f72 6571 7565  ._make_put_reque
-0001afc0: 7374 2862 7563 6b65 744e 616d 652c 2065  st(bucketName, e
-0001afd0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-0001afe0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0001aff0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b010: 2020 2020 2020 2020 2a2a 7365 6c66 2e63          **self.c
-0001b020: 6f6e 7665 7274 6f72 2e74 7261 6e73 5f73  onvertor.trans_s
-0001b030: 6574 5f62 7563 6b65 745f 616c 6961 7328  et_bucket_alias(
-0001b040: 616c 6961 7349 6e66 6f3d 616c 6961 7349  aliasInfo=aliasI
-0001b050: 6e66 6f29 290a 0a20 2020 2040 6675 6e63  nfo))..    @func
-0001b060: 4361 6368 650a 2020 2020 6465 6620 6269  Cache.    def bi
-0001b070: 6e64 4275 636b 6574 416c 6961 7328 7365  ndBucketAlias(se
-0001b080: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
-0001b090: 616c 6961 7349 6e66 6f3d 4e6f 6e65 2c20  aliasInfo=None, 
-0001b0a0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0001b0b0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0001b0c0: 6966 2061 6c69 6173 496e 666f 2069 7320  if aliasInfo is 
-0001b0d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0001b0e0: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
-0001b0f0: 6e28 2761 6c69 6173 496e 666f 2069 7320  n('aliasInfo is 
-0001b100: 4e6f 6e65 2729 0a20 2020 2020 2020 2073  None').        s
-0001b110: 656c 662e 5f61 7373 6572 745f 6e6f 745f  elf._assert_not_
-0001b120: 6e75 6c6c 2861 6c69 6173 496e 666f 2e67  null(aliasInfo.g
-0001b130: 6574 2827 616c 6961 7327 292c 2027 6275  et('alias'), 'bu
-0001b140: 636b 6574 2061 6c69 6173 2073 686f 756c  cket alias shoul
-0001b150: 6420 6e6f 7420 6265 2065 6d70 7479 2729  d not be empty')
-0001b160: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001b170: 7365 6c66 2e5f 6d61 6b65 5f70 7574 5f72  self._make_put_r
-0001b180: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
-0001b190: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
-0001b1a0: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
-0001b1b0: 6465 7273 2c0a 2020 2020 2020 2020 2020  ders,.          
-0001b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1d0: 2020 2020 2020 2020 2020 2020 2a2a 7365              **se
-0001b1e0: 6c66 2e63 6f6e 7665 7274 6f72 2e74 7261  lf.convertor.tra
-0001b1f0: 6e73 5f62 696e 645f 6275 636b 6574 5f61  ns_bind_bucket_a
-0001b200: 6c69 6173 2861 6c69 6173 496e 666f 3d61  lias(aliasInfo=a
-0001b210: 6c69 6173 496e 666f 2929 0a0a 2020 2020  liasInfo))..    
-0001b220: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
-0001b230: 6566 2064 656c 6574 6542 7563 6b65 7441  ef deleteBucketA
-0001b240: 6c69 6173 2873 656c 662c 2062 7563 6b65  lias(self, bucke
-0001b250: 7441 6c69 6173 2c20 6578 7465 6e73 696f  tAlias, extensio
-0001b260: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
-0001b270: 2020 2020 2020 2020 7365 6c66 2e5f 6173          self._as
-0001b280: 7365 7274 5f6e 6f74 5f6e 756c 6c28 6275  sert_not_null(bu
-0001b290: 636b 6574 416c 6961 732c 2027 6275 636b  cketAlias, 'buck
-0001b2a0: 6574 2061 6c69 6173 2073 686f 756c 6420  et alias should 
-0001b2b0: 6e6f 7420 6265 2065 6d70 7479 2729 0a20  not be empty'). 
-0001b2c0: 2020 2020 2020 2070 6174 6841 7267 7320         pathArgs 
-0001b2d0: 3d20 7b63 6f6e 7374 2e4f 4253 4255 434b  = {const.OBSBUCK
-0001b2e0: 4554 414c 4941 535f 5041 5241 4d3a 204e  ETALIAS_PARAM: N
-0001b2f0: 6f6e 657d 0a20 2020 2020 2020 2072 6574  one}.        ret
-0001b300: 7572 6e20 7365 6c66 2e5f 6d61 6b65 5f64  urn self._make_d
-0001b310: 656c 6574 655f 7265 7175 6573 7428 6275  elete_request(bu
-0001b320: 636b 6574 4e61 6d65 3d62 7563 6b65 7441  cketName=bucketA
-0001b330: 6c69 6173 2c20 7061 7468 4172 6773 3d70  lias, pathArgs=p
-0001b340: 6174 6841 7267 732c 2065 7874 656e 7369  athArgs, extensi
-0001b350: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
-0001b360: 696f 6e48 6561 6465 7273 290a 0a20 2020  ionHeaders)..   
-0001b370: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
-0001b380: 6465 6620 756e 6269 6e64 4275 636b 6574  def unbindBucket
-0001b390: 416c 6961 7328 7365 6c66 2c20 6275 636b  Alias(self, buck
-0001b3a0: 6574 4e61 6d65 2c20 6578 7465 6e73 696f  etName, extensio
-0001b3b0: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
-0001b3c0: 2020 2020 2020 2020 7061 7468 4172 6773          pathArgs
-0001b3d0: 203d 207b 636f 6e73 742e 4f42 5341 4c49   = {const.OBSALI
-0001b3e0: 4153 5f50 4152 414d 3a20 4e6f 6e65 7d0a  AS_PARAM: None}.
-0001b3f0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001b400: 656c 662e 5f6d 616b 655f 6465 6c65 7465  elf._make_delete
-0001b410: 5f72 6571 7565 7374 2862 7563 6b65 744e  _request(bucketN
-0001b420: 616d 652c 2070 6174 6841 7267 733d 7061  ame, pathArgs=pa
-0001b430: 7468 4172 6773 2c20 6578 7465 6e73 696f  thArgs, extensio
-0001b440: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
-0001b450: 6f6e 4865 6164 6572 7329 0a0a 2020 2020  onHeaders)..    
-0001b460: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
-0001b470: 6566 2067 6574 4275 636b 6574 416c 6961  ef getBucketAlia
-0001b480: 7328 7365 6c66 2c20 6275 636b 6574 4e61  s(self, bucketNa
-0001b490: 6d65 2c20 6578 7465 6e73 696f 6e48 6561  me, extensionHea
-0001b4a0: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
-0001b4b0: 2020 2020 7061 7468 4172 6773 203d 207b      pathArgs = {
-0001b4c0: 636f 6e73 742e 4f42 5341 4c49 4153 5f50  const.OBSALIAS_P
-0001b4d0: 4152 414d 3a20 4e6f 6e65 7d0a 2020 2020  ARAM: None}.    
-0001b4e0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0001b4f0: 5f6d 616b 655f 6765 745f 7265 7175 6573  _make_get_reques
-0001b500: 7428 6275 636b 6574 4e61 6d65 2c20 7061  t(bucketName, pa
-0001b510: 7468 4172 6773 3d70 6174 6841 7267 732c  thArgs=pathArgs,
-0001b520: 206d 6574 686f 644e 616d 653d 2767 6574   methodName='get
-0001b530: 4275 636b 6574 416c 6961 7327 2c0a 2020  BucketAlias',.  
-0001b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b560: 2020 2020 6578 7465 6e73 696f 6e48 6561      extensionHea
-0001b570: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
-0001b580: 6164 6572 7329 0a0a 2020 2020 4066 756e  aders)..    @fun
-0001b590: 6343 6163 6865 0a20 2020 2064 6566 206c  cCache.    def l
-0001b5a0: 6973 7442 7563 6b65 7441 6c69 6173 2873  istBucketAlias(s
-0001b5b0: 656c 662c 2065 7874 656e 7369 6f6e 4865  elf, extensionHe
-0001b5c0: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
-0001b5d0: 2020 2020 2070 6174 6841 7267 7320 3d20       pathArgs = 
-0001b5e0: 7b63 6f6e 7374 2e4f 4253 4255 434b 4554  {const.OBSBUCKET
-0001b5f0: 414c 4941 535f 5041 5241 4d3a 204e 6f6e  ALIAS_PARAM: Non
-0001b600: 657d 0a20 2020 2020 2020 2072 6574 7572  e}.        retur
-0001b610: 6e20 7365 6c66 2e5f 6d61 6b65 5f67 6574  n self._make_get
-0001b620: 5f72 6571 7565 7374 2870 6174 6841 7267  _request(pathArg
-0001b630: 733d 7061 7468 4172 6773 2c20 6d65 7468  s=pathArgs, meth
-0001b640: 6f64 4e61 6d65 3d27 4c69 7374 4275 636b  odName='ListBuck
-0001b650: 6574 416c 6961 7327 2c0a 2020 2020 2020  etAlias',.      
-0001b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b680: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0001b690: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
-0001b6a0: 7329 0a0a 2020 2020 4066 756e 6343 6163  s)..    @funcCac
-0001b6b0: 6865 0a20 2020 2064 6566 2063 7265 6174  he.    def creat
-0001b6c0: 6556 6972 7475 616c 4275 636b 6574 2873  eVirtualBucket(s
-0001b6d0: 656c 662c 2072 6567 696f 6e49 642c 2074  elf, regionId, t
-0001b6e0: 6f6b 656e 2c20 6275 636b 6574 4e61 6d65  oken, bucketName
-0001b6f0: 312c 2062 7563 6b65 744e 616d 6532 2c20  1, bucketName2, 
-0001b700: 6275 636b 6574 416c 6961 732c 2061 6765  bucketAlias, age
-0001b710: 6e63 794e 616d 652c 2068 6561 6465 723d  ncyName, header=
-0001b720: 4e6f 6e65 293a 0a20 2020 2020 2020 2023  None):.        #
-0001b730: 2073 7465 7020 313a 20e5 8897 e4b8 bee6   step 1: .......
-0001b740: 8c87 e5ae 9a72 6567 696f 6ee4 b88b e79a  .....region.....
-0001b750: 84e9 9b86 e7be a4e4 bfa1 e681 af0a 2020  ..............  
-0001b760: 2020 2020 2020 617a 5265 7370 203d 2073        azResp = s
-0001b770: 656c 662e 6c69 7374 4176 6169 6c61 626c  elf.listAvailabl
-0001b780: 655a 6f6e 6549 6e66 6f28 7265 6769 6f6e  eZoneInfo(region
-0001b790: 4964 2c20 746f 6b65 6e29 0a20 2020 2020  Id, token).     
-0001b7a0: 2020 2069 6620 617a 5265 7370 2e73 7461     if azResp.sta
-0001b7b0: 7475 7320 213d 2032 3030 3a0a 2020 2020  tus != 200:.    
-0001b7c0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-0001b7d0: 6365 7074 696f 6e28 276c 6973 7420 415a  ception('list AZ
-0001b7e0: 2069 6e66 6f73 2066 6169 6c65 642c 2072   infos failed, r
-0001b7f0: 6573 703a 2025 7327 2025 2061 7a52 6573  esp: %s' % azRes
-0001b800: 7029 0a0a 2020 2020 2020 2020 6669 7273  p)..        firs
-0001b810: 7441 5a43 6749 642c 2073 6563 6f6e 6441  tAZCgId, secondA
-0001b820: 5a43 6749 6420 3d20 7365 6c66 2e5f 6765  ZCgId = self._ge
-0001b830: 745f 636c 7573 7465 725f 6772 6f75 705f  t_cluster_group_
-0001b840: 6964 2861 7a52 6573 7029 0a0a 2020 2020  id(azResp)..    
-0001b850: 2020 2020 2320 7374 6570 2032 3a20 e68c      # step 2: ..
-0001b860: 87e5 ae9a e99b 86e7 bea4 6964 e588 9be6  ..........id....
-0001b870: a1b6 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0001b880: 5f63 7265 6174 655f 6275 636b 6574 5f77  _create_bucket_w
-0001b890: 6974 685f 636c 7573 7465 725f 6964 2866  ith_cluster_id(f
-0001b8a0: 6972 7374 415a 4367 4964 2c20 7365 636f  irstAZCgId, seco
-0001b8b0: 6e64 415a 4367 4964 2c20 6275 636b 6574  ndAZCgId, bucket
-0001b8c0: 4e61 6d65 312c 2062 7563 6b65 744e 616d  Name1, bucketNam
-0001b8d0: 6532 2c20 6275 636b 6574 416c 6961 732c  e2, bucketAlias,
-0001b8e0: 2068 6561 6465 7229 0a0a 2020 2020 2020   header)..      
-0001b8f0: 2020 2320 7374 6570 2033 3a20 e588 9be5    # step 3: ....
-0001b900: bbba e4b8 80e6 aca1 e588 abe5 908d 0a20  ............... 
-0001b910: 2020 2020 2020 2061 6c69 6173 496e 666f         aliasInfo
-0001b920: 203d 2042 7563 6b65 7441 6c69 6173 4d6f   = BucketAliasMo
-0001b930: 6465 6c28 290a 2020 2020 2020 2020 616c  del().        al
-0001b940: 6961 7349 6e66 6f2e 6275 636b 6574 3120  iasInfo.bucket1 
-0001b950: 3d20 6275 636b 6574 4e61 6d65 310a 2020  = bucketName1.  
-0001b960: 2020 2020 2020 616c 6961 7349 6e66 6f2e        aliasInfo.
-0001b970: 6275 636b 6574 3220 3d20 6275 636b 6574  bucket2 = bucket
-0001b980: 4e61 6d65 320a 2020 2020 2020 2020 6362  Name2.        cb
-0001b990: 6152 6573 7020 3d20 7365 6c66 2e63 7265  aResp = self.cre
-0001b9a0: 6174 6542 7563 6b65 7441 6c69 6173 2862  ateBucketAlias(b
-0001b9b0: 7563 6b65 7441 6c69 6173 2c20 616c 6961  ucketAlias, alia
-0001b9c0: 7349 6e66 6f29 0a20 2020 2020 2020 2069  sInfo).        i
-0001b9d0: 6620 6362 6152 6573 702e 7374 6174 7573  f cbaResp.status
-0001b9e0: 2021 3d20 3230 303a 0a20 2020 2020 2020   != 200:.       
-0001b9f0: 2020 2020 2073 656c 662e 5f63 6c65 6172       self._clear
-0001ba00: 5f76 6972 7475 616c 5f62 7563 6b65 7428  _virtual_bucket(
-0001ba10: 636f 6e73 742e 5649 5254 5541 4c5f 4255  const.VIRTUAL_BU
-0001ba20: 434b 4554 5f43 5245 4154 4542 5543 4b45  CKET_CREATEBUCKE
-0001ba30: 545f 5354 4147 4544 2c20 6275 636b 6574  T_STAGED, bucket
-0001ba40: 4e61 6d65 312c 2062 7563 6b65 744e 616d  Name1, bucketNam
-0001ba50: 6532 2c20 6275 636b 6574 416c 6961 7329  e2, bucketAlias)
-0001ba60: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0001ba70: 7365 2045 7863 6570 7469 6f6e 2827 6372  se Exception('cr
-0001ba80: 6561 7465 2062 7563 6b65 7420 616c 6961  eate bucket alia
-0001ba90: 7320 6661 696c 6564 2c20 7265 7370 3a20  s failed, resp: 
-0001baa0: 2573 2720 2520 6362 6152 6573 7029 0a0a  %s' % cbaResp)..
-0001bab0: 2020 2020 2020 2020 2320 7374 6570 2034          # step 4
-0001bac0: 3a20 e7bb 91e5 ae9a e4b8 a4e6 aca1 e588  : ..............
-0001bad0: abe5 908d efbc 8ce4 b8ba e4b8 a4e4 b8aa  ................
-0001bae0: e79c 9fe5 ae9e e6a1 b6e5 8886 e588 abe7  ................
-0001baf0: bb91 e5ae 9a0a 2020 2020 2020 2020 616c  ......        al
-0001bb00: 6961 7349 6e66 6f2e 616c 6961 7320 3d20  iasInfo.alias = 
-0001bb10: 6275 636b 6574 416c 6961 730a 2020 2020  bucketAlias.    
-0001bb20: 2020 2020 6269 6e64 5265 7370 203d 2073      bindResp = s
-0001bb30: 656c 662e 6269 6e64 4275 636b 6574 416c  elf.bindBucketAl
-0001bb40: 6961 7328 6275 636b 6574 4e61 6d65 312c  ias(bucketName1,
-0001bb50: 2061 6c69 6173 496e 666f 290a 2020 2020   aliasInfo).    
-0001bb60: 2020 2020 6966 2062 696e 6452 6573 702e      if bindResp.
-0001bb70: 7374 6174 7573 2021 3d20 3230 303a 0a20  status != 200:. 
-0001bb80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001bb90: 5f63 6c65 6172 5f76 6972 7475 616c 5f62  _clear_virtual_b
-0001bba0: 7563 6b65 7428 636f 6e73 742e 5649 5254  ucket(const.VIRT
-0001bbb0: 5541 4c5f 4255 434b 4554 5f43 5245 4154  UAL_BUCKET_CREAT
-0001bbc0: 4541 4c49 4153 5f53 5441 4745 442c 2062  EALIAS_STAGED, b
-0001bbd0: 7563 6b65 744e 616d 6531 2c20 6275 636b  ucketName1, buck
-0001bbe0: 6574 4e61 6d65 322c 2062 7563 6b65 7441  etName2, bucketA
-0001bbf0: 6c69 6173 290a 2020 2020 2020 2020 2020  lias).          
-0001bc00: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
-0001bc10: 6e28 2762 696e 6469 6e67 2062 7563 6b65  n('binding bucke
-0001bc20: 7420 616c 6961 7320 6661 696c 6564 2c20  t alias failed, 
-0001bc30: 7265 7370 3a20 2573 2720 2520 6269 6e64  resp: %s' % bind
-0001bc40: 5265 7370 290a 0a20 2020 2020 2020 2062  Resp)..        b
-0001bc50: 696e 6452 6573 7020 3d20 7365 6c66 2e62  indResp = self.b
-0001bc60: 696e 6442 7563 6b65 7441 6c69 6173 2862  indBucketAlias(b
-0001bc70: 7563 6b65 744e 616d 6532 2c20 616c 6961  ucketName2, alia
-0001bc80: 7349 6e66 6f29 0a20 2020 2020 2020 2069  sInfo).        i
-0001bc90: 6620 6269 6e64 5265 7370 2e73 7461 7475  f bindResp.statu
-0001bca0: 7320 213d 2032 3030 3a0a 2020 2020 2020  s != 200:.      
-0001bcb0: 2020 2020 2020 7365 6c66 2e5f 636c 6561        self._clea
-0001bcc0: 725f 7669 7274 7561 6c5f 6275 636b 6574  r_virtual_bucket
-0001bcd0: 2863 6f6e 7374 2e56 4952 5455 414c 5f42  (const.VIRTUAL_B
-0001bce0: 5543 4b45 545f 4249 4e44 414c 4941 535f  UCKET_BINDALIAS_
-0001bcf0: 5354 4147 4544 2c20 6275 636b 6574 4e61  STAGED, bucketNa
-0001bd00: 6d65 312c 2062 7563 6b65 744e 616d 6532  me1, bucketName2
-0001bd10: 2c20 6275 636b 6574 416c 6961 7329 0a20  , bucketAlias). 
-0001bd20: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001bd30: 2045 7863 6570 7469 6f6e 2827 6269 6e64   Exception('bind
-0001bd40: 696e 6720 6275 636b 6574 2061 6c69 6173  ing bucket alias
-0001bd50: 2066 6169 6c65 642c 2072 6573 703a 2025   failed, resp: %
-0001bd60: 7327 2025 2062 696e 6452 6573 7029 0a0a  s' % bindResp)..
-0001bd70: 2020 2020 2020 2020 2320 7374 6570 2035          # step 5
-0001bd80: 3a20 e58f 8ce5 9091 e985 8de7 bdae e5a4  : ..............
-0001bd90: 8de5 88b6 e585 b3e7 b3bb efbc 8ce5 b9b6  ................
-0001bda0: e5bc 80e5 90af e58e 86e5 8fb2 e5af b9e8  ................
-0001bdb0: b1a1 e5a4 8de5 88b6 0a20 2020 2020 2020  .........       
-0001bdc0: 2072 6570 6c69 6361 7469 6f6e 5265 7370   replicationResp
-0001bdd0: 203d 2073 656c 662e 5f73 6574 5f76 6972   = self._set_vir
-0001bde0: 7475 616c 5f72 6570 6c69 6361 7469 6f6e  tual_replication
-0001bdf0: 2861 6765 6e63 794e 616d 652c 2062 7563  (agencyName, buc
-0001be00: 6b65 744e 616d 6531 2c20 6275 636b 6574  ketName1, bucket
-0001be10: 4e61 6d65 3229 0a20 2020 2020 2020 2069  Name2).        i
-0001be20: 6620 7265 706c 6963 6174 696f 6e52 6573  f replicationRes
-0001be30: 702e 7374 6174 7573 2021 3d20 3230 303a  p.status != 200:
-0001be40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0001be50: 662e 5f63 6c65 6172 5f76 6972 7475 616c  f._clear_virtual
-0001be60: 5f62 7563 6b65 7428 636f 6e73 742e 5649  _bucket(const.VI
-0001be70: 5254 5541 4c5f 4255 434b 4554 5f42 494e  RTUAL_BUCKET_BIN
-0001be80: 4441 4c49 4153 5f53 5441 4745 442c 2062  DALIAS_STAGED, b
-0001be90: 7563 6b65 744e 616d 6531 2c20 6275 636b  ucketName1, buck
-0001bea0: 6574 4e61 6d65 322c 2062 7563 6b65 7441  etName2, bucketA
-0001beb0: 6c69 6173 290a 2020 2020 2020 2020 2020  lias).          
-0001bec0: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
-0001bed0: 6e28 2773 6574 2072 6570 6c69 6361 7469  n('set replicati
-0001bee0: 6f6e 2066 6169 6c65 642c 2072 6573 703a  on failed, resp:
-0001bef0: 2025 7327 2025 2072 6570 6c69 6361 7469   %s' % replicati
-0001bf00: 6f6e 5265 7370 290a 0a20 2020 2020 2020  onResp)..       
-0001bf10: 2072 6570 6c69 6361 7469 6f6e 5265 7370   replicationResp
-0001bf20: 203d 2073 656c 662e 5f73 6574 5f76 6972   = self._set_vir
-0001bf30: 7475 616c 5f72 6570 6c69 6361 7469 6f6e  tual_replication
-0001bf40: 2861 6765 6e63 794e 616d 652c 2062 7563  (agencyName, buc
-0001bf50: 6b65 744e 616d 6532 2c20 6275 636b 6574  ketName2, bucket
-0001bf60: 4e61 6d65 3129 0a20 2020 2020 2020 2069  Name1).        i
-0001bf70: 6620 7265 706c 6963 6174 696f 6e52 6573  f replicationRes
-0001bf80: 702e 7374 6174 7573 2021 3d20 3230 303a  p.status != 200:
-0001bf90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0001bfa0: 662e 5f63 6c65 6172 5f76 6972 7475 616c  f._clear_virtual
-0001bfb0: 5f62 7563 6b65 7428 636f 6e73 742e 5649  _bucket(const.VI
-0001bfc0: 5254 5541 4c5f 4255 434b 4554 5f42 494e  RTUAL_BUCKET_BIN
-0001bfd0: 4441 4c49 4153 5f53 5441 4745 442c 2062  DALIAS_STAGED, b
-0001bfe0: 7563 6b65 744e 616d 6531 2c20 6275 636b  ucketName1, buck
-0001bff0: 6574 4e61 6d65 322c 2062 7563 6b65 7441  etName2, bucketA
-0001c000: 6c69 6173 290a 2020 2020 2020 2020 2020  lias).          
-0001c010: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
-0001c020: 6e28 2773 6574 2072 6570 6c69 6361 7469  n('set replicati
-0001c030: 6f6e 2066 6169 6c65 642c 2072 6573 703a  on failed, resp:
-0001c040: 2025 7327 2025 2072 6570 6c69 6361 7469   %s' % replicati
-0001c050: 6f6e 5265 7370 290a 0a20 2020 2020 2020  onResp)..       
-0001c060: 2072 6574 7572 6e20 7b27 636f 6465 273a   return {'code':
-0001c070: 2027 4f4b 272c 2027 6d65 7373 6167 6527   'OK', 'message'
-0001c080: 3a20 2763 7265 6174 6520 7669 7274 7561  : 'create virtua
-0001c090: 6c20 6275 636b 6574 2073 7563 6365 7373  l bucket success
-0001c0a0: 272c 2027 7669 7274 7561 6c42 7563 6b65  ', 'virtualBucke
-0001c0b0: 744e 616d 6527 3a20 6275 636b 6574 416c  tName': bucketAl
-0001c0c0: 6961 732c 0a20 2020 2020 2020 2020 2020  ias,.           
-0001c0d0: 2020 2020 2027 6275 636b 6574 4e61 6d65       'bucketName
-0001c0e0: 3127 3a20 6275 636b 6574 4e61 6d65 312c  1': bucketName1,
-0001c0f0: 2027 6275 636b 6574 4e61 6d65 3227 3a20   'bucketName2': 
-0001c100: 6275 636b 6574 4e61 6d65 327d 0a0a 2020  bucketName2}..  
-0001c110: 2020 6465 6620 5f67 6574 5f63 6c75 7374    def _get_clust
-0001c120: 6572 5f67 726f 7570 5f69 6428 7365 6c66  er_group_id(self
-0001c130: 2c20 617a 5265 7370 293a 0a20 2020 2020  , azResp):.     
-0001c140: 2020 2061 7a4a 736f 6e52 6573 7020 3d20     azJsonResp = 
-0001c150: 7574 696c 2e6a 736f 6e4c 6f61 6473 466f  util.jsonLoadsFo
-0001c160: 7250 7932 2861 7a52 6573 702e 626f 6479  rPy2(azResp.body
-0001c170: 2920 6966 2063 6f6e 7374 2e49 535f 5059  ) if const.IS_PY
-0001c180: 5448 4f4e 3220 656c 7365 206a 736f 6e2e  THON2 else json.
-0001c190: 6c6f 6164 7328 617a 5265 7370 2e62 6f64  loads(azResp.bod
-0001c1a0: 7929 0a20 2020 2020 2020 2061 7a49 6e66  y).        azInf
-0001c1b0: 6f73 203d 2061 7a4a 736f 6e52 6573 702e  os = azJsonResp.
-0001c1c0: 6765 7428 2769 6e66 6f73 2729 0a0a 2020  get('infos')..  
-0001c1d0: 2020 2020 2020 6966 206c 656e 2861 7a49        if len(azI
-0001c1e0: 6e66 6f73 2920 213d 2063 6f6e 7374 2e56  nfos) != const.V
-0001c1f0: 4952 5455 414c 5f42 5543 4b45 545f 4e45  IRTUAL_BUCKET_NE
-0001c200: 4544 5f41 5a5f 434f 554e 543a 0a20 2020  ED_AZ_COUNT:.   
-0001c210: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
-0001c220: 7863 6570 7469 6f6e 2827 7468 6520 6e75  xception('the nu
-0001c230: 6d62 6572 206f 6620 415a 7320 646f 6573  mber of AZs does
-0001c240: 206e 6f74 206d 6565 7420 7468 6520 7265   not meet the re
-0001c250: 7175 6972 656d 656e 7473 2729 0a0a 2020  quirements')..  
-0001c260: 2020 2020 2020 6669 7273 7441 5a4b 6579        firstAZKey
-0001c270: 203d 206e 6578 7428 6974 6572 2861 7a49   = next(iter(azI
-0001c280: 6e66 6f73 2929 0a20 2020 2020 2020 2066  nfos)).        f
-0001c290: 6972 7374 415a 5661 6c75 6520 3d20 617a  irstAZValue = az
-0001c2a0: 496e 666f 732e 6765 7428 6669 7273 7441  Infos.get(firstA
-0001c2b0: 5a4b 6579 290a 2020 2020 2020 2020 6966  ZKey).        if
-0001c2c0: 206c 656e 2866 6972 7374 415a 5661 6c75   len(firstAZValu
-0001c2d0: 6529 203d 3d20 303a 0a20 2020 2020 2020  e) == 0:.       
-0001c2e0: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-0001c2f0: 7469 6f6e 2827 6e6f 2063 6c75 7374 6572  tion('no cluster
-0001c300: 2065 7869 7374 7320 696e 2074 6865 2041   exists in the A
-0001c310: 5a2c 2041 5a20 6b65 793a 2025 7327 2025  Z, AZ key: %s' %
-0001c320: 2066 6972 7374 415a 4b65 7929 0a0a 2020   firstAZKey)..  
-0001c330: 2020 2020 2020 6669 7273 7441 5a43 6749        firstAZCgI
-0001c340: 6420 3d20 6669 7273 7441 5a56 616c 7565  d = firstAZValue
-0001c350: 5b30 5d2e 6765 7428 636f 6e73 742e 4b45  [0].get(const.KE
-0001c360: 595f 434c 5553 5445 525f 4752 4f55 505f  Y_CLUSTER_GROUP_
-0001c370: 4944 290a 2020 2020 2020 2020 6966 206e  ID).        if n
-0001c380: 6f74 2066 6972 7374 415a 4367 4964 3a0a  ot firstAZCgId:.
-0001c390: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001c3a0: 6520 4578 6365 7074 696f 6e28 2774 6869  e Exception('thi
-0001c3b0: 7320 415a 7320 6669 7273 7420 636c 7573  s AZs first clus
-0001c3c0: 7465 7220 6772 6f75 7020 6964 2069 7320  ter group id is 
-0001c3d0: 4e6f 6e65 2c20 415a 206b 6579 3a20 2573  None, AZ key: %s
-0001c3e0: 2720 2520 6669 7273 7441 5a4b 6579 290a  ' % firstAZKey).
-0001c3f0: 0a20 2020 2020 2020 2073 6563 6f6e 6441  .        secondA
-0001c400: 5a4b 6579 203d 206c 6973 7428 617a 496e  ZKey = list(azIn
-0001c410: 666f 732e 6b65 7973 2829 295b 2d31 5d0a  fos.keys())[-1].
-0001c420: 2020 2020 2020 2020 7365 636f 6e64 415a          secondAZ
-0001c430: 5661 6c75 6520 3d20 617a 496e 666f 732e  Value = azInfos.
-0001c440: 6765 7428 7365 636f 6e64 415a 4b65 7929  get(secondAZKey)
-0001c450: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-0001c460: 7365 636f 6e64 415a 5661 6c75 6529 203d  secondAZValue) =
-0001c470: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0001c480: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-0001c490: 2827 6e6f 2063 6c75 7374 6572 2065 7869  ('no cluster exi
-0001c4a0: 7374 7320 696e 2074 6865 2041 5a2c 2041  sts in the AZ, A
-0001c4b0: 5a20 6b65 793a 2025 7327 2025 2073 6563  Z key: %s' % sec
-0001c4c0: 6f6e 6441 5a4b 6579 290a 0a20 2020 2020  ondAZKey)..     
-0001c4d0: 2020 2073 6563 6f6e 6441 5a43 6749 6420     secondAZCgId 
-0001c4e0: 3d20 7365 636f 6e64 415a 5661 6c75 655b  = secondAZValue[
-0001c4f0: 305d 2e67 6574 2863 6f6e 7374 2e4b 4559  0].get(const.KEY
-0001c500: 5f43 4c55 5354 4552 5f47 524f 5550 5f49  _CLUSTER_GROUP_I
-0001c510: 4429 0a20 2020 2020 2020 2069 6620 6e6f  D).        if no
-0001c520: 7420 7365 636f 6e64 415a 4367 4964 3a0a  t secondAZCgId:.
-0001c530: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001c540: 6520 4578 6365 7074 696f 6e28 2774 6869  e Exception('thi
-0001c550: 7320 415a 7320 6669 7273 7420 636c 7573  s AZs first clus
-0001c560: 7465 7220 6772 6f75 7020 6964 2069 7320  ter group id is 
-0001c570: 4e6f 6e65 2c20 415a 206b 6579 3a20 2573  None, AZ key: %s
-0001c580: 2720 2520 7365 636f 6e64 415a 4b65 7929  ' % secondAZKey)
-0001c590: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0001c5a0: 2066 6972 7374 415a 4367 4964 2c20 7365   firstAZCgId, se
-0001c5b0: 636f 6e64 415a 4367 4964 0a0a 2020 2020  condAZCgId..    
-0001c5c0: 6465 6620 5f63 7265 6174 655f 6275 636b  def _create_buck
-0001c5d0: 6574 5f77 6974 685f 636c 7573 7465 725f  et_with_cluster_
-0001c5e0: 6964 2873 656c 662c 2066 6972 7374 415a  id(self, firstAZ
-0001c5f0: 4367 4964 2c20 7365 636f 6e64 415a 4367  CgId, secondAZCg
-0001c600: 4964 2c20 6275 636b 6574 4e61 6d65 312c  Id, bucketName1,
-0001c610: 2062 7563 6b65 744e 616d 6532 2c20 6275   bucketName2, bu
-0001c620: 636b 6574 416c 6961 732c 2068 6561 6465  cketAlias, heade
-0001c630: 7229 3a0a 2020 2020 2020 2020 2320 e588  r):.        # ..
-0001c640: a4e6 96ad e6a1 b6e6 98af e590 a6e5 ad98  ................
-0001c650: e59c a80a 2020 2020 2020 2020 6275 636b  ....        buck
-0001c660: 6574 3143 6749 642c 2062 7563 6b65 7432  et1CgId, bucket2
-0001c670: 4367 4964 203d 2073 656c 662e 5f68 6561  CgId = self._hea
-0001c680: 645f 7669 7274 7561 6c5f 6275 636b 6574  d_virtual_bucket
-0001c690: 2862 7563 6b65 744e 616d 6531 2c20 6275  (bucketName1, bu
-0001c6a0: 636b 6574 4e61 6d65 3229 0a0a 2020 2020  cketName2)..    
-0001c6b0: 2020 2020 2320 e4b8 a4e4 b8aa e6a1 b6e9      # ..........
-0001c6c0: 83bd e5ad 98e5 9ca8 efbc 8ce4 b894 636c  ..............cl
-0001c6d0: 7573 7465 7220 6772 6f75 7020 6964 e4b8  uster group id..
-0001c6e0: 80e8 87b4 0a20 2020 2020 2020 2069 6620  .....        if 
-0001c6f0: 6275 636b 6574 3143 6749 6420 616e 6420  bucket1CgId and 
-0001c700: 6275 636b 6574 3243 6749 6420 616e 6420  bucket2CgId and 
-0001c710: 6275 636b 6574 3143 6749 6420 3d3d 2062  bucket1CgId == b
-0001c720: 7563 6b65 7432 4367 4964 3a0a 2020 2020  ucket2CgId:.    
-0001c730: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-0001c740: 6365 7074 696f 6e28 2763 7265 6174 6520  ception('create 
-0001c750: 6275 636b 6574 2066 6169 6c65 642c 2062  bucket failed, b
-0001c760: 6f74 6820 6275 636b 6574 7320 6578 6973  oth buckets exis
-0001c770: 7420 616e 6420 636c 7573 7465 7220 6772  t and cluster gr
-0001c780: 6f75 7020 6964 2069 7320 7468 6520 7361  oup id is the sa
-0001c790: 6d65 2729 0a0a 2020 2020 2020 2020 6578  me')..        ex
-0001c7a0: 7465 6e73 696f 6e48 6561 6465 7273 203d  tensionHeaders =
-0001c7b0: 2045 7874 656e 7369 6f6e 4865 6164 6572   ExtensionHeader
-0001c7c0: 2829 0a0a 2020 2020 2020 2020 2320 e58f  ()..        # ..
-0001c7d0: aae5 ad98 e59c a8e6 a1b6 310a 2020 2020  ..........1.    
-0001c7e0: 2020 2020 6966 2062 7563 6b65 7431 4367      if bucket1Cg
-0001c7f0: 4964 3a0a 2020 2020 2020 2020 2020 2020  Id:.            
-0001c800: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0001c810: 2e6c 6f63 6174 696f 6e43 6c75 7374 6572  .locationCluster
-0001c820: 4772 6f75 7049 6420 3d20 7365 636f 6e64  GroupId = second
-0001c830: 415a 4367 4964 2069 6620 6275 636b 6574  AZCgId if bucket
-0001c840: 3143 6749 6420 3d3d 2066 6972 7374 415a  1CgId == firstAZ
-0001c850: 4367 4964 2065 6c73 6520 6669 7273 7441  CgId else firstA
-0001c860: 5a43 6749 640a 2020 2020 2020 2020 2020  ZCgId.          
-0001c870: 2020 6362 5265 7370 203d 2073 656c 662e    cbResp = self.
-0001c880: 6372 6561 7465 4275 636b 6574 2862 7563  createBucket(buc
-0001c890: 6b65 744e 616d 6532 2c20 6865 6164 6572  ketName2, header
-0001c8a0: 3d68 6561 6465 722c 2065 7874 656e 7369  =header, extensi
-0001c8b0: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
-0001c8c0: 696f 6e48 6561 6465 7273 290a 2020 2020  ionHeaders).    
-0001c8d0: 2020 2020 2020 2020 6966 2063 6252 6573          if cbRes
-0001c8e0: 702e 7374 6174 7573 2021 3d20 3230 303a  p.status != 200:
-0001c8f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c900: 2073 656c 662e 5f63 6c65 6172 5f76 6972   self._clear_vir
-0001c910: 7475 616c 5f62 7563 6b65 7428 636f 6e73  tual_bucket(cons
-0001c920: 742e 5649 5254 5541 4c5f 4255 434b 4554  t.VIRTUAL_BUCKET
-0001c930: 5f43 5245 4154 4542 5543 4b45 545f 5354  _CREATEBUCKET_ST
-0001c940: 4147 4544 2c20 6275 636b 6574 4e61 6d65  AGED, bucketName
-0001c950: 312c 2062 7563 6b65 744e 616d 6532 2c0a  1, bucketName2,.
-0001c960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c980: 2020 2020 2020 2020 2020 2062 7563 6b65             bucke
-0001c990: 7441 6c69 6173 290a 2020 2020 2020 2020  tAlias).        
-0001c9a0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-0001c9b0: 6365 7074 696f 6e28 2763 7265 6174 6520  ception('create 
-0001c9c0: 6275 636b 6574 2066 6169 6c65 642c 2063  bucket failed, c
-0001c9d0: 6c75 7374 6572 2067 726f 7570 2069 643a  luster group id:
-0001c9e0: 2025 732c 2072 6573 703a 2025 7327 2025   %s, resp: %s' %
-0001c9f0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-0001ca00: 2020 2020 2020 2065 7874 656e 7369 6f6e         extension
-0001ca10: 4865 6164 6572 732e 6c6f 6361 7469 6f6e  Headers.location
-0001ca20: 436c 7573 7465 7247 726f 7570 4964 2c20  ClusterGroupId, 
-0001ca30: 6362 5265 7370 2929 0a0a 2020 2020 2020  cbResp))..      
-0001ca40: 2020 2320 e58f aae5 ad98 e59c a8e6 a1b6    # ............
-0001ca50: 320a 2020 2020 2020 2020 6966 2062 7563  2.        if buc
-0001ca60: 6b65 7432 4367 4964 3a0a 2020 2020 2020  ket2CgId:.      
-0001ca70: 2020 2020 2020 6578 7465 6e73 696f 6e48        extensionH
-0001ca80: 6561 6465 7273 2e6c 6f63 6174 696f 6e43  eaders.locationC
-0001ca90: 6c75 7374 6572 4772 6f75 7049 6420 3d20  lusterGroupId = 
-0001caa0: 7365 636f 6e64 415a 4367 4964 2069 6620  secondAZCgId if 
-0001cab0: 6275 636b 6574 3243 6749 6420 3d3d 2066  bucket2CgId == f
-0001cac0: 6972 7374 415a 4367 4964 2065 6c73 6520  irstAZCgId else 
-0001cad0: 6669 7273 7441 5a43 6749 640a 2020 2020  firstAZCgId.    
-0001cae0: 2020 2020 2020 2020 6362 5265 7370 203d          cbResp =
-0001caf0: 2073 656c 662e 6372 6561 7465 4275 636b   self.createBuck
-0001cb00: 6574 2862 7563 6b65 744e 616d 6531 2c20  et(bucketName1, 
-0001cb10: 6865 6164 6572 3d68 6561 6465 722c 2065  header=header, e
-0001cb20: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-0001cb30: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0001cb40: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0001cb50: 2063 6252 6573 702e 7374 6174 7573 2021   cbResp.status !
-0001cb60: 3d20 3230 303a 0a20 2020 2020 2020 2020  = 200:.         
-0001cb70: 2020 2020 2020 2073 656c 662e 5f63 6c65         self._cle
-0001cb80: 6172 5f76 6972 7475 616c 5f62 7563 6b65  ar_virtual_bucke
-0001cb90: 7428 636f 6e73 742e 5649 5254 5541 4c5f  t(const.VIRTUAL_
-0001cba0: 4255 434b 4554 5f43 5245 4154 4542 5543  BUCKET_CREATEBUC
-0001cbb0: 4b45 545f 5354 4147 4544 2c20 6275 636b  KET_STAGED, buck
-0001cbc0: 6574 4e61 6d65 312c 2062 7563 6b65 744e  etName1, bucketN
-0001cbd0: 616d 6532 2c0a 2020 2020 2020 2020 2020  ame2,.          
-0001cbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc00: 2062 7563 6b65 7441 6c69 6173 290a 2020   bucketAlias).  
-0001cc10: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0001cc20: 6973 6520 4578 6365 7074 696f 6e28 2763  ise Exception('c
-0001cc30: 7265 6174 6520 6275 636b 6574 2066 6169  reate bucket fai
-0001cc40: 6c65 642c 2063 6c75 7374 6572 2067 726f  led, cluster gro
-0001cc50: 7570 2069 643a 2025 732c 2072 6573 703a  up id: %s, resp:
-0001cc60: 2025 7327 2025 2028 0a20 2020 2020 2020   %s' % (.       
-0001cc70: 2020 2020 2020 2020 2020 2020 2065 7874               ext
-0001cc80: 656e 7369 6f6e 4865 6164 6572 732e 6c6f  ensionHeaders.lo
-0001cc90: 6361 7469 6f6e 436c 7573 7465 7247 726f  cationClusterGro
-0001cca0: 7570 4964 2c20 6362 5265 7370 2929 0a0a  upId, cbResp))..
-0001ccb0: 2020 2020 2020 2020 2320 e4b8 a4e4 b8aa          # ......
-0001ccc0: e6a1 b6e9 83bd e4b8 8de5 ad98 e59c a80a  ................
-0001ccd0: 2020 2020 2020 2020 6966 206e 6f74 2062          if not b
-0001cce0: 7563 6b65 7431 4367 4964 2061 6e64 206e  ucket1CgId and n
-0001ccf0: 6f74 2062 7563 6b65 7432 4367 4964 3a0a  ot bucket2CgId:.
-0001cd00: 2020 2020 2020 2020 2020 2020 6578 7465              exte
-0001cd10: 6e73 696f 6e48 6561 6465 7273 2e6c 6f63  nsionHeaders.loc
-0001cd20: 6174 696f 6e43 6c75 7374 6572 4772 6f75  ationClusterGrou
-0001cd30: 7049 6420 3d20 6669 7273 7441 5a43 6749  pId = firstAZCgI
-0001cd40: 640a 2020 2020 2020 2020 2020 2020 6362  d.            cb
-0001cd50: 5265 7370 203d 2073 656c 662e 6372 6561  Resp = self.crea
-0001cd60: 7465 4275 636b 6574 2862 7563 6b65 744e  teBucket(bucketN
-0001cd70: 616d 6531 2c20 6865 6164 6572 3d68 6561  ame1, header=hea
-0001cd80: 6465 722c 2065 7874 656e 7369 6f6e 4865  der, extensionHe
-0001cd90: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
-0001cda0: 6561 6465 7273 290a 2020 2020 2020 2020  eaders).        
-0001cdb0: 2020 2020 6966 2063 6252 6573 702e 7374      if cbResp.st
-0001cdc0: 6174 7573 2021 3d20 3230 303a 0a20 2020  atus != 200:.   
-0001cdd0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001cde0: 662e 5f63 6c65 6172 5f76 6972 7475 616c  f._clear_virtual
-0001cdf0: 5f62 7563 6b65 7428 636f 6e73 742e 5649  _bucket(const.VI
-0001ce00: 5254 5541 4c5f 4255 434b 4554 5f43 5245  RTUAL_BUCKET_CRE
-0001ce10: 4154 4542 5543 4b45 545f 5354 4147 4544  ATEBUCKET_STAGED
-0001ce20: 2c20 6275 636b 6574 4e61 6d65 312c 2062  , bucketName1, b
-0001ce30: 7563 6b65 744e 616d 6532 2c0a 2020 2020  ucketName2,.    
-0001ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce60: 2020 2020 2020 2062 7563 6b65 7441 6c69         bucketAli
-0001ce70: 6173 290a 2020 2020 2020 2020 2020 2020  as).            
-0001ce80: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-0001ce90: 696f 6e28 2763 7265 6174 6520 6275 636b  ion('create buck
-0001cea0: 6574 2066 6169 6c65 642c 2063 6c75 7374  et failed, clust
-0001ceb0: 6572 2067 726f 7570 2069 643a 2025 732c  er group id: %s,
-0001cec0: 2072 6573 703a 2025 7327 2025 2028 6669   resp: %s' % (fi
-0001ced0: 7273 7441 5a43 6749 642c 2063 6252 6573  rstAZCgId, cbRes
-0001cee0: 7029 290a 0a20 2020 2020 2020 2020 2020  p))..           
-0001cef0: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-0001cf00: 732e 6c6f 6361 7469 6f6e 436c 7573 7465  s.locationCluste
-0001cf10: 7247 726f 7570 4964 203d 2073 6563 6f6e  rGroupId = secon
-0001cf20: 6441 5a43 6749 640a 2020 2020 2020 2020  dAZCgId.        
-0001cf30: 2020 2020 6362 5265 7370 203d 2073 656c      cbResp = sel
-0001cf40: 662e 6372 6561 7465 4275 636b 6574 2862  f.createBucket(b
-0001cf50: 7563 6b65 744e 616d 6532 2c20 6865 6164  ucketName2, head
-0001cf60: 6572 3d68 6561 6465 722c 2065 7874 656e  er=header, exten
-0001cf70: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
-0001cf80: 6e73 696f 6e48 6561 6465 7273 290a 2020  nsionHeaders).  
-0001cf90: 2020 2020 2020 2020 2020 6966 2063 6252            if cbR
-0001cfa0: 6573 702e 7374 6174 7573 2021 3d20 3230  esp.status != 20
-0001cfb0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0001cfc0: 2020 2073 656c 662e 5f63 6c65 6172 5f76     self._clear_v
-0001cfd0: 6972 7475 616c 5f62 7563 6b65 7428 636f  irtual_bucket(co
-0001cfe0: 6e73 742e 5649 5254 5541 4c5f 4255 434b  nst.VIRTUAL_BUCK
-0001cff0: 4554 5f43 5245 4154 4542 5543 4b45 545f  ET_CREATEBUCKET_
-0001d000: 5354 4147 4544 2c20 6275 636b 6574 4e61  STAGED, bucketNa
-0001d010: 6d65 312c 2062 7563 6b65 744e 616d 6532  me1, bucketName2
-0001d020: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d040: 2020 2020 2020 2020 2020 2020 2062 7563               buc
-0001d050: 6b65 7441 6c69 6173 290a 2020 2020 2020  ketAlias).      
-0001d060: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001d070: 4578 6365 7074 696f 6e28 2763 7265 6174  Exception('creat
-0001d080: 6520 6275 636b 6574 2066 6169 6c65 642c  e bucket failed,
-0001d090: 2063 6c75 7374 6572 2067 726f 7570 2069   cluster group i
-0001d0a0: 643a 2025 732c 2072 6573 703a 2025 7327  d: %s, resp: %s'
-0001d0b0: 2025 2028 7365 636f 6e64 415a 4367 4964   % (secondAZCgId
-0001d0c0: 2c20 6362 5265 7370 2929 0a0a 2020 2020  , cbResp))..    
-0001d0d0: 6465 6620 5f68 6561 645f 7669 7274 7561  def _head_virtua
-0001d0e0: 6c5f 6275 636b 6574 2873 656c 662c 2062  l_bucket(self, b
-0001d0f0: 7563 6b65 744e 616d 6531 2c20 6275 636b  ucketName1, buck
-0001d100: 6574 4e61 6d65 3229 3a0a 2020 2020 2020  etName2):.      
-0001d110: 2020 6275 636b 6574 3143 6749 6420 3d20    bucket1CgId = 
-0001d120: 4e6f 6e65 0a20 2020 2020 2020 2062 7563  None.        buc
-0001d130: 6b65 7432 4367 4964 203d 204e 6f6e 650a  ket2CgId = None.
-0001d140: 0a20 2020 2020 2020 2068 6561 6431 5265  .        head1Re
-0001d150: 7370 203d 2073 656c 662e 6865 6164 4275  sp = self.headBu
-0001d160: 636b 6574 2862 7563 6b65 744e 616d 6531  cket(bucketName1
-0001d170: 290a 2020 2020 2020 2020 6966 2068 6561  ).        if hea
-0001d180: 6431 5265 7370 2e73 7461 7475 7320 3d3d  d1Resp.status ==
-0001d190: 2032 3030 3a0a 2020 2020 2020 2020 2020   200:.          
-0001d1a0: 2020 666f 7220 6820 696e 2068 6561 6431    for h in head1
-0001d1b0: 5265 7370 2e68 6561 6465 723a 0a20 2020  Resp.header:.   
-0001d1c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001d1d0: 636f 6e73 742e 4c4f 4341 5449 4f4e 5f43  const.LOCATION_C
-0001d1e0: 4c55 5354 4552 4752 4f55 505f 4944 2069  LUSTERGROUP_ID i
-0001d1f0: 6e20 683a 0a20 2020 2020 2020 2020 2020  n h:.           
-0001d200: 2020 2020 2020 2020 2062 7563 6b65 7431           bucket1
-0001d210: 4367 4964 203d 2068 5b31 5d0a 2020 2020  CgId = h[1].    
-0001d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d230: 6272 6561 6b0a 0a20 2020 2020 2020 2068  break..        h
-0001d240: 6561 6432 5265 7370 203d 2073 656c 662e  ead2Resp = self.
-0001d250: 6865 6164 4275 636b 6574 2862 7563 6b65  headBucket(bucke
-0001d260: 744e 616d 6532 290a 2020 2020 2020 2020  tName2).        
-0001d270: 6966 2068 6561 6432 5265 7370 2e73 7461  if head2Resp.sta
-0001d280: 7475 7320 3d3d 2032 3030 3a0a 2020 2020  tus == 200:.    
-0001d290: 2020 2020 2020 2020 666f 7220 6820 696e          for h in
-0001d2a0: 2068 6561 6432 5265 7370 2e68 6561 6465   head2Resp.heade
-0001d2b0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-0001d2c0: 2020 2069 6620 636f 6e73 742e 4c4f 4341     if const.LOCA
-0001d2d0: 5449 4f4e 5f43 4c55 5354 4552 4752 4f55  TION_CLUSTERGROU
-0001d2e0: 505f 4944 2069 6e20 683a 0a20 2020 2020  P_ID in h:.     
-0001d2f0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001d300: 7563 6b65 7432 4367 4964 203d 2068 5b31  ucket2CgId = h[1
-0001d310: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001d320: 2020 2020 2020 6272 6561 6b0a 0a20 2020        break..   
-0001d330: 2020 2020 2072 6574 7572 6e20 6275 636b       return buck
-0001d340: 6574 3143 6749 642c 2062 7563 6b65 7432  et1CgId, bucket2
-0001d350: 4367 4964 0a0a 2020 2020 6465 6620 5f73  CgId..    def _s
-0001d360: 6574 5f76 6972 7475 616c 5f72 6570 6c69  et_virtual_repli
-0001d370: 6361 7469 6f6e 2873 656c 662c 2061 6765  cation(self, age
-0001d380: 6e63 794e 616d 652c 2073 6f75 7263 6542  ncyName, sourceB
-0001d390: 7563 6b65 744e 616d 652c 2064 6573 7442  ucketName, destB
-0001d3a0: 7563 6b65 744e 616d 6529 3a0a 2020 2020  ucketName):.    
-0001d3b0: 2020 2020 7265 706c 6963 6174 696f 6e20      replication 
-0001d3c0: 3d20 5265 706c 6963 6174 696f 6e28 290a  = Replication().
-0001d3d0: 2020 2020 2020 2020 7265 706c 6963 6174          replicat
-0001d3e0: 696f 6e2e 6167 656e 6379 203d 2061 6765  ion.agency = age
-0001d3f0: 6e63 794e 616d 650a 0a20 2020 2020 2020  ncyName..       
-0001d400: 205f 7275 6c65 7320 3d20 5b5d 0a20 2020   _rules = [].   
-0001d410: 2020 2020 2072 6570 6c69 6361 7469 6f6e       replication
-0001d420: 5275 6c65 203d 2052 6570 6c69 6361 7469  Rule = Replicati
-0001d430: 6f6e 5275 6c65 2829 0a20 2020 2020 2020  onRule().       
-0001d440: 2072 6570 6c69 6361 7469 6f6e 5275 6c65   replicationRule
-0001d450: 2e69 6420 3d20 736f 7572 6365 4275 636b  .id = sourceBuck
-0001d460: 6574 4e61 6d65 202b 2027 5f74 6f5f 2720  etName + '_to_' 
-0001d470: 2b20 6465 7374 4275 636b 6574 4e61 6d65  + destBucketName
-0001d480: 0a20 2020 2020 2020 2072 6570 6c69 6361  .        replica
-0001d490: 7469 6f6e 5275 6c65 2e70 7265 6669 7820  tionRule.prefix 
-0001d4a0: 3d20 2727 0a20 2020 2020 2020 2072 6570  = ''.        rep
-0001d4b0: 6c69 6361 7469 6f6e 5275 6c65 2e73 7461  licationRule.sta
-0001d4c0: 7475 7320 3d20 2745 6e61 626c 6564 270a  tus = 'Enabled'.
-0001d4d0: 2020 2020 2020 2020 7265 706c 6963 6174          replicat
-0001d4e0: 696f 6e52 756c 652e 6275 636b 6574 203d  ionRule.bucket =
-0001d4f0: 2064 6573 7442 7563 6b65 744e 616d 650a   destBucketName.
-0001d500: 2020 2020 2020 2020 7265 706c 6963 6174          replicat
-0001d510: 696f 6e52 756c 652e 7374 6f72 6167 6543  ionRule.storageC
-0001d520: 6c61 7373 203d 2027 5354 414e 4441 5244  lass = 'STANDARD
-0001d530: 270a 2020 2020 2020 2020 7265 706c 6963  '.        replic
-0001d540: 6174 696f 6e52 756c 652e 6465 6c65 7465  ationRule.delete
-0001d550: 4461 7461 203d 2027 456e 6162 6c65 6427  Data = 'Enabled'
-0001d560: 0a20 2020 2020 2020 2072 6570 6c69 6361  .        replica
-0001d570: 7469 6f6e 5275 6c65 2e68 6973 746f 7269  tionRule.histori
-0001d580: 6361 6c4f 626a 6563 7452 6570 6c69 6361  calObjectReplica
-0001d590: 7469 6f6e 203d 2027 456e 6162 6c65 6427  tion = 'Enabled'
-0001d5a0: 0a0a 2020 2020 2020 2020 5f72 756c 6573  ..        _rules
-0001d5b0: 2e61 7070 656e 6428 7265 706c 6963 6174  .append(replicat
-0001d5c0: 696f 6e52 756c 6529 0a20 2020 2020 2020  ionRule).       
-0001d5d0: 2072 6570 6c69 6361 7469 6f6e 2e72 6570   replication.rep
-0001d5e0: 6c69 6361 7469 6f6e 5275 6c65 7320 3d20  licationRules = 
-0001d5f0: 5f72 756c 6573 0a20 2020 2020 2020 2072  _rules.        r
-0001d600: 6573 7020 3d20 7365 6c66 2e73 6574 4275  esp = self.setBu
-0001d610: 636b 6574 5265 706c 6963 6174 696f 6e28  cketReplication(
-0001d620: 736f 7572 6365 4275 636b 6574 4e61 6d65  sourceBucketName
-0001d630: 2c20 7265 706c 6963 6174 696f 6e29 0a20  , replication). 
-0001d640: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-0001d650: 7370 0a0a 2020 2020 6465 6620 5f63 6c65  sp..    def _cle
-0001d660: 6172 5f76 6972 7475 616c 5f62 7563 6b65  ar_virtual_bucke
-0001d670: 7428 7365 6c66 2c20 7374 6167 6564 2c20  t(self, staged, 
-0001d680: 6275 636b 6574 4e61 6d65 312c 2062 7563  bucketName1, buc
-0001d690: 6b65 744e 616d 6532 2c20 6275 636b 6574  ketName2, bucket
-0001d6a0: 416c 6961 7329 3a0a 2020 2020 2020 2020  Alias):.        
-0001d6b0: 2320 7374 6167 6564 e58f 96e5 80bc efbc  # staged........
-0001d6c0: 9a0a 2020 2020 2020 2020 2320 31ef bc9a  ..        # 1...
-0001d6d0: e588 9be5 bbba e79c 9fe5 ae9e e6a1 b60a  ................
-0001d6e0: 2020 2020 2020 2020 2320 32ef bc9a e588          # 2.....
-0001d6f0: 9be5 bbba e6a1 b6e5 88ab e590 8d0a 2020  ..............  
-0001d700: 2020 2020 2020 2320 33ef bc9a e7bb 91e5        # 3.......
-0001d710: ae9a e6a1 b6e5 88ab e590 8d0a 2020 2020  ............    
-0001d720: 2020 2020 6966 2073 7461 6765 6420 3e3d      if staged >=
-0001d730: 2063 6f6e 7374 2e56 4952 5455 414c 5f42   const.VIRTUAL_B
-0001d740: 5543 4b45 545f 4249 4e44 414c 4941 535f  UCKET_BINDALIAS_
-0001d750: 5354 4147 4544 3a0a 2020 2020 2020 2020  STAGED:.        
-0001d760: 2020 2020 2320 e8a7 a3e7 bb91 e6a1 b6e5      # ..........
-0001d770: 88ab e590 8d0a 2020 2020 2020 2020 2020  ......          
-0001d780: 2020 756e 6269 6e64 5265 7370 203d 2073    unbindResp = s
-0001d790: 656c 662e 756e 6269 6e64 4275 636b 6574  elf.unbindBucket
-0001d7a0: 416c 6961 7328 6275 636b 6574 4e61 6d65  Alias(bucketName
-0001d7b0: 3129 0a20 2020 2020 2020 2020 2020 2069  1).            i
-0001d7c0: 6620 756e 6269 6e64 5265 7370 2e73 7461  f unbindResp.sta
-0001d7d0: 7475 7320 213d 2032 3034 3a0a 2020 2020  tus != 204:.    
-0001d7e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001d7f0: 6520 4578 6365 7074 696f 6e28 2775 6e62  e Exception('unb
-0001d800: 696e 6420 6275 636b 6574 2061 6c69 6173  ind bucket alias
-0001d810: 2066 6169 6c65 642c 2072 6573 703a 2025   failed, resp: %
-0001d820: 7327 2025 2075 6e62 696e 6452 6573 7029  s' % unbindResp)
-0001d830: 0a0a 2020 2020 2020 2020 2020 2020 756e  ..            un
-0001d840: 6269 6e64 5265 7370 203d 2073 656c 662e  bindResp = self.
-0001d850: 756e 6269 6e64 4275 636b 6574 416c 6961  unbindBucketAlia
-0001d860: 7328 6275 636b 6574 4e61 6d65 3229 0a20  s(bucketName2). 
-0001d870: 2020 2020 2020 2020 2020 2069 6620 756e             if un
-0001d880: 6269 6e64 5265 7370 2e73 7461 7475 7320  bindResp.status 
-0001d890: 213d 2032 3034 3a0a 2020 2020 2020 2020  != 204:.        
-0001d8a0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-0001d8b0: 6365 7074 696f 6e28 2775 6e62 696e 6420  ception('unbind 
-0001d8c0: 6275 636b 6574 2061 6c69 6173 2066 6169  bucket alias fai
-0001d8d0: 6c65 642c 2072 6573 703a 2025 7327 2025  led, resp: %s' %
-0001d8e0: 2075 6e62 696e 6452 6573 7029 0a0a 2020   unbindResp)..  
-0001d8f0: 2020 2020 2020 6966 2073 7461 6765 6420        if staged 
-0001d900: 3e3d 2063 6f6e 7374 2e56 4952 5455 414c  >= const.VIRTUAL
-0001d910: 5f42 5543 4b45 545f 4352 4541 5445 414c  _BUCKET_CREATEAL
-0001d920: 4941 535f 5354 4147 4544 3a0a 2020 2020  IAS_STAGED:.    
-0001d930: 2020 2020 2020 2020 2320 e588 a0e9 99a4          # ......
-0001d940: e6a1 b6e5 88ab e590 8d0a 2020 2020 2020  ..........      
-0001d950: 2020 2020 2020 6465 6c65 7465 416c 6961        deleteAlia
-0001d960: 7352 6573 7020 3d20 7365 6c66 2e64 656c  sResp = self.del
-0001d970: 6574 6542 7563 6b65 7441 6c69 6173 2862  eteBucketAlias(b
-0001d980: 7563 6b65 7441 6c69 6173 290a 2020 2020  ucketAlias).    
-0001d990: 2020 2020 2020 2020 6966 2064 656c 6574          if delet
-0001d9a0: 6541 6c69 6173 5265 7370 2e73 7461 7475  eAliasResp.statu
-0001d9b0: 7320 213d 2032 3034 3a0a 2020 2020 2020  s != 204:.      
-0001d9c0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001d9d0: 4578 6365 7074 696f 6e28 2764 656c 6574  Exception('delet
-0001d9e0: 6520 6275 636b 6574 2061 6c69 6173 2066  e bucket alias f
-0001d9f0: 6169 6c65 642c 2072 6573 703a 2025 7327  ailed, resp: %s'
-0001da00: 2025 2064 656c 6574 6541 6c69 6173 5265   % deleteAliasRe
-0001da10: 7370 290a 0a20 2020 2020 2020 2069 6620  sp)..        if 
-0001da20: 7374 6167 6564 203e 3d20 636f 6e73 742e  staged >= const.
-0001da30: 5649 5254 5541 4c5f 4255 434b 4554 5f43  VIRTUAL_BUCKET_C
-0001da40: 5245 4154 4542 5543 4b45 545f 5354 4147  REATEBUCKET_STAG
-0001da50: 4544 3a0a 2020 2020 2020 2020 2020 2020  ED:.            
-0001da60: 2320 e588 a0e9 99a4 e79c 9fe5 ae9e e6a1  # ..............
-0001da70: b60a 2020 2020 2020 2020 2020 2020 6465  ..            de
-0001da80: 6c65 7465 4275 636b 6574 5265 7370 203d  leteBucketResp =
-0001da90: 2073 656c 662e 6465 6c65 7465 4275 636b   self.deleteBuck
-0001daa0: 6574 2862 7563 6b65 744e 616d 6531 290a  et(bucketName1).
-0001dab0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-0001dac0: 656c 6574 6542 7563 6b65 7452 6573 702e  eleteBucketResp.
-0001dad0: 7374 6174 7573 2021 3d20 3230 343a 0a20  status != 204:. 
-0001dae0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001daf0: 6169 7365 2045 7863 6570 7469 6f6e 2827  aise Exception('
-0001db00: 6465 6c65 7465 2062 7563 6b65 7420 6661  delete bucket fa
-0001db10: 696c 6564 2c20 7265 7370 3a20 2573 2720  iled, resp: %s' 
-0001db20: 2520 6465 6c65 7465 4275 636b 6574 5265  % deleteBucketRe
-0001db30: 7370 290a 0a20 2020 2020 2020 2020 2020  sp)..           
-0001db40: 2064 656c 6574 6542 7563 6b65 7452 6573   deleteBucketRes
-0001db50: 7020 3d20 7365 6c66 2e64 656c 6574 6542  p = self.deleteB
-0001db60: 7563 6b65 7428 6275 636b 6574 4e61 6d65  ucket(bucketName
-0001db70: 3229 0a20 2020 2020 2020 2020 2020 2069  2).            i
-0001db80: 6620 6465 6c65 7465 4275 636b 6574 5265  f deleteBucketRe
-0001db90: 7370 2e73 7461 7475 7320 213d 2032 3034  sp.status != 204
-0001dba0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001dbb0: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
-0001dbc0: 6e28 2764 656c 6574 6520 6275 636b 6574  n('delete bucket
-0001dbd0: 2066 6169 6c65 642c 2072 6573 703a 2025   failed, resp: %
-0001dbe0: 7327 2025 2064 656c 6574 6542 7563 6b65  s' % deleteBucke
-0001dbf0: 7452 6573 7029 0a0a 2020 2020 2320 656e  tResp)..    # en
-0001dc00: 6420 7669 7274 7561 6c20 6275 636b 6574  d virtual bucket
-0001dc10: 2072 656c 6174 6564 0a20 2020 2023 2065   related.    # e
-0001dc20: 6e64 2076 6972 7475 616c 2062 7563 6b65  nd virtual bucke
-0001dc30: 7420 7265 6c61 7465 640a 2020 2020 2320  t related.    # 
-0001dc40: 656e 6420 7669 7274 7561 6c20 6275 636b  end virtual buck
-0001dc50: 6574 2072 656c 6174 6564 0a0a 2020 2020  et related..    
-0001dc60: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
-0001dc70: 6566 2075 706c 6f61 6446 696c 6528 7365  ef uploadFile(se
-0001dc80: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
-0001dc90: 6f62 6a65 6374 4b65 792c 2075 706c 6f61  objectKey, uploa
-0001dca0: 6446 696c 652c 2070 6172 7453 697a 653d  dFile, partSize=
-0001dcb0: 3920 2a20 3130 3234 202a 2031 3032 342c  9 * 1024 * 1024,
-0001dcc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001dcd0: 2020 2020 7461 736b 4e75 6d3d 312c 2065      taskNum=1, e
-0001dce0: 6e61 626c 6543 6865 636b 706f 696e 743d  nableCheckpoint=
-0001dcf0: 4661 6c73 652c 2063 6865 636b 706f 696e  False, checkpoin
-0001dd00: 7446 696c 653d 4e6f 6e65 2c0a 2020 2020  tFile=None,.    
-0001dd10: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001dd20: 6865 636b 5375 6d3d 4661 6c73 652c 206d  heckSum=False, m
-0001dd30: 6574 6164 6174 613d 4e6f 6e65 2c20 7072  etadata=None, pr
-0001dd40: 6f67 7265 7373 4361 6c6c 6261 636b 3d4e  ogressCallback=N
-0001dd50: 6f6e 652c 2068 6561 6465 7273 3d4e 6f6e  one, headers=Non
-0001dd60: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0001dd70: 2020 2020 2020 6578 7465 6e73 696f 6e48        extensionH
-0001dd80: 6561 6465 7273 3d4e 6f6e 652c 2065 6e63  eaders=None, enc
-0001dd90: 6f64 696e 675f 7479 7065 3d4e 6f6e 6529  oding_type=None)
-0001dda0: 3a0a 2020 2020 2020 2020 7365 6c66 2e6c  :.        self.l
-0001ddb0: 6f67 5f63 6c69 656e 742e 6c6f 6728 494e  og_client.log(IN
-0001ddc0: 464f 2c20 2765 6e74 6572 2072 6573 756d  FO, 'enter resum
-0001ddd0: 6520 7570 6c6f 6164 2066 696c 652e 2e2e  e upload file...
-0001dde0: 2729 0a20 2020 2020 2020 2073 656c 662e  ').        self.
-0001ddf0: 5f61 7373 6572 745f 6e6f 745f 6e75 6c6c  _assert_not_null
-0001de00: 2862 7563 6b65 744e 616d 652c 2027 6275  (bucketName, 'bu
-0001de10: 636b 6574 4e61 6d65 2069 7320 656d 7074  cketName is empt
-0001de20: 7927 290a 2020 2020 2020 2020 7365 6c66  y').        self
-0001de30: 2e5f 6173 7365 7274 5f6e 6f74 5f6e 756c  ._assert_not_nul
-0001de40: 6c28 6f62 6a65 6374 4b65 792c 2027 6f62  l(objectKey, 'ob
-0001de50: 6a65 6374 4b65 7920 6973 2065 6d70 7479  jectKey is empty
-0001de60: 2729 0a20 2020 2020 2020 2073 656c 662e  ').        self.
-0001de70: 5f61 7373 6572 745f 6e6f 745f 6e75 6c6c  _assert_not_null
-0001de80: 2875 706c 6f61 6446 696c 652c 2027 7570  (uploadFile, 'up
-0001de90: 6c6f 6164 4669 6c65 2069 7320 656d 7074  loadFile is empt
-0001dea0: 7927 290a 0a20 2020 2020 2020 2072 6574  y')..        ret
-0001deb0: 7572 6e20 5f72 6573 756d 655f 7570 6c6f  urn _resume_uplo
-0001dec0: 6164 2862 7563 6b65 744e 616d 652c 206f  ad(bucketName, o
-0001ded0: 626a 6563 744b 6579 2c20 7570 6c6f 6164  bjectKey, upload
-0001dee0: 4669 6c65 2c20 7061 7274 5369 7a65 2c20  File, partSize, 
-0001def0: 7461 736b 4e75 6d2c 2065 6e61 626c 6543  taskNum, enableC
-0001df00: 6865 636b 706f 696e 742c 2063 6865 636b  heckpoint, check
-0001df10: 706f 696e 7446 696c 652c 0a20 2020 2020  pointFile,.     
-0001df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df30: 2020 2020 2020 2020 2063 6865 636b 5375           checkSu
-0001df40: 6d2c 206d 6574 6164 6174 612c 2070 726f  m, metadata, pro
-0001df50: 6772 6573 7343 616c 6c62 6163 6b2c 2073  gressCallback, s
-0001df60: 656c 662c 2068 6561 6465 7273 2c0a 2020  elf, headers,.  
-0001df70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df80: 2020 2020 2020 2020 2020 2020 6578 7465              exte
-0001df90: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
-0001dfa0: 656e 7369 6f6e 4865 6164 6572 732c 2065  ensionHeaders, e
-0001dfb0: 6e63 6f64 696e 675f 7479 7065 3d65 6e63  ncoding_type=enc
-0001dfc0: 6f64 696e 675f 7479 7065 290a 0a20 2020  oding_type)..   
-0001dfd0: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
-0001dfe0: 6465 6620 5f64 6f77 6e6c 6f61 6446 696c  def _downloadFil
-0001dff0: 6557 6974 684e 6f74 6966 6965 7228 7365  eWithNotifier(se
-0001e000: 6c66 2c20 6275 636b 6574 4e61 6d65 2c20  lf, bucketName, 
-0001e010: 6f62 6a65 6374 4b65 792c 2064 6f77 6e6c  objectKey, downl
-0001e020: 6f61 6446 696c 653d 4e6f 6e65 2c20 7061  oadFile=None, pa
-0001e030: 7274 5369 7a65 3d35 202a 2031 3032 3420  rtSize=5 * 1024 
-0001e040: 2a20 3130 3234 2c20 7461 736b 4e75 6d3d  * 1024, taskNum=
-0001e050: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
-0001e060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e070: 2020 2020 2065 6e61 626c 6543 6865 636b       enableCheck
-0001e080: 706f 696e 743d 4661 6c73 652c 0a20 2020  point=False,.   
-0001e090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e0a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001e0b0: 6865 636b 706f 696e 7446 696c 653d 4e6f  heckpointFile=No
-0001e0c0: 6e65 2c20 6865 6164 6572 3d4e 6f6e 652c  ne, header=None,
-0001e0d0: 2076 6572 7369 6f6e 4964 3d4e 6f6e 652c   versionId=None,
-0001e0e0: 2070 726f 6772 6573 7343 616c 6c62 6163   progressCallbac
-0001e0f0: 6b3d 4e6f 6e65 2c0a 2020 2020 2020 2020  k=None,.        
-0001e100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e110: 2020 2020 2020 2020 2020 696d 6167 6550            imageP
-0001e120: 726f 6365 7373 3d4e 6f6e 652c 206e 6f74  rocess=None, not
-0001e130: 6966 6965 723d 7072 6f67 7265 7373 2e4e  ifier=progress.N
-0001e140: 4f4e 455f 4e4f 5449 4649 4552 2c20 6578  ONE_NOTIFIER, ex
-0001e150: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
-0001e160: 6f6e 6529 3a0a 2020 2020 2020 2020 7365  one):.        se
-0001e170: 6c66 2e6c 6f67 5f63 6c69 656e 742e 6c6f  lf.log_client.lo
-0001e180: 6728 494e 464f 2c20 2765 6e74 6572 2072  g(INFO, 'enter r
-0001e190: 6573 756d 6520 646f 776e 6c6f 6164 2e2e  esume download..
-0001e1a0: 2e27 290a 2020 2020 2020 2020 7365 6c66  .').        self
-0001e1b0: 2e5f 6173 7365 7274 5f6e 6f74 5f6e 756c  ._assert_not_nul
-0001e1c0: 6c28 6275 636b 6574 4e61 6d65 2c20 2762  l(bucketName, 'b
-0001e1d0: 7563 6b65 744e 616d 6520 6973 2065 6d70  ucketName is emp
-0001e1e0: 7479 2729 0a20 2020 2020 2020 2073 656c  ty').        sel
-0001e1f0: 662e 5f61 7373 6572 745f 6e6f 745f 6e75  f._assert_not_nu
-0001e200: 6c6c 286f 626a 6563 744b 6579 2c20 276f  ll(objectKey, 'o
-0001e210: 626a 6563 744b 6579 2069 7320 656d 7074  bjectKey is empt
-0001e220: 7927 290a 2020 2020 2020 2020 6966 2068  y').        if h
-0001e230: 6561 6465 7220 6973 204e 6f6e 653a 0a20  eader is None:. 
-0001e240: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-0001e250: 7220 3d20 4765 744f 626a 6563 7448 6561  r = GetObjectHea
-0001e260: 6465 7228 290a 2020 2020 2020 2020 6966  der().        if
-0001e270: 2064 6f77 6e6c 6f61 6446 696c 6520 6973   downloadFile is
-0001e280: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0001e290: 2020 2064 6f77 6e6c 6f61 6446 696c 6520     downloadFile 
-0001e2a0: 3d20 6f62 6a65 6374 4b65 790a 0a20 2020  = objectKey..   
-0001e2b0: 2020 2020 2072 6574 7572 6e20 5f72 6573       return _res
-0001e2c0: 756d 655f 646f 776e 6c6f 6164 2862 7563  ume_download(buc
-0001e2d0: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
-0001e2e0: 6579 2c20 646f 776e 6c6f 6164 4669 6c65  ey, downloadFile
-0001e2f0: 2c20 7061 7274 5369 7a65 2c20 7461 736b  , partSize, task
-0001e300: 4e75 6d2c 2065 6e61 626c 6543 6865 636b  Num, enableCheck
-0001e310: 706f 696e 742c 0a20 2020 2020 2020 2020  point,.         
-0001e320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e330: 2020 2020 2020 2063 6865 636b 706f 696e         checkpoin
-0001e340: 7446 696c 652c 2068 6561 6465 722c 2076  tFile, header, v
-0001e350: 6572 7369 6f6e 4964 2c20 7072 6f67 7265  ersionId, progre
-0001e360: 7373 4361 6c6c 6261 636b 2c20 7365 6c66  ssCallback, self
-0001e370: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001e380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e390: 2020 696d 6167 6550 726f 6365 7373 2c20    imageProcess, 
-0001e3a0: 6e6f 7469 6669 6572 2c20 6578 7465 6e73  notifier, extens
-0001e3b0: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-0001e3c0: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
-0001e3d0: 2020 6465 6620 646f 776e 6c6f 6164 4669    def downloadFi
-0001e3e0: 6c65 2873 656c 662c 2062 7563 6b65 744e  le(self, bucketN
-0001e3f0: 616d 652c 206f 626a 6563 744b 6579 2c20  ame, objectKey, 
-0001e400: 646f 776e 6c6f 6164 4669 6c65 3d4e 6f6e  downloadFile=Non
-0001e410: 652c 2070 6172 7453 697a 653d 3520 2a20  e, partSize=5 * 
-0001e420: 3130 3234 202a 2031 3032 342c 2074 6173  1024 * 1024, tas
-0001e430: 6b4e 756d 3d31 2c0a 2020 2020 2020 2020  kNum=1,.        
-0001e440: 2020 2020 2020 2020 2020 2020 2065 6e61               ena
-0001e450: 626c 6543 6865 636b 706f 696e 743d 4661  bleCheckpoint=Fa
-0001e460: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-0001e470: 2020 2020 2020 2020 2020 6368 6563 6b70            checkp
-0001e480: 6f69 6e74 4669 6c65 3d4e 6f6e 652c 2068  ointFile=None, h
-0001e490: 6561 6465 723d 4e6f 6e65 2c20 7665 7273  eader=None, vers
-0001e4a0: 696f 6e49 643d 4e6f 6e65 2c20 7072 6f67  ionId=None, prog
-0001e4b0: 7265 7373 4361 6c6c 6261 636b 3d4e 6f6e  ressCallback=Non
-0001e4c0: 652c 2069 6d61 6765 5072 6f63 6573 733d  e, imageProcess=
-0001e4d0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-0001e4e0: 2020 2020 2020 2020 2020 2065 7874 656e             exten
-0001e4f0: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
-0001e500: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0001e510: 6e20 7365 6c66 2e5f 646f 776e 6c6f 6164  n self._download
-0001e520: 4669 6c65 5769 7468 4e6f 7469 6669 6572  FileWithNotifier
-0001e530: 2862 7563 6b65 744e 616d 652c 206f 626a  (bucketName, obj
-0001e540: 6563 744b 6579 2c20 646f 776e 6c6f 6164  ectKey, download
-0001e550: 4669 6c65 2c20 7061 7274 5369 7a65 2c20  File, partSize, 
-0001e560: 7461 736b 4e75 6d2c 2065 6e61 626c 6543  taskNum, enableC
-0001e570: 6865 636b 706f 696e 742c 0a20 2020 2020  heckpoint,.     
+0001a580: 733d 6578 7465 6e73 696f 6e48 6561 6465  s=extensionHeade
+0001a590: 7273 2c0a 2020 2020 2020 2020 2020 2020  rs,.            
+0001a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a5b0: 2020 2020 2020 2020 2020 2a2a 7365 6c66            **self
+0001a5c0: 2e63 6f6e 7665 7274 6f72 2e74 7261 6e73  .convertor.trans
+0001a5d0: 5f73 6574 5f62 7563 6b65 745f 7374 6f72  _set_bucket_stor
+0001a5e0: 6167 655f 706f 6c69 6379 2873 746f 7261  age_policy(stora
+0001a5f0: 6765 436c 6173 733d 7374 6f72 6167 6543  geClass=storageC
+0001a600: 6c61 7373 2929 0a0a 2020 2020 4066 756e  lass))..    @fun
+0001a610: 6343 6163 6865 0a20 2020 2064 6566 2073  cCache.    def s
+0001a620: 6574 4275 636b 6574 456e 6372 7970 7469  etBucketEncrypti
+0001a630: 6f6e 2873 656c 662c 2062 7563 6b65 744e  on(self, bucketN
+0001a640: 616d 652c 2065 6e63 7279 7074 696f 6e2c  ame, encryption,
+0001a650: 206b 6579 3d4e 6f6e 652c 2065 7874 656e   key=None, exten
+0001a660: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
+0001a670: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+0001a680: 5f61 7373 6572 745f 6e6f 745f 6e75 6c6c  _assert_not_null
+0001a690: 2865 6e63 7279 7074 696f 6e2c 2027 656e  (encryption, 'en
+0001a6a0: 6372 7970 7469 6f6e 2069 7320 656d 7074  cryption is empt
+0001a6b0: 7927 290a 2020 2020 2020 2020 7265 7475  y').        retu
+0001a6c0: 726e 2073 656c 662e 5f6d 616b 655f 7075  rn self._make_pu
+0001a6d0: 745f 7265 7175 6573 7428 6275 636b 6574  t_request(bucket
+0001a6e0: 4e61 6d65 2c20 7061 7468 4172 6773 3d7b  Name, pathArgs={
+0001a6f0: 2765 6e63 7279 7074 696f 6e27 3a20 4e6f  'encryption': No
+0001a700: 6e65 7d2c 0a20 2020 2020 2020 2020 2020  ne},.           
+0001a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a720: 2020 2020 2020 2020 2020 2065 6e74 6974             entit
+0001a730: 793d 7365 6c66 2e63 6f6e 7665 7274 6f72  y=self.convertor
+0001a740: 2e74 7261 6e73 5f65 6e63 7279 7074 696f  .trans_encryptio
+0001a750: 6e28 656e 6372 7970 7469 6f6e 3d65 6e63  n(encryption=enc
+0001a760: 7279 7074 696f 6e2c 206b 6579 3d6b 6579  ryption, key=key
+0001a770: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0001a780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a790: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
+0001a7a0: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
+0001a7b0: 696f 6e48 6561 6465 7273 290a 0a20 2020  ionHeaders)..   
+0001a7c0: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
+0001a7d0: 6465 6620 6765 7442 7563 6b65 7445 6e63  def getBucketEnc
+0001a7e0: 7279 7074 696f 6e28 7365 6c66 2c20 6275  ryption(self, bu
+0001a7f0: 636b 6574 4e61 6d65 2c20 6578 7465 6e73  cketName, extens
+0001a800: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
+0001a810: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0001a820: 2073 656c 662e 5f6d 616b 655f 6765 745f   self._make_get_
+0001a830: 7265 7175 6573 7428 6275 636b 6574 4e61  request(bucketNa
+0001a840: 6d65 2c20 6d65 7468 6f64 4e61 6d65 3d27  me, methodName='
+0001a850: 6765 7442 7563 6b65 7445 6e63 7279 7074  getBucketEncrypt
+0001a860: 696f 6e27 2c20 7061 7468 4172 6773 3d7b  ion', pathArgs={
+0001a870: 2765 6e63 7279 7074 696f 6e27 3a20 4e6f  'encryption': No
+0001a880: 6e65 7d2c 0a20 2020 2020 2020 2020 2020  ne},.           
+0001a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a8a0: 2020 2020 2020 2020 2020 2065 7874 656e             exten
+0001a8b0: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
+0001a8c0: 6e73 696f 6e48 6561 6465 7273 290a 0a20  nsionHeaders).. 
+0001a8d0: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
+0001a8e0: 2020 6465 6620 6465 6c65 7465 4275 636b    def deleteBuck
+0001a8f0: 6574 456e 6372 7970 7469 6f6e 2873 656c  etEncryption(sel
+0001a900: 662c 2062 7563 6b65 744e 616d 652c 2065  f, bucketName, e
+0001a910: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+0001a920: 4e6f 6e65 293a 0a20 2020 2020 2020 2072  None):.        r
+0001a930: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
+0001a940: 5f64 656c 6574 655f 7265 7175 6573 7428  _delete_request(
+0001a950: 6275 636b 6574 4e61 6d65 2c20 7061 7468  bucketName, path
+0001a960: 4172 6773 3d7b 2765 6e63 7279 7074 696f  Args={'encryptio
+0001a970: 6e27 3a20 4e6f 6e65 7d2c 2065 7874 656e  n': None}, exten
+0001a980: 7369 6f6e 4865 6164 6572 733d 6578 7465  sionHeaders=exte
+0001a990: 6e73 696f 6e48 6561 6465 7273 290a 0a20  nsionHeaders).. 
+0001a9a0: 2020 2040 6675 6e63 4361 6368 650a 2020     @funcCache.  
+0001a9b0: 2020 6465 6620 7365 7442 7563 6b65 7452    def setBucketR
+0001a9c0: 6570 6c69 6361 7469 6f6e 2873 656c 662c  eplication(self,
+0001a9d0: 2062 7563 6b65 744e 616d 652c 2072 6570   bucketName, rep
+0001a9e0: 6c69 6361 7469 6f6e 2c20 6578 7465 6e73  lication, extens
+0001a9f0: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
+0001aa00: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
+0001aa10: 6173 7365 7274 5f6e 6f74 5f6e 756c 6c28  assert_not_null(
+0001aa20: 7265 706c 6963 6174 696f 6e2c 2027 7265  replication, 're
+0001aa30: 706c 6963 6174 696f 6e20 6973 2065 6d70  plication is emp
+0001aa40: 7479 2729 0a20 2020 2020 2020 2072 6574  ty').        ret
+0001aa50: 7572 6e20 7365 6c66 2e5f 6d61 6b65 5f70  urn self._make_p
+0001aa60: 7574 5f72 6571 7565 7374 2862 7563 6b65  ut_request(bucke
+0001aa70: 744e 616d 652c 2065 7874 656e 7369 6f6e  tName, extension
+0001aa80: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
+0001aa90: 6e48 6561 6465 7273 2c0a 2020 2020 2020  nHeaders,.      
+0001aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aac0: 2a2a 7365 6c66 2e63 6f6e 7665 7274 6f72  **self.convertor
+0001aad0: 2e74 7261 6e73 5f73 6574 5f62 7563 6b65  .trans_set_bucke
+0001aae0: 745f 7265 706c 6963 6174 696f 6e28 7265  t_replication(re
+0001aaf0: 706c 6963 6174 696f 6e3d 7265 706c 6963  plication=replic
+0001ab00: 6174 696f 6e29 290a 0a20 2020 2040 6675  ation))..    @fu
+0001ab10: 6e63 4361 6368 650a 2020 2020 6465 6620  ncCache.    def 
+0001ab20: 6765 7442 7563 6b65 7452 6570 6c69 6361  getBucketReplica
+0001ab30: 7469 6f6e 2873 656c 662c 2062 7563 6b65  tion(self, bucke
+0001ab40: 744e 616d 652c 2065 7874 656e 7369 6f6e  tName, extension
+0001ab50: 4865 6164 6572 733d 4e6f 6e65 293a 0a20  Headers=None):. 
+0001ab60: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001ab70: 6c66 2e5f 6d61 6b65 5f67 6574 5f72 6571  lf._make_get_req
+0001ab80: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
+0001ab90: 2070 6174 6841 7267 733d 7b27 7265 706c   pathArgs={'repl
+0001aba0: 6963 6174 696f 6e27 3a20 4e6f 6e65 7d2c  ication': None},
+0001abb0: 206d 6574 686f 644e 616d 653d 2767 6574   methodName='get
+0001abc0: 4275 636b 6574 5265 706c 6963 6174 696f  BucketReplicatio
+0001abd0: 6e27 2c0a 2020 2020 2020 2020 2020 2020  n',.            
+0001abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abf0: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
+0001ac00: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
+0001ac10: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
+0001ac20: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
+0001ac30: 2064 6566 2064 656c 6574 6542 7563 6b65   def deleteBucke
+0001ac40: 7452 6570 6c69 6361 7469 6f6e 2873 656c  tReplication(sel
+0001ac50: 662c 2062 7563 6b65 744e 616d 652c 2065  f, bucketName, e
+0001ac60: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+0001ac70: 4e6f 6e65 293a 0a20 2020 2020 2020 2072  None):.        r
+0001ac80: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
+0001ac90: 5f64 656c 6574 655f 7265 7175 6573 7428  _delete_request(
+0001aca0: 6275 636b 6574 4e61 6d65 2c20 7061 7468  bucketName, path
+0001acb0: 4172 6773 3d7b 2772 6570 6c69 6361 7469  Args={'replicati
+0001acc0: 6f6e 273a 204e 6f6e 657d 2c20 6578 7465  on': None}, exte
+0001acd0: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
+0001ace0: 656e 7369 6f6e 4865 6164 6572 7329 0a0a  ensionHeaders)..
+0001acf0: 2020 2020 4066 756e 6343 6163 6865 0a20      @funcCache. 
+0001ad00: 2020 2064 6566 2073 6574 4275 636b 6574     def setBucket
+0001ad10: 5265 7175 6573 7450 6179 6d65 6e74 2873  RequestPayment(s
+0001ad20: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+0001ad30: 2070 6179 6572 2c20 6578 7465 6e73 696f   payer, extensio
+0001ad40: 6e48 6561 6465 7273 3d4e 6f6e 6529 3a0a  nHeaders=None):.
+0001ad50: 2020 2020 2020 2020 7365 6c66 2e5f 6173          self._as
+0001ad60: 7365 7274 5f6e 6f74 5f6e 756c 6c28 7061  sert_not_null(pa
+0001ad70: 7965 722c 2027 7061 7965 7220 6973 2065  yer, 'payer is e
+0001ad80: 6d70 7479 2729 0a20 2020 2020 2020 2072  mpty').        r
+0001ad90: 6574 7572 6e20 7365 6c66 2e5f 6d61 6b65  eturn self._make
+0001ada0: 5f70 7574 5f72 6571 7565 7374 2862 7563  _put_request(buc
+0001adb0: 6b65 744e 616d 652c 2070 6174 6841 7267  ketName, pathArg
+0001adc0: 733d 7b27 7265 7175 6573 7450 6179 6d65  s={'requestPayme
+0001add0: 6e74 273a 204e 6f6e 657d 2c0a 2020 2020  nt': None},.    
+0001ade0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001adf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae00: 2020 656e 7469 7479 3d73 656c 662e 636f    entity=self.co
+0001ae10: 6e76 6572 746f 722e 7472 616e 735f 6275  nvertor.trans_bu
+0001ae20: 636b 6574 5f72 6571 7565 7374 5f70 6179  cket_request_pay
+0001ae30: 6d65 6e74 2870 6179 6572 3d70 6179 6572  ment(payer=payer
+0001ae40: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0001ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae60: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
+0001ae70: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
+0001ae80: 696f 6e48 6561 6465 7273 290a 0a20 2020  ionHeaders)..   
+0001ae90: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
+0001aea0: 6465 6620 6765 7442 7563 6b65 7452 6571  def getBucketReq
+0001aeb0: 7565 7374 5061 796d 656e 7428 7365 6c66  uestPayment(self
+0001aec0: 2c20 6275 636b 6574 4e61 6d65 2c20 6578  , bucketName, ex
+0001aed0: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
+0001aee0: 6f6e 6529 3a0a 2020 2020 2020 2020 7265  one):.        re
+0001aef0: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
+0001af00: 6765 745f 7265 7175 6573 7428 6275 636b  get_request(buck
+0001af10: 6574 4e61 6d65 2c20 7061 7468 4172 6773  etName, pathArgs
+0001af20: 3d7b 2772 6571 7565 7374 5061 796d 656e  ={'requestPaymen
+0001af30: 7427 3a20 4e6f 6e65 7d2c 0a20 2020 2020  t': None},.     
+0001af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af60: 206d 6574 686f 644e 616d 653d 2767 6574   methodName='get
+0001af70: 4275 636b 6574 5265 7175 6573 7450 6179  BucketRequestPay
+0001af80: 6d65 6e74 272c 2065 7874 656e 7369 6f6e  ment', extension
+0001af90: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
+0001afa0: 6e48 6561 6465 7273 290a 0a20 2020 2023  nHeaders)..    #
+0001afb0: 2062 6567 696e 2076 6972 7475 616c 2062   begin virtual b
+0001afc0: 7563 6b65 7420 7265 6c61 7465 640a 2020  ucket related.  
+0001afd0: 2020 2320 6265 6769 6e20 7669 7274 7561    # begin virtua
+0001afe0: 6c20 6275 636b 6574 2072 656c 6174 6564  l bucket related
+0001aff0: 0a20 2020 2023 2062 6567 696e 2076 6972  .    # begin vir
+0001b000: 7475 616c 2062 7563 6b65 7420 7265 6c61  tual bucket rela
+0001b010: 7465 640a 0a20 2020 2040 6675 6e63 4361  ted..    @funcCa
+0001b020: 6368 650a 2020 2020 6465 6620 6c69 7374  che.    def list
+0001b030: 4176 6169 6c61 626c 655a 6f6e 6549 6e66  AvailableZoneInf
+0001b040: 6f28 7365 6c66 2c20 7265 6769 6f6e 4964  o(self, regionId
+0001b050: 2c20 746f 6b65 6e2c 2065 7874 656e 7369  , token, extensi
+0001b060: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
+0001b070: 0a20 2020 2020 2020 2073 656c 662e 5f61  .        self._a
+0001b080: 7373 6572 745f 6e6f 745f 6e75 6c6c 2872  ssert_not_null(r
+0001b090: 6567 696f 6e49 642c 2027 7265 6769 6f6e  egionId, 'region
+0001b0a0: 4964 2073 686f 756c 6420 6e6f 7420 6265  Id should not be
+0001b0b0: 2065 6d70 7479 2729 0a20 2020 2020 2020   empty').       
+0001b0c0: 2073 656c 662e 5f61 7373 6572 745f 6e6f   self._assert_no
+0001b0d0: 745f 6e75 6c6c 2874 6f6b 656e 2c20 2774  t_null(token, 't
+0001b0e0: 6f6b 656e 2073 686f 756c 6420 6e6f 7420  oken should not 
+0001b0f0: 6265 2065 6d70 7479 2729 0a0a 2020 2020  be empty')..    
+0001b100: 2020 2020 7061 7468 4172 6773 203d 207b      pathArgs = {
+0001b110: 2772 6567 696f 6e49 6427 3a20 7265 6769  'regionId': regi
+0001b120: 6f6e 4964 7d0a 2020 2020 2020 2020 6865  onId}.        he
+0001b130: 6164 6572 203d 207b 0a20 2020 2020 2020  ader = {.       
+0001b140: 2020 2020 2063 6f6e 7374 2e58 5f41 5554       const.X_AUT
+0001b150: 485f 544f 4b45 4e5f 4845 4144 4552 3a20  H_TOKEN_HEADER: 
+0001b160: 746f 6b65 6e2c 0a20 2020 2020 2020 2020  token,.         
+0001b170: 2020 2063 6f6e 7374 2e43 4f4e 5445 4e54     const.CONTENT
+0001b180: 5f54 5950 455f 4845 4144 4552 3a20 636f  _TYPE_HEADER: co
+0001b190: 6e73 742e 4d49 4d45 5f54 5950 4553 2e67  nst.MIME_TYPES.g
+0001b1a0: 6574 2827 6a73 6f6e 2729 0a20 2020 2020  et('json').     
+0001b1b0: 2020 207d 0a0a 2020 2020 2020 2020 7265     }..        re
+0001b1c0: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
+0001b1d0: 6765 745f 7265 7175 6573 7428 0a20 2020  get_request(.   
+0001b1e0: 2020 2020 2020 2020 206f 626a 6563 744b           objectK
+0001b1f0: 6579 3d27 7631 2f73 6572 7669 6365 732f  ey='v1/services/
+0001b200: 636c 7573 7465 7273 272c 0a20 2020 2020  clusters',.     
+0001b210: 2020 2020 2020 2070 6174 6841 7267 733d         pathArgs=
+0001b220: 7061 7468 4172 6773 2c0a 2020 2020 2020  pathArgs,.      
+0001b230: 2020 2020 2020 6865 6164 6572 733d 6865        headers=he
+0001b240: 6164 6572 2c0a 2020 2020 2020 2020 2020  ader,.          
+0001b250: 2020 6d65 7468 6f64 4e61 6d65 3d73 656c    methodName=sel
+0001b260: 662e 6a73 6f6e 5f72 6573 706f 6e73 655f  f.json_response_
+0001b270: 6d65 7468 6f64 5f6e 616d 652c 0a20 2020  method_name,.   
+0001b280: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
+0001b290: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
+0001b2a0: 696f 6e48 6561 6465 7273 0a20 2020 2020  ionHeaders.     
+0001b2b0: 2020 2029 0a0a 2020 2020 4066 756e 6343     )..    @funcC
+0001b2c0: 6163 6865 0a20 2020 2064 6566 2063 7265  ache.    def cre
+0001b2d0: 6174 6542 7563 6b65 7441 6c69 6173 2873  ateBucketAlias(s
+0001b2e0: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+0001b2f0: 2061 6c69 6173 496e 666f 3d4e 6f6e 652c   aliasInfo=None,
+0001b300: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+0001b310: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
+0001b320: 2069 6620 616c 6961 7349 6e66 6f20 6973   if aliasInfo is
+0001b330: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0001b340: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+0001b350: 6f6e 2827 616c 6961 7349 6e66 6f20 6973  on('aliasInfo is
+0001b360: 204e 6f6e 6527 290a 2020 2020 2020 2020   None').        
+0001b370: 7365 6c66 2e5f 6173 7365 7274 5f6e 6f74  self._assert_not
+0001b380: 5f6e 756c 6c28 616c 6961 7349 6e66 6f2e  _null(aliasInfo.
+0001b390: 6765 7428 2762 7563 6b65 7431 2729 2c20  get('bucket1'), 
+0001b3a0: 2762 7563 6b65 7431 2073 686f 756c 6420  'bucket1 should 
+0001b3b0: 6e6f 7420 6265 2065 6d70 7479 2729 0a20  not be empty'). 
+0001b3c0: 2020 2020 2020 2073 656c 662e 5f61 7373         self._ass
+0001b3d0: 6572 745f 6e6f 745f 6e75 6c6c 2861 6c69  ert_not_null(ali
+0001b3e0: 6173 496e 666f 2e67 6574 2827 6275 636b  asInfo.get('buck
+0001b3f0: 6574 3227 292c 2027 6275 636b 6574 3220  et2'), 'bucket2 
+0001b400: 7368 6f75 6c64 206e 6f74 2062 6520 656d  should not be em
+0001b410: 7074 7927 290a 2020 2020 2020 2020 7265  pty').        re
+0001b420: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
+0001b430: 7075 745f 7265 7175 6573 7428 6275 636b  put_request(buck
+0001b440: 6574 4e61 6d65 2c20 6578 7465 6e73 696f  etName, extensio
+0001b450: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
+0001b460: 6f6e 4865 6164 6572 732c 0a20 2020 2020  onHeaders,.     
+0001b470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b490: 202a 2a73 656c 662e 636f 6e76 6572 746f   **self.converto
+0001b4a0: 722e 7472 616e 735f 7365 745f 6275 636b  r.trans_set_buck
+0001b4b0: 6574 5f61 6c69 6173 2861 6c69 6173 496e  et_alias(aliasIn
+0001b4c0: 666f 3d61 6c69 6173 496e 666f 2929 0a0a  fo=aliasInfo))..
+0001b4d0: 2020 2020 4066 756e 6343 6163 6865 0a20      @funcCache. 
+0001b4e0: 2020 2064 6566 2062 696e 6442 7563 6b65     def bindBucke
+0001b4f0: 7441 6c69 6173 2873 656c 662c 2062 7563  tAlias(self, buc
+0001b500: 6b65 744e 616d 652c 2061 6c69 6173 496e  ketName, aliasIn
+0001b510: 666f 3d4e 6f6e 652c 2065 7874 656e 7369  fo=None, extensi
+0001b520: 6f6e 4865 6164 6572 733d 4e6f 6e65 293a  onHeaders=None):
+0001b530: 0a20 2020 2020 2020 2069 6620 616c 6961  .        if alia
+0001b540: 7349 6e66 6f20 6973 204e 6f6e 653a 0a20  sInfo is None:. 
+0001b550: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001b560: 2045 7863 6570 7469 6f6e 2827 616c 6961   Exception('alia
+0001b570: 7349 6e66 6f20 6973 204e 6f6e 6527 290a  sInfo is None').
+0001b580: 2020 2020 2020 2020 7365 6c66 2e5f 6173          self._as
+0001b590: 7365 7274 5f6e 6f74 5f6e 756c 6c28 616c  sert_not_null(al
+0001b5a0: 6961 7349 6e66 6f2e 6765 7428 2761 6c69  iasInfo.get('ali
+0001b5b0: 6173 2729 2c20 2762 7563 6b65 7420 616c  as'), 'bucket al
+0001b5c0: 6961 7320 7368 6f75 6c64 206e 6f74 2062  ias should not b
+0001b5d0: 6520 656d 7074 7927 290a 2020 2020 2020  e empty').      
+0001b5e0: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+0001b5f0: 616b 655f 7075 745f 7265 7175 6573 7428  ake_put_request(
+0001b600: 6275 636b 6574 4e61 6d65 2c20 6578 7465  bucketName, exte
+0001b610: 6e73 696f 6e48 6561 6465 7273 3d65 7874  nsionHeaders=ext
+0001b620: 656e 7369 6f6e 4865 6164 6572 732c 0a20  ensionHeaders,. 
+0001b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b650: 2020 2020 202a 2a73 656c 662e 636f 6e76       **self.conv
+0001b660: 6572 746f 722e 7472 616e 735f 6269 6e64  ertor.trans_bind
+0001b670: 5f62 7563 6b65 745f 616c 6961 7328 616c  _bucket_alias(al
+0001b680: 6961 7349 6e66 6f3d 616c 6961 7349 6e66  iasInfo=aliasInf
+0001b690: 6f29 290a 0a20 2020 2040 6675 6e63 4361  o))..    @funcCa
+0001b6a0: 6368 650a 2020 2020 6465 6620 6465 6c65  che.    def dele
+0001b6b0: 7465 4275 636b 6574 416c 6961 7328 7365  teBucketAlias(se
+0001b6c0: 6c66 2c20 6275 636b 6574 416c 6961 732c  lf, bucketAlias,
+0001b6d0: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+0001b6e0: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
+0001b6f0: 2073 656c 662e 5f61 7373 6572 745f 6e6f   self._assert_no
+0001b700: 745f 6e75 6c6c 2862 7563 6b65 7441 6c69  t_null(bucketAli
+0001b710: 6173 2c20 2762 7563 6b65 7420 616c 6961  as, 'bucket alia
+0001b720: 7320 7368 6f75 6c64 206e 6f74 2062 6520  s should not be 
+0001b730: 656d 7074 7927 290a 2020 2020 2020 2020  empty').        
+0001b740: 7061 7468 4172 6773 203d 207b 636f 6e73  pathArgs = {cons
+0001b750: 742e 4f42 5342 5543 4b45 5441 4c49 4153  t.OBSBUCKETALIAS
+0001b760: 5f50 4152 414d 3a20 4e6f 6e65 7d0a 2020  _PARAM: None}.  
+0001b770: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0001b780: 662e 5f6d 616b 655f 6465 6c65 7465 5f72  f._make_delete_r
+0001b790: 6571 7565 7374 2862 7563 6b65 744e 616d  equest(bucketNam
+0001b7a0: 653d 6275 636b 6574 416c 6961 732c 2070  e=bucketAlias, p
+0001b7b0: 6174 6841 7267 733d 7061 7468 4172 6773  athArgs=pathArgs
+0001b7c0: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+0001b7d0: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
+0001b7e0: 6572 7329 0a0a 2020 2020 4066 756e 6343  ers)..    @funcC
+0001b7f0: 6163 6865 0a20 2020 2064 6566 2075 6e62  ache.    def unb
+0001b800: 696e 6442 7563 6b65 7441 6c69 6173 2873  indBucketAlias(s
+0001b810: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+0001b820: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+0001b830: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
+0001b840: 2070 6174 6841 7267 7320 3d20 7b63 6f6e   pathArgs = {con
+0001b850: 7374 2e4f 4253 414c 4941 535f 5041 5241  st.OBSALIAS_PARA
+0001b860: 4d3a 204e 6f6e 657d 0a20 2020 2020 2020  M: None}.       
+0001b870: 2072 6574 7572 6e20 7365 6c66 2e5f 6d61   return self._ma
+0001b880: 6b65 5f64 656c 6574 655f 7265 7175 6573  ke_delete_reques
+0001b890: 7428 6275 636b 6574 4e61 6d65 2c20 7061  t(bucketName, pa
+0001b8a0: 7468 4172 6773 3d70 6174 6841 7267 732c  thArgs=pathArgs,
+0001b8b0: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
+0001b8c0: 733d 6578 7465 6e73 696f 6e48 6561 6465  s=extensionHeade
+0001b8d0: 7273 290a 0a20 2020 2040 6675 6e63 4361  rs)..    @funcCa
+0001b8e0: 6368 650a 2020 2020 6465 6620 6765 7442  che.    def getB
+0001b8f0: 7563 6b65 7441 6c69 6173 2873 656c 662c  ucketAlias(self,
+0001b900: 2062 7563 6b65 744e 616d 652c 2065 7874   bucketName, ext
+0001b910: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
+0001b920: 6e65 293a 0a20 2020 2020 2020 2070 6174  ne):.        pat
+0001b930: 6841 7267 7320 3d20 7b63 6f6e 7374 2e4f  hArgs = {const.O
+0001b940: 4253 414c 4941 535f 5041 5241 4d3a 204e  BSALIAS_PARAM: N
+0001b950: 6f6e 657d 0a20 2020 2020 2020 2072 6574  one}.        ret
+0001b960: 7572 6e20 7365 6c66 2e5f 6d61 6b65 5f67  urn self._make_g
+0001b970: 6574 5f72 6571 7565 7374 2862 7563 6b65  et_request(bucke
+0001b980: 744e 616d 652c 2070 6174 6841 7267 733d  tName, pathArgs=
+0001b990: 7061 7468 4172 6773 2c20 6d65 7468 6f64  pathArgs, method
+0001b9a0: 4e61 6d65 3d27 6765 7442 7563 6b65 7441  Name='getBucketA
+0001b9b0: 6c69 6173 272c 0a20 2020 2020 2020 2020  lias',.         
+0001b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b9d0: 2020 2020 2020 2020 2020 2020 2065 7874               ext
+0001b9e0: 656e 7369 6f6e 4865 6164 6572 733d 6578  ensionHeaders=ex
+0001b9f0: 7465 6e73 696f 6e48 6561 6465 7273 290a  tensionHeaders).
+0001ba00: 0a20 2020 2040 6675 6e63 4361 6368 650a  .    @funcCache.
+0001ba10: 2020 2020 6465 6620 6c69 7374 4275 636b      def listBuck
+0001ba20: 6574 416c 6961 7328 7365 6c66 2c20 6578  etAlias(self, ex
+0001ba30: 7465 6e73 696f 6e48 6561 6465 7273 3d4e  tensionHeaders=N
+0001ba40: 6f6e 6529 3a0a 2020 2020 2020 2020 7061  one):.        pa
+0001ba50: 7468 4172 6773 203d 207b 636f 6e73 742e  thArgs = {const.
+0001ba60: 4f42 5342 5543 4b45 5441 4c49 4153 5f50  OBSBUCKETALIAS_P
+0001ba70: 4152 414d 3a20 4e6f 6e65 7d0a 2020 2020  ARAM: None}.    
+0001ba80: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001ba90: 5f6d 616b 655f 6765 745f 7265 7175 6573  _make_get_reques
+0001baa0: 7428 7061 7468 4172 6773 3d70 6174 6841  t(pathArgs=pathA
+0001bab0: 7267 732c 206d 6574 686f 644e 616d 653d  rgs, methodName=
+0001bac0: 274c 6973 7442 7563 6b65 7441 6c69 6173  'ListBucketAlias
+0001bad0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+0001bae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001baf0: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
+0001bb00: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
+0001bb10: 696f 6e48 6561 6465 7273 290a 0a20 2020  ionHeaders)..   
+0001bb20: 2040 6675 6e63 4361 6368 650a 2020 2020   @funcCache.    
+0001bb30: 6465 6620 6372 6561 7465 5669 7274 7561  def createVirtua
+0001bb40: 6c42 7563 6b65 7428 7365 6c66 2c20 7265  lBucket(self, re
+0001bb50: 6769 6f6e 4964 2c20 746f 6b65 6e2c 2062  gionId, token, b
+0001bb60: 7563 6b65 744e 616d 6531 2c20 6275 636b  ucketName1, buck
+0001bb70: 6574 4e61 6d65 322c 2062 7563 6b65 7441  etName2, bucketA
+0001bb80: 6c69 6173 2c20 6167 656e 6379 4e61 6d65  lias, agencyName
+0001bb90: 2c20 6865 6164 6572 3d4e 6f6e 6529 3a0a  , header=None):.
+0001bba0: 2020 2020 2020 2020 2320 7374 6570 2031          # step 1
+0001bbb0: 3a20 e588 97e4 b8be e68c 87e5 ae9a 7265  : ............re
+0001bbc0: 6769 6f6e e4b8 8be7 9a84 e99b 86e7 bea4  gion............
+0001bbd0: e4bf a1e6 81af 0a20 2020 2020 2020 2061  .......        a
+0001bbe0: 7a52 6573 7020 3d20 7365 6c66 2e6c 6973  zResp = self.lis
+0001bbf0: 7441 7661 696c 6162 6c65 5a6f 6e65 496e  tAvailableZoneIn
+0001bc00: 666f 2872 6567 696f 6e49 642c 2074 6f6b  fo(regionId, tok
+0001bc10: 656e 290a 2020 2020 2020 2020 6966 2061  en).        if a
+0001bc20: 7a52 6573 702e 7374 6174 7573 2021 3d20  zResp.status != 
+0001bc30: 3230 303a 0a20 2020 2020 2020 2020 2020  200:.           
+0001bc40: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+0001bc50: 2827 6c69 7374 2041 5a20 696e 666f 7320  ('list AZ infos 
+0001bc60: 6661 696c 6564 2c20 7265 7370 3a20 2573  failed, resp: %s
+0001bc70: 2720 2520 617a 5265 7370 290a 0a20 2020  ' % azResp)..   
+0001bc80: 2020 2020 2066 6972 7374 415a 4367 4964       firstAZCgId
+0001bc90: 2c20 7365 636f 6e64 415a 4367 4964 203d  , secondAZCgId =
+0001bca0: 2073 656c 662e 5f67 6574 5f63 6c75 7374   self._get_clust
+0001bcb0: 6572 5f67 726f 7570 5f69 6428 617a 5265  er_group_id(azRe
+0001bcc0: 7370 290a 0a20 2020 2020 2020 2023 2073  sp)..        # s
+0001bcd0: 7465 7020 323a 20e6 8c87 e5ae 9ae9 9b86  tep 2: .........
+0001bce0: e7be a469 64e5 889b e6a1 b60a 2020 2020  ...id.......    
+0001bcf0: 2020 2020 7365 6c66 2e5f 6372 6561 7465      self._create
+0001bd00: 5f62 7563 6b65 745f 7769 7468 5f63 6c75  _bucket_with_clu
+0001bd10: 7374 6572 5f69 6428 6669 7273 7441 5a43  ster_id(firstAZC
+0001bd20: 6749 642c 2073 6563 6f6e 6441 5a43 6749  gId, secondAZCgI
+0001bd30: 642c 2062 7563 6b65 744e 616d 6531 2c20  d, bucketName1, 
+0001bd40: 6275 636b 6574 4e61 6d65 322c 2062 7563  bucketName2, buc
+0001bd50: 6b65 7441 6c69 6173 2c20 6865 6164 6572  ketAlias, header
+0001bd60: 290a 0a20 2020 2020 2020 2023 2073 7465  )..        # ste
+0001bd70: 7020 333a 20e5 889b e5bb bae4 b880 e6ac  p 3: ...........
+0001bd80: a1e5 88ab e590 8d0a 2020 2020 2020 2020  ........        
+0001bd90: 616c 6961 7349 6e66 6f20 3d20 4275 636b  aliasInfo = Buck
+0001bda0: 6574 416c 6961 734d 6f64 656c 2829 0a20  etAliasModel(). 
+0001bdb0: 2020 2020 2020 2061 6c69 6173 496e 666f         aliasInfo
+0001bdc0: 2e62 7563 6b65 7431 203d 2062 7563 6b65  .bucket1 = bucke
+0001bdd0: 744e 616d 6531 0a20 2020 2020 2020 2061  tName1.        a
+0001bde0: 6c69 6173 496e 666f 2e62 7563 6b65 7432  liasInfo.bucket2
+0001bdf0: 203d 2062 7563 6b65 744e 616d 6532 0a20   = bucketName2. 
+0001be00: 2020 2020 2020 2063 6261 5265 7370 203d         cbaResp =
+0001be10: 2073 656c 662e 6372 6561 7465 4275 636b   self.createBuck
+0001be20: 6574 416c 6961 7328 6275 636b 6574 416c  etAlias(bucketAl
+0001be30: 6961 732c 2061 6c69 6173 496e 666f 290a  ias, aliasInfo).
+0001be40: 2020 2020 2020 2020 6966 2063 6261 5265          if cbaRe
+0001be50: 7370 2e73 7461 7475 7320 213d 2032 3030  sp.status != 200
+0001be60: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0001be70: 6c66 2e5f 636c 6561 725f 7669 7274 7561  lf._clear_virtua
+0001be80: 6c5f 6275 636b 6574 2863 6f6e 7374 2e56  l_bucket(const.V
+0001be90: 4952 5455 414c 5f42 5543 4b45 545f 4352  IRTUAL_BUCKET_CR
+0001bea0: 4541 5445 4255 434b 4554 5f53 5441 4745  EATEBUCKET_STAGE
+0001beb0: 442c 2062 7563 6b65 744e 616d 6531 2c20  D, bucketName1, 
+0001bec0: 6275 636b 6574 4e61 6d65 322c 2062 7563  bucketName2, buc
+0001bed0: 6b65 7441 6c69 6173 290a 2020 2020 2020  ketAlias).      
+0001bee0: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+0001bef0: 7074 696f 6e28 2763 7265 6174 6520 6275  ption('create bu
+0001bf00: 636b 6574 2061 6c69 6173 2066 6169 6c65  cket alias faile
+0001bf10: 642c 2072 6573 703a 2025 7327 2025 2063  d, resp: %s' % c
+0001bf20: 6261 5265 7370 290a 0a20 2020 2020 2020  baResp)..       
+0001bf30: 2023 2073 7465 7020 343a 20e7 bb91 e5ae   # step 4: .....
+0001bf40: 9ae4 b8a4 e6ac a1e5 88ab e590 8def bc8c  ................
+0001bf50: e4b8 bae4 b8a4 e4b8 aae7 9c9f e5ae 9ee6  ................
+0001bf60: a1b6 e588 86e5 88ab e7bb 91e5 ae9a 0a20  ............... 
+0001bf70: 2020 2020 2020 2061 6c69 6173 496e 666f         aliasInfo
+0001bf80: 2e61 6c69 6173 203d 2062 7563 6b65 7441  .alias = bucketA
+0001bf90: 6c69 6173 0a20 2020 2020 2020 2062 696e  lias.        bin
+0001bfa0: 6452 6573 7020 3d20 7365 6c66 2e62 696e  dResp = self.bin
+0001bfb0: 6442 7563 6b65 7441 6c69 6173 2862 7563  dBucketAlias(buc
+0001bfc0: 6b65 744e 616d 6531 2c20 616c 6961 7349  ketName1, aliasI
+0001bfd0: 6e66 6f29 0a20 2020 2020 2020 2069 6620  nfo).        if 
+0001bfe0: 6269 6e64 5265 7370 2e73 7461 7475 7320  bindResp.status 
+0001bff0: 213d 2032 3030 3a0a 2020 2020 2020 2020  != 200:.        
+0001c000: 2020 2020 7365 6c66 2e5f 636c 6561 725f      self._clear_
+0001c010: 7669 7274 7561 6c5f 6275 636b 6574 2863  virtual_bucket(c
+0001c020: 6f6e 7374 2e56 4952 5455 414c 5f42 5543  onst.VIRTUAL_BUC
+0001c030: 4b45 545f 4352 4541 5445 414c 4941 535f  KET_CREATEALIAS_
+0001c040: 5354 4147 4544 2c20 6275 636b 6574 4e61  STAGED, bucketNa
+0001c050: 6d65 312c 2062 7563 6b65 744e 616d 6532  me1, bucketName2
+0001c060: 2c20 6275 636b 6574 416c 6961 7329 0a20  , bucketAlias). 
+0001c070: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001c080: 2045 7863 6570 7469 6f6e 2827 6269 6e64   Exception('bind
+0001c090: 696e 6720 6275 636b 6574 2061 6c69 6173  ing bucket alias
+0001c0a0: 2066 6169 6c65 642c 2072 6573 703a 2025   failed, resp: %
+0001c0b0: 7327 2025 2062 696e 6452 6573 7029 0a0a  s' % bindResp)..
+0001c0c0: 2020 2020 2020 2020 6269 6e64 5265 7370          bindResp
+0001c0d0: 203d 2073 656c 662e 6269 6e64 4275 636b   = self.bindBuck
+0001c0e0: 6574 416c 6961 7328 6275 636b 6574 4e61  etAlias(bucketNa
+0001c0f0: 6d65 322c 2061 6c69 6173 496e 666f 290a  me2, aliasInfo).
+0001c100: 2020 2020 2020 2020 6966 2062 696e 6452          if bindR
+0001c110: 6573 702e 7374 6174 7573 2021 3d20 3230  esp.status != 20
+0001c120: 303a 0a20 2020 2020 2020 2020 2020 2073  0:.            s
+0001c130: 656c 662e 5f63 6c65 6172 5f76 6972 7475  elf._clear_virtu
+0001c140: 616c 5f62 7563 6b65 7428 636f 6e73 742e  al_bucket(const.
+0001c150: 5649 5254 5541 4c5f 4255 434b 4554 5f42  VIRTUAL_BUCKET_B
+0001c160: 494e 4441 4c49 4153 5f53 5441 4745 442c  INDALIAS_STAGED,
+0001c170: 2062 7563 6b65 744e 616d 6531 2c20 6275   bucketName1, bu
+0001c180: 636b 6574 4e61 6d65 322c 2062 7563 6b65  cketName2, bucke
+0001c190: 7441 6c69 6173 290a 2020 2020 2020 2020  tAlias).        
+0001c1a0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+0001c1b0: 696f 6e28 2762 696e 6469 6e67 2062 7563  ion('binding buc
+0001c1c0: 6b65 7420 616c 6961 7320 6661 696c 6564  ket alias failed
+0001c1d0: 2c20 7265 7370 3a20 2573 2720 2520 6269  , resp: %s' % bi
+0001c1e0: 6e64 5265 7370 290a 0a20 2020 2020 2020  ndResp)..       
+0001c1f0: 2023 2073 7465 7020 353a 20e5 8f8c e590   # step 5: .....
+0001c200: 91e9 858d e7bd aee5 a48d e588 b6e5 85b3  ................
+0001c210: e7b3 bbef bc8c e5b9 b6e5 bc80 e590 afe5  ................
+0001c220: 8e86 e58f b2e5 afb9 e8b1 a1e5 a48d e588  ................
+0001c230: b60a 2020 2020 2020 2020 7265 706c 6963  ..        replic
+0001c240: 6174 696f 6e52 6573 7020 3d20 7365 6c66  ationResp = self
+0001c250: 2e5f 7365 745f 7669 7274 7561 6c5f 7265  ._set_virtual_re
+0001c260: 706c 6963 6174 696f 6e28 6167 656e 6379  plication(agency
+0001c270: 4e61 6d65 2c20 6275 636b 6574 4e61 6d65  Name, bucketName
+0001c280: 312c 2062 7563 6b65 744e 616d 6532 290a  1, bucketName2).
+0001c290: 2020 2020 2020 2020 6966 2072 6570 6c69          if repli
+0001c2a0: 6361 7469 6f6e 5265 7370 2e73 7461 7475  cationResp.statu
+0001c2b0: 7320 213d 2032 3030 3a0a 2020 2020 2020  s != 200:.      
+0001c2c0: 2020 2020 2020 7365 6c66 2e5f 636c 6561        self._clea
+0001c2d0: 725f 7669 7274 7561 6c5f 6275 636b 6574  r_virtual_bucket
+0001c2e0: 2863 6f6e 7374 2e56 4952 5455 414c 5f42  (const.VIRTUAL_B
+0001c2f0: 5543 4b45 545f 4249 4e44 414c 4941 535f  UCKET_BINDALIAS_
+0001c300: 5354 4147 4544 2c20 6275 636b 6574 4e61  STAGED, bucketNa
+0001c310: 6d65 312c 2062 7563 6b65 744e 616d 6532  me1, bucketName2
+0001c320: 2c20 6275 636b 6574 416c 6961 7329 0a20  , bucketAlias). 
+0001c330: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001c340: 2045 7863 6570 7469 6f6e 2827 7365 7420   Exception('set 
+0001c350: 7265 706c 6963 6174 696f 6e20 6661 696c  replication fail
+0001c360: 6564 2c20 7265 7370 3a20 2573 2720 2520  ed, resp: %s' % 
+0001c370: 7265 706c 6963 6174 696f 6e52 6573 7029  replicationResp)
+0001c380: 0a0a 2020 2020 2020 2020 7265 706c 6963  ..        replic
+0001c390: 6174 696f 6e52 6573 7020 3d20 7365 6c66  ationResp = self
+0001c3a0: 2e5f 7365 745f 7669 7274 7561 6c5f 7265  ._set_virtual_re
+0001c3b0: 706c 6963 6174 696f 6e28 6167 656e 6379  plication(agency
+0001c3c0: 4e61 6d65 2c20 6275 636b 6574 4e61 6d65  Name, bucketName
+0001c3d0: 322c 2062 7563 6b65 744e 616d 6531 290a  2, bucketName1).
+0001c3e0: 2020 2020 2020 2020 6966 2072 6570 6c69          if repli
+0001c3f0: 6361 7469 6f6e 5265 7370 2e73 7461 7475  cationResp.statu
+0001c400: 7320 213d 2032 3030 3a0a 2020 2020 2020  s != 200:.      
+0001c410: 2020 2020 2020 7365 6c66 2e5f 636c 6561        self._clea
+0001c420: 725f 7669 7274 7561 6c5f 6275 636b 6574  r_virtual_bucket
+0001c430: 2863 6f6e 7374 2e56 4952 5455 414c 5f42  (const.VIRTUAL_B
+0001c440: 5543 4b45 545f 4249 4e44 414c 4941 535f  UCKET_BINDALIAS_
+0001c450: 5354 4147 4544 2c20 6275 636b 6574 4e61  STAGED, bucketNa
+0001c460: 6d65 312c 2062 7563 6b65 744e 616d 6532  me1, bucketName2
+0001c470: 2c20 6275 636b 6574 416c 6961 7329 0a20  , bucketAlias). 
+0001c480: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001c490: 2045 7863 6570 7469 6f6e 2827 7365 7420   Exception('set 
+0001c4a0: 7265 706c 6963 6174 696f 6e20 6661 696c  replication fail
+0001c4b0: 6564 2c20 7265 7370 3a20 2573 2720 2520  ed, resp: %s' % 
+0001c4c0: 7265 706c 6963 6174 696f 6e52 6573 7029  replicationResp)
+0001c4d0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001c4e0: 207b 2763 6f64 6527 3a20 274f 4b27 2c20   {'code': 'OK', 
+0001c4f0: 276d 6573 7361 6765 273a 2027 6372 6561  'message': 'crea
+0001c500: 7465 2076 6972 7475 616c 2062 7563 6b65  te virtual bucke
+0001c510: 7420 7375 6363 6573 7327 2c20 2776 6972  t success', 'vir
+0001c520: 7475 616c 4275 636b 6574 4e61 6d65 273a  tualBucketName':
+0001c530: 2062 7563 6b65 7441 6c69 6173 2c0a 2020   bucketAlias,.  
+0001c540: 2020 2020 2020 2020 2020 2020 2020 2762                'b
+0001c550: 7563 6b65 744e 616d 6531 273a 2062 7563  ucketName1': buc
+0001c560: 6b65 744e 616d 6531 2c20 2762 7563 6b65  ketName1, 'bucke
+0001c570: 744e 616d 6532 273a 2062 7563 6b65 744e  tName2': bucketN
+0001c580: 616d 6532 7d0a 0a20 2020 2064 6566 205f  ame2}..    def _
+0001c590: 6765 745f 636c 7573 7465 725f 6772 6f75  get_cluster_grou
+0001c5a0: 705f 6964 2873 656c 662c 2061 7a52 6573  p_id(self, azRes
+0001c5b0: 7029 3a0a 2020 2020 2020 2020 617a 4a73  p):.        azJs
+0001c5c0: 6f6e 5265 7370 203d 2075 7469 6c2e 6a73  onResp = util.js
+0001c5d0: 6f6e 4c6f 6164 7346 6f72 5079 3228 617a  onLoadsForPy2(az
+0001c5e0: 5265 7370 2e62 6f64 7929 2069 6620 636f  Resp.body) if co
+0001c5f0: 6e73 742e 4953 5f50 5954 484f 4e32 2065  nst.IS_PYTHON2 e
+0001c600: 6c73 6520 6a73 6f6e 2e6c 6f61 6473 2861  lse json.loads(a
+0001c610: 7a52 6573 702e 626f 6479 290a 2020 2020  zResp.body).    
+0001c620: 2020 2020 617a 496e 666f 7320 3d20 617a      azInfos = az
+0001c630: 4a73 6f6e 5265 7370 2e67 6574 2827 696e  JsonResp.get('in
+0001c640: 666f 7327 290a 0a20 2020 2020 2020 2069  fos')..        i
+0001c650: 6620 6c65 6e28 617a 496e 666f 7329 2021  f len(azInfos) !
+0001c660: 3d20 636f 6e73 742e 5649 5254 5541 4c5f  = const.VIRTUAL_
+0001c670: 4255 434b 4554 5f4e 4545 445f 415a 5f43  BUCKET_NEED_AZ_C
+0001c680: 4f55 4e54 3a0a 2020 2020 2020 2020 2020  OUNT:.          
+0001c690: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+0001c6a0: 6e28 2774 6865 206e 756d 6265 7220 6f66  n('the number of
+0001c6b0: 2041 5a73 2064 6f65 7320 6e6f 7420 6d65   AZs does not me
+0001c6c0: 6574 2074 6865 2072 6571 7569 7265 6d65  et the requireme
+0001c6d0: 6e74 7327 290a 0a20 2020 2020 2020 2066  nts')..        f
+0001c6e0: 6972 7374 415a 4b65 7920 3d20 6e65 7874  irstAZKey = next
+0001c6f0: 2869 7465 7228 617a 496e 666f 7329 290a  (iter(azInfos)).
+0001c700: 2020 2020 2020 2020 6669 7273 7441 5a56          firstAZV
+0001c710: 616c 7565 203d 2061 7a49 6e66 6f73 2e67  alue = azInfos.g
+0001c720: 6574 2866 6972 7374 415a 4b65 7929 0a20  et(firstAZKey). 
+0001c730: 2020 2020 2020 2069 6620 6c65 6e28 6669         if len(fi
+0001c740: 7273 7441 5a56 616c 7565 2920 3d3d 2030  rstAZValue) == 0
+0001c750: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0001c760: 6973 6520 4578 6365 7074 696f 6e28 276e  ise Exception('n
+0001c770: 6f20 636c 7573 7465 7220 6578 6973 7473  o cluster exists
+0001c780: 2069 6e20 7468 6520 415a 2c20 415a 206b   in the AZ, AZ k
+0001c790: 6579 3a20 2573 2720 2520 6669 7273 7441  ey: %s' % firstA
+0001c7a0: 5a4b 6579 290a 0a20 2020 2020 2020 2066  ZKey)..        f
+0001c7b0: 6972 7374 415a 4367 4964 203d 2066 6972  irstAZCgId = fir
+0001c7c0: 7374 415a 5661 6c75 655b 305d 2e67 6574  stAZValue[0].get
+0001c7d0: 2863 6f6e 7374 2e4b 4559 5f43 4c55 5354  (const.KEY_CLUST
+0001c7e0: 4552 5f47 524f 5550 5f49 4429 0a20 2020  ER_GROUP_ID).   
+0001c7f0: 2020 2020 2069 6620 6e6f 7420 6669 7273       if not firs
+0001c800: 7441 5a43 6749 643a 0a20 2020 2020 2020  tAZCgId:.       
+0001c810: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
+0001c820: 7469 6f6e 2827 7468 6973 2041 5a73 2066  tion('this AZs f
+0001c830: 6972 7374 2063 6c75 7374 6572 2067 726f  irst cluster gro
+0001c840: 7570 2069 6420 6973 204e 6f6e 652c 2041  up id is None, A
+0001c850: 5a20 6b65 793a 2025 7327 2025 2066 6972  Z key: %s' % fir
+0001c860: 7374 415a 4b65 7929 0a0a 2020 2020 2020  stAZKey)..      
+0001c870: 2020 7365 636f 6e64 415a 4b65 7920 3d20    secondAZKey = 
+0001c880: 6c69 7374 2861 7a49 6e66 6f73 2e6b 6579  list(azInfos.key
+0001c890: 7328 2929 5b2d 315d 0a20 2020 2020 2020  s())[-1].       
+0001c8a0: 2073 6563 6f6e 6441 5a56 616c 7565 203d   secondAZValue =
+0001c8b0: 2061 7a49 6e66 6f73 2e67 6574 2873 6563   azInfos.get(sec
+0001c8c0: 6f6e 6441 5a4b 6579 290a 2020 2020 2020  ondAZKey).      
+0001c8d0: 2020 6966 206c 656e 2873 6563 6f6e 6441    if len(secondA
+0001c8e0: 5a56 616c 7565 2920 3d3d 2030 3a0a 2020  ZValue) == 0:.  
+0001c8f0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001c900: 4578 6365 7074 696f 6e28 276e 6f20 636c  Exception('no cl
+0001c910: 7573 7465 7220 6578 6973 7473 2069 6e20  uster exists in 
+0001c920: 7468 6520 415a 2c20 415a 206b 6579 3a20  the AZ, AZ key: 
+0001c930: 2573 2720 2520 7365 636f 6e64 415a 4b65  %s' % secondAZKe
+0001c940: 7929 0a0a 2020 2020 2020 2020 7365 636f  y)..        seco
+0001c950: 6e64 415a 4367 4964 203d 2073 6563 6f6e  ndAZCgId = secon
+0001c960: 6441 5a56 616c 7565 5b30 5d2e 6765 7428  dAZValue[0].get(
+0001c970: 636f 6e73 742e 4b45 595f 434c 5553 5445  const.KEY_CLUSTE
+0001c980: 525f 4752 4f55 505f 4944 290a 2020 2020  R_GROUP_ID).    
+0001c990: 2020 2020 6966 206e 6f74 2073 6563 6f6e      if not secon
+0001c9a0: 6441 5a43 6749 643a 0a20 2020 2020 2020  dAZCgId:.       
+0001c9b0: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
+0001c9c0: 7469 6f6e 2827 7468 6973 2041 5a73 2066  tion('this AZs f
+0001c9d0: 6972 7374 2063 6c75 7374 6572 2067 726f  irst cluster gro
+0001c9e0: 7570 2069 6420 6973 204e 6f6e 652c 2041  up id is None, A
+0001c9f0: 5a20 6b65 793a 2025 7327 2025 2073 6563  Z key: %s' % sec
+0001ca00: 6f6e 6441 5a4b 6579 290a 0a20 2020 2020  ondAZKey)..     
+0001ca10: 2020 2072 6574 7572 6e20 6669 7273 7441     return firstA
+0001ca20: 5a43 6749 642c 2073 6563 6f6e 6441 5a43  ZCgId, secondAZC
+0001ca30: 6749 640a 0a20 2020 2064 6566 205f 6372  gId..    def _cr
+0001ca40: 6561 7465 5f62 7563 6b65 745f 7769 7468  eate_bucket_with
+0001ca50: 5f63 6c75 7374 6572 5f69 6428 7365 6c66  _cluster_id(self
+0001ca60: 2c20 6669 7273 7441 5a43 6749 642c 2073  , firstAZCgId, s
+0001ca70: 6563 6f6e 6441 5a43 6749 642c 2062 7563  econdAZCgId, buc
+0001ca80: 6b65 744e 616d 6531 2c20 6275 636b 6574  ketName1, bucket
+0001ca90: 4e61 6d65 322c 2062 7563 6b65 7441 6c69  Name2, bucketAli
+0001caa0: 6173 2c20 6865 6164 6572 293a 0a20 2020  as, header):.   
+0001cab0: 2020 2020 2023 20e5 88a4 e696 ade6 a1b6       # .........
+0001cac0: e698 afe5 90a6 e5ad 98e5 9ca8 0a20 2020  .............   
+0001cad0: 2020 2020 2062 7563 6b65 7431 4367 4964       bucket1CgId
+0001cae0: 2c20 6275 636b 6574 3243 6749 6420 3d20  , bucket2CgId = 
+0001caf0: 7365 6c66 2e5f 6865 6164 5f76 6972 7475  self._head_virtu
+0001cb00: 616c 5f62 7563 6b65 7428 6275 636b 6574  al_bucket(bucket
+0001cb10: 4e61 6d65 312c 2062 7563 6b65 744e 616d  Name1, bucketNam
+0001cb20: 6532 290a 0a20 2020 2020 2020 2023 20e4  e2)..        # .
+0001cb30: b8a4 e4b8 aae6 a1b6 e983 bde5 ad98 e59c  ................
+0001cb40: a8ef bc8c e4b8 9463 6c75 7374 6572 2067  .......cluster g
+0001cb50: 726f 7570 2069 64e4 b880 e887 b40a 2020  roup id.......  
+0001cb60: 2020 2020 2020 6966 2062 7563 6b65 7431        if bucket1
+0001cb70: 4367 4964 2061 6e64 2062 7563 6b65 7432  CgId and bucket2
+0001cb80: 4367 4964 2061 6e64 2062 7563 6b65 7431  CgId and bucket1
+0001cb90: 4367 4964 203d 3d20 6275 636b 6574 3243  CgId == bucket2C
+0001cba0: 6749 643a 0a20 2020 2020 2020 2020 2020  gId:.           
+0001cbb0: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+0001cbc0: 2827 6372 6561 7465 2062 7563 6b65 7420  ('create bucket 
+0001cbd0: 6661 696c 6564 2c20 626f 7468 2062 7563  failed, both buc
+0001cbe0: 6b65 7473 2065 7869 7374 2061 6e64 2063  kets exist and c
+0001cbf0: 6c75 7374 6572 2067 726f 7570 2069 6420  luster group id 
+0001cc00: 6973 2074 6865 2073 616d 6527 290a 0a20  is the same').. 
+0001cc10: 2020 2020 2020 2065 7874 656e 7369 6f6e         extension
+0001cc20: 4865 6164 6572 7320 3d20 4578 7465 6e73  Headers = Extens
+0001cc30: 696f 6e48 6561 6465 7228 290a 0a20 2020  ionHeader()..   
+0001cc40: 2020 2020 2023 20e5 8faa e5ad 98e5 9ca8       # .........
+0001cc50: e6a1 b631 0a20 2020 2020 2020 2069 6620  ...1.        if 
+0001cc60: 6275 636b 6574 3143 6749 643a 0a20 2020  bucket1CgId:.   
+0001cc70: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
+0001cc80: 6f6e 4865 6164 6572 732e 6c6f 6361 7469  onHeaders.locati
+0001cc90: 6f6e 436c 7573 7465 7247 726f 7570 4964  onClusterGroupId
+0001cca0: 203d 2073 6563 6f6e 6441 5a43 6749 6420   = secondAZCgId 
+0001ccb0: 6966 2062 7563 6b65 7431 4367 4964 203d  if bucket1CgId =
+0001ccc0: 3d20 6669 7273 7441 5a43 6749 6420 656c  = firstAZCgId el
+0001ccd0: 7365 2066 6972 7374 415a 4367 4964 0a20  se firstAZCgId. 
+0001cce0: 2020 2020 2020 2020 2020 2063 6252 6573             cbRes
+0001ccf0: 7020 3d20 7365 6c66 2e63 7265 6174 6542  p = self.createB
+0001cd00: 7563 6b65 7428 6275 636b 6574 4e61 6d65  ucket(bucketName
+0001cd10: 322c 2068 6561 6465 723d 6865 6164 6572  2, header=header
+0001cd20: 2c20 6578 7465 6e73 696f 6e48 6561 6465  , extensionHeade
+0001cd30: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
+0001cd40: 6572 7329 0a20 2020 2020 2020 2020 2020  ers).           
+0001cd50: 2069 6620 6362 5265 7370 2e73 7461 7475   if cbResp.statu
+0001cd60: 7320 213d 2032 3030 3a0a 2020 2020 2020  s != 200:.      
+0001cd70: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0001cd80: 636c 6561 725f 7669 7274 7561 6c5f 6275  clear_virtual_bu
+0001cd90: 636b 6574 2863 6f6e 7374 2e56 4952 5455  cket(const.VIRTU
+0001cda0: 414c 5f42 5543 4b45 545f 4352 4541 5445  AL_BUCKET_CREATE
+0001cdb0: 4255 434b 4554 5f53 5441 4745 442c 2062  BUCKET_STAGED, b
+0001cdc0: 7563 6b65 744e 616d 6531 2c20 6275 636b  ucketName1, buck
+0001cdd0: 6574 4e61 6d65 322c 0a20 2020 2020 2020  etName2,.       
+0001cde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce00: 2020 2020 6275 636b 6574 416c 6961 7329      bucketAlias)
+0001ce10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ce20: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+0001ce30: 2827 6372 6561 7465 2062 7563 6b65 7420  ('create bucket 
+0001ce40: 6661 696c 6564 2c20 636c 7573 7465 7220  failed, cluster 
+0001ce50: 6772 6f75 7020 6964 3a20 2573 2c20 7265  group id: %s, re
+0001ce60: 7370 3a20 2573 2720 2520 280a 2020 2020  sp: %s' % (.    
+0001ce70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce80: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+0001ce90: 2e6c 6f63 6174 696f 6e43 6c75 7374 6572  .locationCluster
+0001cea0: 4772 6f75 7049 642c 2063 6252 6573 7029  GroupId, cbResp)
+0001ceb0: 290a 0a20 2020 2020 2020 2023 20e5 8faa  )..        # ...
+0001cec0: e5ad 98e5 9ca8 e6a1 b632 0a20 2020 2020  .........2.     
+0001ced0: 2020 2069 6620 6275 636b 6574 3243 6749     if bucket2CgI
+0001cee0: 643a 0a20 2020 2020 2020 2020 2020 2065  d:.            e
+0001cef0: 7874 656e 7369 6f6e 4865 6164 6572 732e  xtensionHeaders.
+0001cf00: 6c6f 6361 7469 6f6e 436c 7573 7465 7247  locationClusterG
+0001cf10: 726f 7570 4964 203d 2073 6563 6f6e 6441  roupId = secondA
+0001cf20: 5a43 6749 6420 6966 2062 7563 6b65 7432  ZCgId if bucket2
+0001cf30: 4367 4964 203d 3d20 6669 7273 7441 5a43  CgId == firstAZC
+0001cf40: 6749 6420 656c 7365 2066 6972 7374 415a  gId else firstAZ
+0001cf50: 4367 4964 0a20 2020 2020 2020 2020 2020  CgId.           
+0001cf60: 2063 6252 6573 7020 3d20 7365 6c66 2e63   cbResp = self.c
+0001cf70: 7265 6174 6542 7563 6b65 7428 6275 636b  reateBucket(buck
+0001cf80: 6574 4e61 6d65 312c 2068 6561 6465 723d  etName1, header=
+0001cf90: 6865 6164 6572 2c20 6578 7465 6e73 696f  header, extensio
+0001cfa0: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
+0001cfb0: 6f6e 4865 6164 6572 7329 0a20 2020 2020  onHeaders).     
+0001cfc0: 2020 2020 2020 2069 6620 6362 5265 7370         if cbResp
+0001cfd0: 2e73 7461 7475 7320 213d 2032 3030 3a0a  .status != 200:.
+0001cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cff0: 7365 6c66 2e5f 636c 6561 725f 7669 7274  self._clear_virt
+0001d000: 7561 6c5f 6275 636b 6574 2863 6f6e 7374  ual_bucket(const
+0001d010: 2e56 4952 5455 414c 5f42 5543 4b45 545f  .VIRTUAL_BUCKET_
+0001d020: 4352 4541 5445 4255 434b 4554 5f53 5441  CREATEBUCKET_STA
+0001d030: 4745 442c 2062 7563 6b65 744e 616d 6531  GED, bucketName1
+0001d040: 2c20 6275 636b 6574 4e61 6d65 322c 0a20  , bucketName2,. 
+0001d050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d070: 2020 2020 2020 2020 2020 6275 636b 6574            bucket
+0001d080: 416c 6961 7329 0a20 2020 2020 2020 2020  Alias).         
+0001d090: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+0001d0a0: 6570 7469 6f6e 2827 6372 6561 7465 2062  eption('create b
+0001d0b0: 7563 6b65 7420 6661 696c 6564 2c20 636c  ucket failed, cl
+0001d0c0: 7573 7465 7220 6772 6f75 7020 6964 3a20  uster group id: 
+0001d0d0: 2573 2c20 7265 7370 3a20 2573 2720 2520  %s, resp: %s' % 
+0001d0e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001d0f0: 2020 2020 2020 6578 7465 6e73 696f 6e48        extensionH
+0001d100: 6561 6465 7273 2e6c 6f63 6174 696f 6e43  eaders.locationC
+0001d110: 6c75 7374 6572 4772 6f75 7049 642c 2063  lusterGroupId, c
+0001d120: 6252 6573 7029 290a 0a20 2020 2020 2020  bResp))..       
+0001d130: 2023 20e4 b8a4 e4b8 aae6 a1b6 e983 bde4   # .............
+0001d140: b88d e5ad 98e5 9ca8 0a20 2020 2020 2020  .........       
+0001d150: 2069 6620 6e6f 7420 6275 636b 6574 3143   if not bucket1C
+0001d160: 6749 6420 616e 6420 6e6f 7420 6275 636b  gId and not buck
+0001d170: 6574 3243 6749 643a 0a20 2020 2020 2020  et2CgId:.       
+0001d180: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
+0001d190: 6164 6572 732e 6c6f 6361 7469 6f6e 436c  aders.locationCl
+0001d1a0: 7573 7465 7247 726f 7570 4964 203d 2066  usterGroupId = f
+0001d1b0: 6972 7374 415a 4367 4964 0a20 2020 2020  irstAZCgId.     
+0001d1c0: 2020 2020 2020 2063 6252 6573 7020 3d20         cbResp = 
+0001d1d0: 7365 6c66 2e63 7265 6174 6542 7563 6b65  self.createBucke
+0001d1e0: 7428 6275 636b 6574 4e61 6d65 312c 2068  t(bucketName1, h
+0001d1f0: 6561 6465 723d 6865 6164 6572 2c20 6578  eader=header, ex
+0001d200: 7465 6e73 696f 6e48 6561 6465 7273 3d65  tensionHeaders=e
+0001d210: 7874 656e 7369 6f6e 4865 6164 6572 7329  xtensionHeaders)
+0001d220: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001d230: 6362 5265 7370 2e73 7461 7475 7320 213d  cbResp.status !=
+0001d240: 2032 3030 3a0a 2020 2020 2020 2020 2020   200:.          
+0001d250: 2020 2020 2020 7365 6c66 2e5f 636c 6561        self._clea
+0001d260: 725f 7669 7274 7561 6c5f 6275 636b 6574  r_virtual_bucket
+0001d270: 2863 6f6e 7374 2e56 4952 5455 414c 5f42  (const.VIRTUAL_B
+0001d280: 5543 4b45 545f 4352 4541 5445 4255 434b  UCKET_CREATEBUCK
+0001d290: 4554 5f53 5441 4745 442c 2062 7563 6b65  ET_STAGED, bucke
+0001d2a0: 744e 616d 6531 2c20 6275 636b 6574 4e61  tName1, bucketNa
+0001d2b0: 6d65 322c 0a20 2020 2020 2020 2020 2020  me2,.           
+0001d2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d2e0: 6275 636b 6574 416c 6961 7329 0a20 2020  bucketAlias).   
+0001d2f0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0001d300: 7365 2045 7863 6570 7469 6f6e 2827 6372  se Exception('cr
+0001d310: 6561 7465 2062 7563 6b65 7420 6661 696c  eate bucket fail
+0001d320: 6564 2c20 636c 7573 7465 7220 6772 6f75  ed, cluster grou
+0001d330: 7020 6964 3a20 2573 2c20 7265 7370 3a20  p id: %s, resp: 
+0001d340: 2573 2720 2520 2866 6972 7374 415a 4367  %s' % (firstAZCg
+0001d350: 4964 2c20 6362 5265 7370 2929 0a0a 2020  Id, cbResp))..  
+0001d360: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
+0001d370: 696f 6e48 6561 6465 7273 2e6c 6f63 6174  ionHeaders.locat
+0001d380: 696f 6e43 6c75 7374 6572 4772 6f75 7049  ionClusterGroupI
+0001d390: 6420 3d20 7365 636f 6e64 415a 4367 4964  d = secondAZCgId
+0001d3a0: 0a20 2020 2020 2020 2020 2020 2063 6252  .            cbR
+0001d3b0: 6573 7020 3d20 7365 6c66 2e63 7265 6174  esp = self.creat
+0001d3c0: 6542 7563 6b65 7428 6275 636b 6574 4e61  eBucket(bucketNa
+0001d3d0: 6d65 322c 2068 6561 6465 723d 6865 6164  me2, header=head
+0001d3e0: 6572 2c20 6578 7465 6e73 696f 6e48 6561  er, extensionHea
+0001d3f0: 6465 7273 3d65 7874 656e 7369 6f6e 4865  ders=extensionHe
+0001d400: 6164 6572 7329 0a20 2020 2020 2020 2020  aders).         
+0001d410: 2020 2069 6620 6362 5265 7370 2e73 7461     if cbResp.sta
+0001d420: 7475 7320 213d 2032 3030 3a0a 2020 2020  tus != 200:.    
+0001d430: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001d440: 2e5f 636c 6561 725f 7669 7274 7561 6c5f  ._clear_virtual_
+0001d450: 6275 636b 6574 2863 6f6e 7374 2e56 4952  bucket(const.VIR
+0001d460: 5455 414c 5f42 5543 4b45 545f 4352 4541  TUAL_BUCKET_CREA
+0001d470: 5445 4255 434b 4554 5f53 5441 4745 442c  TEBUCKET_STAGED,
+0001d480: 2062 7563 6b65 744e 616d 6531 2c20 6275   bucketName1, bu
+0001d490: 636b 6574 4e61 6d65 322c 0a20 2020 2020  cketName2,.     
+0001d4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4c0: 2020 2020 2020 6275 636b 6574 416c 6961        bucketAlia
+0001d4d0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+0001d4e0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+0001d4f0: 6f6e 2827 6372 6561 7465 2062 7563 6b65  on('create bucke
+0001d500: 7420 6661 696c 6564 2c20 636c 7573 7465  t failed, cluste
+0001d510: 7220 6772 6f75 7020 6964 3a20 2573 2c20  r group id: %s, 
+0001d520: 7265 7370 3a20 2573 2720 2520 2873 6563  resp: %s' % (sec
+0001d530: 6f6e 6441 5a43 6749 642c 2063 6252 6573  ondAZCgId, cbRes
+0001d540: 7029 290a 0a20 2020 2064 6566 205f 6865  p))..    def _he
+0001d550: 6164 5f76 6972 7475 616c 5f62 7563 6b65  ad_virtual_bucke
+0001d560: 7428 7365 6c66 2c20 6275 636b 6574 4e61  t(self, bucketNa
+0001d570: 6d65 312c 2062 7563 6b65 744e 616d 6532  me1, bucketName2
+0001d580: 293a 0a20 2020 2020 2020 2062 7563 6b65  ):.        bucke
+0001d590: 7431 4367 4964 203d 204e 6f6e 650a 2020  t1CgId = None.  
+0001d5a0: 2020 2020 2020 6275 636b 6574 3243 6749        bucket2CgI
+0001d5b0: 6420 3d20 4e6f 6e65 0a0a 2020 2020 2020  d = None..      
+0001d5c0: 2020 6865 6164 3152 6573 7020 3d20 7365    head1Resp = se
+0001d5d0: 6c66 2e68 6561 6442 7563 6b65 7428 6275  lf.headBucket(bu
+0001d5e0: 636b 6574 4e61 6d65 3129 0a20 2020 2020  cketName1).     
+0001d5f0: 2020 2069 6620 6865 6164 3152 6573 702e     if head1Resp.
+0001d600: 7374 6174 7573 203d 3d20 3230 303a 0a20  status == 200:. 
+0001d610: 2020 2020 2020 2020 2020 2066 6f72 2068             for h
+0001d620: 2069 6e20 6865 6164 3152 6573 702e 6865   in head1Resp.he
+0001d630: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
+0001d640: 2020 2020 2020 6966 2063 6f6e 7374 2e4c        if const.L
+0001d650: 4f43 4154 494f 4e5f 434c 5553 5445 5247  OCATION_CLUSTERG
+0001d660: 524f 5550 5f49 4420 696e 2068 3a0a 2020  ROUP_ID in h:.  
+0001d670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d680: 2020 6275 636b 6574 3143 6749 6420 3d20    bucket1CgId = 
+0001d690: 685b 315d 0a20 2020 2020 2020 2020 2020  h[1].           
+0001d6a0: 2020 2020 2020 2020 2062 7265 616b 0a0a           break..
+0001d6b0: 2020 2020 2020 2020 6865 6164 3252 6573          head2Res
+0001d6c0: 7020 3d20 7365 6c66 2e68 6561 6442 7563  p = self.headBuc
+0001d6d0: 6b65 7428 6275 636b 6574 4e61 6d65 3229  ket(bucketName2)
+0001d6e0: 0a20 2020 2020 2020 2069 6620 6865 6164  .        if head
+0001d6f0: 3252 6573 702e 7374 6174 7573 203d 3d20  2Resp.status == 
+0001d700: 3230 303a 0a20 2020 2020 2020 2020 2020  200:.           
+0001d710: 2066 6f72 2068 2069 6e20 6865 6164 3252   for h in head2R
+0001d720: 6573 702e 6865 6164 6572 3a0a 2020 2020  esp.header:.    
+0001d730: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0001d740: 6f6e 7374 2e4c 4f43 4154 494f 4e5f 434c  onst.LOCATION_CL
+0001d750: 5553 5445 5247 524f 5550 5f49 4420 696e  USTERGROUP_ID in
+0001d760: 2068 3a0a 2020 2020 2020 2020 2020 2020   h:.            
+0001d770: 2020 2020 2020 2020 6275 636b 6574 3243          bucket2C
+0001d780: 6749 6420 3d20 685b 315d 0a20 2020 2020  gId = h[1].     
+0001d790: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001d7a0: 7265 616b 0a0a 2020 2020 2020 2020 7265  reak..        re
+0001d7b0: 7475 726e 2062 7563 6b65 7431 4367 4964  turn bucket1CgId
+0001d7c0: 2c20 6275 636b 6574 3243 6749 640a 0a20  , bucket2CgId.. 
+0001d7d0: 2020 2064 6566 205f 7365 745f 7669 7274     def _set_virt
+0001d7e0: 7561 6c5f 7265 706c 6963 6174 696f 6e28  ual_replication(
+0001d7f0: 7365 6c66 2c20 6167 656e 6379 4e61 6d65  self, agencyName
+0001d800: 2c20 736f 7572 6365 4275 636b 6574 4e61  , sourceBucketNa
+0001d810: 6d65 2c20 6465 7374 4275 636b 6574 4e61  me, destBucketNa
+0001d820: 6d65 293a 0a20 2020 2020 2020 2072 6570  me):.        rep
+0001d830: 6c69 6361 7469 6f6e 203d 2052 6570 6c69  lication = Repli
+0001d840: 6361 7469 6f6e 2829 0a20 2020 2020 2020  cation().       
+0001d850: 2072 6570 6c69 6361 7469 6f6e 2e61 6765   replication.age
+0001d860: 6e63 7920 3d20 6167 656e 6379 4e61 6d65  ncy = agencyName
+0001d870: 0a0a 2020 2020 2020 2020 5f72 756c 6573  ..        _rules
+0001d880: 203d 205b 5d0a 2020 2020 2020 2020 7265   = [].        re
+0001d890: 706c 6963 6174 696f 6e52 756c 6520 3d20  plicationRule = 
+0001d8a0: 5265 706c 6963 6174 696f 6e52 756c 6528  ReplicationRule(
+0001d8b0: 290a 2020 2020 2020 2020 7265 706c 6963  ).        replic
+0001d8c0: 6174 696f 6e52 756c 652e 6964 203d 2073  ationRule.id = s
+0001d8d0: 6f75 7263 6542 7563 6b65 744e 616d 6520  ourceBucketName 
+0001d8e0: 2b20 275f 746f 5f27 202b 2064 6573 7442  + '_to_' + destB
+0001d8f0: 7563 6b65 744e 616d 650a 2020 2020 2020  ucketName.      
+0001d900: 2020 7265 706c 6963 6174 696f 6e52 756c    replicationRul
+0001d910: 652e 7072 6566 6978 203d 2027 270a 2020  e.prefix = ''.  
+0001d920: 2020 2020 2020 7265 706c 6963 6174 696f        replicatio
+0001d930: 6e52 756c 652e 7374 6174 7573 203d 2027  nRule.status = '
+0001d940: 456e 6162 6c65 6427 0a20 2020 2020 2020  Enabled'.       
+0001d950: 2072 6570 6c69 6361 7469 6f6e 5275 6c65   replicationRule
+0001d960: 2e62 7563 6b65 7420 3d20 6465 7374 4275  .bucket = destBu
+0001d970: 636b 6574 4e61 6d65 0a20 2020 2020 2020  cketName.       
+0001d980: 2072 6570 6c69 6361 7469 6f6e 5275 6c65   replicationRule
+0001d990: 2e73 746f 7261 6765 436c 6173 7320 3d20  .storageClass = 
+0001d9a0: 2753 5441 4e44 4152 4427 0a20 2020 2020  'STANDARD'.     
+0001d9b0: 2020 2072 6570 6c69 6361 7469 6f6e 5275     replicationRu
+0001d9c0: 6c65 2e64 656c 6574 6544 6174 6120 3d20  le.deleteData = 
+0001d9d0: 2745 6e61 626c 6564 270a 2020 2020 2020  'Enabled'.      
+0001d9e0: 2020 7265 706c 6963 6174 696f 6e52 756c    replicationRul
+0001d9f0: 652e 6869 7374 6f72 6963 616c 4f62 6a65  e.historicalObje
+0001da00: 6374 5265 706c 6963 6174 696f 6e20 3d20  ctReplication = 
+0001da10: 2745 6e61 626c 6564 270a 0a20 2020 2020  'Enabled'..     
+0001da20: 2020 205f 7275 6c65 732e 6170 7065 6e64     _rules.append
+0001da30: 2872 6570 6c69 6361 7469 6f6e 5275 6c65  (replicationRule
+0001da40: 290a 2020 2020 2020 2020 7265 706c 6963  ).        replic
+0001da50: 6174 696f 6e2e 7265 706c 6963 6174 696f  ation.replicatio
+0001da60: 6e52 756c 6573 203d 205f 7275 6c65 730a  nRules = _rules.
+0001da70: 2020 2020 2020 2020 7265 7370 203d 2073          resp = s
+0001da80: 656c 662e 7365 7442 7563 6b65 7452 6570  elf.setBucketRep
+0001da90: 6c69 6361 7469 6f6e 2873 6f75 7263 6542  lication(sourceB
+0001daa0: 7563 6b65 744e 616d 652c 2072 6570 6c69  ucketName, repli
+0001dab0: 6361 7469 6f6e 290a 2020 2020 2020 2020  cation).        
+0001dac0: 7265 7475 726e 2072 6573 700a 0a20 2020  return resp..   
+0001dad0: 2064 6566 205f 636c 6561 725f 7669 7274   def _clear_virt
+0001dae0: 7561 6c5f 6275 636b 6574 2873 656c 662c  ual_bucket(self,
+0001daf0: 2073 7461 6765 642c 2062 7563 6b65 744e   staged, bucketN
+0001db00: 616d 6531 2c20 6275 636b 6574 4e61 6d65  ame1, bucketName
+0001db10: 322c 2062 7563 6b65 7441 6c69 6173 293a  2, bucketAlias):
+0001db20: 0a20 2020 2020 2020 2023 2073 7461 6765  .        # stage
+0001db30: 64e5 8f96 e580 bcef bc9a 0a20 2020 2020  d..........     
+0001db40: 2020 2023 2031 efbc 9ae5 889b e5bb bae7     # 1..........
+0001db50: 9c9f e5ae 9ee6 a1b6 0a20 2020 2020 2020  .........       
+0001db60: 2023 2032 efbc 9ae5 889b e5bb bae6 a1b6   # 2............
+0001db70: e588 abe5 908d 0a20 2020 2020 2020 2023  .......        #
+0001db80: 2033 efbc 9ae7 bb91 e5ae 9ae6 a1b6 e588   3..............
+0001db90: abe5 908d 0a20 2020 2020 2020 2069 6620  .....        if 
+0001dba0: 7374 6167 6564 203e 3d20 636f 6e73 742e  staged >= const.
+0001dbb0: 5649 5254 5541 4c5f 4255 434b 4554 5f42  VIRTUAL_BUCKET_B
+0001dbc0: 494e 4441 4c49 4153 5f53 5441 4745 443a  INDALIAS_STAGED:
+0001dbd0: 0a20 2020 2020 2020 2020 2020 2023 20e8  .            # .
+0001dbe0: a7a3 e7bb 91e6 a1b6 e588 abe5 908d 0a20  ............... 
+0001dbf0: 2020 2020 2020 2020 2020 2075 6e62 696e             unbin
+0001dc00: 6452 6573 7020 3d20 7365 6c66 2e75 6e62  dResp = self.unb
+0001dc10: 696e 6442 7563 6b65 7441 6c69 6173 2862  indBucketAlias(b
+0001dc20: 7563 6b65 744e 616d 6531 290a 2020 2020  ucketName1).    
+0001dc30: 2020 2020 2020 2020 6966 2075 6e62 696e          if unbin
+0001dc40: 6452 6573 702e 7374 6174 7573 2021 3d20  dResp.status != 
+0001dc50: 3230 343a 0a20 2020 2020 2020 2020 2020  204:.           
+0001dc60: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
+0001dc70: 7469 6f6e 2827 756e 6269 6e64 2062 7563  tion('unbind buc
+0001dc80: 6b65 7420 616c 6961 7320 6661 696c 6564  ket alias failed
+0001dc90: 2c20 7265 7370 3a20 2573 2720 2520 756e  , resp: %s' % un
+0001dca0: 6269 6e64 5265 7370 290a 0a20 2020 2020  bindResp)..     
+0001dcb0: 2020 2020 2020 2075 6e62 696e 6452 6573         unbindRes
+0001dcc0: 7020 3d20 7365 6c66 2e75 6e62 696e 6442  p = self.unbindB
+0001dcd0: 7563 6b65 7441 6c69 6173 2862 7563 6b65  ucketAlias(bucke
+0001dce0: 744e 616d 6532 290a 2020 2020 2020 2020  tName2).        
+0001dcf0: 2020 2020 6966 2075 6e62 696e 6452 6573      if unbindRes
+0001dd00: 702e 7374 6174 7573 2021 3d20 3230 343a  p.status != 204:
+0001dd10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dd20: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+0001dd30: 2827 756e 6269 6e64 2062 7563 6b65 7420  ('unbind bucket 
+0001dd40: 616c 6961 7320 6661 696c 6564 2c20 7265  alias failed, re
+0001dd50: 7370 3a20 2573 2720 2520 756e 6269 6e64  sp: %s' % unbind
+0001dd60: 5265 7370 290a 0a20 2020 2020 2020 2069  Resp)..        i
+0001dd70: 6620 7374 6167 6564 203e 3d20 636f 6e73  f staged >= cons
+0001dd80: 742e 5649 5254 5541 4c5f 4255 434b 4554  t.VIRTUAL_BUCKET
+0001dd90: 5f43 5245 4154 4541 4c49 4153 5f53 5441  _CREATEALIAS_STA
+0001dda0: 4745 443a 0a20 2020 2020 2020 2020 2020  GED:.           
+0001ddb0: 2023 20e5 88a0 e999 a4e6 a1b6 e588 abe5   # .............
+0001ddc0: 908d 0a20 2020 2020 2020 2020 2020 2064  ...            d
+0001ddd0: 656c 6574 6541 6c69 6173 5265 7370 203d  eleteAliasResp =
+0001dde0: 2073 656c 662e 6465 6c65 7465 4275 636b   self.deleteBuck
+0001ddf0: 6574 416c 6961 7328 6275 636b 6574 416c  etAlias(bucketAl
+0001de00: 6961 7329 0a20 2020 2020 2020 2020 2020  ias).           
+0001de10: 2069 6620 6465 6c65 7465 416c 6961 7352   if deleteAliasR
+0001de20: 6573 702e 7374 6174 7573 2021 3d20 3230  esp.status != 20
+0001de30: 343a 0a20 2020 2020 2020 2020 2020 2020  4:.             
+0001de40: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+0001de50: 6f6e 2827 6465 6c65 7465 2062 7563 6b65  on('delete bucke
+0001de60: 7420 616c 6961 7320 6661 696c 6564 2c20  t alias failed, 
+0001de70: 7265 7370 3a20 2573 2720 2520 6465 6c65  resp: %s' % dele
+0001de80: 7465 416c 6961 7352 6573 7029 0a0a 2020  teAliasResp)..  
+0001de90: 2020 2020 2020 6966 2073 7461 6765 6420        if staged 
+0001dea0: 3e3d 2063 6f6e 7374 2e56 4952 5455 414c  >= const.VIRTUAL
+0001deb0: 5f42 5543 4b45 545f 4352 4541 5445 4255  _BUCKET_CREATEBU
+0001dec0: 434b 4554 5f53 5441 4745 443a 0a20 2020  CKET_STAGED:.   
+0001ded0: 2020 2020 2020 2020 2023 20e5 88a0 e999           # .....
+0001dee0: a4e7 9c9f e5ae 9ee6 a1b6 0a20 2020 2020  ...........     
+0001def0: 2020 2020 2020 2064 656c 6574 6542 7563         deleteBuc
+0001df00: 6b65 7452 6573 7020 3d20 7365 6c66 2e64  ketResp = self.d
+0001df10: 656c 6574 6542 7563 6b65 7428 6275 636b  eleteBucket(buck
+0001df20: 6574 4e61 6d65 3129 0a20 2020 2020 2020  etName1).       
+0001df30: 2020 2020 2069 6620 6465 6c65 7465 4275       if deleteBu
+0001df40: 636b 6574 5265 7370 2e73 7461 7475 7320  cketResp.status 
+0001df50: 213d 2032 3034 3a0a 2020 2020 2020 2020  != 204:.        
+0001df60: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+0001df70: 6365 7074 696f 6e28 2764 656c 6574 6520  ception('delete 
+0001df80: 6275 636b 6574 2066 6169 6c65 642c 2072  bucket failed, r
+0001df90: 6573 703a 2025 7327 2025 2064 656c 6574  esp: %s' % delet
+0001dfa0: 6542 7563 6b65 7452 6573 7029 0a0a 2020  eBucketResp)..  
+0001dfb0: 2020 2020 2020 2020 2020 6465 6c65 7465            delete
+0001dfc0: 4275 636b 6574 5265 7370 203d 2073 656c  BucketResp = sel
+0001dfd0: 662e 6465 6c65 7465 4275 636b 6574 2862  f.deleteBucket(b
+0001dfe0: 7563 6b65 744e 616d 6532 290a 2020 2020  ucketName2).    
+0001dff0: 2020 2020 2020 2020 6966 2064 656c 6574          if delet
+0001e000: 6542 7563 6b65 7452 6573 702e 7374 6174  eBucketResp.stat
+0001e010: 7573 2021 3d20 3230 343a 0a20 2020 2020  us != 204:.     
+0001e020: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001e030: 2045 7863 6570 7469 6f6e 2827 6465 6c65   Exception('dele
+0001e040: 7465 2062 7563 6b65 7420 6661 696c 6564  te bucket failed
+0001e050: 2c20 7265 7370 3a20 2573 2720 2520 6465  , resp: %s' % de
+0001e060: 6c65 7465 4275 636b 6574 5265 7370 290a  leteBucketResp).
+0001e070: 0a20 2020 2023 2065 6e64 2076 6972 7475  .    # end virtu
+0001e080: 616c 2062 7563 6b65 7420 7265 6c61 7465  al bucket relate
+0001e090: 640a 2020 2020 2320 656e 6420 7669 7274  d.    # end virt
+0001e0a0: 7561 6c20 6275 636b 6574 2072 656c 6174  ual bucket relat
+0001e0b0: 6564 0a20 2020 2023 2065 6e64 2076 6972  ed.    # end vir
+0001e0c0: 7475 616c 2062 7563 6b65 7420 7265 6c61  tual bucket rela
+0001e0d0: 7465 640a 0a20 2020 2040 6675 6e63 4361  ted..    @funcCa
+0001e0e0: 6368 650a 2020 2020 6465 6620 7570 6c6f  che.    def uplo
+0001e0f0: 6164 4669 6c65 2873 656c 662c 2062 7563  adFile(self, buc
+0001e100: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
+0001e110: 6579 2c20 7570 6c6f 6164 4669 6c65 2c20  ey, uploadFile, 
+0001e120: 7061 7274 5369 7a65 3d39 202a 2031 3032  partSize=9 * 102
+0001e130: 3420 2a20 3130 3234 2c0a 2020 2020 2020  4 * 1024,.      
+0001e140: 2020 2020 2020 2020 2020 2020 2074 6173               tas
+0001e150: 6b4e 756d 3d31 2c20 656e 6162 6c65 4368  kNum=1, enableCh
+0001e160: 6563 6b70 6f69 6e74 3d46 616c 7365 2c20  eckpoint=False, 
+0001e170: 6368 6563 6b70 6f69 6e74 4669 6c65 3d4e  checkpointFile=N
+0001e180: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+0001e190: 2020 2020 2020 2020 6368 6563 6b53 756d          checkSum
+0001e1a0: 3d46 616c 7365 2c20 6d65 7461 6461 7461  =False, metadata
+0001e1b0: 3d4e 6f6e 652c 2070 726f 6772 6573 7343  =None, progressC
+0001e1c0: 616c 6c62 6163 6b3d 4e6f 6e65 2c20 6865  allback=None, he
+0001e1d0: 6164 6572 733d 4e6f 6e65 2c0a 2020 2020  aders=None,.    
+0001e1e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001e1f0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
+0001e200: 4e6f 6e65 2c20 656e 636f 6469 6e67 5f74  None, encoding_t
+0001e210: 7970 653d 4e6f 6e65 293a 0a20 2020 2020  ype=None):.     
+0001e220: 2020 2073 656c 662e 6c6f 675f 636c 6965     self.log_clie
+0001e230: 6e74 2e6c 6f67 2849 4e46 4f2c 2027 656e  nt.log(INFO, 'en
+0001e240: 7465 7220 7265 7375 6d65 2075 706c 6f61  ter resume uploa
+0001e250: 6420 6669 6c65 2e2e 2e27 290a 2020 2020  d file...').    
+0001e260: 2020 2020 7365 6c66 2e5f 6173 7365 7274      self._assert
+0001e270: 5f6e 6f74 5f6e 756c 6c28 6275 636b 6574  _not_null(bucket
+0001e280: 4e61 6d65 2c20 2762 7563 6b65 744e 616d  Name, 'bucketNam
+0001e290: 6520 6973 2065 6d70 7479 2729 0a20 2020  e is empty').   
+0001e2a0: 2020 2020 2073 656c 662e 5f61 7373 6572       self._asser
+0001e2b0: 745f 6e6f 745f 6e75 6c6c 286f 626a 6563  t_not_null(objec
+0001e2c0: 744b 6579 2c20 276f 626a 6563 744b 6579  tKey, 'objectKey
+0001e2d0: 2069 7320 656d 7074 7927 290a 2020 2020   is empty').    
+0001e2e0: 2020 2020 7365 6c66 2e5f 6173 7365 7274      self._assert
+0001e2f0: 5f6e 6f74 5f6e 756c 6c28 7570 6c6f 6164  _not_null(upload
+0001e300: 4669 6c65 2c20 2775 706c 6f61 6446 696c  File, 'uploadFil
+0001e310: 6520 6973 2065 6d70 7479 2729 0a0a 2020  e is empty')..  
+0001e320: 2020 2020 2020 7265 7475 726e 205f 7265        return _re
+0001e330: 7375 6d65 5f75 706c 6f61 6428 6275 636b  sume_upload(buck
+0001e340: 6574 4e61 6d65 2c20 6f62 6a65 6374 4b65  etName, objectKe
+0001e350: 792c 2075 706c 6f61 6446 696c 652c 2070  y, uploadFile, p
+0001e360: 6172 7453 697a 652c 2074 6173 6b4e 756d  artSize, taskNum
+0001e370: 2c20 656e 6162 6c65 4368 6563 6b70 6f69  , enableCheckpoi
+0001e380: 6e74 2c20 6368 6563 6b70 6f69 6e74 4669  nt, checkpointFi
+0001e390: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
+0001e3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3b0: 2020 6368 6563 6b53 756d 2c20 6d65 7461    checkSum, meta
+0001e3c0: 6461 7461 2c20 7072 6f67 7265 7373 4361  data, progressCa
+0001e3d0: 6c6c 6261 636b 2c20 7365 6c66 2c20 6865  llback, self, he
+0001e3e0: 6164 6572 732c 0a20 2020 2020 2020 2020  aders,.         
+0001e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e400: 2020 2020 2065 7874 656e 7369 6f6e 4865       extensionHe
+0001e410: 6164 6572 733d 6578 7465 6e73 696f 6e48  aders=extensionH
+0001e420: 6561 6465 7273 2c20 656e 636f 6469 6e67  eaders, encoding
+0001e430: 5f74 7970 653d 656e 636f 6469 6e67 5f74  _type=encoding_t
+0001e440: 7970 6529 0a0a 2020 2020 4066 756e 6343  ype)..    @funcC
+0001e450: 6163 6865 0a20 2020 2064 6566 205f 646f  ache.    def _do
+0001e460: 776e 6c6f 6164 4669 6c65 5769 7468 4e6f  wnloadFileWithNo
+0001e470: 7469 6669 6572 2873 656c 662c 2062 7563  tifier(self, buc
+0001e480: 6b65 744e 616d 652c 206f 626a 6563 744b  ketName, objectK
+0001e490: 6579 2c20 646f 776e 6c6f 6164 4669 6c65  ey, downloadFile
+0001e4a0: 3d4e 6f6e 652c 2070 6172 7453 697a 653d  =None, partSize=
+0001e4b0: 3520 2a20 3130 3234 202a 2031 3032 342c  5 * 1024 * 1024,
+0001e4c0: 2074 6173 6b4e 756d 3d31 2c0a 2020 2020   taskNum=1,.    
+0001e4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e4e0: 2020 2020 2020 2020 2020 2020 2020 656e                en
+0001e4f0: 6162 6c65 4368 6563 6b70 6f69 6e74 3d46  ableCheckpoint=F
+0001e500: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+0001e510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e520: 2020 2020 2020 2020 6368 6563 6b70 6f69          checkpoi
+0001e530: 6e74 4669 6c65 3d4e 6f6e 652c 2068 6561  ntFile=None, hea
+0001e540: 6465 723d 4e6f 6e65 2c20 7665 7273 696f  der=None, versio
+0001e550: 6e49 643d 4e6f 6e65 2c20 7072 6f67 7265  nId=None, progre
+0001e560: 7373 4361 6c6c 6261 636b 3d4e 6f6e 652c  ssCallback=None,
+0001e570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0001e580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e5a0: 2020 2020 2020 2020 2063 6865 636b 706f           checkpo
-0001e5b0: 696e 7446 696c 652c 2068 6561 6465 722c  intFile, header,
-0001e5c0: 2076 6572 7369 6f6e 4964 2c20 7072 6f67   versionId, prog
-0001e5d0: 7265 7373 4361 6c6c 6261 636b 2c20 696d  ressCallback, im
-0001e5e0: 6167 6550 726f 6365 7373 2c0a 2020 2020  ageProcess,.    
-0001e5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e610: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
-0001e620: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-0001e630: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
-0001e640: 2020 6465 6620 646f 776e 6c6f 6164 4669    def downloadFi
-0001e650: 6c65 7328 7365 6c66 2c20 6275 636b 6574  les(self, bucket
-0001e660: 4e61 6d65 2c20 7072 6566 6978 2c20 646f  Name, prefix, do
-0001e670: 776e 6c6f 6164 466f 6c64 6572 3d4e 6f6e  wnloadFolder=Non
-0001e680: 652c 2074 6173 6b4e 756d 3d63 6f6e 7374  e, taskNum=const
-0001e690: 2e44 4546 4155 4c54 5f54 4153 4b5f 4e55  .DEFAULT_TASK_NU
-0001e6a0: 4d2c 0a20 2020 2020 2020 2020 2020 2020  M,.             
-0001e6b0: 2020 2020 2020 2020 2074 6173 6b51 7565           taskQue
-0001e6c0: 7565 5369 7a65 3d63 6f6e 7374 2e44 4546  ueSize=const.DEF
-0001e6d0: 4155 4c54 5f54 4153 4b5f 5155 4555 455f  AULT_TASK_QUEUE_
-0001e6e0: 5349 5a45 2c0a 2020 2020 2020 2020 2020  SIZE,.          
-0001e6f0: 2020 2020 2020 2020 2020 2020 6865 6164              head
-0001e700: 6572 733d 4e6f 6e65 2c20 696d 6167 6550  ers=None, imageP
-0001e710: 726f 6365 7373 3d4e 6f6e 652c 2069 6e74  rocess=None, int
-0001e720: 6572 7661 6c3d 636f 6e73 742e 4445 4641  erval=const.DEFA
-0001e730: 554c 545f 4259 5445 5f49 4e54 5445 5256  ULT_BYTE_INTTERV
-0001e740: 414c 2c0a 2020 2020 2020 2020 2020 2020  AL,.            
-0001e750: 2020 2020 2020 2020 2020 7461 736b 4361            taskCa
-0001e760: 6c6c 6261 636b 3d4e 6f6e 652c 2070 726f  llback=None, pro
-0001e770: 6772 6573 7343 616c 6c62 6163 6b3d 4e6f  gressCallback=No
-0001e780: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-0001e790: 2020 2020 2020 2020 2020 7468 7265 7368            thresh
-0001e7a0: 6f6c 643d 636f 6e73 742e 4445 4641 554c  old=const.DEFAUL
-0001e7b0: 545f 4d41 5849 4d55 4d5f 5349 5a45 2c20  T_MAXIMUM_SIZE, 
-0001e7c0: 7061 7274 5369 7a65 3d35 202a 2031 3032  partSize=5 * 102
-0001e7d0: 3420 2a20 3130 3234 2c20 7375 6254 6173  4 * 1024, subTas
-0001e7e0: 6b4e 756d 3d31 2c0a 2020 2020 2020 2020  kNum=1,.        
-0001e7f0: 2020 2020 2020 2020 2020 2020 2020 656e                en
-0001e800: 6162 6c65 4368 6563 6b70 6f69 6e74 3d46  ableCheckpoint=F
-0001e810: 616c 7365 2c20 6368 6563 6b70 6f69 6e74  alse, checkpoint
-0001e820: 4669 6c65 3d4e 6f6e 652c 2065 7874 656e  File=None, exten
-0001e830: 7369 6f6e 4865 6164 6572 733d 4e6f 6e65  sionHeaders=None
-0001e840: 293a 0a20 2020 2020 2020 2069 6620 6865  ):.        if he
-0001e850: 6164 6572 7320 6973 204e 6f6e 653a 0a20  aders is None:. 
-0001e860: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-0001e870: 7273 203d 2047 6574 4f62 6a65 6374 4865  rs = GetObjectHe
-0001e880: 6164 6572 2829 0a20 2020 2020 2020 2072  ader().        r
-0001e890: 6574 7572 6e20 5f64 6f77 6e6c 6f61 645f  eturn _download_
-0001e8a0: 6669 6c65 7328 7365 6c66 2c20 6275 636b  files(self, buck
-0001e8b0: 6574 4e61 6d65 2c20 7072 6566 6978 2c20  etName, prefix, 
-0001e8c0: 646f 776e 6c6f 6164 466f 6c64 6572 2c20  downloadFolder, 
-0001e8d0: 7461 736b 4e75 6d2c 2074 6173 6b51 7565  taskNum, taskQue
-0001e8e0: 7565 5369 7a65 2c20 6865 6164 6572 732c  ueSize, headers,
-0001e8f0: 2069 6d61 6765 5072 6f63 6573 732c 0a20   imageProcess,. 
-0001e900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e910: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0001e920: 7465 7276 616c 2c20 7461 736b 4361 6c6c  terval, taskCall
-0001e930: 6261 636b 2c20 7072 6f67 7265 7373 4361  back, progressCa
-0001e940: 6c6c 6261 636b 2c20 7468 7265 7368 6f6c  llback, threshol
-0001e950: 642c 2070 6172 7453 697a 652c 2073 7562  d, partSize, sub
-0001e960: 5461 736b 4e75 6d2c 0a20 2020 2020 2020  TaskNum,.       
-0001e970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e980: 2020 2020 2020 2020 656e 6162 6c65 4368          enableCh
-0001e990: 6563 6b70 6f69 6e74 2c20 6368 6563 6b70  eckpoint, checkp
-0001e9a0: 6f69 6e74 4669 6c65 2c20 6578 7465 6e73  ointFile, extens
-0001e9b0: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-0001e9c0: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
-0001e9d0: 2020 2320 4f45 4620 696e 7465 7266 6163    # OEF interfac
-0001e9e0: 650a 0a20 2020 2040 6675 6e63 4361 6368  e..    @funcCach
-0001e9f0: 650a 2020 2020 6465 6620 7365 7442 7563  e.    def setBuc
-0001ea00: 6b65 7446 6574 6368 506f 6c69 6379 2873  ketFetchPolicy(s
-0001ea10: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
-0001ea20: 2073 7461 7475 732c 2061 6765 6e63 792c   status, agency,
-0001ea30: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-0001ea40: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
-0001ea50: 2073 656c 662e 5f61 7373 6572 745f 6e6f   self._assert_no
-0001ea60: 745f 6e75 6c6c 2873 7461 7475 732c 2022  t_null(status, "
-0001ea70: 7374 6174 7573 2069 7320 656d 7074 7922  status is empty"
-0001ea80: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-0001ea90: 6173 7365 7274 5f6e 6f74 5f6e 756c 6c28  assert_not_null(
-0001eaa0: 6167 656e 6379 2c20 2261 6765 6e63 7920  agency, "agency 
-0001eab0: 6973 2065 6d70 7479 2229 0a20 2020 2020  is empty").     
-0001eac0: 2020 2066 6574 6368 506f 6c69 6379 203d     fetchPolicy =
-0001ead0: 2046 6574 6368 506f 6c69 6379 2873 7461   FetchPolicy(sta
-0001eae0: 7475 732c 2061 6765 6e63 7929 0a20 2020  tus, agency).   
-0001eaf0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001eb00: 2e5f 6d61 6b65 5f70 7574 5f72 6571 7565  ._make_put_reque
-0001eb10: 7374 2862 7563 6b65 744e 616d 652c 2063  st(bucketName, c
-0001eb20: 6f6e 7374 2e46 4554 4348 5f50 4f4c 4943  onst.FETCH_POLIC
-0001eb30: 595f 4b45 592c 2065 7874 656e 7369 6f6e  Y_KEY, extension
-0001eb40: 4865 6164 6572 733d 6578 7465 6e73 696f  Headers=extensio
-0001eb50: 6e48 6561 6465 7273 2c0a 2020 2020 2020  nHeaders,.      
+0001e590: 2020 2069 6d61 6765 5072 6f63 6573 733d     imageProcess=
+0001e5a0: 4e6f 6e65 2c20 6e6f 7469 6669 6572 3d70  None, notifier=p
+0001e5b0: 726f 6772 6573 732e 4e4f 4e45 5f4e 4f54  rogress.NONE_NOT
+0001e5c0: 4946 4945 522c 2065 7874 656e 7369 6f6e  IFIER, extension
+0001e5d0: 4865 6164 6572 733d 4e6f 6e65 293a 0a20  Headers=None):. 
+0001e5e0: 2020 2020 2020 2073 656c 662e 6c6f 675f         self.log_
+0001e5f0: 636c 6965 6e74 2e6c 6f67 2849 4e46 4f2c  client.log(INFO,
+0001e600: 2027 656e 7465 7220 7265 7375 6d65 2064   'enter resume d
+0001e610: 6f77 6e6c 6f61 642e 2e2e 2729 0a20 2020  ownload...').   
+0001e620: 2020 2020 2073 656c 662e 5f61 7373 6572       self._asser
+0001e630: 745f 6e6f 745f 6e75 6c6c 2862 7563 6b65  t_not_null(bucke
+0001e640: 744e 616d 652c 2027 6275 636b 6574 4e61  tName, 'bucketNa
+0001e650: 6d65 2069 7320 656d 7074 7927 290a 2020  me is empty').  
+0001e660: 2020 2020 2020 7365 6c66 2e5f 6173 7365        self._asse
+0001e670: 7274 5f6e 6f74 5f6e 756c 6c28 6f62 6a65  rt_not_null(obje
+0001e680: 6374 4b65 792c 2027 6f62 6a65 6374 4b65  ctKey, 'objectKe
+0001e690: 7920 6973 2065 6d70 7479 2729 0a20 2020  y is empty').   
+0001e6a0: 2020 2020 2069 6620 6865 6164 6572 2069       if header i
+0001e6b0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0001e6c0: 2020 2020 6865 6164 6572 203d 2047 6574      header = Get
+0001e6d0: 4f62 6a65 6374 4865 6164 6572 2829 0a20  ObjectHeader(). 
+0001e6e0: 2020 2020 2020 2069 6620 646f 776e 6c6f         if downlo
+0001e6f0: 6164 4669 6c65 2069 7320 4e6f 6e65 3a0a  adFile is None:.
+0001e700: 2020 2020 2020 2020 2020 2020 646f 776e              down
+0001e710: 6c6f 6164 4669 6c65 203d 206f 626a 6563  loadFile = objec
+0001e720: 744b 6579 0a0a 2020 2020 2020 2020 7265  tKey..        re
+0001e730: 7475 726e 205f 7265 7375 6d65 5f64 6f77  turn _resume_dow
+0001e740: 6e6c 6f61 6428 6275 636b 6574 4e61 6d65  nload(bucketName
+0001e750: 2c20 6f62 6a65 6374 4b65 792c 2064 6f77  , objectKey, dow
+0001e760: 6e6c 6f61 6446 696c 652c 2070 6172 7453  nloadFile, partS
+0001e770: 697a 652c 2074 6173 6b4e 756d 2c20 656e  ize, taskNum, en
+0001e780: 6162 6c65 4368 6563 6b70 6f69 6e74 2c0a  ableCheckpoint,.
+0001e790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e7b0: 6368 6563 6b70 6f69 6e74 4669 6c65 2c20  checkpointFile, 
+0001e7c0: 6865 6164 6572 2c20 7665 7273 696f 6e49  header, versionI
+0001e7d0: 642c 2070 726f 6772 6573 7343 616c 6c62  d, progressCallb
+0001e7e0: 6163 6b2c 2073 656c 662c 0a20 2020 2020  ack, self,.     
+0001e7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e800: 2020 2020 2020 2020 2020 2069 6d61 6765             image
+0001e810: 5072 6f63 6573 732c 206e 6f74 6966 6965  Process, notifie
+0001e820: 722c 2065 7874 656e 7369 6f6e 4865 6164  r, extensionHead
+0001e830: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
+0001e840: 6465 7273 290a 0a20 2020 2064 6566 2064  ders)..    def d
+0001e850: 6f77 6e6c 6f61 6446 696c 6528 7365 6c66  ownloadFile(self
+0001e860: 2c20 6275 636b 6574 4e61 6d65 2c20 6f62  , bucketName, ob
+0001e870: 6a65 6374 4b65 792c 2064 6f77 6e6c 6f61  jectKey, downloa
+0001e880: 6446 696c 653d 4e6f 6e65 2c20 7061 7274  dFile=None, part
+0001e890: 5369 7a65 3d35 202a 2031 3032 3420 2a20  Size=5 * 1024 * 
+0001e8a0: 3130 3234 2c20 7461 736b 4e75 6d3d 312c  1024, taskNum=1,
+0001e8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e8c0: 2020 2020 2020 656e 6162 6c65 4368 6563        enableChec
+0001e8d0: 6b70 6f69 6e74 3d46 616c 7365 2c0a 2020  kpoint=False,.  
+0001e8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8f0: 2020 2063 6865 636b 706f 696e 7446 696c     checkpointFil
+0001e900: 653d 4e6f 6e65 2c20 6865 6164 6572 3d4e  e=None, header=N
+0001e910: 6f6e 652c 2076 6572 7369 6f6e 4964 3d4e  one, versionId=N
+0001e920: 6f6e 652c 2070 726f 6772 6573 7343 616c  one, progressCal
+0001e930: 6c62 6163 6b3d 4e6f 6e65 2c20 696d 6167  lback=None, imag
+0001e940: 6550 726f 6365 7373 3d4e 6f6e 652c 0a20  eProcess=None,. 
+0001e950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e960: 2020 2020 6578 7465 6e73 696f 6e48 6561      extensionHea
+0001e970: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
+0001e980: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001e990: 5f64 6f77 6e6c 6f61 6446 696c 6557 6974  _downloadFileWit
+0001e9a0: 684e 6f74 6966 6965 7228 6275 636b 6574  hNotifier(bucket
+0001e9b0: 4e61 6d65 2c20 6f62 6a65 6374 4b65 792c  Name, objectKey,
+0001e9c0: 2064 6f77 6e6c 6f61 6446 696c 652c 2070   downloadFile, p
+0001e9d0: 6172 7453 697a 652c 2074 6173 6b4e 756d  artSize, taskNum
+0001e9e0: 2c20 656e 6162 6c65 4368 6563 6b70 6f69  , enableCheckpoi
+0001e9f0: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
+0001ea00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea20: 2020 6368 6563 6b70 6f69 6e74 4669 6c65    checkpointFile
+0001ea30: 2c20 6865 6164 6572 2c20 7665 7273 696f  , header, versio
+0001ea40: 6e49 642c 2070 726f 6772 6573 7343 616c  nId, progressCal
+0001ea50: 6c62 6163 6b2c 2069 6d61 6765 5072 6f63  lback, imageProc
+0001ea60: 6573 732c 0a20 2020 2020 2020 2020 2020  ess,.           
+0001ea70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea90: 2020 2065 7874 656e 7369 6f6e 4865 6164     extensionHead
+0001eaa0: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
+0001eab0: 6465 7273 290a 0a20 2020 2064 6566 2064  ders)..    def d
+0001eac0: 6f77 6e6c 6f61 6446 696c 6573 2873 656c  ownloadFiles(sel
+0001ead0: 662c 2062 7563 6b65 744e 616d 652c 2070  f, bucketName, p
+0001eae0: 7265 6669 782c 2064 6f77 6e6c 6f61 6446  refix, downloadF
+0001eaf0: 6f6c 6465 723d 4e6f 6e65 2c20 7461 736b  older=None, task
+0001eb00: 4e75 6d3d 636f 6e73 742e 4445 4641 554c  Num=const.DEFAUL
+0001eb10: 545f 5441 534b 5f4e 554d 2c0a 2020 2020  T_TASK_NUM,.    
+0001eb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eb30: 2020 7461 736b 5175 6575 6553 697a 653d    taskQueueSize=
+0001eb40: 636f 6e73 742e 4445 4641 554c 545f 5441  const.DEFAULT_TA
+0001eb50: 534b 5f51 5545 5545 5f53 495a 452c 0a20  SK_QUEUE_SIZE,. 
 0001eb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb80: 2a2a 7365 6c66 2e63 6f6e 7665 7274 6f72  **self.convertor
-0001eb90: 2e74 7261 6e73 5f73 6574 5f62 7563 6b65  .trans_set_bucke
-0001eba0: 745f 6665 7463 685f 706f 6c69 6379 2866  t_fetch_policy(f
-0001ebb0: 6574 6368 506f 6c69 6379 2929 0a0a 2020  etchPolicy))..  
-0001ebc0: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
-0001ebd0: 2064 6566 2067 6574 4275 636b 6574 4665   def getBucketFe
-0001ebe0: 7463 6850 6f6c 6963 7928 7365 6c66 2c20  tchPolicy(self, 
-0001ebf0: 6275 636b 6574 4e61 6d65 2c20 6578 7465  bucketName, exte
-0001ec00: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
-0001ec10: 6529 3a0a 2020 2020 2020 2020 6865 6164  e):.        head
-0001ec20: 6572 7320 3d20 7b73 656c 662e 6861 2e6f  ers = {self.ha.o
-0001ec30: 6566 5f6d 6172 6b65 725f 6865 6164 6572  ef_marker_header
-0001ec40: 2829 3a20 2279 6573 227d 0a20 2020 2020  (): "yes"}.     
-0001ec50: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0001ec60: 6d61 6b65 5f67 6574 5f72 6571 7565 7374  make_get_request
-0001ec70: 2862 7563 6b65 744e 616d 652c 2063 6f6e  (bucketName, con
-0001ec80: 7374 2e46 4554 4348 5f50 4f4c 4943 595f  st.FETCH_POLICY_
-0001ec90: 4b45 592c 206d 6574 686f 644e 616d 653d  KEY, methodName=
-0001eca0: 2267 6574 4275 636b 6574 4665 7463 6850  "getBucketFetchP
-0001ecb0: 6f6c 6963 7922 2c0a 2020 2020 2020 2020  olicy",.        
-0001ecc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ecd0: 2020 2020 2020 2020 2020 2020 2020 6865                he
-0001ece0: 6164 6572 733d 6865 6164 6572 732c 2065  aders=headers, e
-0001ecf0: 7874 656e 7369 6f6e 4865 6164 6572 733d  xtensionHeaders=
-0001ed00: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
-0001ed10: 290a 0a20 2020 2040 6675 6e63 4361 6368  )..    @funcCach
-0001ed20: 650a 2020 2020 6465 6620 6465 6c65 7465  e.    def delete
-0001ed30: 4275 636b 6574 4665 7463 6850 6f6c 6963  BucketFetchPolic
-0001ed40: 7928 7365 6c66 2c20 6275 636b 6574 4e61  y(self, bucketNa
-0001ed50: 6d65 2c20 6578 7465 6e73 696f 6e48 6561  me, extensionHea
-0001ed60: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
-0001ed70: 2020 2020 6865 6164 6572 7320 3d20 7b73      headers = {s
-0001ed80: 656c 662e 6861 2e6f 6566 5f6d 6172 6b65  elf.ha.oef_marke
-0001ed90: 725f 6865 6164 6572 2829 3a20 2279 6573  r_header(): "yes
-0001eda0: 227d 0a20 2020 2020 2020 2072 6574 7572  "}.        retur
-0001edb0: 6e20 7365 6c66 2e5f 6d61 6b65 5f64 656c  n self._make_del
-0001edc0: 6574 655f 7265 7175 6573 7428 6275 636b  ete_request(buck
-0001edd0: 6574 4e61 6d65 2c20 636f 6e73 742e 4645  etName, const.FE
-0001ede0: 5443 485f 504f 4c49 4359 5f4b 4559 2c20  TCH_POLICY_KEY, 
-0001edf0: 6865 6164 6572 733d 6865 6164 6572 732c  headers=headers,
-0001ee00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ee10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee20: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
-0001ee30: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
-0001ee40: 7369 6f6e 4865 6164 6572 7329 0a0a 2020  sionHeaders)..  
-0001ee50: 2020 4066 756e 6343 6163 6865 0a20 2020    @funcCache.   
-0001ee60: 2064 6566 2073 6574 4275 636b 6574 4665   def setBucketFe
-0001ee70: 7463 684a 6f62 2873 656c 662c 2062 7563  tchJob(self, buc
-0001ee80: 6b65 744e 616d 652c 2075 726c 2c20 686f  ketName, url, ho
-0001ee90: 7374 3d4e 6f6e 652c 206b 6579 3d4e 6f6e  st=None, key=Non
-0001eea0: 652c 206d 6435 3d4e 6f6e 652c 2063 616c  e, md5=None, cal
-0001eeb0: 6c42 6163 6b55 726c 3d4e 6f6e 652c 0a20  lBackUrl=None,. 
-0001eec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eed0: 2020 2020 2020 2020 2063 616c 6c42 6163           callBac
-0001eee0: 6b42 6f64 793d 4e6f 6e65 2c20 6361 6c6c  kBody=None, call
-0001eef0: 4261 636b 426f 6479 5479 7065 3d4e 6f6e  BackBodyType=Non
-0001ef00: 652c 2063 616c 6c42 6163 6b48 6f73 743d  e, callBackHost=
-0001ef10: 4e6f 6e65 2c20 6669 6c65 5479 7065 3d4e  None, fileType=N
-0001ef20: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-0001ef30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001ef40: 676e 6f72 6553 616d 654b 6579 3d46 616c  gnoreSameKey=Fal
-0001ef50: 7365 2c20 6f62 6a65 6374 4865 6164 6572  se, objectHeader
-0001ef60: 733d 4e6f 6e65 2c20 6574 6167 3d4e 6f6e  s=None, etag=Non
-0001ef70: 652c 2074 7275 7374 4e61 6d65 3d4e 6f6e  e, trustName=Non
-0001ef80: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
-0001ef90: 6572 733d 4e6f 6e65 293a 0a20 2020 2020  ers=None):.     
-0001efa0: 2020 2073 656c 662e 5f61 7373 6572 745f     self._assert_
-0001efb0: 6e6f 745f 6e75 6c6c 2875 726c 2c20 2275  not_null(url, "u
-0001efc0: 726c 2069 7320 656d 7074 7922 290a 2020  rl is empty").  
-0001efd0: 2020 2020 2020 6665 7463 684a 6f62 203d        fetchJob =
-0001efe0: 205f 4665 7463 684a 6f62 2875 726c 3d75   _FetchJob(url=u
-0001eff0: 726c 2c20 686f 7374 3d68 6f73 742c 2062  rl, host=host, b
-0001f000: 7563 6b65 743d 6275 636b 6574 4e61 6d65  ucket=bucketName
-0001f010: 2c20 6b65 793d 6b65 792c 206d 6435 3d6d  , key=key, md5=m
-0001f020: 6435 2c20 6361 6c6c 4261 636b 5572 6c3d  d5, callBackUrl=
-0001f030: 6361 6c6c 4261 636b 5572 6c2c 0a20 2020  callBackUrl,.   
-0001f040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f050: 2020 2020 2020 2020 2020 6361 6c6c 4261            callBa
-0001f060: 636b 426f 6479 3d63 616c 6c42 6163 6b42  ckBody=callBackB
-0001f070: 6f64 792c 2063 616c 6c42 6163 6b42 6f64  ody, callBackBod
-0001f080: 7954 7970 653d 6361 6c6c 4261 636b 426f  yType=callBackBo
-0001f090: 6479 5479 7065 2c20 6361 6c6c 4261 636b  dyType, callBack
-0001f0a0: 486f 7374 3d63 616c 6c42 6163 6b48 6f73  Host=callBackHos
-0001f0b0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-0001f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f0d0: 6669 6c65 5479 7065 3d66 696c 6554 7970  fileType=fileTyp
-0001f0e0: 652c 2069 676e 6f72 6553 616d 654b 6579  e, ignoreSameKey
-0001f0f0: 3d69 676e 6f72 6553 616d 654b 6579 2c20  =ignoreSameKey, 
-0001f100: 6f62 6a65 6374 4865 6164 6572 733d 6f62  objectHeaders=ob
-0001f110: 6a65 6374 4865 6164 6572 732c 2065 7461  jectHeaders, eta
-0001f120: 673d 6574 6167 2c0a 2020 2020 2020 2020  g=etag,.        
-0001f130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f140: 2020 2020 2074 7275 7374 4e61 6d65 3d74       trustName=t
-0001f150: 7275 7374 4e61 6d65 290a 2020 2020 2020  rustName).      
-0001f160: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
-0001f170: 616b 655f 706f 7374 5f72 6571 7565 7374  ake_post_request
-0001f180: 2862 7563 6b65 744e 616d 652c 2063 6f6e  (bucketName, con
-0001f190: 7374 2e46 4554 4348 5f4a 4f42 5f4b 4559  st.FETCH_JOB_KEY
-0001f1a0: 2c20 6d65 7468 6f64 4e61 6d65 3d22 7365  , methodName="se
-0001f1b0: 7442 7563 6b65 7446 6574 6368 4a6f 6222  tBucketFetchJob"
-0001f1c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001f1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f1e0: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
-0001f1f0: 6f6e 4865 6164 6572 733d 6578 7465 6e73  onHeaders=extens
-0001f200: 696f 6e48 6561 6465 7273 2c0a 2020 2020  ionHeaders,.    
-0001f210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f230: 2020 202a 2a73 656c 662e 636f 6e76 6572     **self.conver
-0001f240: 746f 722e 7472 616e 735f 7365 745f 6275  tor.trans_set_bu
-0001f250: 636b 6574 5f66 6574 6368 5f6a 6f62 2866  cket_fetch_job(f
-0001f260: 6574 6368 4a6f 6229 290a 0a20 2020 2040  etchJob))..    @
-0001f270: 6675 6e63 4361 6368 650a 2020 2020 6465  funcCache.    de
-0001f280: 6620 6765 7442 7563 6b65 7446 6574 6368  f getBucketFetch
-0001f290: 4a6f 6228 7365 6c66 2c20 6275 636b 6574  Job(self, bucket
-0001f2a0: 4e61 6d65 2c20 6a6f 6249 642c 2065 7874  Name, jobId, ext
-0001f2b0: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
-0001f2c0: 6e65 293a 0a20 2020 2020 2020 2073 656c  ne):.        sel
-0001f2d0: 662e 5f61 7373 6572 745f 6e6f 745f 6e75  f._assert_not_nu
-0001f2e0: 6c6c 286a 6f62 4964 2c20 226a 6f62 4964  ll(jobId, "jobId
-0001f2f0: 2069 7320 656d 7074 7922 290a 2020 2020   is empty").    
-0001f300: 2020 2020 6865 6164 6572 7320 3d20 7b73      headers = {s
-0001f310: 656c 662e 6861 2e6f 6566 5f6d 6172 6b65  elf.ha.oef_marke
-0001f320: 725f 6865 6164 6572 2829 3a20 2279 6573  r_header(): "yes
-0001f330: 227d 0a20 2020 2020 2020 206b 6579 203d  "}.        key =
-0001f340: 2063 6f6e 7374 2e46 4554 4348 5f4a 4f42   const.FETCH_JOB
-0001f350: 5f4b 4559 202b 2022 2f22 202b 206a 6f62  _KEY + "/" + job
-0001f360: 4964 0a20 2020 2020 2020 2072 6574 7572  Id.        retur
-0001f370: 6e20 7365 6c66 2e5f 6d61 6b65 5f67 6574  n self._make_get
-0001f380: 5f72 6571 7565 7374 2862 7563 6b65 744e  _request(bucketN
-0001f390: 616d 652c 206b 6579 2c20 6d65 7468 6f64  ame, key, method
-0001f3a0: 4e61 6d65 3d22 6765 7442 7563 6b65 7446  Name="getBucketF
-0001f3b0: 6574 6368 4a6f 6222 2c20 6865 6164 6572  etchJob", header
-0001f3c0: 733d 6865 6164 6572 732c 0a20 2020 2020  s=headers,.     
-0001f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f3f0: 2065 7874 656e 7369 6f6e 4865 6164 6572   extensionHeader
-0001f400: 733d 6578 7465 6e73 696f 6e48 6561 6465  s=extensionHeade
-0001f410: 7273 290a 0a0a 4f62 7343 6c69 656e 742e  rs)...ObsClient.
-0001f420: 7365 7442 7563 6b65 7456 6572 7369 6f6e  setBucketVersion
-0001f430: 696e 6743 6f6e 6669 6775 7261 7469 6f6e  ingConfiguration
-0001f440: 203d 204f 6273 436c 6965 6e74 2e73 6574   = ObsClient.set
-0001f450: 4275 636b 6574 5665 7273 696f 6e69 6e67  BucketVersioning
-0001f460: 0a4f 6273 436c 6965 6e74 2e67 6574 4275  .ObsClient.getBu
-0001f470: 636b 6574 5665 7273 696f 6e69 6e67 436f  cketVersioningCo
-0001f480: 6e66 6967 7572 6174 696f 6e20 3d20 4f62  nfiguration = Ob
-0001f490: 7343 6c69 656e 742e 6765 7442 7563 6b65  sClient.getBucke
-0001f4a0: 7456 6572 7369 6f6e 696e 670a 4f62 7343  tVersioning.ObsC
-0001f4b0: 6c69 656e 742e 6465 6c65 7465 4275 636b  lient.deleteBuck
-0001f4c0: 6574 4c69 6665 6379 636c 6543 6f6e 6669  etLifecycleConfi
-0001f4d0: 6775 7261 7469 6f6e 203d 204f 6273 436c  guration = ObsCl
-0001f4e0: 6965 6e74 2e64 656c 6574 6542 7563 6b65  ient.deleteBucke
-0001f4f0: 744c 6966 6563 7963 6c65 0a4f 6273 436c  tLifecycle.ObsCl
-0001f500: 6965 6e74 2e73 6574 4275 636b 6574 4c69  ient.setBucketLi
-0001f510: 6665 6379 636c 6543 6f6e 6669 6775 7261  fecycleConfigura
-0001f520: 7469 6f6e 203d 204f 6273 436c 6965 6e74  tion = ObsClient
-0001f530: 2e73 6574 4275 636b 6574 4c69 6665 6379  .setBucketLifecy
-0001f540: 636c 650a 4f62 7343 6c69 656e 742e 6765  cle.ObsClient.ge
-0001f550: 7442 7563 6b65 744c 6966 6563 7963 6c65  tBucketLifecycle
-0001f560: 436f 6e66 6967 7572 6174 696f 6e20 3d20  Configuration = 
-0001f570: 4f62 7343 6c69 656e 742e 6765 7442 7563  ObsClient.getBuc
-0001f580: 6b65 744c 6966 6563 7963 6c65 0a4f 6273  ketLifecycle.Obs
-0001f590: 436c 6965 6e74 2e67 6574 4275 636b 6574  Client.getBucket
-0001f5a0: 5765 6273 6974 6543 6f6e 6669 6775 7261  WebsiteConfigura
-0001f5b0: 7469 6f6e 203d 204f 6273 436c 6965 6e74  tion = ObsClient
-0001f5c0: 2e67 6574 4275 636b 6574 5765 6273 6974  .getBucketWebsit
-0001f5d0: 650a 4f62 7343 6c69 656e 742e 7365 7442  e.ObsClient.setB
-0001f5e0: 7563 6b65 7457 6562 7369 7465 436f 6e66  ucketWebsiteConf
-0001f5f0: 6967 7572 6174 696f 6e20 3d20 4f62 7343  iguration = ObsC
-0001f600: 6c69 656e 742e 7365 7442 7563 6b65 7457  lient.setBucketW
-0001f610: 6562 7369 7465 0a4f 6273 436c 6965 6e74  ebsite.ObsClient
-0001f620: 2e64 656c 6574 6542 7563 6b65 7457 6562  .deleteBucketWeb
-0001f630: 7369 7465 436f 6e66 6967 7572 6174 696f  siteConfiguratio
-0001f640: 6e20 3d20 4f62 7343 6c69 656e 742e 6465  n = ObsClient.de
-0001f650: 6c65 7465 4275 636b 6574 5765 6273 6974  leteBucketWebsit
-0001f660: 650a 4f62 7343 6c69 656e 742e 7365 7442  e.ObsClient.setB
-0001f670: 7563 6b65 744c 6f67 6769 6e67 436f 6e66  ucketLoggingConf
-0001f680: 6967 7572 6174 696f 6e20 3d20 4f62 7343  iguration = ObsC
-0001f690: 6c69 656e 742e 7365 7442 7563 6b65 744c  lient.setBucketL
-0001f6a0: 6f67 6769 6e67 0a4f 6273 436c 6965 6e74  ogging.ObsClient
-0001f6b0: 2e67 6574 4275 636b 6574 4c6f 6767 696e  .getBucketLoggin
-0001f6c0: 6743 6f6e 6669 6775 7261 7469 6f6e 203d  gConfiguration =
-0001f6d0: 204f 6273 436c 6965 6e74 2e67 6574 4275   ObsClient.getBu
-0001f6e0: 636b 6574 4c6f 6767 696e 670a            cketLogging.
+0001eb70: 2020 2020 2068 6561 6465 7273 3d4e 6f6e       headers=Non
+0001eb80: 652c 2069 6d61 6765 5072 6f63 6573 733d  e, imageProcess=
+0001eb90: 4e6f 6e65 2c20 696e 7465 7276 616c 3d63  None, interval=c
+0001eba0: 6f6e 7374 2e44 4546 4155 4c54 5f42 5954  onst.DEFAULT_BYT
+0001ebb0: 455f 494e 5454 4552 5641 4c2c 0a20 2020  E_INTTERVAL,.   
+0001ebc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ebd0: 2020 2074 6173 6b43 616c 6c62 6163 6b3d     taskCallback=
+0001ebe0: 4e6f 6e65 2c20 7072 6f67 7265 7373 4361  None, progressCa
+0001ebf0: 6c6c 6261 636b 3d4e 6f6e 652c 0a20 2020  llback=None,.   
+0001ec00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec10: 2020 2074 6872 6573 686f 6c64 3d63 6f6e     threshold=con
+0001ec20: 7374 2e44 4546 4155 4c54 5f4d 4158 494d  st.DEFAULT_MAXIM
+0001ec30: 554d 5f53 495a 452c 2070 6172 7453 697a  UM_SIZE, partSiz
+0001ec40: 653d 3520 2a20 3130 3234 202a 2031 3032  e=5 * 1024 * 102
+0001ec50: 342c 2073 7562 5461 736b 4e75 6d3d 312c  4, subTaskNum=1,
+0001ec60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ec70: 2020 2020 2020 2065 6e61 626c 6543 6865         enableChe
+0001ec80: 636b 706f 696e 743d 4661 6c73 652c 2063  ckpoint=False, c
+0001ec90: 6865 636b 706f 696e 7446 696c 653d 4e6f  heckpointFile=No
+0001eca0: 6e65 2c20 6578 7465 6e73 696f 6e48 6561  ne, extensionHea
+0001ecb0: 6465 7273 3d4e 6f6e 6529 3a0a 2020 2020  ders=None):.    
+0001ecc0: 2020 2020 6966 2068 6561 6465 7273 2069      if headers i
+0001ecd0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0001ece0: 2020 2020 6865 6164 6572 7320 3d20 4765      headers = Ge
+0001ecf0: 744f 626a 6563 7448 6561 6465 7228 290a  tObjectHeader().
+0001ed00: 2020 2020 2020 2020 7265 7475 726e 205f          return _
+0001ed10: 646f 776e 6c6f 6164 5f66 696c 6573 2873  download_files(s
+0001ed20: 656c 662c 2062 7563 6b65 744e 616d 652c  elf, bucketName,
+0001ed30: 2070 7265 6669 782c 2064 6f77 6e6c 6f61   prefix, downloa
+0001ed40: 6446 6f6c 6465 722c 2074 6173 6b4e 756d  dFolder, taskNum
+0001ed50: 2c20 7461 736b 5175 6575 6553 697a 652c  , taskQueueSize,
+0001ed60: 2068 6561 6465 7273 2c20 696d 6167 6550   headers, imageP
+0001ed70: 726f 6365 7373 2c0a 2020 2020 2020 2020  rocess,.        
+0001ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed90: 2020 2020 2020 2069 6e74 6572 7661 6c2c         interval,
+0001eda0: 2074 6173 6b43 616c 6c62 6163 6b2c 2070   taskCallback, p
+0001edb0: 726f 6772 6573 7343 616c 6c62 6163 6b2c  rogressCallback,
+0001edc0: 2074 6872 6573 686f 6c64 2c20 7061 7274   threshold, part
+0001edd0: 5369 7a65 2c20 7375 6254 6173 6b4e 756d  Size, subTaskNum
+0001ede0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001edf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee00: 2065 6e61 626c 6543 6865 636b 706f 696e   enableCheckpoin
+0001ee10: 742c 2063 6865 636b 706f 696e 7446 696c  t, checkpointFil
+0001ee20: 652c 2065 7874 656e 7369 6f6e 4865 6164  e, extensionHead
+0001ee30: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
+0001ee40: 6465 7273 290a 0a20 2020 2023 204f 4546  ders)..    # OEF
+0001ee50: 2069 6e74 6572 6661 6365 0a0a 2020 2020   interface..    
+0001ee60: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
+0001ee70: 6566 2073 6574 4275 636b 6574 4665 7463  ef setBucketFetc
+0001ee80: 6850 6f6c 6963 7928 7365 6c66 2c20 6275  hPolicy(self, bu
+0001ee90: 636b 6574 4e61 6d65 2c20 7374 6174 7573  cketName, status
+0001eea0: 2c20 6167 656e 6379 2c20 6578 7465 6e73  , agency, extens
+0001eeb0: 696f 6e48 6561 6465 7273 3d4e 6f6e 6529  ionHeaders=None)
+0001eec0: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
+0001eed0: 6173 7365 7274 5f6e 6f74 5f6e 756c 6c28  assert_not_null(
+0001eee0: 7374 6174 7573 2c20 2273 7461 7475 7320  status, "status 
+0001eef0: 6973 2065 6d70 7479 2229 0a20 2020 2020  is empty").     
+0001ef00: 2020 2073 656c 662e 5f61 7373 6572 745f     self._assert_
+0001ef10: 6e6f 745f 6e75 6c6c 2861 6765 6e63 792c  not_null(agency,
+0001ef20: 2022 6167 656e 6379 2069 7320 656d 7074   "agency is empt
+0001ef30: 7922 290a 2020 2020 2020 2020 6665 7463  y").        fetc
+0001ef40: 6850 6f6c 6963 7920 3d20 4665 7463 6850  hPolicy = FetchP
+0001ef50: 6f6c 6963 7928 7374 6174 7573 2c20 6167  olicy(status, ag
+0001ef60: 656e 6379 290a 2020 2020 2020 2020 7265  ency).        re
+0001ef70: 7475 726e 2073 656c 662e 5f6d 616b 655f  turn self._make_
+0001ef80: 7075 745f 7265 7175 6573 7428 6275 636b  put_request(buck
+0001ef90: 6574 4e61 6d65 2c20 636f 6e73 742e 4645  etName, const.FE
+0001efa0: 5443 485f 504f 4c49 4359 5f4b 4559 2c20  TCH_POLICY_KEY, 
+0001efb0: 6578 7465 6e73 696f 6e48 6561 6465 7273  extensionHeaders
+0001efc0: 3d65 7874 656e 7369 6f6e 4865 6164 6572  =extensionHeader
+0001efd0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0001efe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eff0: 2020 2020 2020 2020 202a 2a73 656c 662e           **self.
+0001f000: 636f 6e76 6572 746f 722e 7472 616e 735f  convertor.trans_
+0001f010: 7365 745f 6275 636b 6574 5f66 6574 6368  set_bucket_fetch
+0001f020: 5f70 6f6c 6963 7928 6665 7463 6850 6f6c  _policy(fetchPol
+0001f030: 6963 7929 290a 0a20 2020 2040 6675 6e63  icy))..    @func
+0001f040: 4361 6368 650a 2020 2020 6465 6620 6765  Cache.    def ge
+0001f050: 7442 7563 6b65 7446 6574 6368 506f 6c69  tBucketFetchPoli
+0001f060: 6379 2873 656c 662c 2062 7563 6b65 744e  cy(self, bucketN
+0001f070: 616d 652c 2065 7874 656e 7369 6f6e 4865  ame, extensionHe
+0001f080: 6164 6572 733d 4e6f 6e65 293a 0a20 2020  aders=None):.   
+0001f090: 2020 2020 2068 6561 6465 7273 203d 207b       headers = {
+0001f0a0: 7365 6c66 2e68 612e 6f65 665f 6d61 726b  self.ha.oef_mark
+0001f0b0: 6572 5f68 6561 6465 7228 293a 2022 7965  er_header(): "ye
+0001f0c0: 7322 7d0a 2020 2020 2020 2020 7265 7475  s"}.        retu
+0001f0d0: 726e 2073 656c 662e 5f6d 616b 655f 6765  rn self._make_ge
+0001f0e0: 745f 7265 7175 6573 7428 6275 636b 6574  t_request(bucket
+0001f0f0: 4e61 6d65 2c20 636f 6e73 742e 4645 5443  Name, const.FETC
+0001f100: 485f 504f 4c49 4359 5f4b 4559 2c20 6d65  H_POLICY_KEY, me
+0001f110: 7468 6f64 4e61 6d65 3d22 6765 7442 7563  thodName="getBuc
+0001f120: 6b65 7446 6574 6368 506f 6c69 6379 222c  ketFetchPolicy",
+0001f130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f150: 2020 2020 2020 2068 6561 6465 7273 3d68         headers=h
+0001f160: 6561 6465 7273 2c20 6578 7465 6e73 696f  eaders, extensio
+0001f170: 6e48 6561 6465 7273 3d65 7874 656e 7369  nHeaders=extensi
+0001f180: 6f6e 4865 6164 6572 7329 0a0a 2020 2020  onHeaders)..    
+0001f190: 4066 756e 6343 6163 6865 0a20 2020 2064  @funcCache.    d
+0001f1a0: 6566 2064 656c 6574 6542 7563 6b65 7446  ef deleteBucketF
+0001f1b0: 6574 6368 506f 6c69 6379 2873 656c 662c  etchPolicy(self,
+0001f1c0: 2062 7563 6b65 744e 616d 652c 2065 7874   bucketName, ext
+0001f1d0: 656e 7369 6f6e 4865 6164 6572 733d 4e6f  ensionHeaders=No
+0001f1e0: 6e65 293a 0a20 2020 2020 2020 2068 6561  ne):.        hea
+0001f1f0: 6465 7273 203d 207b 7365 6c66 2e68 612e  ders = {self.ha.
+0001f200: 6f65 665f 6d61 726b 6572 5f68 6561 6465  oef_marker_heade
+0001f210: 7228 293a 2022 7965 7322 7d0a 2020 2020  r(): "yes"}.    
+0001f220: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001f230: 5f6d 616b 655f 6465 6c65 7465 5f72 6571  _make_delete_req
+0001f240: 7565 7374 2862 7563 6b65 744e 616d 652c  uest(bucketName,
+0001f250: 2063 6f6e 7374 2e46 4554 4348 5f50 4f4c   const.FETCH_POL
+0001f260: 4943 595f 4b45 592c 2068 6561 6465 7273  ICY_KEY, headers
+0001f270: 3d68 6561 6465 7273 2c0a 2020 2020 2020  =headers,.      
+0001f280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f2a0: 2020 2065 7874 656e 7369 6f6e 4865 6164     extensionHead
+0001f2b0: 6572 733d 6578 7465 6e73 696f 6e48 6561  ers=extensionHea
+0001f2c0: 6465 7273 290a 0a20 2020 2040 6675 6e63  ders)..    @func
+0001f2d0: 4361 6368 650a 2020 2020 6465 6620 7365  Cache.    def se
+0001f2e0: 7442 7563 6b65 7446 6574 6368 4a6f 6228  tBucketFetchJob(
+0001f2f0: 7365 6c66 2c20 6275 636b 6574 4e61 6d65  self, bucketName
+0001f300: 2c20 7572 6c2c 2068 6f73 743d 4e6f 6e65  , url, host=None
+0001f310: 2c20 6b65 793d 4e6f 6e65 2c20 6d64 353d  , key=None, md5=
+0001f320: 4e6f 6e65 2c20 6361 6c6c 4261 636b 5572  None, callBackUr
+0001f330: 6c3d 4e6f 6e65 2c0a 2020 2020 2020 2020  l=None,.        
+0001f340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f350: 2020 6361 6c6c 4261 636b 426f 6479 3d4e    callBackBody=N
+0001f360: 6f6e 652c 2063 616c 6c42 6163 6b42 6f64  one, callBackBod
+0001f370: 7954 7970 653d 4e6f 6e65 2c20 6361 6c6c  yType=None, call
+0001f380: 4261 636b 486f 7374 3d4e 6f6e 652c 2066  BackHost=None, f
+0001f390: 696c 6554 7970 653d 4e6f 6e65 2c0a 2020  ileType=None,.  
+0001f3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f3b0: 2020 2020 2020 2020 6967 6e6f 7265 5361          ignoreSa
+0001f3c0: 6d65 4b65 793d 4661 6c73 652c 206f 626a  meKey=False, obj
+0001f3d0: 6563 7448 6561 6465 7273 3d4e 6f6e 652c  ectHeaders=None,
+0001f3e0: 2065 7461 673d 4e6f 6e65 2c20 7472 7573   etag=None, trus
+0001f3f0: 744e 616d 653d 4e6f 6e65 2c20 6578 7465  tName=None, exte
+0001f400: 6e73 696f 6e48 6561 6465 7273 3d4e 6f6e  nsionHeaders=Non
+0001f410: 6529 3a0a 2020 2020 2020 2020 7365 6c66  e):.        self
+0001f420: 2e5f 6173 7365 7274 5f6e 6f74 5f6e 756c  ._assert_not_nul
+0001f430: 6c28 7572 6c2c 2022 7572 6c20 6973 2065  l(url, "url is e
+0001f440: 6d70 7479 2229 0a20 2020 2020 2020 2066  mpty").        f
+0001f450: 6574 6368 4a6f 6220 3d20 5f46 6574 6368  etchJob = _Fetch
+0001f460: 4a6f 6228 7572 6c3d 7572 6c2c 2068 6f73  Job(url=url, hos
+0001f470: 743d 686f 7374 2c20 6275 636b 6574 3d62  t=host, bucket=b
+0001f480: 7563 6b65 744e 616d 652c 206b 6579 3d6b  ucketName, key=k
+0001f490: 6579 2c20 6d64 353d 6d64 352c 2063 616c  ey, md5=md5, cal
+0001f4a0: 6c42 6163 6b55 726c 3d63 616c 6c42 6163  lBackUrl=callBac
+0001f4b0: 6b55 726c 2c0a 2020 2020 2020 2020 2020  kUrl,.          
+0001f4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4d0: 2020 2063 616c 6c42 6163 6b42 6f64 793d     callBackBody=
+0001f4e0: 6361 6c6c 4261 636b 426f 6479 2c20 6361  callBackBody, ca
+0001f4f0: 6c6c 4261 636b 426f 6479 5479 7065 3d63  llBackBodyType=c
+0001f500: 616c 6c42 6163 6b42 6f64 7954 7970 652c  allBackBodyType,
+0001f510: 2063 616c 6c42 6163 6b48 6f73 743d 6361   callBackHost=ca
+0001f520: 6c6c 4261 636b 486f 7374 2c0a 2020 2020  llBackHost,.    
+0001f530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f540: 2020 2020 2020 2020 2066 696c 6554 7970           fileTyp
+0001f550: 653d 6669 6c65 5479 7065 2c20 6967 6e6f  e=fileType, igno
+0001f560: 7265 5361 6d65 4b65 793d 6967 6e6f 7265  reSameKey=ignore
+0001f570: 5361 6d65 4b65 792c 206f 626a 6563 7448  SameKey, objectH
+0001f580: 6561 6465 7273 3d6f 626a 6563 7448 6561  eaders=objectHea
+0001f590: 6465 7273 2c20 6574 6167 3d65 7461 672c  ders, etag=etag,
+0001f5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f5b0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+0001f5c0: 7573 744e 616d 653d 7472 7573 744e 616d  ustName=trustNam
+0001f5d0: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
+0001f5e0: 6e20 7365 6c66 2e5f 6d61 6b65 5f70 6f73  n self._make_pos
+0001f5f0: 745f 7265 7175 6573 7428 6275 636b 6574  t_request(bucket
+0001f600: 4e61 6d65 2c20 636f 6e73 742e 4645 5443  Name, const.FETC
+0001f610: 485f 4a4f 425f 4b45 592c 206d 6574 686f  H_JOB_KEY, metho
+0001f620: 644e 616d 653d 2273 6574 4275 636b 6574  dName="setBucket
+0001f630: 4665 7463 684a 6f62 222c 0a20 2020 2020  FetchJob",.     
+0001f640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f660: 2020 6578 7465 6e73 696f 6e48 6561 6465    extensionHeade
+0001f670: 7273 3d65 7874 656e 7369 6f6e 4865 6164  rs=extensionHead
+0001f680: 6572 732c 0a20 2020 2020 2020 2020 2020  ers,.           
+0001f690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f6a0: 2020 2020 2020 2020 2020 2020 2a2a 7365              **se
+0001f6b0: 6c66 2e63 6f6e 7665 7274 6f72 2e74 7261  lf.convertor.tra
+0001f6c0: 6e73 5f73 6574 5f62 7563 6b65 745f 6665  ns_set_bucket_fe
+0001f6d0: 7463 685f 6a6f 6228 6665 7463 684a 6f62  tch_job(fetchJob
+0001f6e0: 2929 0a0a 2020 2020 4066 756e 6343 6163  ))..    @funcCac
+0001f6f0: 6865 0a20 2020 2064 6566 2067 6574 4275  he.    def getBu
+0001f700: 636b 6574 4665 7463 684a 6f62 2873 656c  cketFetchJob(sel
+0001f710: 662c 2062 7563 6b65 744e 616d 652c 206a  f, bucketName, j
+0001f720: 6f62 4964 2c20 6578 7465 6e73 696f 6e48  obId, extensionH
+0001f730: 6561 6465 7273 3d4e 6f6e 6529 3a0a 2020  eaders=None):.  
+0001f740: 2020 2020 2020 7365 6c66 2e5f 6173 7365        self._asse
+0001f750: 7274 5f6e 6f74 5f6e 756c 6c28 6a6f 6249  rt_not_null(jobI
+0001f760: 642c 2022 6a6f 6249 6420 6973 2065 6d70  d, "jobId is emp
+0001f770: 7479 2229 0a20 2020 2020 2020 2068 6561  ty").        hea
+0001f780: 6465 7273 203d 207b 7365 6c66 2e68 612e  ders = {self.ha.
+0001f790: 6f65 665f 6d61 726b 6572 5f68 6561 6465  oef_marker_heade
+0001f7a0: 7228 293a 2022 7965 7322 7d0a 2020 2020  r(): "yes"}.    
+0001f7b0: 2020 2020 6b65 7920 3d20 636f 6e73 742e      key = const.
+0001f7c0: 4645 5443 485f 4a4f 425f 4b45 5920 2b20  FETCH_JOB_KEY + 
+0001f7d0: 222f 2220 2b20 6a6f 6249 640a 2020 2020  "/" + jobId.    
+0001f7e0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001f7f0: 5f6d 616b 655f 6765 745f 7265 7175 6573  _make_get_reques
+0001f800: 7428 6275 636b 6574 4e61 6d65 2c20 6b65  t(bucketName, ke
+0001f810: 792c 206d 6574 686f 644e 616d 653d 2267  y, methodName="g
+0001f820: 6574 4275 636b 6574 4665 7463 684a 6f62  etBucketFetchJob
+0001f830: 222c 2068 6561 6465 7273 3d68 6561 6465  ", headers=heade
+0001f840: 7273 2c0a 2020 2020 2020 2020 2020 2020  rs,.            
+0001f850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f860: 2020 2020 2020 2020 2020 6578 7465 6e73            extens
+0001f870: 696f 6e48 6561 6465 7273 3d65 7874 656e  ionHeaders=exten
+0001f880: 7369 6f6e 4865 6164 6572 7329 0a0a 0a4f  sionHeaders)...O
+0001f890: 6273 436c 6965 6e74 2e73 6574 4275 636b  bsClient.setBuck
+0001f8a0: 6574 5665 7273 696f 6e69 6e67 436f 6e66  etVersioningConf
+0001f8b0: 6967 7572 6174 696f 6e20 3d20 4f62 7343  iguration = ObsC
+0001f8c0: 6c69 656e 742e 7365 7442 7563 6b65 7456  lient.setBucketV
+0001f8d0: 6572 7369 6f6e 696e 670a 4f62 7343 6c69  ersioning.ObsCli
+0001f8e0: 656e 742e 6765 7442 7563 6b65 7456 6572  ent.getBucketVer
+0001f8f0: 7369 6f6e 696e 6743 6f6e 6669 6775 7261  sioningConfigura
+0001f900: 7469 6f6e 203d 204f 6273 436c 6965 6e74  tion = ObsClient
+0001f910: 2e67 6574 4275 636b 6574 5665 7273 696f  .getBucketVersio
+0001f920: 6e69 6e67 0a4f 6273 436c 6965 6e74 2e64  ning.ObsClient.d
+0001f930: 656c 6574 6542 7563 6b65 744c 6966 6563  eleteBucketLifec
+0001f940: 7963 6c65 436f 6e66 6967 7572 6174 696f  ycleConfiguratio
+0001f950: 6e20 3d20 4f62 7343 6c69 656e 742e 6465  n = ObsClient.de
+0001f960: 6c65 7465 4275 636b 6574 4c69 6665 6379  leteBucketLifecy
+0001f970: 636c 650a 4f62 7343 6c69 656e 742e 7365  cle.ObsClient.se
+0001f980: 7442 7563 6b65 744c 6966 6563 7963 6c65  tBucketLifecycle
+0001f990: 436f 6e66 6967 7572 6174 696f 6e20 3d20  Configuration = 
+0001f9a0: 4f62 7343 6c69 656e 742e 7365 7442 7563  ObsClient.setBuc
+0001f9b0: 6b65 744c 6966 6563 7963 6c65 0a4f 6273  ketLifecycle.Obs
+0001f9c0: 436c 6965 6e74 2e67 6574 4275 636b 6574  Client.getBucket
+0001f9d0: 4c69 6665 6379 636c 6543 6f6e 6669 6775  LifecycleConfigu
+0001f9e0: 7261 7469 6f6e 203d 204f 6273 436c 6965  ration = ObsClie
+0001f9f0: 6e74 2e67 6574 4275 636b 6574 4c69 6665  nt.getBucketLife
+0001fa00: 6379 636c 650a 4f62 7343 6c69 656e 742e  cycle.ObsClient.
+0001fa10: 6765 7442 7563 6b65 7457 6562 7369 7465  getBucketWebsite
+0001fa20: 436f 6e66 6967 7572 6174 696f 6e20 3d20  Configuration = 
+0001fa30: 4f62 7343 6c69 656e 742e 6765 7442 7563  ObsClient.getBuc
+0001fa40: 6b65 7457 6562 7369 7465 0a4f 6273 436c  ketWebsite.ObsCl
+0001fa50: 6965 6e74 2e73 6574 4275 636b 6574 5765  ient.setBucketWe
+0001fa60: 6273 6974 6543 6f6e 6669 6775 7261 7469  bsiteConfigurati
+0001fa70: 6f6e 203d 204f 6273 436c 6965 6e74 2e73  on = ObsClient.s
+0001fa80: 6574 4275 636b 6574 5765 6273 6974 650a  etBucketWebsite.
+0001fa90: 4f62 7343 6c69 656e 742e 6465 6c65 7465  ObsClient.delete
+0001faa0: 4275 636b 6574 5765 6273 6974 6543 6f6e  BucketWebsiteCon
+0001fab0: 6669 6775 7261 7469 6f6e 203d 204f 6273  figuration = Obs
+0001fac0: 436c 6965 6e74 2e64 656c 6574 6542 7563  Client.deleteBuc
+0001fad0: 6b65 7457 6562 7369 7465 0a4f 6273 436c  ketWebsite.ObsCl
+0001fae0: 6965 6e74 2e73 6574 4275 636b 6574 4c6f  ient.setBucketLo
+0001faf0: 6767 696e 6743 6f6e 6669 6775 7261 7469  ggingConfigurati
+0001fb00: 6f6e 203d 204f 6273 436c 6965 6e74 2e73  on = ObsClient.s
+0001fb10: 6574 4275 636b 6574 4c6f 6767 696e 670a  etBucketLogging.
+0001fb20: 4f62 7343 6c69 656e 742e 6765 7442 7563  ObsClient.getBuc
+0001fb30: 6b65 744c 6f67 6769 6e67 436f 6e66 6967  ketLoggingConfig
+0001fb40: 7572 6174 696f 6e20 3d20 4f62 7343 6c69  uration = ObsCli
+0001fb50: 656e 742e 6765 7442 7563 6b65 744c 6f67  ent.getBucketLog
+0001fb60: 6769 6e67 0a                             ging.
```

### Comparing `esdk-obs-python-3.23.9.1/obs/const.py` & `esdk-obs-python-3.24.3/obs/const.py`

 * *Files 1% similar despite different names*

```diff
@@ -17,15 +17,15 @@
 import os
 
 READ_ONCE_LENGTH = 65536
 
 CONTENT_LENGTH_HEADER = 'Content-Length'
 CONTENT_TYPE_HEADER = 'Content-Type'
 CONTENT_MD5_HEADER = 'Content-MD5'
-CACHE_CONTROL_HEADER = 'Cache-Control'
+CACHE_CONTROL_HEADER = 'Cache-Control'  # type: str
 CONTENT_DISPOSITION_HEADER = 'Content-Disposition'
 CONTENT_ENCODING_HEADER = 'Content-Encoding'
 CONTENT_LANGUAGE_HEADER = 'Content-Language'
 EXPIRES_HEADER = 'Expires'
 DATE_HEADER = 'Date'
 
 CONTENT_LIST = [CONTENT_TYPE_HEADER.lower(), CONTENT_MD5_HEADER.lower(), DATE_HEADER.lower()]
@@ -92,15 +92,15 @@
 DEFAULT_MAXIMUM_SIZE = 5 * 1024 * 1024 * 1024
 
 DEFAULT_BYTE_INTTERVAL = 102400
 DEFAULT_TASK_INTTERVAL = 100
 DEFAULT_TASK_NUM = 8
 DEFAULT_TASK_QUEUE_SIZE = 20000
 
-OBS_SDK_VERSION = '3.23.9'
+OBS_SDK_VERSION = '3.24.3'
 
 V2_META_HEADER_PREFIX = 'x-amz-meta-'
 V2_HEADER_PREFIX = 'x-amz-'
 
 OBS_META_HEADER_PREFIX = 'x-obs-meta-'
 OBS_HEADER_PREFIX = 'x-obs-'
```

### Comparing `esdk-obs-python-3.23.9.1/obs/convertor.py` & `esdk-obs-python-3.24.3/obs/convertor.py`

 * *Files 0% similar despite different names*

```diff
@@ -50,15 +50,15 @@
                                'public-read-write-delivered', 'bucket-owner-full-control']
     V2_ALLOWED_ACL_CONTROL = ['private', 'public-read', 'public-read-write', 'authenticated-read', 'bucket-owner-read',
                               'bucket-owner-full-control', 'log-delivery-write']
 
     OBS_ALLOWED_STORAGE_CLASS = ['STANDARD', 'WARM', 'COLD']
     V2_ALLOWED_STORAGE_CLASS = ['STANDARD', 'STANDARD_IA', 'GLACIER']
 
-    OBS_ALLOWED_GROUP = ['Everyone']
+    OBS_ALLOWED_GROUP = ['Everyone','AuthenticatedUsers','LogDelivery']
     V2_ALLOWED_GROUP = ['http://acs.amazonaws.com/groups/global/AllUsers',
                         'http://acs.amazonaws.com/groups/global/AuthenticatedUsers',
                         'http://acs.amazonaws.com/groups/s3/LogDelivery']
 
     OBS_ALLOWED_RESTORE_TIER = ['Expedited', 'Standard']
     V2_ALLOWED_RESTORE_TIER = ['Expedited', 'Standard', 'Bulk']
 
@@ -1915,14 +1915,18 @@
         option = SetObjectMetadataResponse()
         self._parseGetObjectCommonHeader(headers, option)
         option.isAppendable = headers.get(self.ha.object_type_header()) == 'Appendable'
         if option.isAppendable:
             option.nextPosition = util.to_long(headers.get(self.ha.next_position_header()))
         return option
 
+    def parseGetAccessLabel(self, jsons, headers=None):
+        result = json.loads(jsons)
+        return result
+    
     def parseGetObject(self, headers, option):
         self._parseGetObjectCommonHeader(headers, option)
         option.deleteMarker = headers.get(self.ha.delete_marker_header())
         option.cacheControl = headers.get(const.CACHE_CONTROL_HEADER.lower())
         option.contentDisposition = headers.get(const.CONTENT_DISPOSITION_HEADER.lower())
         option.contentEncoding = headers.get(const.CONTENT_ENCODING_HEADER.lower())
         option.contentLanguage = headers.get(const.CONTENT_LANGUAGE_HEADER.lower())
```

### Comparing `esdk-obs-python-3.23.9.1/obs/crypto_client.py` & `esdk-obs-python-3.24.3/obs/crypto_client.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,267 +1,279 @@
-# coding:utf-8
-
-import io
-
-from obs import GetObjectHeader, ObsClient, PutObjectHeader, UploadFileHeader, const, progress, util
-from obs.ilog import INFO
-from obs.transfer import _resume_download_with_operation, downloadOperation, uploadOperation
-
-
-class CryptoObsClient(ObsClient):
-    def __init__(self, cipher_generator, *args, **kwargs):
-        self.cipher_generator = cipher_generator
-        super(CryptoObsClient, self).__init__(*args, **kwargs)
-
-    def appendObject(self, bucketName, objectKey, content=None, metadata=None, headers=None, progressCallback=None,
-                     autoClose=True, extensionHeaders=None):
-        raise Exception("AppendObject is not supported in CryptoObsClient")
-
-    def copyPart(self, bucketName, objectKey, partNumber, uploadId, copySource, copySourceRange=None,
-                 destSseHeader=None, sourceSseHeader=None, extensionHeaders=None):
-        raise Exception("CopyPart is not supported in CryptoObsClient")
-
-    def initiateMultipartUpload(self, bucketName, objectKey, acl=None, storageClass=None,
-                                metadata=None, websiteRedirectLocation=None, contentType=None, sseHeader=None,
-                                expires=None, extensionGrants=None, extensionHeaders=None, encoding_type=None):
-        raise Exception("InitiateMultipartUpload is not supported in CryptoObsClient")
-
-    def uploadPart(self, bucketName, objectKey, partNumber, uploadId, object=None, isFile=False, partSize=None,
-                   offset=0, sseHeader=None, isAttachMd5=False, md5=None, content=None, progressCallback=None,
-                   autoClose=True, extensionHeaders=None):
-        raise Exception("UploadPart is not supported in CryptoObsClient")
-
-    def initiateEncryptedMultipartUpload(self, bucketName, objectKey, crypto_cipher, acl=None, storageClass=None,
-                                         metadata=None, websiteRedirectLocation=None, contentType=None, sseHeader=None,
-                                         expires=None, extensionGrants=None, extensionHeaders=None, encoding_type=None):
-        if self.cipher_generator.need_sha256:
-            raise Exception("Could not calculate sha256 for initiateMultipartUpload")
-        if metadata is None:
-            metadata = dict()
-        content = crypto_cipher
-        metadata = content.gen_need_metadata_and_headers(metadata, UploadFileHeader())
-        resp = super(CryptoObsClient, self).initiateMultipartUpload(bucketName, objectKey, acl, storageClass, metadata,
-                                                                    websiteRedirectLocation, contentType, sseHeader,
-                                                                    expires, extensionGrants,
-                                                                    extensionHeaders, encoding_type)
-        resp.body["crypto_info"] = content.safe_crypto_info()
-        content.close()
-        return resp
-
-    def putContent(self, bucketName, objectKey, content=None, metadata=None, headers=None,
-                   progressCallback=None, autoClose=True, extensionHeaders=None):
-        if headers is None:
-            headers = PutObjectHeader()
-        if (const.IS_PYTHON2 and isinstance(content, unicode)) or isinstance(content, str):
-            content = self._covert_string_to_bytes_io(content)
-            headers.contentLength = content.seek(0, 2)
-            content.seek(0)
-        elif self.cipher_generator.need_sha256:
-            # 如果不是字符串，不允许计算 sha256
-            raise Exception("Could not calculate sha256 for a stream object")
-        content = self.cipher_generator.new(content)
-        if metadata is None:
-            metadata = dict()
-        metadata = content.gen_need_metadata_and_headers(metadata, headers)
-        put_result = super(CryptoObsClient, self).putContent(bucketName, objectKey, content, metadata, headers=headers,
-                                                             progressCallback=progressCallback, autoClose=autoClose,
-                                                             extensionHeaders=extensionHeaders)
-        return put_result
-
-    def _gen_readable_object_from_file(self, file_path):
-        return self.cipher_generator.new(open(file_path, "rb"))
-
-    def putObject(self, bucketName, objectKey, content, metadata=None, headers=None, progressCallback=None,
-                  autoClose=True, extensionHeaders=None):
-        raise Exception("putObject is not supported in CryptoObsClient")
-
-    def uploadEncryptedPart(self, bucketName, objectKey, partNumber, uploadId, crypto_cipher, object=None,
-                            isFile=False, partSize=None, offset=0, sseHeader=None, isAttachMd5=False, md5=None,
-                            content=None, progressCallback=None, autoClose=True, extensionHeaders=None):
-        if isAttachMd5:
-            raise Exception("Could not calculate md5 for uploadEncryptedPart")
-        if content is None:
-            content = object
-        if isFile:
-            checked_file_part_info = self._check_file_part_info(content, offset, partSize)
-            content = crypto_cipher
-            content._file = open(checked_file_part_info["file_path"], "rb")
-            content._file.seek(checked_file_part_info["offset"])
-            partSize = checked_file_part_info["partSize"]
-        else:
-            if content is not None and hasattr(content, 'read') and callable(content.read):
-                crypto_cipher._file = content
-            else:
-                crypto_cipher._file = self._covert_string_to_bytes_io(content)
-            content = crypto_cipher
-        return super(CryptoObsClient, self).uploadPart(bucketName, objectKey, partNumber, uploadId,
-                                                       object=None, isFile=False, partSize=partSize,
-                                                       offset=0, sseHeader=sseHeader,
-                                                       isAttachMd5=isAttachMd5, md5=md5, content=content,
-                                                       progressCallback=progressCallback,
-                                                       autoClose=autoClose, extensionHeaders=extensionHeaders)
-
-    def uploadFile(self, bucketName, objectKey, uploadFile, partSize=9 * 1024 * 1024,
-                   taskNum=1, enableCheckpoint=False, checkpointFile=None,
-                   checkSum=False, metadata=None, progressCallback=None, headers=None,
-                   extensionHeaders=None, encoding_type=None):
-        self.log_client.log(INFO, 'enter resume upload file...')
-        self._assert_not_null(bucketName, 'bucketName is empty')
-        self._assert_not_null(objectKey, 'objectKey is empty')
-        self._assert_not_null(uploadFile, 'uploadFile is empty')
-        upload_operation = EncryptedUploadOperation(self.cipher_generator, util.to_string(bucketName),
-                                                    util.to_string(objectKey),
-                                                    util.to_string(uploadFile), partSize, taskNum, enableCheckpoint,
-                                                    util.to_string(checkpointFile), checkSum, metadata,
-                                                    progressCallback, self, headers, extensionHeaders=extensionHeaders,
-                                                    encoding_type=encoding_type)
-        return upload_operation._upload()
-
-    def downloadFile(self, bucketName, objectKey, downloadFile=None, partSize=5 * 1024 * 1024, taskNum=1,
-                     enableCheckpoint=False, checkpointFile=None, header=None, versionId=None,
-                     progressCallback=None, imageProcess=None, extensionHeaders=None):
-        if header is None:
-            header = GetObjectHeader()
-        if downloadFile is None:
-            downloadFile = objectKey
-
-        down_operation = DecryptedDownloadOperation(self.cipher_generator, util.to_string(bucketName),
-                                                    util.to_string(objectKey), util.to_string(downloadFile),
-                                                    partSize, taskNum, enableCheckpoint, util.to_string(checkpointFile),
-                                                    header, versionId, progressCallback, self, imageProcess,
-                                                    progress.NONE_NOTIFIER, extensionHeaders=extensionHeaders)
-        return _resume_download_with_operation(down_operation)
-
-    def _parse_content(self, objectKey, conn, readable, result_wrapper=None, download_start=None,
-                       downloadPath=None, chuckSize=const.READ_ONCE_LENGTH, loadStreamInMemory=False,
-                       progressCallback=None, notifier=None):
-        if readable.status >= 300:
-            return super(CryptoObsClient, self)._parse_content(objectKey, conn, readable,
-                                                               download_start=download_start, downloadPath=downloadPath,
-                                                               chuckSize=chuckSize,
-                                                               loadStreamInMemory=loadStreamInMemory,
-                                                               progressCallback=progressCallback, notifier=notifier)
-        crypto_info = self.cipher_generator.get_crypto_info_from_headers(dict(readable.getheaders()))
-        try:
-            iv_offset = int(download_start.split("-")[0])
-        except (AttributeError, ValueError):
-            iv_offset = 0
-        decryptedObject = self.cipher_generator.new(readable, is_decrypt=True, crypto_info=crypto_info)
-        decryptedObject.seek_iv(iv_offset)
-        return super(CryptoObsClient, self)._parse_content(objectKey, conn, decryptedObject,
-                                                           download_start=download_start, downloadPath=downloadPath,
-                                                           chuckSize=chuckSize, loadStreamInMemory=loadStreamInMemory,
-                                                           progressCallback=progressCallback, notifier=notifier)
-
-    def _encrypted_upload_part(self, bucketName, objectKey, partNumber, uploadId, crypto_info,
-                               content=None, partSize=None, offset=0, sseHeader=None, isAttachMd5=False,
-                               md5=None, notifier=None, extensionHeaders=None):
-        checked_file_part_info = self._check_file_part_info(content, offset, partSize)
-        content = self.cipher_generator.new(open(checked_file_part_info["file_path"], "rb"), crypto_info=crypto_info)
-        content.seek(checked_file_part_info["offset"])
-        headers = dict()
-        if self.cipher_generator.need_sha256:
-            headers[self.ha.content_sha256_header()] = content.calculate_sha256(partSize)[1]
-        return super(CryptoObsClient, self)._uploadPartWithNotifier(bucketName, objectKey, partNumber, uploadId,
-                                                                    content, False, checked_file_part_info["partSize"],
-                                                                    checked_file_part_info["offset"], sseHeader,
-                                                                    isAttachMd5, md5, notifier, extensionHeaders,
-                                                                    headers)
-
-    def gen_readable_object_from_file(self, file_path):
-        content = self.cipher_generator.new(open(file_path, "rb"))
-        return content
-
-    @staticmethod
-    def add_metadata_from_content(metadata, headers, content):
-        return content.gen_need_metadata_and_headers(metadata, headers)
-
-    @staticmethod
-    def _covert_string_to_bytes_io(str_object):
-        if const.IS_PYTHON2 and isinstance(str_object, unicode) \
-                or (not const.IS_PYTHON2 and isinstance(str_object, str)):
-            return io.BytesIO(str_object.encode("UTF-8"))
-        return io.BytesIO(str_object)
-
-
-class EncryptedUploadOperation(uploadOperation):
-    def __init__(self, cipher_generator, bucketName, objectKey, uploadFile, partSize, taskNum, enableCheckPoint,
-                 checkPointFile, checkSum, metadata, progressCallback, obsClient, headers, extensionHeaders=None,
-                 encoding_type=None):
-        self.cipher_generator = cipher_generator
-        self.encrypted_content = cipher_generator.new(open(uploadFile, "rb"))
-        self.crypto_info = self.encrypted_content.safe_crypto_info()
-        if metadata is None:
-            metadata = dict()
-        if headers is None:
-            headers = UploadFileHeader()
-        metadata = self.encrypted_content.gen_need_metadata_and_headers(metadata, headers)
-        super(EncryptedUploadOperation, self).__init__(bucketName, objectKey, uploadFile, partSize, taskNum,
-                                                       enableCheckPoint, checkPointFile, checkSum, metadata,
-                                                       progressCallback, obsClient, headers, extensionHeaders,
-                                                       encoding_type)
-        self._record = self.encrypted_content.gen_need_record(self._record)
-
-    def _check_upload_record(self, record):
-        self._record = self._get_record()
-        if not self.cipher_generator.check_upload_record(self._record, self.encrypted_content.safe_crypto_info()):
-            self.obsClient.log_client.log(INFO, 'The crypto_info was changed. clear the record')
-            return False
-        return super(EncryptedUploadOperation, self)._check_upload_record(record)
-
-    def _load(self):
-        super(EncryptedUploadOperation, self)._load()
-        # 如果 record 通过校验，使用 record 里的信息初始化新 cipher, 否则使用当前的 cipher 补全 record 信息
-        if "crypto_mod" in self._record:
-            self.encrypted_content = self.cipher_generator.new("", crypto_info=self._record)
-        else:
-            self._record = self.encrypted_content.gen_need_record(self._record)
-
-    def _upload(self):
-        try:
-            return super(EncryptedUploadOperation, self)._upload()
-        finally:
-            self.encrypted_content.close()
-
-    def get_upload_part_resp(self, part):
-        return self.obsClient._encrypted_upload_part(self.bucketName, self.objectKey, part['partNumber'],
-                                                     self._record['uploadId'],
-                                                     self.encrypted_content.crypto_info(),
-                                                     self.fileName, partSize=part['length'],
-                                                     offset=part['offset'], notifier=self.notifier,
-                                                     extensionHeaders=self.extensionHeaders,
-                                                     sseHeader=self.headers.sseHeader)
-
-    def get_init_upload_result(self):
-        return super(self.obsClient.__class__, self.obsClient).initiateMultipartUpload(
-            self.bucketName, self.objectKey, metadata=self.metadata, acl=self.headers.acl,
-            storageClass=self.headers.storageClass, websiteRedirectLocation=self.headers.websiteRedirectLocation,
-            contentType=self.headers.contentType, sseHeader=self.headers.sseHeader,
-            expires=self.headers.expires, extensionGrants=self.headers.extensionGrants,
-            extensionHeaders=self.extensionHeaders, encoding_type=self.encoding_type)
-
-
-class DecryptedDownloadOperation(downloadOperation):
-    def __init__(self, cipher_generator, *args, **kwargs):
-        super(DecryptedDownloadOperation, self).__init__(*args, **kwargs)
-        self.cipher_generator = cipher_generator
-        header_dict = dict(self._metadata_resp.header)
-        crypto_info = self.cipher_generator.get_crypto_info_from_headers(header_dict)
-        # 用空字符串生成个临时加密下载对象，用以获取加密信息
-        self.decrypted_content = cipher_generator.new("", crypto_info=crypto_info)
-
-    def _check_download_record(self, record):
-        self._record = self._get_record()
-        if not self.cipher_generator.check_download_record(self._record, self.decrypted_content.safe_crypto_info()):
-            self.obsClient.log_client.log(INFO, 'The crypto_info was changed. clear the record')
-            return False
-        return super(DecryptedDownloadOperation, self)._check_download_record(record)
-
-    def _load(self):
-        super(DecryptedDownloadOperation, self)._load()
-        self._record = self.decrypted_content.gen_need_record(self._record)
-
-    def _download(self):
-        try:
-            return super(DecryptedDownloadOperation, self)._download()
-        finally:
-            self.decrypted_content.close()
+#!/usr/bin/python
+# -*- coding:utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+import io
+
+from obs import GetObjectHeader, ObsClient, PutObjectHeader, UploadFileHeader, const, progress, util
+from obs.ilog import INFO
+from obs.transfer import _resume_download_with_operation, downloadOperation, uploadOperation
+
+
+class CryptoObsClient(ObsClient):
+    def __init__(self, cipher_generator, *args, **kwargs):
+        self.cipher_generator = cipher_generator
+        super(CryptoObsClient, self).__init__(*args, **kwargs)
+
+    def appendObject(self, bucketName, objectKey, content=None, metadata=None, headers=None, progressCallback=None,
+                     autoClose=True, extensionHeaders=None):
+        raise Exception("AppendObject is not supported in CryptoObsClient")
+
+    def copyPart(self, bucketName, objectKey, partNumber, uploadId, copySource, copySourceRange=None,
+                 destSseHeader=None, sourceSseHeader=None, extensionHeaders=None):
+        raise Exception("CopyPart is not supported in CryptoObsClient")
+
+    def initiateMultipartUpload(self, bucketName, objectKey, acl=None, storageClass=None,
+                                metadata=None, websiteRedirectLocation=None, contentType=None, sseHeader=None,
+                                expires=None, extensionGrants=None, extensionHeaders=None, encoding_type=None):
+        raise Exception("InitiateMultipartUpload is not supported in CryptoObsClient")
+
+    def uploadPart(self, bucketName, objectKey, partNumber, uploadId, object=None, isFile=False, partSize=None,
+                   offset=0, sseHeader=None, isAttachMd5=False, md5=None, content=None, progressCallback=None,
+                   autoClose=True, extensionHeaders=None):
+        raise Exception("UploadPart is not supported in CryptoObsClient")
+
+    def initiateEncryptedMultipartUpload(self, bucketName, objectKey, crypto_cipher, acl=None, storageClass=None,
+                                         metadata=None, websiteRedirectLocation=None, contentType=None, sseHeader=None,
+                                         expires=None, extensionGrants=None, extensionHeaders=None, encoding_type=None):
+        if self.cipher_generator.need_sha256:
+            raise Exception("Could not calculate sha256 for initiateMultipartUpload")
+        if metadata is None:
+            metadata = dict()
+        content = crypto_cipher
+        metadata = content.gen_need_metadata_and_headers(metadata, UploadFileHeader())
+        resp = super(CryptoObsClient, self).initiateMultipartUpload(bucketName, objectKey, acl, storageClass, metadata,
+                                                                    websiteRedirectLocation, contentType, sseHeader,
+                                                                    expires, extensionGrants,
+                                                                    extensionHeaders, encoding_type)
+        resp.body["crypto_info"] = content.safe_crypto_info()
+        content.close()
+        return resp
+
+    def putContent(self, bucketName, objectKey, content=None, metadata=None, headers=None,
+                   progressCallback=None, autoClose=True, extensionHeaders=None):
+        if headers is None:
+            headers = PutObjectHeader()
+        if (const.IS_PYTHON2 and isinstance(content, unicode)) or isinstance(content, str):
+            content = self._covert_string_to_bytes_io(content)
+            headers.contentLength = content.seek(0, 2)
+            content.seek(0)
+        elif self.cipher_generator.need_sha256:
+            # 如果不是字符串，不允许计算 sha256
+            raise Exception("Could not calculate sha256 for a stream object")
+        content = self.cipher_generator.new(content)
+        if metadata is None:
+            metadata = dict()
+        metadata = content.gen_need_metadata_and_headers(metadata, headers)
+        put_result = super(CryptoObsClient, self).putContent(bucketName, objectKey, content, metadata, headers=headers,
+                                                             progressCallback=progressCallback, autoClose=autoClose,
+                                                             extensionHeaders=extensionHeaders)
+        return put_result
+
+    def _gen_readable_object_from_file(self, file_path):
+        return self.cipher_generator.new(open(file_path, "rb"))
+
+    def putObject(self, bucketName, objectKey, content, metadata=None, headers=None, progressCallback=None,
+                  autoClose=True, extensionHeaders=None):
+        raise Exception("putObject is not supported in CryptoObsClient")
+
+    def uploadEncryptedPart(self, bucketName, objectKey, partNumber, uploadId, crypto_cipher, object=None,
+                            isFile=False, partSize=None, offset=0, sseHeader=None, isAttachMd5=False, md5=None,
+                            content=None, progressCallback=None, autoClose=True, extensionHeaders=None):
+        if isAttachMd5:
+            raise Exception("Could not calculate md5 for uploadEncryptedPart")
+        if content is None:
+            content = object
+        if isFile:
+            checked_file_part_info = self._check_file_part_info(content, offset, partSize)
+            content = crypto_cipher
+            content._file = open(checked_file_part_info["file_path"], "rb")
+            content._file.seek(checked_file_part_info["offset"])
+            partSize = checked_file_part_info["partSize"]
+        else:
+            if content is not None and hasattr(content, 'read') and callable(content.read):
+                crypto_cipher._file = content
+            else:
+                crypto_cipher._file = self._covert_string_to_bytes_io(content)
+            content = crypto_cipher
+        return super(CryptoObsClient, self).uploadPart(bucketName, objectKey, partNumber, uploadId,
+                                                       object=None, isFile=False, partSize=partSize,
+                                                       offset=0, sseHeader=sseHeader,
+                                                       isAttachMd5=isAttachMd5, md5=md5, content=content,
+                                                       progressCallback=progressCallback,
+                                                       autoClose=autoClose, extensionHeaders=extensionHeaders)
+
+    def uploadFile(self, bucketName, objectKey, uploadFile, partSize=9 * 1024 * 1024,
+                   taskNum=1, enableCheckpoint=False, checkpointFile=None,
+                   checkSum=False, metadata=None, progressCallback=None, headers=None,
+                   extensionHeaders=None, encoding_type=None):
+        self.log_client.log(INFO, 'enter resume upload file...')
+        self._assert_not_null(bucketName, 'bucketName is empty')
+        self._assert_not_null(objectKey, 'objectKey is empty')
+        self._assert_not_null(uploadFile, 'uploadFile is empty')
+        upload_operation = EncryptedUploadOperation(self.cipher_generator, util.to_string(bucketName),
+                                                    util.to_string(objectKey),
+                                                    util.to_string(uploadFile), partSize, taskNum, enableCheckpoint,
+                                                    util.to_string(checkpointFile), checkSum, metadata,
+                                                    progressCallback, self, headers, extensionHeaders=extensionHeaders,
+                                                    encoding_type=encoding_type)
+        return upload_operation._upload()
+
+    def downloadFile(self, bucketName, objectKey, downloadFile=None, partSize=5 * 1024 * 1024, taskNum=1,
+                     enableCheckpoint=False, checkpointFile=None, header=None, versionId=None,
+                     progressCallback=None, imageProcess=None, extensionHeaders=None):
+        if header is None:
+            header = GetObjectHeader()
+        if downloadFile is None:
+            downloadFile = objectKey
+
+        down_operation = DecryptedDownloadOperation(self.cipher_generator, util.to_string(bucketName),
+                                                    util.to_string(objectKey), util.to_string(downloadFile),
+                                                    partSize, taskNum, enableCheckpoint, util.to_string(checkpointFile),
+                                                    header, versionId, progressCallback, self, imageProcess,
+                                                    progress.NONE_NOTIFIER, extensionHeaders=extensionHeaders)
+        return _resume_download_with_operation(down_operation)
+
+    def _parse_content(self, objectKey, conn, readable, result_wrapper=None, download_start=None,
+                       downloadPath=None, chuckSize=const.READ_ONCE_LENGTH, loadStreamInMemory=False,
+                       progressCallback=None, notifier=None):
+        if readable.status >= 300:
+            return super(CryptoObsClient, self)._parse_content(objectKey, conn, readable,
+                                                               download_start=download_start, downloadPath=downloadPath,
+                                                               chuckSize=chuckSize,
+                                                               loadStreamInMemory=loadStreamInMemory,
+                                                               progressCallback=progressCallback, notifier=notifier)
+        crypto_info = self.cipher_generator.get_crypto_info_from_headers(dict(readable.getheaders()))
+        try:
+            iv_offset = int(download_start.split("-")[0])
+        except (AttributeError, ValueError):
+            iv_offset = 0
+        decryptedObject = self.cipher_generator.new(readable, is_decrypt=True, crypto_info=crypto_info)
+        decryptedObject.seek_iv(iv_offset)
+        return super(CryptoObsClient, self)._parse_content(objectKey, conn, decryptedObject,
+                                                           download_start=download_start, downloadPath=downloadPath,
+                                                           chuckSize=chuckSize, loadStreamInMemory=loadStreamInMemory,
+                                                           progressCallback=progressCallback, notifier=notifier)
+
+    def _encrypted_upload_part(self, bucketName, objectKey, partNumber, uploadId, crypto_info,
+                               content=None, partSize=None, offset=0, sseHeader=None, isAttachMd5=False,
+                               md5=None, notifier=None, extensionHeaders=None):
+        checked_file_part_info = self._check_file_part_info(content, offset, partSize)
+        content = self.cipher_generator.new(open(checked_file_part_info["file_path"], "rb"), crypto_info=crypto_info)
+        content.seek(checked_file_part_info["offset"])
+        headers = dict()
+        if self.cipher_generator.need_sha256:
+            headers[self.ha.content_sha256_header()] = content.calculate_sha256(partSize)[1]
+        return super(CryptoObsClient, self)._uploadPartWithNotifier(bucketName, objectKey, partNumber, uploadId,
+                                                                    content, False, checked_file_part_info["partSize"],
+                                                                    checked_file_part_info["offset"], sseHeader,
+                                                                    isAttachMd5, md5, notifier, extensionHeaders,
+                                                                    headers)
+
+    def gen_readable_object_from_file(self, file_path):
+        content = self.cipher_generator.new(open(file_path, "rb"))
+        return content
+
+    @staticmethod
+    def add_metadata_from_content(metadata, headers, content):
+        return content.gen_need_metadata_and_headers(metadata, headers)
+
+    @staticmethod
+    def _covert_string_to_bytes_io(str_object):
+        if const.IS_PYTHON2 and isinstance(str_object, unicode) \
+                or (not const.IS_PYTHON2 and isinstance(str_object, str)):
+            return io.BytesIO(str_object.encode("UTF-8"))
+        return io.BytesIO(str_object)
+
+
+class EncryptedUploadOperation(uploadOperation):
+    def __init__(self, cipher_generator, bucketName, objectKey, uploadFile, partSize, taskNum, enableCheckPoint,
+                 checkPointFile, checkSum, metadata, progressCallback, obsClient, headers, extensionHeaders=None,
+                 encoding_type=None):
+        self.cipher_generator = cipher_generator
+        self.encrypted_content = cipher_generator.new(open(uploadFile, "rb"))
+        self.crypto_info = self.encrypted_content.safe_crypto_info()
+        if metadata is None:
+            metadata = dict()
+        if headers is None:
+            headers = UploadFileHeader()
+        metadata = self.encrypted_content.gen_need_metadata_and_headers(metadata, headers)
+        super(EncryptedUploadOperation, self).__init__(bucketName, objectKey, uploadFile, partSize, taskNum,
+                                                       enableCheckPoint, checkPointFile, checkSum, metadata,
+                                                       progressCallback, obsClient, headers, extensionHeaders,
+                                                       encoding_type)
+        self._record = self.encrypted_content.gen_need_record(self._record)
+
+    def _check_upload_record(self, record):
+        self._record = self._get_record()
+        if not self.cipher_generator.check_upload_record(self._record, self.encrypted_content.safe_crypto_info()):
+            self.obsClient.log_client.log(INFO, 'The crypto_info was changed. clear the record')
+            return False
+        return super(EncryptedUploadOperation, self)._check_upload_record(record)
+
+    def _load(self):
+        super(EncryptedUploadOperation, self)._load()
+        # 如果 record 通过校验，使用 record 里的信息初始化新 cipher, 否则使用当前的 cipher 补全 record 信息
+        if "crypto_mod" in self._record:
+            self.encrypted_content = self.cipher_generator.new("", crypto_info=self._record)
+        else:
+            self._record = self.encrypted_content.gen_need_record(self._record)
+
+    def _upload(self):
+        try:
+            return super(EncryptedUploadOperation, self)._upload()
+        finally:
+            self.encrypted_content.close()
+
+    def get_upload_part_resp(self, part):
+        return self.obsClient._encrypted_upload_part(self.bucketName, self.objectKey, part['partNumber'],
+                                                     self._record['uploadId'],
+                                                     self.encrypted_content.crypto_info(),
+                                                     self.fileName, partSize=part['length'],
+                                                     offset=part['offset'], notifier=self.notifier,
+                                                     extensionHeaders=self.extensionHeaders,
+                                                     sseHeader=self.headers.sseHeader)
+
+    def get_init_upload_result(self):
+        return super(self.obsClient.__class__, self.obsClient).initiateMultipartUpload(
+            self.bucketName, self.objectKey, metadata=self.metadata, acl=self.headers.acl,
+            storageClass=self.headers.storageClass, websiteRedirectLocation=self.headers.websiteRedirectLocation,
+            contentType=self.headers.contentType, sseHeader=self.headers.sseHeader,
+            expires=self.headers.expires, extensionGrants=self.headers.extensionGrants,
+            extensionHeaders=self.extensionHeaders, encoding_type=self.encoding_type)
+
+
+class DecryptedDownloadOperation(downloadOperation):
+    def __init__(self, cipher_generator, *args, **kwargs):
+        super(DecryptedDownloadOperation, self).__init__(*args, **kwargs)
+        self.cipher_generator = cipher_generator
+        header_dict = dict(self._metadata_resp.header)
+        crypto_info = self.cipher_generator.get_crypto_info_from_headers(header_dict)
+        # 用空字符串生成个临时加密下载对象，用以获取加密信息
+        self.decrypted_content = cipher_generator.new("", crypto_info=crypto_info)
+
+    def _check_download_record(self, record):
+        self._record = self._get_record()
+        if not self.cipher_generator.check_download_record(self._record, self.decrypted_content.safe_crypto_info()):
+            self.obsClient.log_client.log(INFO, 'The crypto_info was changed. clear the record')
+            return False
+        return super(DecryptedDownloadOperation, self)._check_download_record(record)
+
+    def _load(self):
+        super(DecryptedDownloadOperation, self)._load()
+        self._record = self.decrypted_content.gen_need_record(self._record)
+
+    def _download(self):
+        try:
+            return super(DecryptedDownloadOperation, self)._download()
+        finally:
+            self.decrypted_content.close()
```

### Comparing `esdk-obs-python-3.23.9.1/obs/extension.py` & `esdk-obs-python-3.24.3/obs/extension.py`

 * *Ordering differences only*

 * *Files 10% similar despite different names*

```diff
@@ -1,152 +1,152 @@
-#!/usr/bin/python
-# -*- coding:utf-8 -*-
-# Copyright 2019 Huawei Technologies Co.,Ltd.
-# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
-# this file except in compliance with the License.  You may obtain a copy of the
-# License at
-
-# http://www.apache.org/licenses/LICENSE-2.0
-
-# Unless required by applicable law or agreed to in writing, software distributed
-# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
-# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
-# specific language governing permissions and limitations under the License.
-
-import os
-import traceback
-from obs import const, util, progress, bulktasks
-from obs.model import GetObjectRequest
-from obs.model import GetObjectHeader
-from obs.ilog import ERROR
-
-
-def _download_files(obsClient, bucketName, prefix, downloadFolder=None, taskNum=const.DEFAULT_TASK_NUM,
-                    taskQueueSize=const.DEFAULT_TASK_QUEUE_SIZE,
-                    headers=None, imageProcess=None, interval=const.DEFAULT_BYTE_INTTERVAL,
-                    taskCallback=None, progressCallback=None,
-                    threshold=const.DEFAULT_MAXIMUM_SIZE, partSize=5 * 1024 * 1024, subTaskNum=1,
-                    enableCheckpoint=False, checkpointFile=None, extensionHeaders=None):
-    if headers is None:
-        headers = GetObjectHeader()
-    try:
-        executor = None
-        notifier = None
-        _download_files_check(downloadFolder, taskCallback)
-        (taskNum, taskQueueSize, interval, threshold) = bulktasks._checkBulkTasksPara(taskNum, taskQueueSize, interval,
-                                                                                      threshold)
-
-        taskCallback = _download_files_taskCallback(taskCallback)
-        executor = bulktasks.ThreadPool(taskNum, taskQueueSize)
-        state = bulktasks.ExecuteProgress()
-        totalTasks = const.LONG(0)
-        totalAmount = const.LONG(0)
-        notifier = _download_files_notifier(progressCallback, totalAmount, interval)
-        notifier.start()
-
-        query = GetObjectRequest(imageProcess=imageProcess)
-
-        prefix = _download_files_prefix(prefix)
-        prefixDir = prefix[:prefix.rfind('/') + 1]
-
-        for content in _list_objects(obsClient, bucketName, prefix=prefix, extensionHeaders=extensionHeaders):
-            objectKey = content.key
-            totalTasks += 1
-            totalAmount += content.size
-            objectPath = objectKey.replace(prefixDir, '', 1)
-            if objectPath.startswith('/') or objectPath.find('//') != -1 or objectPath.find('\\') != -1:
-                state._failed_increment()
-                taskCallback(objectKey, Exception('illegal path: %s' % objectKey))
-                obsClient.log_client.log(ERROR, 'illegal path: %s' % objectKey)
-                continue
-
-            downloadPath = os.path.join(downloadFolder, objectPath)
-            downloadPath = util.safe_encode(downloadPath)
-            if const.IS_WINDOWS:
-                downloadPath = util.safe_trans_to_gb2312(downloadPath)
-
-            dirName = os.path.dirname(downloadPath)
-            if not os.path.exists(dirName):
-                try:
-                    os.makedirs(dirName, 0o755)
-                except Exception as e:
-                    state._failed_increment()
-                    taskCallback(objectKey, e)
-                    obsClient.log_client.log(ERROR, traceback.format_exc())
-                    continue
-
-            if objectKey.endswith('/'):
-                state._successful_increment()
-            elif content.size < threshold:
-                executor.execute(_task_wrap, obsClient, obsClient.getObject, key=objectKey,
-                                 taskCallback=taskCallback, state=state, bucketName=bucketName,
-                                 objectKey=objectKey, getObjectRequest=query, headers=headers,
-                                 downloadPath=downloadPath, notifier=notifier, extensionHeaders=extensionHeaders)
-            else:
-                executor.execute(_task_wrap, obsClient, obsClient._downloadFileWithNotifier, key=objectKey,
-                                 taskCallback=taskCallback, state=state, bucketName=bucketName,
-                                 objectKey=objectKey, downloadFile=downloadPath, partSize=partSize, taskNum=subTaskNum,
-                                 enableCheckpoint=enableCheckpoint,
-                                 checkpointFile=checkpointFile, header=headers, imageProcess=imageProcess,
-                                 notifier=notifier, extensionHeaders=extensionHeaders)
-
-        state.total_tasks = totalTasks
-        notifier.totalAmount = totalAmount
-    finally:
-        if executor is not None:
-            executor.shutdown()
-        if notifier is not None:
-            notifier.end()
-
-    return state
-
-
-def _download_files_check(downloadFolder, taskCallback):
-    if downloadFolder is None or not os.path.isdir(downloadFolder):
-        raise Exception('%s is not a Folder' % downloadFolder)
-
-    if taskCallback is not None and not callable(taskCallback):
-        raise Exception('Invalid taskCallback')
-
-
-def _download_files_taskCallback(taskCallback):
-    return taskCallback if taskCallback is not None else util.lazyCallback
-
-
-def _download_files_notifier(progressCallback, totalAmount, interval):
-    return progress.ProgressNotifier(progressCallback, totalAmount,
-                                     interval) if progressCallback is not None else progress.NONE_NOTIFIER
-
-
-def _download_files_prefix(prefix):
-    return prefix if prefix is not None else ''
-
-
-def _task_wrap(obsClient, func, key, taskCallback=None, state=None, **kwargs):
-    try:
-        res = func(**kwargs)
-        if res.status < 300:
-            state._successful_increment()
-        else:
-            state._failed_increment()
-        taskCallback(key, res)
-    except Exception as e:
-        state._failed_increment()
-        taskCallback(key, e)
-        obsClient.log_client.log(ERROR, traceback.format_exc())
-
-
-def _list_objects(obsClient, bucketName, prefix=None, marker=None, max_keys=None, delimiter=None,
-                  extensionHeaders=None):
-    while True:
-        resp = obsClient.listObjects(bucketName, max_keys=max_keys, marker=marker, prefix=prefix, delimiter=delimiter,
-                                     extensionHeaders=extensionHeaders)
-        if resp.status < 300:
-            for content in resp.body.contents:
-                yield content
-            if not resp.body.is_truncated:
-                break
-            marker = resp.body.next_marker
-        else:
-            obsClient.log_client.log(ERROR, 'listObjects Error: errorCode:%s, errorMessage:%s' % (
-                resp.errorCode, resp.errorMessage))
-            break
+#!/usr/bin/python
+# -*- coding:utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+import os
+import traceback
+from obs import const, util, progress, bulktasks
+from obs.model import GetObjectRequest
+from obs.model import GetObjectHeader
+from obs.ilog import ERROR
+
+
+def _download_files(obsClient, bucketName, prefix, downloadFolder=None, taskNum=const.DEFAULT_TASK_NUM,
+                    taskQueueSize=const.DEFAULT_TASK_QUEUE_SIZE,
+                    headers=None, imageProcess=None, interval=const.DEFAULT_BYTE_INTTERVAL,
+                    taskCallback=None, progressCallback=None,
+                    threshold=const.DEFAULT_MAXIMUM_SIZE, partSize=5 * 1024 * 1024, subTaskNum=1,
+                    enableCheckpoint=False, checkpointFile=None, extensionHeaders=None):
+    if headers is None:
+        headers = GetObjectHeader()
+    try:
+        executor = None
+        notifier = None
+        _download_files_check(downloadFolder, taskCallback)
+        (taskNum, taskQueueSize, interval, threshold) = bulktasks._checkBulkTasksPara(taskNum, taskQueueSize, interval,
+                                                                                      threshold)
+
+        taskCallback = _download_files_taskCallback(taskCallback)
+        executor = bulktasks.ThreadPool(taskNum, taskQueueSize)
+        state = bulktasks.ExecuteProgress()
+        totalTasks = const.LONG(0)
+        totalAmount = const.LONG(0)
+        notifier = _download_files_notifier(progressCallback, totalAmount, interval)
+        notifier.start()
+
+        query = GetObjectRequest(imageProcess=imageProcess)
+
+        prefix = _download_files_prefix(prefix)
+        prefixDir = prefix[:prefix.rfind('/') + 1]
+
+        for content in _list_objects(obsClient, bucketName, prefix=prefix, extensionHeaders=extensionHeaders):
+            objectKey = content.key
+            totalTasks += 1
+            totalAmount += content.size
+            objectPath = objectKey.replace(prefixDir, '', 1)
+            if objectPath.startswith('/') or objectPath.find('//') != -1 or objectPath.find('\\') != -1:
+                state._failed_increment()
+                taskCallback(objectKey, Exception('illegal path: %s' % objectKey))
+                obsClient.log_client.log(ERROR, 'illegal path: %s' % objectKey)
+                continue
+
+            downloadPath = os.path.join(downloadFolder, objectPath)
+            downloadPath = util.safe_encode(downloadPath)
+            if const.IS_WINDOWS:
+                downloadPath = util.safe_trans_to_gb2312(downloadPath)
+
+            dirName = os.path.dirname(downloadPath)
+            if not os.path.exists(dirName):
+                try:
+                    os.makedirs(dirName, 0o755)
+                except Exception as e:
+                    state._failed_increment()
+                    taskCallback(objectKey, e)
+                    obsClient.log_client.log(ERROR, traceback.format_exc())
+                    continue
+
+            if objectKey.endswith('/'):
+                state._successful_increment()
+            elif content.size < threshold:
+                executor.execute(_task_wrap, obsClient, obsClient.getObject, key=objectKey,
+                                 taskCallback=taskCallback, state=state, bucketName=bucketName,
+                                 objectKey=objectKey, getObjectRequest=query, headers=headers,
+                                 downloadPath=downloadPath, notifier=notifier, extensionHeaders=extensionHeaders)
+            else:
+                executor.execute(_task_wrap, obsClient, obsClient._downloadFileWithNotifier, key=objectKey,
+                                 taskCallback=taskCallback, state=state, bucketName=bucketName,
+                                 objectKey=objectKey, downloadFile=downloadPath, partSize=partSize, taskNum=subTaskNum,
+                                 enableCheckpoint=enableCheckpoint,
+                                 checkpointFile=checkpointFile, header=headers, imageProcess=imageProcess,
+                                 notifier=notifier, extensionHeaders=extensionHeaders)
+
+        state.total_tasks = totalTasks
+        notifier.totalAmount = totalAmount
+    finally:
+        if executor is not None:
+            executor.shutdown()
+        if notifier is not None:
+            notifier.end()
+
+    return state
+
+
+def _download_files_check(downloadFolder, taskCallback):
+    if downloadFolder is None or not os.path.isdir(downloadFolder):
+        raise Exception('%s is not a Folder' % downloadFolder)
+
+    if taskCallback is not None and not callable(taskCallback):
+        raise Exception('Invalid taskCallback')
+
+
+def _download_files_taskCallback(taskCallback):
+    return taskCallback if taskCallback is not None else util.lazyCallback
+
+
+def _download_files_notifier(progressCallback, totalAmount, interval):
+    return progress.ProgressNotifier(progressCallback, totalAmount,
+                                     interval) if progressCallback is not None else progress.NONE_NOTIFIER
+
+
+def _download_files_prefix(prefix):
+    return prefix if prefix is not None else ''
+
+
+def _task_wrap(obsClient, func, key, taskCallback=None, state=None, **kwargs):
+    try:
+        res = func(**kwargs)
+        if res.status < 300:
+            state._successful_increment()
+        else:
+            state._failed_increment()
+        taskCallback(key, res)
+    except Exception as e:
+        state._failed_increment()
+        taskCallback(key, e)
+        obsClient.log_client.log(ERROR, traceback.format_exc())
+
+
+def _list_objects(obsClient, bucketName, prefix=None, marker=None, max_keys=None, delimiter=None,
+                  extensionHeaders=None):
+    while True:
+        resp = obsClient.listObjects(bucketName, max_keys=max_keys, marker=marker, prefix=prefix, delimiter=delimiter,
+                                     extensionHeaders=extensionHeaders)
+        if resp.status < 300:
+            for content in resp.body.contents:
+                yield content
+            if not resp.body.is_truncated:
+                break
+            marker = resp.body.next_marker
+        else:
+            obsClient.log_client.log(ERROR, 'listObjects Error: errorCode:%s, errorMessage:%s' % (
+                resp.errorCode, resp.errorMessage))
+            break
```

### Comparing `esdk-obs-python-3.23.9.1/obs/http2.py` & `esdk-obs-python-3.24.3/obs/http2.py`

 * *Ordering differences only*

 * *Files 15% similar despite different names*

```diff
@@ -1,169 +1,169 @@
-#!/usr/bin/python
-# -*- coding:utf-8 -*-
-# Copyright 2019 Huawei Technologies Co.,Ltd.
-# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
-# this file except in compliance with the License.  You may obtain a copy of the
-# License at
-
-# http://www.apache.org/licenses/LICENSE-2.0
-
-# Unless required by applicable law or agreed to in writing, software distributed
-# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
-# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
-# specific language governing permissions and limitations under the License.
-
-from __future__ import print_function
-import hyper
-from hyper.common import headers
-from hyper.common import util
-from hyper.http20 import stream
-from hyper.common import exceptions
-from obs import const
-import threading
-
-
-def _is_hyper_exception(e):
-    return isinstance(e, (exceptions.SocketError, exceptions.InvalidResponseError, exceptions.ConnectionResetError))
-
-
-def _get_server_connection(server, port=None, context=None, is_secure=False, proxy_host=None, proxy_port=None):
-    try:
-        return HTTP20ConnectionWrapper(host=server, port=port, ssl_context=context, secure=is_secure,
-                                       proxy_host=proxy_host, proxy_port=proxy_port)
-    except Exception as e:
-        raise e
-
-
-def to_string(item):
-    try:
-        return str(item) if item is not None else ''
-    except Exception:
-        return ''
-
-
-def _get_ssl_context(ssl_verify):
-    try:
-        from hyper import tls
-        import ssl
-        import os
-        context = tls.init_context(None, None, None)
-        context.check_hostname = False
-        if ssl_verify:
-            cafile = to_string(ssl_verify)
-            if os.path.isfile(cafile):
-                context.load_verify_locations(cafile)
-            context.verify_mode = ssl.CERT_REQUIRED
-        else:
-            context.verify_mode = ssl.CERT_NONE
-        return context
-    except Exception:
-        import traceback
-        print(traceback.format_exc())
-
-
-def canonical_form(k, v):
-    yield k, v
-
-
-headers.canonical_form = canonical_form
-
-
-def _send_chunk(self, data, final):
-    while len(data) > self._out_flow_control_window:
-        self._recv_cb()
-
-    end_stream = False
-    if len(data) <= stream.MAX_CHUNK and final:
-        end_stream = True
-
-    with self._conn as conn:
-        conn.send_data(
-            stream_id=self.stream_id, data=data, end_stream=end_stream
-        )
-    self._send_outstanding_data()
-
-    if end_stream:
-        self.local_closed = True
-
-
-def send_data(self, data, final):
-    chunks = [data[i:i + stream.MAX_CHUNK]
-              for i in range(0, len(data), stream.MAX_CHUNK)]
-
-    index = 0
-    count = len(chunks)
-    for chunk in chunks:
-        self._send_chunk(chunk, final and index == count - 1)
-        index += 1
-
-
-stream.Stream._send_chunk = _send_chunk
-stream.Stream.send_data = send_data
-
-
-class HTTP20ConnectionWrapper(hyper.HTTP20Connection):
-
-    def __init__(self, host, port=None, secure=None, window_manager=None,
-                 enable_push=False, ssl_context=None, proxy_host=None,
-                 proxy_port=None, force_proto=None, **kwargs):
-        self._stream_id_context = threading.local()
-        super(HTTP20ConnectionWrapper, self).__init__(host, port=port, secure=secure,
-                                                      window_manager=window_manager, enable_push=enable_push,
-                                                      ssl_context=ssl_context, proxy_host=proxy_host,
-                                                      proxy_port=proxy_port, force_proto=force_proto, **kwargs)
-
-    def getresponse(self, stream_id=None):
-        stream_id = stream_id or (
-            self._stream_id_context.stream_id if hasattr(self._stream_id_context, 'stream_id') else None)
-        stream = self._get_stream(stream_id)
-        return HTTP20ResponseWrapper(stream.getheaders(), stream)
-
-    def request(self, method, url, body=None, headers=None):
-        headers = headers or {}
-        if const.HOST_HEADER in headers:
-            headers[':authority'] = headers[const.HOST_HEADER]
-
-        with self._write_lock:
-            stream_id = self.putrequest(method, url)
-            self._stream_id_context.stream_id = stream_id
-            default_headers = (':method', ':scheme', ':authority', ':path')
-            for name, value in headers.items():
-                is_default = util.to_native_string(name) in default_headers
-                if isinstance(value, list):
-                    for item in value:
-                        self.putheader(name, item, stream_id, replace=is_default)
-                else:
-                    self.putheader(name, value, stream_id, replace=is_default)
-
-            final = True
-            message_body = body
-            if body is not None:
-                if callable(body):
-                    final = False
-                    message_body = None
-                else:
-                    if isinstance(body, (unicode, bytes)):
-                        message_body = util.to_bytestring(body)
-                    if len(message_body) == 0:
-                        message_body = None
-
-            self.endheaders(message_body=message_body, final=final, stream_id=stream_id)
-            if not final:
-                body(self)
-
-            return stream_id
-
-    def send(self, data, final=False, stream_id=None):
-        stream_id = stream_id or (
-            self._stream_id_context.stream_id if hasattr(self._stream_id_context, 'stream_id') else None)
-        stream = self._get_stream(stream_id)
-        stream.send_data(data, final)
-
-
-class HTTP20ResponseWrapper(hyper.HTTP20Response):
-    def getheader(self, key, default_value=None):
-        ret = self.headers.get(key)
-        return ret if ret is not None else default_value
-
-    def getheaders(self):
-        return self.headers
+#!/usr/bin/python
+# -*- coding:utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+from __future__ import print_function
+import hyper
+from hyper.common import headers
+from hyper.common import util
+from hyper.http20 import stream
+from hyper.common import exceptions
+from obs import const
+import threading
+
+
+def _is_hyper_exception(e):
+    return isinstance(e, (exceptions.SocketError, exceptions.InvalidResponseError, exceptions.ConnectionResetError))
+
+
+def _get_server_connection(server, port=None, context=None, is_secure=False, proxy_host=None, proxy_port=None):
+    try:
+        return HTTP20ConnectionWrapper(host=server, port=port, ssl_context=context, secure=is_secure,
+                                       proxy_host=proxy_host, proxy_port=proxy_port)
+    except Exception as e:
+        raise e
+
+
+def to_string(item):
+    try:
+        return str(item) if item is not None else ''
+    except Exception:
+        return ''
+
+
+def _get_ssl_context(ssl_verify):
+    try:
+        from hyper import tls
+        import ssl
+        import os
+        context = tls.init_context(None, None, None)
+        context.check_hostname = False
+        if ssl_verify:
+            cafile = to_string(ssl_verify)
+            if os.path.isfile(cafile):
+                context.load_verify_locations(cafile)
+            context.verify_mode = ssl.CERT_REQUIRED
+        else:
+            context.verify_mode = ssl.CERT_NONE
+        return context
+    except Exception:
+        import traceback
+        print(traceback.format_exc())
+
+
+def canonical_form(k, v):
+    yield k, v
+
+
+headers.canonical_form = canonical_form
+
+
+def _send_chunk(self, data, final):
+    while len(data) > self._out_flow_control_window:
+        self._recv_cb()
+
+    end_stream = False
+    if len(data) <= stream.MAX_CHUNK and final:
+        end_stream = True
+
+    with self._conn as conn:
+        conn.send_data(
+            stream_id=self.stream_id, data=data, end_stream=end_stream
+        )
+    self._send_outstanding_data()
+
+    if end_stream:
+        self.local_closed = True
+
+
+def send_data(self, data, final):
+    chunks = [data[i:i + stream.MAX_CHUNK]
+              for i in range(0, len(data), stream.MAX_CHUNK)]
+
+    index = 0
+    count = len(chunks)
+    for chunk in chunks:
+        self._send_chunk(chunk, final and index == count - 1)
+        index += 1
+
+
+stream.Stream._send_chunk = _send_chunk
+stream.Stream.send_data = send_data
+
+
+class HTTP20ConnectionWrapper(hyper.HTTP20Connection):
+
+    def __init__(self, host, port=None, secure=None, window_manager=None,
+                 enable_push=False, ssl_context=None, proxy_host=None,
+                 proxy_port=None, force_proto=None, **kwargs):
+        self._stream_id_context = threading.local()
+        super(HTTP20ConnectionWrapper, self).__init__(host, port=port, secure=secure,
+                                                      window_manager=window_manager, enable_push=enable_push,
+                                                      ssl_context=ssl_context, proxy_host=proxy_host,
+                                                      proxy_port=proxy_port, force_proto=force_proto, **kwargs)
+
+    def getresponse(self, stream_id=None):
+        stream_id = stream_id or (
+            self._stream_id_context.stream_id if hasattr(self._stream_id_context, 'stream_id') else None)
+        stream = self._get_stream(stream_id)
+        return HTTP20ResponseWrapper(stream.getheaders(), stream)
+
+    def request(self, method, url, body=None, headers=None):
+        headers = headers or {}
+        if const.HOST_HEADER in headers:
+            headers[':authority'] = headers[const.HOST_HEADER]
+
+        with self._write_lock:
+            stream_id = self.putrequest(method, url)
+            self._stream_id_context.stream_id = stream_id
+            default_headers = (':method', ':scheme', ':authority', ':path')
+            for name, value in headers.items():
+                is_default = util.to_native_string(name) in default_headers
+                if isinstance(value, list):
+                    for item in value:
+                        self.putheader(name, item, stream_id, replace=is_default)
+                else:
+                    self.putheader(name, value, stream_id, replace=is_default)
+
+            final = True
+            message_body = body
+            if body is not None:
+                if callable(body):
+                    final = False
+                    message_body = None
+                else:
+                    if isinstance(body, (unicode, bytes)):
+                        message_body = util.to_bytestring(body)
+                    if len(message_body) == 0:
+                        message_body = None
+
+            self.endheaders(message_body=message_body, final=final, stream_id=stream_id)
+            if not final:
+                body(self)
+
+            return stream_id
+
+    def send(self, data, final=False, stream_id=None):
+        stream_id = stream_id or (
+            self._stream_id_context.stream_id if hasattr(self._stream_id_context, 'stream_id') else None)
+        stream = self._get_stream(stream_id)
+        stream.send_data(data, final)
+
+
+class HTTP20ResponseWrapper(hyper.HTTP20Response):
+    def getheader(self, key, default_value=None):
+        ret = self.headers.get(key)
+        return ret if ret is not None else default_value
+
+    def getheaders(self):
+        return self.headers
```

### Comparing `esdk-obs-python-3.23.9.1/obs/ilog.py` & `esdk-obs-python-3.24.3/obs/ilog.py`

 * *Ordering differences only*

 * *Files 21% similar despite different names*

```diff
@@ -1,147 +1,147 @@
-#!/usr/bin/python
-# -*- coding:utf-8 -*-
-# Copyright 2019 Huawei Technologies Co.,Ltd.
-# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
-# this file except in compliance with the License.  You may obtain a copy of the
-# License at
-
-# http://www.apache.org/licenses/LICENSE-2.0
-
-# Unless required by applicable law or agreed to in writing, software distributed
-# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
-# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
-# specific language governing permissions and limitations under the License.
-
-import os
-import sys
-import logging.handlers
-from obs.const import IS_WINDOWS, IS_PYTHON2
-
-import threading
-
-_lock = threading.Lock()
-
-if IS_PYTHON2:
-    from ConfigParser import ConfigParser
-else:
-    from configparser import ConfigParser
-
-_handler = logging.handlers.RotatingFileHandler
-
-CRITICAL = logging.CRITICAL
-ERROR = logging.ERROR
-WARNING = logging.WARNING
-INFO = logging.INFO
-DEBUG = logging.DEBUG
-
-LOG_LEVEL_DICT = {'CRITICAL': CRITICAL, 'ERROR': ERROR, 'WARNING': WARNING, 'INFO': INFO, 'DEBUG': DEBUG}
-
-
-class LogConf(object):
-    def __init__(self, config_file=None, sec='LOGCONF'):
-        self.disable = True
-        if config_file:
-            str_path = os.path.abspath(config_file)
-            if not os.path.exists(str_path):
-                raise Exception('%s is not exist' % (str_path))
-
-            cf = ConfigParser()
-            read_ok = cf.read(config_file) if IS_PYTHON2 else cf.read(config_file, 'UTF-8')
-
-            if read_ok:
-                secs = cf.sections()
-                if sec not in secs:
-                    raise Exception('%s is not in secs:%s' % (sec, str(secs)))
-
-                items = cf.items(sec)
-                idict = {}
-                for e in items:
-                    idict[e[0]] = e[1]
-                self.log_file_dir = idict.get('logfiledir', './')
-                self.log_file_name = idict.get('logfilename', 'log.log')
-                self.log_file_number = int(idict.get('logfilenumber', 0))
-                self.log_file_size = int(idict.get('logfilesize', 0))
-                self.print_log_to_console = int(idict.get('printlogtoconsole', 0))
-                log_file_level = idict.get('logfilelevel')
-                print_log_level = idict.get('printloglevel')
-                self.log_file_level = LOG_LEVEL_DICT.get(log_file_level, DEBUG)
-                self.print_log_level = LOG_LEVEL_DICT.get(print_log_level, DEBUG)
-                self.disable = False
-
-
-class NoneLogClient(object):
-    def log(self, level, msg, *args, **kwargs):
-        pass
-
-    def close(self):
-        pass
-
-
-class LogClient(object):
-    def __init__(self, log_config, log_name='OBS_LOGGER', display_name=None):
-        if not log_config or not isinstance(log_config, LogConf):
-            raise Exception('log config is not correct')
-        self.log_config = log_config
-        if display_name is None:
-            display_name = log_name
-        self.display_name = display_name
-        self.logger = logging.getLogger(log_name)
-        if not hasattr(self.logger, '_inited'):
-            self.logger.setLevel(logging.DEBUG)
-            if hasattr(self.logger, 'propagate'):
-                self.logger.propagate = False
-            if not log_config.disable:
-                self.initLogger()
-            self.logger._inited = 1
-
-    def initLogger(self):
-        if not os.path.exists(self.log_config.log_file_dir):
-            with _lock:
-                if not os.path.exists(self.log_config.log_file_dir):
-                    os.makedirs(self.log_config.log_file_dir, 0o755)
-
-        sep = '\\' if IS_WINDOWS else '/'
-        logfilepath = self.log_config.log_file_dir + sep + self.log_config.log_file_name
-        encoding = None if IS_PYTHON2 else 'UTF-8'
-        formatter_handle = _handler(filename=logfilepath, encoding=encoding,
-                                    maxBytes=1024 * 1024 * self.log_config.log_file_size,
-                                    backupCount=self.log_config.log_file_number)
-        formatter_handle.setLevel(self.log_config.log_file_level)
-        formatter = logging.Formatter(
-            '%(asctime)s|process:%(process)d|thread:%(thread)d|%(levelname)s|HTTP(s)+XML|%(message)s|')
-        formatter_handle.setFormatter(formatter)
-
-        self.logger.addHandler(formatter_handle)
-        if self.log_config.print_log_to_console == 1:
-            console_handler = logging.StreamHandler()
-            console_handler.setLevel(self.log_config.print_log_level)
-            console_handler.setFormatter(formatter)
-            self.logger.addHandler(console_handler)
-
-    def close(self):
-        for handle in self.logger.handlers:
-            try:
-                handle.close()
-            except Exception:
-                print("exception of log handle close")
-
-    def log(self, level, msg, *args, **kwargs):
-        base_back = sys._getframe().f_back
-        func_name = base_back.f_code.co_name
-        while func_name.lower() == 'log':
-            base_back = base_back.f_back
-            func_name = base_back.f_code.co_name
-        line = base_back.f_lineno
-        msg = '%(logger)s|%(name)s,%(lineno)d|' % {'logger': self.display_name, 'name': func_name,
-                                                   'lineno': int(line)} + str(msg)
-
-        if level == CRITICAL:
-            self.logger.critical(msg, *args, **kwargs)
-        elif level == ERROR:
-            self.logger.error(msg, *args, **kwargs)
-        elif level == WARNING:
-            self.logger.warning(msg, *args, **kwargs)
-        elif level == INFO:
-            self.logger.info(msg, *args, **kwargs)
-        elif level == DEBUG:
-            self.logger.debug(msg, *args, **kwargs)
+#!/usr/bin/python
+# -*- coding:utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+import os
+import sys
+import logging.handlers
+from obs.const import IS_WINDOWS, IS_PYTHON2
+
+import threading
+
+_lock = threading.Lock()
+
+if IS_PYTHON2:
+    from ConfigParser import ConfigParser
+else:
+    from configparser import ConfigParser
+
+_handler = logging.handlers.RotatingFileHandler
+
+CRITICAL = logging.CRITICAL
+ERROR = logging.ERROR
+WARNING = logging.WARNING
+INFO = logging.INFO
+DEBUG = logging.DEBUG
+
+LOG_LEVEL_DICT = {'CRITICAL': CRITICAL, 'ERROR': ERROR, 'WARNING': WARNING, 'INFO': INFO, 'DEBUG': DEBUG}
+
+
+class LogConf(object):
+    def __init__(self, config_file=None, sec='LOGCONF'):
+        self.disable = True
+        if config_file:
+            str_path = os.path.abspath(config_file)
+            if not os.path.exists(str_path):
+                raise Exception('%s is not exist' % (str_path))
+
+            cf = ConfigParser()
+            read_ok = cf.read(config_file) if IS_PYTHON2 else cf.read(config_file, 'UTF-8')
+
+            if read_ok:
+                secs = cf.sections()
+                if sec not in secs:
+                    raise Exception('%s is not in secs:%s' % (sec, str(secs)))
+
+                items = cf.items(sec)
+                idict = {}
+                for e in items:
+                    idict[e[0]] = e[1]
+                self.log_file_dir = idict.get('logfiledir', './')
+                self.log_file_name = idict.get('logfilename', 'log.log')
+                self.log_file_number = int(idict.get('logfilenumber', 0))
+                self.log_file_size = int(idict.get('logfilesize', 0))
+                self.print_log_to_console = int(idict.get('printlogtoconsole', 0))
+                log_file_level = idict.get('logfilelevel')
+                print_log_level = idict.get('printloglevel')
+                self.log_file_level = LOG_LEVEL_DICT.get(log_file_level, DEBUG)
+                self.print_log_level = LOG_LEVEL_DICT.get(print_log_level, DEBUG)
+                self.disable = False
+
+
+class NoneLogClient(object):
+    def log(self, level, msg, *args, **kwargs):
+        pass
+
+    def close(self):
+        pass
+
+
+class LogClient(object):
+    def __init__(self, log_config, log_name='OBS_LOGGER', display_name=None):
+        if not log_config or not isinstance(log_config, LogConf):
+            raise Exception('log config is not correct')
+        self.log_config = log_config
+        if display_name is None:
+            display_name = log_name
+        self.display_name = display_name
+        self.logger = logging.getLogger(log_name)
+        if not hasattr(self.logger, '_inited'):
+            self.logger.setLevel(logging.DEBUG)
+            if hasattr(self.logger, 'propagate'):
+                self.logger.propagate = False
+            if not log_config.disable:
+                self.initLogger()
+            self.logger._inited = 1
+
+    def initLogger(self):
+        if not os.path.exists(self.log_config.log_file_dir):
+            with _lock:
+                if not os.path.exists(self.log_config.log_file_dir):
+                    os.makedirs(self.log_config.log_file_dir, 0o755)
+
+        sep = '\\' if IS_WINDOWS else '/'
+        logfilepath = self.log_config.log_file_dir + sep + self.log_config.log_file_name
+        encoding = None if IS_PYTHON2 else 'UTF-8'
+        formatter_handle = _handler(filename=logfilepath, encoding=encoding,
+                                    maxBytes=1024 * 1024 * self.log_config.log_file_size,
+                                    backupCount=self.log_config.log_file_number)
+        formatter_handle.setLevel(self.log_config.log_file_level)
+        formatter = logging.Formatter(
+            '%(asctime)s|process:%(process)d|thread:%(thread)d|%(levelname)s|HTTP(s)+XML|%(message)s|')
+        formatter_handle.setFormatter(formatter)
+
+        self.logger.addHandler(formatter_handle)
+        if self.log_config.print_log_to_console == 1:
+            console_handler = logging.StreamHandler()
+            console_handler.setLevel(self.log_config.print_log_level)
+            console_handler.setFormatter(formatter)
+            self.logger.addHandler(console_handler)
+
+    def close(self):
+        for handle in self.logger.handlers:
+            try:
+                handle.close()
+            except Exception:
+                print("exception of log handle close")
+
+    def log(self, level, msg, *args, **kwargs):
+        base_back = sys._getframe().f_back
+        func_name = base_back.f_code.co_name
+        while func_name.lower() == 'log':
+            base_back = base_back.f_back
+            func_name = base_back.f_code.co_name
+        line = base_back.f_lineno
+        msg = '%(logger)s|%(name)s,%(lineno)d|' % {'logger': self.display_name, 'name': func_name,
+                                                   'lineno': int(line)} + str(msg)
+
+        if level == CRITICAL:
+            self.logger.critical(msg, *args, **kwargs)
+        elif level == ERROR:
+            self.logger.error(msg, *args, **kwargs)
+        elif level == WARNING:
+            self.logger.warning(msg, *args, **kwargs)
+        elif level == INFO:
+            self.logger.info(msg, *args, **kwargs)
+        elif level == DEBUG:
+            self.logger.debug(msg, *args, **kwargs)
```

### Comparing `esdk-obs-python-3.23.9.1/obs/loadtoken.py` & `esdk-obs-python-3.24.3/obs/loadtoken.py`

 * *Ordering differences only*

 * *Files 22% similar despite different names*

```diff
@@ -1,184 +1,184 @@
-#!/usr/bin/python
-# -*- coding:utf-8 -*-
-# Copyright 2019 Huawei Technologies Co.,Ltd.
-# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
-# this file except in compliance with the License.  You may obtain a copy of the
-# License at
-
-# http://www.apache.org/licenses/LICENSE-2.0
-
-# Unless required by applicable law or agreed to in writing, software distributed
-# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
-# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
-# specific language governing permissions and limitations under the License.
-
-import os
-import re
-from obs import const
-import threading
-
-
-class NoneTokenException(Exception):
-    def __init__(self, errorInfo):
-        super(NoneTokenException, self).__init__(self)
-        self.errorInfo = errorInfo
-
-    def __str__(self):
-        return self.errorInfo
-
-
-class ENV(object):
-
-    @staticmethod
-    def search():
-        reAccessKey = 'OBS_ACCESS_KEY_ID'
-        reSecretKey = 'OBS_SECRET_ACCESS_KEY'
-        reSecurityToken = 'OBS_SECURITY_TOKEN'
-
-        accessKey = os.environ.get(reAccessKey)
-        secretKey = os.environ.get(reSecretKey)
-        securityToken = os.environ.get(reSecurityToken)
-
-        if accessKey is None or secretKey is None:
-            raise NoneTokenException('get token failed')
-
-        return {'accessKey': accessKey,
-                'secretKey': secretKey,
-                'securityToken': securityToken}
-
-
-class ECS(object):
-    ak = None
-    sk = None
-    token = None
-    expires = None
-    lock = threading.Lock()
-
-    @staticmethod
-    def search():
-        if const.IS_PYTHON2:
-            import httplib
-        else:
-            import http.client as httplib
-        from datetime import datetime
-        from datetime import timedelta
-
-        hostIP = '169.254.169.254'
-        contactURL = '/openstack/latest/securitykey'
-
-        res = ECS._search_handle_expires(datetime, timedelta)
-        if res is not None:
-            return res
-
-        if ECS.lock.acquire():
-            try:
-                res = ECS._search_handle_lock_acquire(datetime, timedelta)
-                if res is not None:
-                    return res
-
-                accessKey = None
-                secretKey = None
-                securityToken = None
-                expiresAt = None
-                try:
-                    conn = httplib.HTTPConnection(hostIP)
-                    conn.request('GET', contactURL)
-                    result = ECS._search_get_result(conn)
-                    responseBody = result.read()
-                except Exception:
-                    if ECS._search_judge(datetime):
-                        return {
-                            'accessKey': ECS.ak,
-                            'secretKey': ECS.sk,
-                            'securityToken': ECS.token
-                        }
-                    raise
-                finally:
-                    conn.close()
-
-                try:
-                    reAccessKey = r'.*"access": "(.*?)",'
-                    reSecretKey = r'.*"secret": "(.*?)",'
-                    reSecurityToken = r'.*"securitytoken": "(.*?)"'
-                    reExpires = r'.*"expires_at": "(.*?)",'
-
-                    patternA = re.compile(reAccessKey)
-                    patternS = re.compile(reSecretKey)
-                    patternT = re.compile(reSecurityToken)
-                    patternE = re.compile(reExpires)
-
-                    responseBody = ECS._search_handle_response_body(responseBody)
-
-                    resultS = patternS.match(responseBody)
-                    resultA = patternA.match(responseBody)
-                    resultT = patternT.match(responseBody)
-                    resultE = patternE.match(responseBody)
-                except Exception:
-                    if ECS._search_judge(datetime):
-                        return {
-                            'accessKey': ECS.ak,
-                            'secretKey': ECS.sk,
-                            'securityToken': ECS.token
-                        }
-                    raise
-
-                if resultA is None or resultS is None or resultT is None or resultE is None:
-                    if ECS._search_judge(datetime):
-                        return {
-                            'accessKey': ECS.ak,
-                            'secretKey': ECS.sk,
-                            'securityToken': ECS.token
-                        }
-                    raise NoneTokenException('get token failed')
-
-                accessKey = resultA.group(1)
-                secretKey = resultS.group(1)
-                securityToken = resultT.group(1)
-                expiresAt = resultE.group(1)
-
-                ECS.ak = accessKey
-                ECS.sk = secretKey
-                ECS.token = securityToken
-                ECS.expires = datetime.strptime(expiresAt, '%Y-%m-%dT%H:%M:%S.%fZ')
-
-                return {
-                    'accessKey': accessKey,
-                    'secretKey': secretKey,
-                    'securityToken': securityToken
-                }
-            finally:
-                ECS.lock.release()
-
-    @staticmethod
-    def _search_handle_expires(datetime, timedelta):
-        if ECS.expires is not None:
-            token_date_now = datetime.utcnow()
-            if token_date_now < (ECS.expires - timedelta(minutes=10)):
-                return {
-                    'accessKey': ECS.ak,
-                    'secretKey': ECS.sk,
-                    'securityToken': ECS.token
-                }
-
-    @staticmethod
-    def _search_handle_lock_acquire(datetime, timedelta):
-        if ECS.expires is not None and datetime.utcnow() < (ECS.expires - timedelta(minutes=10)):
-            return {
-                'accessKey': ECS.ak,
-                'secretKey': ECS.sk,
-                'securityToken': ECS.token
-            }
-
-    @staticmethod
-    def _search_handle_response_body(responseBody):
-        if not const.IS_PYTHON2:
-            return responseBody.decode('utf-8')
-        return responseBody
-
-    @staticmethod
-    def _search_judge(datetime):
-        return ECS.expires is not None and datetime.utcnow() < ECS.expires
-
-    @staticmethod
-    def _search_get_result(conn):
-        return conn.getresponse(True) if const.IS_PYTHON2 else conn.getresponse()
+#!/usr/bin/python
+# -*- coding:utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+import os
+import re
+from obs import const
+import threading
+
+
+class NoneTokenException(Exception):
+    def __init__(self, errorInfo):
+        super(NoneTokenException, self).__init__(self)
+        self.errorInfo = errorInfo
+
+    def __str__(self):
+        return self.errorInfo
+
+
+class ENV(object):
+
+    @staticmethod
+    def search():
+        reAccessKey = 'OBS_ACCESS_KEY_ID'
+        reSecretKey = 'OBS_SECRET_ACCESS_KEY'
+        reSecurityToken = 'OBS_SECURITY_TOKEN'
+
+        accessKey = os.environ.get(reAccessKey)
+        secretKey = os.environ.get(reSecretKey)
+        securityToken = os.environ.get(reSecurityToken)
+
+        if accessKey is None or secretKey is None:
+            raise NoneTokenException('get token failed')
+
+        return {'accessKey': accessKey,
+                'secretKey': secretKey,
+                'securityToken': securityToken}
+
+
+class ECS(object):
+    ak = None
+    sk = None
+    token = None
+    expires = None
+    lock = threading.Lock()
+
+    @staticmethod
+    def search():
+        if const.IS_PYTHON2:
+            import httplib
+        else:
+            import http.client as httplib
+        from datetime import datetime
+        from datetime import timedelta
+
+        hostIP = '169.254.169.254'
+        contactURL = '/openstack/latest/securitykey'
+
+        res = ECS._search_handle_expires(datetime, timedelta)
+        if res is not None:
+            return res
+
+        if ECS.lock.acquire():
+            try:
+                res = ECS._search_handle_lock_acquire(datetime, timedelta)
+                if res is not None:
+                    return res
+
+                accessKey = None
+                secretKey = None
+                securityToken = None
+                expiresAt = None
+                try:
+                    conn = httplib.HTTPConnection(hostIP)
+                    conn.request('GET', contactURL)
+                    result = ECS._search_get_result(conn)
+                    responseBody = result.read()
+                except Exception:
+                    if ECS._search_judge(datetime):
+                        return {
+                            'accessKey': ECS.ak,
+                            'secretKey': ECS.sk,
+                            'securityToken': ECS.token
+                        }
+                    raise
+                finally:
+                    conn.close()
+
+                try:
+                    reAccessKey = r'.*"access": "(.*?)",'
+                    reSecretKey = r'.*"secret": "(.*?)",'
+                    reSecurityToken = r'.*"securitytoken": "(.*?)"'
+                    reExpires = r'.*"expires_at": "(.*?)",'
+
+                    patternA = re.compile(reAccessKey)
+                    patternS = re.compile(reSecretKey)
+                    patternT = re.compile(reSecurityToken)
+                    patternE = re.compile(reExpires)
+
+                    responseBody = ECS._search_handle_response_body(responseBody)
+
+                    resultS = patternS.match(responseBody)
+                    resultA = patternA.match(responseBody)
+                    resultT = patternT.match(responseBody)
+                    resultE = patternE.match(responseBody)
+                except Exception:
+                    if ECS._search_judge(datetime):
+                        return {
+                            'accessKey': ECS.ak,
+                            'secretKey': ECS.sk,
+                            'securityToken': ECS.token
+                        }
+                    raise
+
+                if resultA is None or resultS is None or resultT is None or resultE is None:
+                    if ECS._search_judge(datetime):
+                        return {
+                            'accessKey': ECS.ak,
+                            'secretKey': ECS.sk,
+                            'securityToken': ECS.token
+                        }
+                    raise NoneTokenException('get token failed')
+
+                accessKey = resultA.group(1)
+                secretKey = resultS.group(1)
+                securityToken = resultT.group(1)
+                expiresAt = resultE.group(1)
+
+                ECS.ak = accessKey
+                ECS.sk = secretKey
+                ECS.token = securityToken
+                ECS.expires = datetime.strptime(expiresAt, '%Y-%m-%dT%H:%M:%S.%fZ')
+
+                return {
+                    'accessKey': accessKey,
+                    'secretKey': secretKey,
+                    'securityToken': securityToken
+                }
+            finally:
+                ECS.lock.release()
+
+    @staticmethod
+    def _search_handle_expires(datetime, timedelta):
+        if ECS.expires is not None:
+            token_date_now = datetime.utcnow()
+            if token_date_now < (ECS.expires - timedelta(minutes=10)):
+                return {
+                    'accessKey': ECS.ak,
+                    'secretKey': ECS.sk,
+                    'securityToken': ECS.token
+                }
+
+    @staticmethod
+    def _search_handle_lock_acquire(datetime, timedelta):
+        if ECS.expires is not None and datetime.utcnow() < (ECS.expires - timedelta(minutes=10)):
+            return {
+                'accessKey': ECS.ak,
+                'secretKey': ECS.sk,
+                'securityToken': ECS.token
+            }
+
+    @staticmethod
+    def _search_handle_response_body(responseBody):
+        if not const.IS_PYTHON2:
+            return responseBody.decode('utf-8')
+        return responseBody
+
+    @staticmethod
+    def _search_judge(datetime):
+        return ECS.expires is not None and datetime.utcnow() < ECS.expires
+
+    @staticmethod
+    def _search_get_result(conn):
+        return conn.getresponse(True) if const.IS_PYTHON2 else conn.getresponse()
```

### Comparing `esdk-obs-python-3.23.9.1/obs/locks.py` & `esdk-obs-python-3.24.3/obs/locks.py`

 * *Ordering differences only*

 * *Files 18% similar despite different names*

```diff
@@ -1,28 +1,28 @@
-#!/usr/bin/env python
-# -*- coding: utf-8 -*-
-# Copyright 2019 Huawei Technologies Co.,Ltd.
-# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
-# this file except in compliance with the License.  You may obtain a copy of the
-# License at
-
-# http://www.apache.org/licenses/LICENSE-2.0
-
-# Unless required by applicable law or agreed to in writing, software distributed
-# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
-# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
-# specific language governing permissions and limitations under the License.
-
-import threading
-
-LOCK_COUNT = 16
-lock_list = []
-
-for i in range(LOCK_COUNT):
-    lock_list.append(threading.RLock())
-
-
-def get_lock(index):
-    if index < 0 or index >= LOCK_COUNT:
-        raise Exception('cannot find a valid lock')
-
-    return lock_list[index]
+#!/usr/bin/env python
+# -*- coding: utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+import threading
+
+LOCK_COUNT = 16
+lock_list = []
+
+for i in range(LOCK_COUNT):
+    lock_list.append(threading.RLock())
+
+
+def get_lock(index):
+    if index < 0 or index >= LOCK_COUNT:
+        raise Exception('cannot find a valid lock')
+
+    return lock_list[index]
```

### Comparing `esdk-obs-python-3.23.9.1/obs/model.py` & `esdk-obs-python-3.24.3/obs/model.py`

 * *Ordering differences only*

 * *Files 27% similar despite different names*

```diff
@@ -1,1690 +1,1690 @@
-#!/usr/bin/python
-# -*- coding:utf-8 -*-
-# Copyright 2019 Huawei Technologies Co.,Ltd.
-# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
-# this file except in compliance with the License.  You may obtain a copy of the
-# License at
-
-# http://www.apache.org/licenses/LICENSE-2.0
-
-# Unless required by applicable law or agreed to in writing, software distributed
-# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
-# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
-# specific language governing permissions and limitations under the License.
-
-import time
-from obs.const import LONG, BASESTRING
-from obs import util
-from obs import progress
-
-__all__ = [
-    'BaseModel',
-    'GetResult',
-    'CompletePart',
-    'Permission',
-    'StorageClass',
-    'EventType',
-    'RestoreTier',
-    'Group',
-    'Grantee',
-    'Grant',
-    'ExtensionGrant',
-    'Owner',
-    'Initiator',
-    'ACL',
-    'Bucket',
-    'CommonPrefix',
-    'Condition',
-    'Content',
-    'DateTime',
-    'SseHeader',
-    'SseCHeader',
-    'SseKmsHeader',
-    'CopyObjectHeader',
-    'SetObjectMetadataHeader',
-    'CorsRule',
-    'CreateBucketHeader',
-    'ErrorDocument',
-    'IndexDocument',
-    'Expiration',
-    'NoncurrentVersionExpiration',
-    'AbortIncompleteMultipartUpload',
-    'GetObjectHeader',
-    'HeadPermission',
-    'Lifecycle',
-    'Notification',
-    'TopicConfiguration',
-    'FunctionGraphConfiguration',
-    'FilterRule',
-    'Replication',
-    'ReplicationRule',
-    'ObjectDeleteMarker',
-    'ObjectVersionHead',
-    'ObjectVersion',
-    'Options',
-    'Policy',
-    'PutObjectHeader',
-    'AppendObjectHeader',
-    'AppendObjectContent',
-    'RedirectAllRequestTo',
-    'Redirect',
-    'RoutingRule',
-    'Tag',
-    'TagInfo',
-    'Transition',
-    'Part',
-    'NoncurrentVersionTransition',
-    'Rule',
-    'Upload',
-    'Versions',
-    'Object',
-    'WebsiteConfiguration',
-    'Logging',
-    'ObjectVersions',
-    'CompleteMultipartUploadRequest',
-    'CompleteMultipartUploadResponse',
-    'CopyObjectResponse',
-    'CopyPartResponse',
-    'DeleteObjectResponse',
-    'DeleteObjectsRequest',
-    'DeleteObjectsResponse',
-    'ErrorResult',
-    'DeleteObjectResult',
-    'ListMultipartUploadsRequest',
-    'ListPartsResponse',
-    'GetBucketMetadataResponse',
-    'GetBucketQuotaResponse',
-    'GetBucketStorageInfoResponse',
-    'GetBucketStoragePolicyResponse',
-    'GetObjectMetadataResponse',
-    'SetObjectMetadataResponse',
-    'GetObjectRequest',
-    'InitiateMultipartUploadResponse',
-    'LifecycleResponse',
-    'ListBucketsResponse',
-    'ListMultipartUploadsResponse',
-    'ListObjectsResponse',
-    'LocationResponse',
-    'OptionsResponse',
-    'PutContentResponse',
-    'AppendObjectResponse',
-    'UploadPartResponse',
-    'ResponseWrapper',
-    'ObjectStream',
-    'GetBucketEncryptionResponse',
-    'UploadFileHeader',
-    'GetBucketRequestPaymentResponse',
-    'Payer',
-    'ExtensionHeader',
-    'FetchStatus',
-    'FetchPolicy',
-    '_FetchJob',
-    'FetchJobResponse',
-    'SetBucketFetchJobResponse',
-    'GetBucketFetchJobResponse',
-    'CreateWorkflowTemplateResponse',
-    'GetWorkflowTemplateResponse',
-    'ListWorkflowTemplateResponse',
-    'CreateWorkflowResponse',
-    'GetWorkflowResponse',
-    'UpdateWorkflowResponse',
-    'ListWorkflowResponse',
-    'AsyncAPIStartWorkflowResponse',
-    'ListWorkflowExecutionResponse',
-    'GetWorkflowExecutionResponse',
-    'RestoreFailedWorkflowExecutionResponse',
-    'GetTriggerPolicyResponse',
-    'BucketAliasModel',
-    'ListBucketAliasModel'
-]
-
-
-class BaseModel(dict):
-    def __init__(self, **kwargs):
-        super(BaseModel, self).__init__(**kwargs)
-
-    def __getattr__(self, key):
-        if key == 'allowedAttr':
-            return {}
-        key = key[:1].lower() + key[1:] if key is not None else ''
-        if key in self.allowedAttr:
-            return self.get(key)
-        return None
-
-    def __setattr__(self, key, value):
-        key = key[:1].lower() + key[1:] if key is not None else ''
-        if key in self.allowedAttr:
-            if util.verify_attr_type(value, self.allowedAttr[key]):
-                self[key] = value
-
-    def __delattr__(self, key):
-        key = key[:1].lower() + key[1:] if key is not None else ''
-        if key in self.allowedAttr and key in self:
-            del self[key]
-
-
-class GetResult(BaseModel):
-    allowedAttr = {'status': int, 'reason': BASESTRING, 'errorCode': BASESTRING, 'errorMessage': BASESTRING,
-                   'body': object, 'requestId': BASESTRING, 'hostId': BASESTRING, 'resource': BASESTRING,
-                   'header': list,
-                   'indicator': BASESTRING}
-
-    def __init__(self, code=None, message=None, status=None, reason=None, body=None, requestId=None, hostId=None,
-                 resource=None, header=None, indicator=None):
-        self.status = status
-        self.reason = reason
-        self.errorCode = code
-        self.errorMessage = message
-        self.body = body
-        self.requestId = requestId
-        self.hostId = hostId
-        self.resource = resource
-        self.header = header
-        self.indicator = indicator
-
-
-class CompletePart(BaseModel):
-    allowedAttr = {'partNum': int, 'etag': BASESTRING}
-
-    def __init__(self, partNum=None, etag=None):
-        self.partNum = partNum
-        self.etag = etag
-
-
-class AvailableZone(object):
-    MULTI_AZ = '3az'
-
-
-class Permission(object):
-    READ = 'READ'
-    WRITE = 'WRITE'
-    READ_ACP = 'READ_ACP'
-    WRITE_ACP = 'WRITE_ACP'
-    FULL_CONTROL = 'FULL_CONTROL'
-
-
-class Group(object):
-    ALL_USERS = 'Everyone'
-    AUTHENTICATED_USERS = 'AuthenticatedUsers'
-    LOG_DELIVERY = 'LogDelivery'
-
-
-class HeadPermission(object):
-    PRIVATE = 'private'
-    PUBLIC_READ = 'public-read'
-    PUBLIC_READ_WRITE = 'public-read-write'
-    PUBLIC_READ_DELIVERED = 'public-read-delivered'
-    PUBLIC_READ_WRITE_DELIVERED = 'public-read-write-delivered'
-    AUTHENTICATED_READ = 'authenticated-read'
-    BUCKET_OWNER_READ = 'bucket-owner-read'
-    BUCKET_OWNER_FULL_CONTROL = 'bucket-owner-full-control'
-    LOG_DELIVERY_WRITE = 'log-delivery-write'
-
-
-class StorageClass(object):
-    STANDARD = 'STANDARD'
-    WARM = 'WARM'
-    COLD = 'COLD'
-
-
-class RestoreTier(object):
-    EXPEDITED = 'Expedited'
-    STANDARD = 'STANDARD'
-    BULK = 'Bulk'
-
-
-class EventType(object):
-    OBJECT_CREATED_ALL = 'ObjectCreated:*'
-    OBJECT_CREATED_PUT = 'ObjectCreated:Put'
-    OBJECT_CREATED_POST = 'ObjectCreated:Post'
-    OBJECT_CREATED_COPY = 'ObjectCreated:Copy'
-    OBJECT_CREATED_COMPLETE_MULTIPART_UPLOAD = 'ObjectCreated:CompleteMultipartUpload'
-    OBJECT_REMOVED_ALL = 'ObjectRemoved:*'
-    OBJECT_REMOVED_DELETE = 'ObjectRemoved:Delete'
-    OBJECT_REMOVED_DELETE_MARKER_CREATED = 'ObjectRemoved:DeleteMarkerCreated'
-
-
-class Grantee(BaseModel):
-    allowedAttr = {'grantee_id': BASESTRING, 'grantee_name': BASESTRING, 'group': BASESTRING}
-
-    def __init__(self, grantee_id=None, grantee_name=None, group=None):
-        self.grantee_id = grantee_id
-        self.grantee_name = grantee_name
-        self.group = group
-
-
-class Grant(BaseModel):
-    allowedAttr = {'grantee': Grantee, 'permission': BASESTRING, 'delivered': [bool, BASESTRING]}
-
-    def __init__(self, grantee=None, permission=None, delivered=None):
-        self.grantee = grantee
-        self.permission = permission
-        self.delivered = delivered
-
-
-class Owner(BaseModel):
-    allowedAttr = {'owner_id': BASESTRING, 'owner_name': BASESTRING}
-
-    def __init__(self, owner_id=None, owner_name=None):
-        self.owner_id = owner_id
-        self.owner_name = owner_name
-
-
-class Initiator(BaseModel):
-    allowedAttr = {'id': BASESTRING, 'name': BASESTRING}
-
-    def __init__(self, id=None, name=None):
-        self.id = id
-        self.name = name
-
-
-class ACL(BaseModel):
-    allowedAttr = {'owner': Owner, 'grants': list, 'delivered': [bool, BASESTRING]}
-
-    def __init__(self, owner=None, grants=None, delivered=None):
-        self.owner = owner
-        self.grants = grants
-        self.delivered = delivered
-
-    def add_grant(self, grant):
-        if self.grants is None:
-            self.grants = []
-        if isinstance(grant, Grant):
-            self.grants.append(grant)
-
-
-class Bucket(BaseModel):
-    allowedAttr = {'name': BASESTRING, 'create_date': BASESTRING, 'location': BASESTRING, "bucket_type": BASESTRING}
-
-    def __init__(self, name=None, create_date=None, location=None, bucket_type=None):
-        self.name = name
-        self.create_date = create_date
-        self.location = location
-        self.bucket_type = bucket_type
-
-
-class CommonPrefix(BaseModel):
-    allowedAttr = {'prefix': BASESTRING}
-
-    def __init__(self, prefix=None):
-        self.prefix = prefix
-
-
-class Condition(BaseModel):
-    allowedAttr = {'keyPrefixEquals': BASESTRING, 'httpErrorCodeReturnedEquals': int}
-
-    def __init__(self, keyPrefixEquals=None, httpErrorCodeReturnedEquals=None):
-        self.keyPrefixEquals = keyPrefixEquals
-        self.httpErrorCodeReturnedEquals = httpErrorCodeReturnedEquals
-
-
-class Content(BaseModel):
-    allowedAttr = {'key': BASESTRING, 'lastModified': BASESTRING, 'etag': BASESTRING,
-                   'size': LONG, 'owner': Owner, 'storageClass': BASESTRING, 'isAppendable': bool}
-
-    def __init__(self, key=None, lastModified=None, etag=None, size=None, owner=None, storageClass=None,
-                 isAppendable=None):
-        self.key = key
-        self.lastModified = lastModified
-        self.etag = etag
-        self.size = size
-        self.owner = owner
-        self.storageClass = storageClass
-        self.isAppendable = isAppendable
-
-    def __str__(self):
-        return self.key
-
-
-class DateTime(BaseModel):
-    allowedAttr = {'year': int, 'month': int, 'day': int, 'hour': int, 'min': int, 'sec': int}
-
-    def __init__(self, year, month, day, hour=0, min=0, sec=0):
-        self.year = year
-        self.month = month
-        self.day = day
-        self.hour = hour
-        self.min = min
-        self.sec = sec
-
-    def ToUTTime(self):
-        strTime = '%04d-%02d-%02dT%02d:%02d:%02d.000Z' % (
-            self.year, self.month, self.day, self.hour, self.min, self.sec)
-        return strTime
-
-    def ToGMTTime(self):
-        strTime = (self.year, self.month, self.day, self.hour, self.min, self.sec, 0, 0, 0)
-        gmt_time = time.gmtime(time.mktime(strTime) - time.timezone)
-        return time.strftime('%a, %d %b %Y %H:%M:%S GMT', gmt_time)
-
-    def ToUTMidTime(self):
-        strTime = '%04d-%02d-%02dT00:00:00.000Z' % (self.year, self.month, self.day)
-        return strTime
-
-    @staticmethod
-    def UTCToLocal(strUTC):
-        if strUTC is None:
-            return None
-
-        date_format = '%Y-%m-%dT%H:%M:%S.%fZ'
-        CST_FORMAT = '%Y/%m/%d %H:%M:%S'
-        try:
-            gmt_time = time.strptime(strUTC, date_format)
-
-            cst_time = time.localtime(time.mktime(gmt_time) - time.timezone)
-            dt = time.strftime(CST_FORMAT, cst_time)
-
-            return dt
-        except Exception:
-            return strUTC
-
-    @staticmethod
-    def UTCToLocalMid(strUTC):
-        if strUTC is None:
-            return None
-
-        date_format = '%Y-%m-%dT%H:%M:%S.%fZ'
-        CST_FORMAT = '%Y/%m/%d 00:00:00'
-        try:
-            gmt_time = time.strptime(util.to_string(strUTC), date_format)
-
-            cst_time = time.localtime(time.mktime(gmt_time) - time.timezone)
-            dt = time.strftime(CST_FORMAT, cst_time)
-            return dt
-        except Exception:
-            return strUTC
-
-
-class SseHeader(BaseModel):
-    allowedAttr = {'encryption': BASESTRING, 'key': BASESTRING}
-
-
-class SseCHeader(SseHeader):
-    @staticmethod
-    def getInstance(key, encryption='AES256'):
-        return SseCHeader(encryption=encryption, key=key)
-
-
-class SseKmsHeader(SseHeader):
-    @staticmethod
-    def getInstance(key=None, encryption='kms'):
-        return SseKmsHeader(encryption=encryption, key=key)
-
-
-class CopyObjectHeader(BaseModel):
-    allowedAttr = {'acl': BASESTRING, 'directive': BASESTRING, 'if_match': BASESTRING,
-                   'if_none_match': BASESTRING, 'if_modified_since': [BASESTRING, DateTime],
-                   'if_unmodified_since': [BASESTRING, DateTime], 'location': BASESTRING,
-                   'destSseHeader': SseHeader, 'sourceSseHeader': SseHeader, 'cacheControl': BASESTRING,
-                   'contentDisposition': BASESTRING,
-                   'contentEncoding': BASESTRING, 'contentLanguage': BASESTRING, 'contentType': BASESTRING,
-                   'expires': BASESTRING,
-                   'storageClass': BASESTRING, 'successActionRedirect': BASESTRING, 'extensionGrants': list}
-
-    def __init__(self, acl=None, directive=None, if_match=None, if_none_match=None, if_modified_since=None,
-                 if_unmodified_since=None, location=None, destSseHeader=None, sourceSseHeader=None,
-                 cacheControl=None, contentDisposition=None, contentEncoding=None, contentLanguage=None,
-                 contentType=None, expires=None, storageClass=None, successActionRedirect=None, extensionGrants=None):
-        self.acl = acl
-        self.directive = directive
-        self.if_match = if_match
-        self.if_none_match = if_none_match
-        self.if_modified_since = if_modified_since
-        self.if_unmodified_since = if_unmodified_since
-        self.location = location
-        self.destSseHeader = destSseHeader
-        self.sourceSseHeader = sourceSseHeader
-        self.cacheControl = cacheControl
-        self.contentDisposition = contentDisposition
-        self.contentEncoding = contentEncoding
-        self.contentLanguage = contentLanguage
-        self.contentType = contentType
-        self.expires = expires
-        self.storageClass = storageClass
-        self.successActionRedirect = successActionRedirect
-        self.extensionGrants = extensionGrants
-
-
-class SetObjectMetadataHeader(BaseModel):
-    allowedAttr = {'removeUnset': bool, 'cacheControl': BASESTRING, 'contentDisposition': BASESTRING,
-                   'contentEncoding': BASESTRING, 'contentLanguage': BASESTRING, 'contentType': BASESTRING,
-                   'expires': BASESTRING,
-                   'storageClass': BASESTRING, 'location': BASESTRING}
-
-    def __init__(self, removeUnset=False, location=None, cacheControl=None, contentDisposition=None,
-                 contentEncoding=None, contentLanguage=None, contentType=None, expires=None, storageClass=None):
-        self.removeUnset = removeUnset
-        self.location = location
-        self.cacheControl = cacheControl
-        self.contentDisposition = contentDisposition
-        self.contentEncoding = contentEncoding
-        self.contentLanguage = contentLanguage
-        self.contentType = contentType
-        self.expires = expires
-        self.storageClass = storageClass
-
-class RenameFileHeader(BaseModel,object):
-    allowedAttr = {'objectKey': BASESTRING, 'newObjectKey': BASESTRING}
-
-    def __init__(self, objectKey=None, newObjectKey=None):
-        super(RenameFileHeader, self).__init__()
-        self.objectKey = objectKey
-        self.newObjectKey = newObjectKey
-
-
-class CorsRule(BaseModel):
-    allowedAttr = {'id': BASESTRING, 'allowedMethod': list, 'allowedOrigin': list,
-                   'allowedHeader': list, 'maxAgeSecond': [int, BASESTRING], 'exposeHeader': list}
-
-    def __init__(self, id=None, allowedMethod=None, allowedOrigin=None, allowedHeader=None, maxAgeSecond=None,
-                 exposeHeader=None):
-        self.id = id
-        self.allowedMethod = allowedMethod
-        self.allowedOrigin = allowedOrigin
-        self.allowedHeader = allowedHeader
-        self.maxAgeSecond = maxAgeSecond
-        self.exposeHeader = exposeHeader
-
-
-class CreateBucketHeader(BaseModel):
-    allowedAttr = {'aclControl': BASESTRING, 'storageClass': BASESTRING, 'extensionGrants': list,
-                   'availableZone': BASESTRING, 'epid': BASESTRING, "isPFS": bool, "redundancy": BASESTRING,
-                   "isFusionAllowUpgrade": bool, "isFusionAllowAlternative": bool}
-
-    def __init__(self, aclControl=None, storageClass=None, extensionGrants=None,
-                 availableZone=None, epid=None, isPFS=False, redundancy=None, 
-                 isFusionAllowUpgrade=None, isFusionAllowAlternative=None):
-        """
-        Headers that can be carried during bucket creation
-        :param aclControl: ACL policy of a bucket
-        :param storageClass: Specifies the default storage class of a bucket. The value can be "STANDARD" (Standard),
-               "WARM" (Infrequent Access), and "COLD" (Archive). The Standard storage class is used by default.
-        :param extensionGrants: Extended permission list that can be specified during bucket creation.
-        :param availableZone: AZ type that can be specified during bucket creation. A single AZ is used by default.
-               You can also use "3az".
-        :param epid: Enterprise project ID. Users who have enabled the enterprise project function can obtain this ID
-               from the enterprise project management service.
-        :param isPFS: Specifies whether to create a parallel file system.
-        """
-        self.aclControl = aclControl
-        self.storageClass = storageClass
-        self.extensionGrants = extensionGrants
-        self.availableZone = availableZone
-        self.epid = epid
-        self.isPFS = isPFS
-        self.redundancy = redundancy
-        self.isFusionAllowUpgrade = isFusionAllowUpgrade
-        self.isFusionAllowAlternative = isFusionAllowAlternative
-
-class ExtensionGrant(BaseModel):
-    allowedAttr = {'permission': BASESTRING, 'granteeId': BASESTRING}
-
-    def __init__(self, granteeId=None, permission=None):
-        self.granteeId = granteeId
-        self.permission = permission
-
-
-class ErrorDocument(BaseModel):
-    allowedAttr = {'key': BASESTRING}
-
-    def __init__(self, key=None):
-        self.key = key
-
-
-class IndexDocument(BaseModel):
-    allowedAttr = {'suffix': BASESTRING}
-
-    def __init__(self, suffix=None):
-        self.suffix = suffix
-
-
-class Expiration(BaseModel):
-    allowedAttr = {'date': [BASESTRING, DateTime], 'days': int}
-
-    def __init__(self, date=None, days=None):
-        self.date = date
-        self.days = days
-
-
-class NoncurrentVersionExpiration(BaseModel):
-    allowedAttr = {'noncurrentDays': int}
-
-    def __init__(self, noncurrentDays=None):
-        self.noncurrentDays = noncurrentDays
-
-
-class GetObjectHeader(BaseModel):
-    allowedAttr = {'range': BASESTRING, 'if_modified_since': [BASESTRING, DateTime],
-                   'if_unmodified_since': [BASESTRING, DateTime], 'if_match': BASESTRING, 'if_none_match': BASESTRING,
-                   'origin': BASESTRING, 'requestHeaders': BASESTRING, 'sseHeader': SseHeader}
-
-    def __init__(self, range=None, if_modified_since=None, if_unmodified_since=None, if_match=None, if_none_match=None,
-                 origin=None,
-                 requestHeaders=None, sseHeader=None):
-        self.range = range
-        self.if_modified_since = if_modified_since
-        self.if_unmodified_since = if_unmodified_since
-        self.if_match = if_match
-        self.if_none_match = if_none_match
-        self.origin = origin
-        self.requestHeaders = requestHeaders
-        self.sseHeader = sseHeader
-
-
-class Lifecycle(BaseModel):
-    allowedAttr = {'rule': list}
-
-    def __init__(self, rule=None):
-        self.rule = rule
-
-
-class Replication(BaseModel):
-    allowedAttr = {'replicationRules': list, 'agency': BASESTRING}
-
-    def __init__(self, replicationRules=None, agency=None):
-        self.replicationRules = replicationRules
-        self.agency = agency
-
-
-class ReplicationRule(BaseModel):
-    allowedAttr = {'id': BASESTRING, 'prefix': BASESTRING, 'status': BASESTRING, 'bucket': BASESTRING,
-                   'storageClass': BASESTRING, 'deleteData': BASESTRING, 'historicalObjectReplication': BASESTRING}
-
-    def __init__(self, id=None, prefix=None, status=None, bucket=None, storageClass=None, deleteData=None,
-                 historicalObjectReplication=None):
-        self.id = id
-        self.prefix = prefix
-        self.status = status
-        self.bucket = bucket
-        self.storageClass = storageClass
-        self.deleteData = deleteData
-        self.historicalObjectReplication = historicalObjectReplication
-
-
-class Notification(BaseModel):
-    allowedAttr = {'topicConfigurations': list, 'functionGraphConfigurations': list}
-
-    def __init__(self, topicConfigurations=None, functionGraphConfigurations=None):
-        self.topicConfigurations = topicConfigurations
-        self.functionGraphConfigurations = functionGraphConfigurations
-
-
-class TopicConfiguration(BaseModel):
-    allowedAttr = {'id': BASESTRING, 'topic': BASESTRING, 'events': list, 'filterRules': list}
-
-    def __init__(self, id=None, topic=None, events=None, filterRules=None):
-        self.id = id
-        self.topic = topic
-        self.events = events
-        self.filterRules = filterRules
-
-
-class FunctionGraphConfiguration(BaseModel):
-    allowedAttr = {'id': BASESTRING, 'functionGraph': BASESTRING, 'events': list, 'filterRules': list}
-
-    def __init__(self, id=None, functionGraph=None, events=None, filterRules=None):
-        self.id = id
-        self.functionGraph = functionGraph
-        self.events = events
-        self.filterRules = filterRules
-
-
-class FilterRule(BaseModel):
-    allowedAttr = {'name': BASESTRING, 'value': BASESTRING}
-
-    def __init__(self, name=None, value=None):
-        self.name = name
-        self.value = value
-
-
-class ObjectDeleteMarker(BaseModel):
-    allowedAttr = {'key': BASESTRING, 'versionId': BASESTRING, 'isLatest': bool, 'lastModified': BASESTRING,
-                   'owner': Owner}
-
-    def __init__(self, key=None, versionId=None, isLatest=None, lastModified=None, owner=None):
-        self.key = key
-        self.versionId = versionId
-        self.isLatest = isLatest
-        self.lastModified = lastModified
-        self.owner = owner
-
-
-class ObjectVersionHead(BaseModel):
-    allowedAttr = {'name': BASESTRING, 'location': BASESTRING, 'prefix': BASESTRING, 'delimiter': BASESTRING,
-                   'keyMarker': BASESTRING,
-                   'versionIdMarker': BASESTRING, 'nextKeyMarker': BASESTRING, 'nextVersionIdMarker': BASESTRING,
-                   'maxKeys': int, 'isTruncated': bool, "encoding_type": BASESTRING}
-
-    def __init__(self, name=None, location=None, prefix=None, delimiter=None, keyMarker=None, versionIdMarker=None,
-                 nextKeyMarker=None, nextVersionIdMarker=None, maxKeys=None, isTruncated=None, encoding_type=None):
-        self.name = name
-        self.location = location
-        self.prefix = prefix
-        self.delimiter = delimiter
-        self.keyMarker = keyMarker
-        self.versionIdMarker = versionIdMarker
-        self.nextKeyMarker = nextKeyMarker
-        self.nextVersionIdMarker = nextVersionIdMarker
-        self.maxKeys = maxKeys
-        self.isTruncated = isTruncated
-        self.encoding_type = encoding_type
-
-
-class ObjectVersion(BaseModel):
-    allowedAttr = {'key': BASESTRING, 'versionId': BASESTRING, 'isLatest': bool, 'lastModified': BASESTRING,
-                   'etag': BASESTRING, 'size': LONG, 'owner': Owner, 'storageClass': BASESTRING, 'isAppendable': bool}
-
-    def __init__(self, key=None, versionId=None, isLatest=None, lastModified=None, etag=None,
-                 size=None, owner=None, storageClass=None, isAppendable=None):
-        self.key = key
-        self.versionId = versionId
-        self.isLatest = isLatest
-        self.lastModified = lastModified
-        self.etag = etag
-        self.size = size
-        self.owner = owner
-        self.storageClass = storageClass
-        self.isAppendable = isAppendable
-
-
-class Options(BaseModel):
-    allowedAttr = {'origin': BASESTRING, 'accessControlRequestMethods': list, 'accessControlRequestHeaders': list}
-
-    def __init__(self, origin=None, accessControlRequestMethods=None, accessControlRequestHeaders=None):
-        self.origin = origin
-        self.accessControlRequestMethods = accessControlRequestMethods
-        self.accessControlRequestHeaders = accessControlRequestHeaders
-
-
-class Policy(BaseModel):
-    allowedAttr = {'policyJSON': BASESTRING}
-
-    def __init__(self, policyJSON=None):
-        self.policyJSON = policyJSON
-
-
-class PutObjectHeader(BaseModel):
-    allowedAttr = {'md5': BASESTRING, 'acl': BASESTRING, 'location': BASESTRING,
-                   'contentType': BASESTRING, 'sseHeader': SseHeader, 'contentLength': [int, LONG, BASESTRING],
-                   'storageClass': BASESTRING, 'successActionRedirect': BASESTRING, 'expires': int,
-                   'extensionGrants': list, "sha256": BASESTRING}
-
-    def __init__(self, md5=None, acl=None, location=None, contentType=None, sseHeader=None, contentLength=None,
-                 storageClass=None, successActionRedirect=None, expires=None, extensionGrants=None, sha256=None):
-        self.md5 = md5
-        self.sha256 = sha256
-        self.acl = acl
-        self.location = location
-        self.contentType = contentType
-        self.sseHeader = sseHeader
-        self.contentLength = contentLength
-        self.storageClass = storageClass
-        self.successActionRedirect = successActionRedirect
-        self.expires = expires
-        self.extensionGrants = extensionGrants
-
-
-AppendObjectHeader = PutObjectHeader
-
-
-class UploadFileHeader(BaseModel):
-    allowedAttr = {'acl': BASESTRING, 'websiteRedirectLocation': BASESTRING, 'contentType': BASESTRING,
-                   'sseHeader': SseHeader, 'storageClass': BASESTRING,
-                   'successActionRedirect': BASESTRING, 'expires': int, 'extensionGrants': list}
-
-    def __init__(self, acl=None, websiteRedirectLocation=None, contentType=None, sseHeader=None,
-                 storageClass=None, successActionRedirect=None, expires=None, extensionGrants=None):
-        self.acl = acl
-        self.websiteRedirectLocation = websiteRedirectLocation
-        self.contentType = contentType
-        self.sseHeader = sseHeader
-        self.storageClass = storageClass
-        self.successActionRedirect = successActionRedirect
-        self.expires = expires
-        self.extensionGrants = extensionGrants
-
-
-class AppendObjectContent(BaseModel):
-    allowedAttr = {'content': [object], 'position': [LONG, int, BASESTRING], 'offset': [LONG, int, BASESTRING],
-                   'isFile': bool}
-
-    def __init__(self, content=None, position=None, offset=None, isFile=False):
-        self.content = content
-        self.position = position
-        self.offset = offset
-        self.isFile = isFile
-
-
-class RedirectAllRequestTo(BaseModel):
-    allowedAttr = {'hostName': BASESTRING, 'protocol': BASESTRING}
-
-    def __init__(self, hostName=None, protocol=None):
-        self.hostName = hostName
-        self.protocol = protocol
-
-
-class Redirect(BaseModel):
-    allowedAttr = {'protocol': BASESTRING, 'hostName': BASESTRING, 'replaceKeyPrefixWith': BASESTRING,
-                   'replaceKeyWith': BASESTRING, 'httpRedirectCode': int}
-
-    def __init__(self, protocol=None, hostName=None, replaceKeyPrefixWith=None, replaceKeyWith=None,
-                 httpRedirectCode=None):
-        self.protocol = protocol
-        self.hostName = hostName
-        self.replaceKeyPrefixWith = replaceKeyPrefixWith
-        self.replaceKeyWith = replaceKeyWith
-        self.httpRedirectCode = httpRedirectCode
-
-
-class RoutingRule(BaseModel):
-    allowedAttr = {'condition': Condition, 'redirect': Redirect}
-
-    def __init__(self, condition=None, redirect=None):
-        self.condition = condition
-        self.redirect = redirect
-
-
-class Tag(BaseModel):
-    allowedAttr = {'key': BASESTRING, 'value': BASESTRING}
-
-    def __init__(self, key=None, value=None):
-        self.key = key
-        self.value = value
-
-
-class TagInfo(BaseModel):
-    allowedAttr = {'tagSet': list}
-
-    def __init__(self, tagSet=None):
-        self.tagSet = tagSet
-
-    def addTag(self, key, value):
-        if self.tagSet is None:
-            self.tagSet = []
-        self.tagSet.append(Tag(key=key, value=value))
-        return self
-
-
-class Transition(BaseModel):
-    allowedAttr = {'date': [BASESTRING, DateTime], 'days': int, 'storageClass': BASESTRING}
-
-    def __init__(self, storageClass=None, date=None, days=None):
-        self.storageClass = storageClass
-        self.date = date
-        self.days = days
-
-
-class Part(BaseModel):
-    allowedAttr = {'partNumber': int, 'lastModified': BASESTRING, 'etag': BASESTRING, 'size': LONG}
-
-    def __init__(self, partNumber=None, lastModified=None, etag=None, size=None):
-        self.partNumber = partNumber
-        self.lastModified = lastModified
-        self.etag = etag
-        self.size = size
-
-
-class NoncurrentVersionTransition(BaseModel):
-    allowedAttr = {'noncurrentDays': int, 'storageClass': BASESTRING}
-
-    def __init__(self, storageClass=None, noncurrentDays=None):
-        self.noncurrentDays = noncurrentDays
-        self.storageClass = storageClass
-
-
-class AbortIncompleteMultipartUpload(BaseModel):
-    allowedAttr = {'daysAfterInitiation': int}
-
-    def __init__(self, daysAfterInitiation=None):
-        super(AbortIncompleteMultipartUpload, self).__init__()
-        self.daysAfterInitiation = daysAfterInitiation
-
-
-class Rule(BaseModel):
-    allowedAttr = {'id': BASESTRING, 'prefix': BASESTRING, 'status': BASESTRING, 'expiration': Expiration,
-                   'noncurrentVersionExpiration': NoncurrentVersionExpiration,
-                   'transition': [Transition, list], 'noncurrentVersionTransition': [NoncurrentVersionTransition, list],
-                   'abortIncompleteMultipartUpload': AbortIncompleteMultipartUpload}
-
-    def __init__(self, id=None, prefix=None, status=None, expiration=None, noncurrentVersionExpiration=None,
-                 transition=None, noncurrentVersionTransition=None, abortIncompleteMultipartUpload=None):
-        self.id = id
-        self.prefix = prefix
-        self.status = status
-        self.expiration = expiration
-        self.noncurrentVersionExpiration = noncurrentVersionExpiration
-        self.transition = transition
-        self.noncurrentVersionTransition = noncurrentVersionTransition
-        self.abortIncompleteMultipartUpload = abortIncompleteMultipartUpload
-
-
-class Upload(BaseModel):
-    allowedAttr = {'key': BASESTRING, 'uploadId': BASESTRING, 'initiator': Initiator,
-                   'owner': Owner, 'storageClass': BASESTRING, 'initiated': BASESTRING}
-
-    def __init__(self, key=None, uploadId=None, initiator=None, owner=None, storageClass=None, initiated=None):
-        self.key = key
-        self.uploadId = uploadId
-        self.initiator = initiator
-        self.owner = owner
-        self.storageClass = storageClass
-        self.initiated = initiated
-
-
-class Versions(BaseModel):
-    allowedAttr = {'prefix': BASESTRING, 'key_marker': BASESTRING, 'max_keys': [int, BASESTRING],
-                   'delimiter': BASESTRING, 'version_id_marker': BASESTRING, 'encoding_type': BASESTRING}
-
-    def __init__(self, prefix=None, key_marker=None, max_keys=None, delimiter=None, version_id_marker=None,
-                 encoding_type=None):
-        self.prefix = prefix
-        self.key_marker = key_marker
-        self.max_keys = max_keys
-        self.delimiter = delimiter
-        self.version_id_marker = version_id_marker
-        self.encoding_type = encoding_type
-
-
-class Object(BaseModel):
-    allowedAttr = {'key': BASESTRING, 'versionId': BASESTRING}
-
-    def __init__(self, key=None, versionId=None):
-        self.key = key
-        self.versionId = versionId
-
-
-class WebsiteConfiguration(BaseModel):
-    allowedAttr = {'redirectAllRequestTo': RedirectAllRequestTo, 'indexDocument': IndexDocument,
-                   'errorDocument': ErrorDocument, 'routingRules': list}
-
-    def __init__(self, redirectAllRequestTo=None,
-                 indexDocument=None,
-                 errorDocument=None,
-                 routingRules=None):
-        self.redirectAllRequestTo = redirectAllRequestTo
-        self.indexDocument = indexDocument
-        self.errorDocument = errorDocument
-        self.routingRules = routingRules
-
-
-class Logging(BaseModel):
-    allowedAttr = {'targetBucket': BASESTRING, 'targetPrefix': BASESTRING, 'targetGrants': list, 'agency': BASESTRING}
-
-    def __init__(self, targetBucket=None, targetPrefix=None, targetGrants=None, agency=None):
-        self.targetBucket = targetBucket
-        self.targetPrefix = targetPrefix
-        self.targetGrants = targetGrants
-        self.agency = agency
-
-    def add_grant(self, grant):
-        if self.targetGrants is None:
-            self.targetGrants = []
-        if isinstance(grant, Grant):
-            self.targetGrants.append(grant)
-
-
-class ObjectVersions(BaseModel):
-    allowedAttr = {'head': ObjectVersionHead, 'versions': list, 'markers': list, 'commonPrefixs': list}
-
-    def __init__(self, head=None, versions=None, markers=None, commonPrefixs=None):
-        self.head = head
-        self.versions = versions
-        self.markers = markers
-        self.commonPrefixs = commonPrefixs
-
-
-class CompleteMultipartUploadRequest(BaseModel):
-    allowedAttr = {'parts': list}
-
-    def __init__(self, parts=None):
-        self.parts = parts
-
-    def add_part(self, part):
-        if self.parts is None:
-            self.parts = []
-        if isinstance(part, CompletePart):
-            self.parts.append(part)
-
-
-class CompleteMultipartUploadResponse(BaseModel):
-    allowedAttr = {'location': BASESTRING, 'bucket': BASESTRING, "encoding_type": BASESTRING,
-                   'key': BASESTRING, 'etag': BASESTRING, 'versionId': BASESTRING, 'sseKms': BASESTRING,
-                   'sseKmsKey': BASESTRING, 'sseC': BASESTRING, 'sseCKeyMd5': BASESTRING, 'objectUrl': BASESTRING}
-
-    def __init__(self, location=None, bucket=None, key=None, etag=None,
-                 versionId=None, sseKms=None, sseKmsKey=None, sseC=None,
-                 sseCKeyMd5=None, objectUrl=None, encoding_type=None):
-        self.location = location
-        self.bucket = bucket
-        self.key = key
-        self.etag = etag
-        self.versionId = versionId
-        self.sseKms = sseKms
-        self.sseKmsKey = sseKmsKey
-        self.sseC = sseC
-        self.sseCKeyMd5 = sseCKeyMd5
-        self.objectUrl = objectUrl
-        self.encoding_type = encoding_type
-
-
-class CopyObjectResponse(BaseModel):
-    allowedAttr = {'lastModified': BASESTRING, 'etag': BASESTRING, 'copySourceVersionId': BASESTRING,
-                   'versionId': BASESTRING,
-                   'sseKms': BASESTRING, 'sseKmsKey': BASESTRING, 'sseC': BASESTRING, 'sseCKeyMd5': BASESTRING}
-
-    def __init__(self, lastModified=None, etag=None, copySourceVersionId=None, versionId=None, sseKms=None,
-                 sseKmsKey=None, sseC=None, sseCKeyMd5=None):
-        self.lastModified = lastModified
-        self.etag = etag
-        self.copySourceVersionId = copySourceVersionId
-        self.versionId = versionId
-        self.sseKms = sseKms
-        self.sseKmsKey = sseKmsKey
-        self.sseC = sseC
-        self.sseCKeyMd5 = sseCKeyMd5
-
-
-class CopyPartResponse(BaseModel):
-    allowedAttr = {'lastModified': BASESTRING, 'etag': BASESTRING, 'modifiedDate': BASESTRING,
-                   'sseKms': BASESTRING, 'sseKmsKey': BASESTRING, 'sseC': BASESTRING, 'sseCKeyMd5': BASESTRING}
-
-    def __init__(self, lastModified=None, etag=None, modifiedDate=None, sseKms=None, sseKmsKey=None, sseC=None,
-                 sseCKeyMd5=None):
-        self.lastModified = lastModified
-        self.etag = etag
-        self.modifiedDate = modifiedDate
-        self.sseKms = sseKms
-        self.sseKmsKey = sseKmsKey
-        self.sseC = sseC
-        self.sseCKeyMd5 = sseCKeyMd5
-
-
-class DeleteObjectResponse(BaseModel):
-    allowedAttr = {'deleteMarker': bool, 'versionId': BASESTRING}
-
-    def __init__(self, deleteMarker=None, versionId=None):
-        self.deleteMarker = deleteMarker
-        self.versionId = versionId
-
-
-class DeleteObjectsRequest(BaseModel):
-    allowedAttr = {'quiet': bool, 'objects': list, "encoding_type": BASESTRING}
-
-    def __init__(self, quiet=None, objects=None, encoding_type=None):
-        self.quiet = quiet
-        self.objects = objects
-        self.encoding_type = encoding_type
-
-    def add_object(self, object):
-        if self.objects is None:
-            self.objects = []
-        if isinstance(object, Object):
-            self.objects.append(object)
-
-
-class DeleteObjectsResponse(BaseModel):
-    allowedAttr = {'deleted': list, 'error': list, "encoding_type": BASESTRING}
-
-    def __init__(self, deleted=None, error=None, encoding_type=None):
-        self.deleted = deleted
-        self.error = error
-        self.encoding_type = encoding_type
-
-
-class ErrorResult(BaseModel):
-    allowedAttr = {'key': BASESTRING, 'versionId': BASESTRING, 'code': BASESTRING, 'message': BASESTRING}
-
-    def __init__(self, key=None, versionId=None, code=None, message=None):
-        self.key = key
-        self.versionId = versionId
-        self.code = code
-        self.message = message
-
-
-class DeleteObjectResult(BaseModel):
-    allowedAttr = {'key': BASESTRING, 'versionId': BASESTRING, 'deleteMarker': bool,
-                   'deleteMarkerVersionId': BASESTRING}
-
-    def __init__(self, key=None, versionId=None, deleteMarker=None, deleteMarkerVersionId=None):
-        self.key = key
-        self.versionId = versionId
-        self.deleteMarker = deleteMarker
-        self.deleteMarkerVersionId = deleteMarkerVersionId
-
-
-class ListMultipartUploadsRequest(BaseModel):
-    allowedAttr = {'delimiter': BASESTRING, 'prefix': BASESTRING, 'max_uploads': [int, BASESTRING],
-                   'key_marker': BASESTRING, 'upload_id_marker': BASESTRING}
-
-    def __init__(self, delimiter=None, prefix=None, max_uploads=None, key_marker=None, upload_id_marker=None):
-        self.delimiter = delimiter
-        self.prefix = prefix
-        self.max_uploads = max_uploads
-        self.key_marker = key_marker
-        self.upload_id_marker = upload_id_marker
-
-
-class ListPartsResponse(BaseModel):
-    allowedAttr = {'bucketName': BASESTRING, 'objectKey': BASESTRING, 'uploadId': BASESTRING, 'initiator': Initiator,
-                   'owner': Owner, 'storageClass': BASESTRING, 'partNumberMarker': int, 'nextPartNumberMarker': int,
-                   'maxParts': int, "encoding_type": BASESTRING,
-                   'isTruncated': bool, 'parts': list}
-
-    def __init__(self, bucketName=None, objectKey=None, uploadId=None, initiator=None, owner=None,
-                 storageClass=None, partNumberMarker=None, nextPartNumberMarker=None, maxParts=None, isTruncated=None,
-                 parts=None, encoding_type=None):
-        self.bucketName = bucketName
-        self.objectKey = objectKey
-        self.uploadId = uploadId
-        self.initiator = initiator
-        self.owner = owner
-        self.storageClass = storageClass
-        self.partNumberMarker = partNumberMarker
-        self.nextPartNumberMarker = nextPartNumberMarker
-        self.maxParts = maxParts
-        self.isTruncated = isTruncated
-        self.parts = parts
-        self.encoding_type = encoding_type
-
-
-class GetBucketMetadataResponse(BaseModel):
-    allowedAttr = {'storageClass': BASESTRING, 'accessContorlAllowOrigin': BASESTRING, 
-                   'accessContorlAllowHeaders': BASESTRING,
-                   'accessContorlAllowMethods': BASESTRING,
-                   'accessContorlExposeHeaders': BASESTRING,
-                   'accessContorlMaxAge': int, 'location': BASESTRING, 'obsVersion': BASESTRING,
-                   'availableZone': BASESTRING, 'epid': BASESTRING, 'redundancy': BASESTRING}
-
-    def __init__(self, storageClass=None, accessContorlAllowOrigin=None, accessContorlAllowHeaders=None,
-                 accessContorlAllowMethods=None, accessContorlExposeHeaders=None, accessContorlMaxAge=None,
-                 location=None, obsVersion=None, availableZone=None, epid=None, redundancy=None):
-        self.storageClass = storageClass
-        self.accessContorlAllowOrigin = accessContorlAllowOrigin
-        self.accessContorlAllowHeaders = accessContorlAllowHeaders
-        self.accessContorlAllowMethods = accessContorlAllowMethods
-        self.accessContorlExposeHeaders = accessContorlExposeHeaders
-        self.accessContorlMaxAge = accessContorlMaxAge
-        self.location = location
-        self.obsVersion = obsVersion
-        self.availableZone = availableZone
-        self.epid = epid
-        self.redundancy = redundancy
-
-
-class GetBucketQuotaResponse(BaseModel):
-    allowedAttr = {'quota': LONG}
-
-    def __init__(self, quota=None):
-        self.quota = quota
-
-
-class GetBucketStorageInfoResponse(BaseModel):
-    allowedAttr = {'size': LONG, 'objectNumber': int, 'standardSize': LONG, 'standardObjectNumber': int, 'warmSize': LONG,
-                   'warmObjectNumber': int, 'coldSize': LONG, 'coldObjectNumber': int, 'deepArchiveSize': LONG, 'deepArchiveObjectNumber': int,
-                   'highPerformanceSize': LONG, 'highPerformanceObjectNumber': int, 'standard_IASize': LONG, 'standard_IAObjectNumber': int, 'glacierObjectNumber': LONG}
-
-    def __init__(self, size=None, objectNumber=None, standardSize=None, standardObjectNumber=None, warmSize=None,
-                 warmObjectNumber=None, coldSize=None, coldObjectNumber=None, deepArchiveSize=None, deepArchiveObjectNumber=None,
-                 highPerformanceSize=None, highPerformanceObjectNumber=None, standard_IASize=None, standard_IAObjectNumber=None, glacierSize=None, glacierObjectNumber=None):
-        self.size = size
-        self.objectNumber = objectNumber
-        self.standardSize = standardSize
-        self.standardObjectNumber = standardObjectNumber
-        self.warmSize = warmSize
-        self.warmObjectNumber = warmObjectNumber
-        self.coldSize = coldSize
-        self.coldObjectNumber = coldObjectNumber
-        self.deepArchiveSize = deepArchiveSize
-        self.deepArchiveObjectNumber = deepArchiveObjectNumber
-        self.highPerformanceSize = highPerformanceSize
-        self.highPerformanceObjectNumber = highPerformanceObjectNumber
-        self.standard_IASize = standard_IASize
-        self.standard_IAObjectNumber = standard_IAObjectNumber
-        self.glacierSize = glacierSize
-        self.glacierObjectNumber = glacierObjectNumber
-
-class GetBucketEncryptionResponse(BaseModel):
-    allowedAttr = {'encryption': BASESTRING, 'key': BASESTRING}
-
-    def __init__(self, encryption=None, key=None):
-        self.encryption = encryption
-        self.key = key
-
-
-class GetBucketStoragePolicyResponse(BaseModel):
-    allowedAttr = {'storageClass': BASESTRING}
-
-    def __init__(self, storageClass=None):
-        self.storageClass = storageClass
-
-
-class GetObjectMetadataResponse(BaseModel):
-    allowedAttr = {'storageClass': BASESTRING, 'accessContorlAllowOrigin': BASESTRING,
-                   'accessContorlAllowHeaders': BASESTRING, 'accessContorlAllowMethods': BASESTRING,
-                   'accessContorlExposeHeaders': BASESTRING, 'accessContorlMaxAge': int,
-                   'contentLength': LONG, 'contentType': BASESTRING, 'websiteRedirectLocation': BASESTRING,
-                   'lastModified': BASESTRING, 'etag': BASESTRING, 'versionId': BASESTRING,
-                   'restore': BASESTRING, 'expiration': BASESTRING, 'sseKms': BASESTRING,
-                   'sseKmsKey': BASESTRING, 'sseC': BASESTRING, 'sseCKeyMd5': BASESTRING, 'isAppendable': bool,
-                   'nextPosition': LONG}
-
-    def __init__(self, storageClass=None, accessContorlAllowOrigin=None, accessContorlAllowHeaders=None,
-                 accessContorlAllowMethods=None, accessContorlExposeHeaders=None, accessContorlMaxAge=None,
-                 contentLength=None,
-                 contentType=None, websiteRedirectLocation=None, lastModified=None, etag=None, versionId=None,
-                 restore=None, expiration=None, sseKms=None, sseKmsKey=None, sseC=None, sseCKeyMd5=None,
-                 isAppendable=None, nextPosition=None):
-        self.storageClass = storageClass
-        self.accessContorlAllowOrigin = accessContorlAllowOrigin
-        self.accessContorlAllowHeaders = accessContorlAllowHeaders
-        self.accessContorlAllowMethods = accessContorlAllowMethods
-        self.accessContorlExposeHeaders = accessContorlExposeHeaders
-        self.accessContorlMaxAge = accessContorlMaxAge
-        self.contentLength = contentLength
-        self.contentType = contentType
-
-        self.websiteRedirectLocation = websiteRedirectLocation
-        self.lastModified = lastModified
-        self.etag = etag
-        self.versionId = versionId
-        self.restore = restore
-        self.expiration = expiration
-        self.sseKms = sseKms
-        self.sseKmsKey = sseKmsKey
-        self.sseC = sseC
-        self.sseCKeyMd5 = sseCKeyMd5
-        self.isAppendable = isAppendable
-        self.nextPosition = nextPosition
-
-
-SetObjectMetadataResponse = GetObjectMetadataResponse
-
-
-class GetObjectRequest(BaseModel):
-    allowedAttr = {'content_type': BASESTRING, 'content_language': BASESTRING,
-                   'expires': BASESTRING, 'cache_control': BASESTRING, 'content_disposition': BASESTRING,
-                   'content_encoding': BASESTRING, 'versionId': BASESTRING, 'imageProcess': BASESTRING}
-
-    def __init__(self, content_type=None, content_language=None, expires=None, cache_control=None,
-                 content_disposition=None,
-                 content_encoding=None, versionId=None, imageProcess=None):
-        self.content_type = content_type
-        self.content_language = content_language
-        self.expires = expires
-        self.cache_control = cache_control
-        self.content_disposition = content_disposition
-        self.content_encoding = content_encoding
-        self.versionId = versionId
-        self.imageProcess = imageProcess
-
-
-class InitiateMultipartUploadResponse(BaseModel):
-    allowedAttr = {'bucketName': BASESTRING, 'objectKey': BASESTRING, 'uploadId': BASESTRING, 'sseKms': BASESTRING,
-                   'sseKmsKey': BASESTRING, 'sseC': BASESTRING, 'sseCKeyMd5': BASESTRING, "encoding_type": BASESTRING}
-
-    def __init__(self, bucketName=None, objectKey=None, uploadId=None, encoding_type=None):
-        self.bucketName = bucketName
-        self.objectKey = objectKey
-        self.uploadId = uploadId
-        self.encoding_type = encoding_type
-
-
-class LifecycleResponse(BaseModel):
-    allowedAttr = {'lifecycleConfig': Lifecycle}
-
-    def __init__(self, lifecycleConfig=None):
-        self.lifecycleConfig = lifecycleConfig
-
-
-class ListBucketsResponse(BaseModel):
-    allowedAttr = {'buckets': list, 'owner': Owner, 'maxKeys': int, 'marker': BASESTRING, 'isTruncated': bool, 'nextMarker': BASESTRING}
-
-    def __init__(self, buckets=None, owner=None, maxKeys=None, marker=None, isTruncated=None, nextMarker=None):
-        self.buckets = buckets
-        self.owner = owner
-        self.maxKeys = maxKeys
-        self.marker = marker
-        self.isTruncated = isTruncated
-        self.nextMarker = nextMarker
-
-class ListMultipartUploadsResponse(BaseModel):
-    allowedAttr = {'bucket': BASESTRING, 'keyMarker': BASESTRING, 'uploadIdMarker': BASESTRING,
-                   'nextKeyMarker': BASESTRING, 'nextUploadIdMarker': BASESTRING, 'maxUploads': int,
-                   'isTruncated': bool, 'prefix': BASESTRING, 'delimiter': BASESTRING, 'upload': list,
-                   'commonPrefixs': list, "encoding_type": BASESTRING}
-
-    def __init__(self, bucket=None, keyMarker=None, uploadIdMarker=None, nextKeyMarker=None, nextUploadIdMarker=None,
-                 maxUploads=None, isTruncated=None, prefix=None, delimiter=None, upload=None, commonPrefixs=None,
-                 encoding_type=None):
-        self.bucket = bucket
-        self.keyMarker = keyMarker
-        self.uploadIdMarker = uploadIdMarker
-        self.nextKeyMarker = nextKeyMarker
-        self.nextUploadIdMarker = nextUploadIdMarker
-        self.maxUploads = maxUploads
-        self.isTruncated = isTruncated
-        self.prefix = prefix
-
-        self.delimiter = delimiter
-        self.upload = upload
-        self.commonPrefixs = commonPrefixs
-        self.encoding_type = encoding_type
-
-
-class ListObjectsResponse(BaseModel):
-    allowedAttr = {'name': BASESTRING, 'location': BASESTRING, 'prefix': BASESTRING, 'marker': BASESTRING,
-                   'delimiter': BASESTRING, 'commonPrefixs': list, 'encoding_type': BASESTRING,
-                   'max_keys': int, 'is_truncated': bool, 'next_marker': BASESTRING, 'contents': list}
-
-    def __init__(self, name=None, location=None, prefix=None, marker=None, delimiter=None, max_keys=None,
-                 is_truncated=None, next_marker=None, contents=None, commonPrefixs=None, encoding_type=None):
-        self.name = name
-        self.location = location
-        self.prefix = prefix
-        self.marker = marker
-        self.delimiter = delimiter
-        self.max_keys = max_keys
-        self.is_truncated = is_truncated
-        self.next_marker = next_marker
-        self.contents = contents
-        self.commonPrefixs = commonPrefixs
-        self.encoding_type = encoding_type
-
-
-class LocationResponse(BaseModel):
-    allowedAttr = {'location': BASESTRING}
-
-    def __init__(self, location=None):
-        self.location = location
-
-
-class OptionsResponse(BaseModel):
-    allowedAttr = {'accessContorlAllowOrigin': BASESTRING, 'accessContorlAllowHeaders': BASESTRING,
-                   'accessContorlAllowMethods': BASESTRING,
-                   'accessContorlExposeHeaders': BASESTRING, 'accessContorlMaxAge': int}
-
-    def __init__(self, accessContorlAllowOrigin=None, accessContorlAllowHeaders=None, accessContorlAllowMethods=None,
-                 accessContorlExposeHeaders=None, accessContorlMaxAge=None):
-        self.accessContorlAllowOrigin = accessContorlAllowOrigin
-        self.accessContorlAllowHeaders = accessContorlAllowHeaders
-        self.accessContorlAllowMethods = accessContorlAllowMethods
-        self.accessContorlExposeHeaders = accessContorlExposeHeaders
-        self.accessContorlMaxAge = accessContorlMaxAge
-
-
-class PutContentResponse(BaseModel):
-    allowedAttr = {'storageClass': BASESTRING, 'etag': BASESTRING, 'versionId': BASESTRING,
-                   'sseKms': BASESTRING, 'sseKmsKey': BASESTRING, 'sseC': BASESTRING, 'sseCKeyMd5': BASESTRING,
-                   'objectUrl': BASESTRING}
-
-    def __init__(self, storageClass=None, etag=None, versionId=None, sseKms=None, sseKmsKey=None,
-                 sseC=None, sseCKeyMd5=None, objectUrl=None):
-        self.storageClass = storageClass
-        self.etag = etag
-        self.versionId = versionId
-        self.sseKms = sseKms
-        self.sseKmsKey = sseKmsKey
-        self.sseC = sseC
-        self.sseCKeyMd5 = sseCKeyMd5
-        self.objectUrl = objectUrl
-
-
-class AppendObjectResponse(BaseModel):
-    allowedAttr = {'storageClass': BASESTRING, 'etag': BASESTRING, 'nextPosition': LONG,
-                   'sseKms': BASESTRING, 'sseKmsKey': BASESTRING, 'sseC': BASESTRING, 'sseCKeyMd5': BASESTRING,
-                   'objectUrl': BASESTRING}
-
-    def __init__(self, storageClass=None, etag=None, nextPosition=None, sseKms=None, sseKmsKey=None,
-                 sseC=None, sseCKeyMd5=None, objectUrl=None):
-        self.storageClass = storageClass
-        self.etag = etag
-        self.nextPosition = nextPosition
-        self.sseKms = sseKms
-        self.sseKmsKey = sseKmsKey
-        self.sseC = sseC
-        self.sseCKeyMd5 = sseCKeyMd5
-        self.objectUrl = objectUrl
-
-
-class UploadPartResponse(BaseModel):
-    allowedAttr = {'etag': BASESTRING, 'sseKms': BASESTRING, 'sseKmsKey': BASESTRING, 'sseC': BASESTRING,
-                   'sseCKeyMd5': BASESTRING}
-
-    def __init__(self, etag=None, sseKms=None, sseKmsKey=None, sseC=None, sseCKeyMd5=None):
-        self.etag = etag
-        self.sseKms = sseKms
-        self.sseKmsKey = sseKmsKey
-        self.sseC = sseC
-        self.sseCKeyMd5 = sseCKeyMd5
-
-
-class GetBucketRequestPaymentResponse(BaseModel):
-    allowedAttr = {'payer': BASESTRING}
-
-    def __init__(self, payer=None):
-        self.payer = payer
-
-
-class Payer(object):
-    BUCKET_OWNER_PAYER = "BucketOwner"
-    REQUESTER_PAYER = "Requester"
-    REQUESTER = "requester"
-
-
-class ResponseWrapper(object):
-    def __init__(self, conn, result, connHolder, contentLength=None, notifier=None):
-        self.conn = conn
-        self.result = result
-        self.connHolder = connHolder
-        self.contentLength = contentLength
-        self.read_count = 0
-        self.notifier = notifier
-        if self.notifier is None:
-            self.notifier = progress.NONE_NOTIFIER
-
-    def __getattr__(self, name):
-        if name == 'read' and self.result:
-            def _read(*args, **kwargs):
-                chunk = self.result.read(*args, **kwargs)
-                if not chunk:
-                    if self.contentLength is not None and self.contentLength != self.read_count:
-                        raise Exception(
-                            'premature end of Content-Length delimiter message body (expected:' + util.to_string(
-                                self.contentLength) + '; received:' + util.to_string(self.read_count) + ')')
-                else:
-                    newReadCount = len(chunk)
-                    if newReadCount > 0:
-                        self.notifier.send(newReadCount)
-                    self.read_count += newReadCount
-                return chunk
-
-            return _read
-
-        return getattr(self.result, name) if self.result else None
-
-    def close(self):
-        self.notifier.end()
-        if self.conn:
-            util.do_close(self.result, self.conn, self.connHolder)
-
-
-class ObjectStream(BaseModel):
-    allowedAttr = {'response': ResponseWrapper, 'buffer': object, 'size': LONG, 'url': BASESTRING, 'deleteMarker': bool,
-                   'storageClass': BASESTRING, 'accessContorlAllowOrigin': BASESTRING,
-                   'accessContorlAllowHeaders': BASESTRING, 'accessContorlAllowMethods': BASESTRING,
-                   'accessContorlExposeHeaders': BASESTRING, 'accessContorlMaxAge': int,
-                   'contentLength': LONG, 'cacheControl': BASESTRING, 'contentDisposition': BASESTRING,
-                   'contentEncoding': BASESTRING, 'contentLanguage': BASESTRING,
-                   'contentType': BASESTRING, 'expires': BASESTRING, 'websiteRedirectLocation': BASESTRING,
-                   'lastModified': BASESTRING, 'etag': BASESTRING, 'versionId': BASESTRING,
-                   'restore': BASESTRING, 'expiration': BASESTRING, 'sseKms': BASESTRING,
-                   'sseKmsKey': BASESTRING, 'sseC': BASESTRING, 'sseCKeyMd5': BASESTRING}
-
-    def __init__(self, response=None, buffer=None, size=None, url=None, deleteMarker=None, storageClass=None,
-                 accessContorlAllowOrigin=None, accessContorlAllowHeaders=None, accessContorlAllowMethods=None,
-                 accessContorlExposeHeaders=None, accessContorlMaxAge=None, contentLength=None, cacheControl=None,
-                 contentDisposition=None, contentEncoding=None, contentLanguage=None, contentType=None, expires=None,
-                 websiteRedirectLocation=None, lastModified=None, etag=None, versionId=None, restore=None,
-                 expiration=None, sseKms=None, sseKmsKey=None, sseC=None, sseCKeyMd5=None):
-        self.response = response
-        self.buffer = buffer
-        self.size = size
-        self.url = url
-        self.deleteMarker = deleteMarker
-        self.storageClass = storageClass
-        self.accessContorlAllowOrigin = accessContorlAllowOrigin
-        self.accessContorlAllowHeaders = accessContorlAllowHeaders
-        self.accessContorlAllowMethods = accessContorlAllowMethods
-        self.accessContorlExposeHeaders = accessContorlExposeHeaders
-        self.accessContorlMaxAge = accessContorlMaxAge
-        self.contentLength = contentLength
-        self.cacheControl = cacheControl
-        self.contentDisposition = contentDisposition
-        self.contentEncoding = contentEncoding
-        self.contentLanguage = contentLanguage
-        self.contentType = contentType
-        self.expires = expires
-        self.websiteRedirectLocation = websiteRedirectLocation
-        self.lastModified = lastModified
-        self.etag = etag
-        self.versionId = versionId
-        self.restore = restore
-        self.expiration = expiration
-        self.sseKms = sseKms
-        self.sseKmsKey = sseKmsKey
-        self.sseC = sseC
-        self.sseCKeyMd5 = sseCKeyMd5
-
-
-class ExtensionHeader(BaseModel):
-    allowedAttr = {'requesterPayer': BASESTRING, 'locationClusterGroupId': BASESTRING}
-
-    def __init__(self, requesterPayer=None, locationClusterGroupId=None):
-        self.requesterPayer = requesterPayer
-        self.locationClusterGroupId = locationClusterGroupId
-
-
-# OEF Model
-class FetchStatus(object):
-    OPEN = "open"
-    CLOSED = "closed"
-
-
-class FetchPolicy(BaseModel):
-    allowedAttr = {'status': BASESTRING, 'agency': BASESTRING}
-
-    def __init__(self, status=None, agency=None):
-        self.status = status
-        self.agency = agency
-
-
-class _FetchJob(BaseModel):
-    allowedAttr = {'url': BASESTRING, 'host': BASESTRING, 'bucket': BASESTRING, 'key': BASESTRING, 'md5': BASESTRING,
-                   'callbackurl': BASESTRING, 'callbackbody': BASESTRING, 'callbackbodytype': BASESTRING,
-                   'callbackhost': BASESTRING, 'file_type': BASESTRING, 'ignore_same_key': bool, 'objectheaders': dict,
-                   'etag': BASESTRING, 'trustname': BASESTRING}
-
-    def __init__(self, url=None, host=None, bucket=None, key=None, md5=None, callBackUrl=None,
-                 callBackBody=None, callBackBodyType=None, callBackHost=None, fileType=None,
-                 ignoreSameKey=False, objectHeaders=None, etag=None, trustName=None):
-        self.url = url
-        self.host = host
-        self.bucket = bucket
-        self.key = key
-        self.md5 = md5
-        self.callbackurl = callBackUrl
-        self.callbackbody = callBackBody
-        self.callbackbodytype = callBackBodyType
-        self.callbackhost = callBackHost
-        self.file_type = fileType
-        self.ignore_same_key = ignoreSameKey
-        self.objectheaders = objectHeaders
-        self.etag = etag
-        self.trustname = trustName
-
-
-class SetBucketFetchJobResponse(BaseModel):
-    allowedAttr = {"id": BASESTRING, "wait": int}
-
-    def __init__(self, id=None, wait=None):
-        self.id = id
-        self.wait = wait
-
-
-class FetchJobResponse(BaseModel):
-    allowedAttr = {'url': BASESTRING, 'host': BASESTRING, 'bucket': BASESTRING, 'key': BASESTRING, 'md5': BASESTRING,
-                   'callBackUrl': BASESTRING, 'callBackBody': BASESTRING, 'callBackBodyType': BASESTRING,
-                   'callBackHost': BASESTRING, 'fileType': BASESTRING, 'ignoreSameKey': bool}
-
-    def __init__(self, url=None, host=None, bucket=None, key=None, md5=None, callBackUrl=None,
-                 callBackBody=None, callBackBodyType=None, callBackHost=None, fileType=None,
-                 ignoreSameKey=False):
-        self.url = url
-        self.host = host
-        self.bucket = bucket
-        self.key = key
-        self.md5 = md5
-        self.callBackUrl = callBackUrl
-        self.callBackBody = callBackBody
-        self.callBackBodyType = callBackBodyType
-        self.callBackHost = callBackHost
-        self.fileType = fileType
-        self.ignoreSameKey = ignoreSameKey
-
-
-class GetBucketFetchJobResponse(BaseModel):
-    allowedAttr = {"code": BASESTRING, "err": BASESTRING, "status": BASESTRING, "job": FetchJobResponse}
-
-    def __init__(self, code=None, status=None, job=None, err=None):
-        self.code = code
-        self.status = status
-        self.job = job
-        self.err = err
-
-
-# begin workflow related
-# begin workflow related
-# begin workflow related
-
-class CreateWorkflowTemplateResponse(BaseModel):
-    allowedAttr = {'templateName': BASESTRING}
-
-    def __init__(self, templateName=None):
-        self.templateName = templateName
-
-
-class GetWorkflowTemplateResponse(BaseModel):
-    allowedAttr = {'templateName': BASESTRING, 'description': BASESTRING, 'states': list, 'inputs': list,
-                   'tags': list, 'createTime': BASESTRING, 'lastModifyTime': BASESTRING}
-
-    def __init__(self, templateName=None, description=None, states=None, inputs=None, tags=None, createTime=None,
-                 lastModifyTime=None):
-        self.templateName = templateName
-        self.description = description
-        self.states = states
-        self.inputs = inputs
-        self.tags = tags
-        self.createTime = createTime
-        self.lastModifyTime = lastModifyTime
-
-
-class ListWorkflowTemplateResponse(BaseModel):
-    allowedAttr = {'count': int, 'templates': list, 'nextStart': int, 'isTruncated': bool}
-
-    def __init__(self, count=None, templates=None, nextStart=None, isTruncated=None):
-        self.count = count
-        self.templates = templates
-        self.nextStart = nextStart
-        self.isTruncated = isTruncated
-
-
-class CreateWorkflowResponse(BaseModel):
-    allowedAttr = {'graphName': BASESTRING, 'graphUrn': BASESTRING, 'createdAt': BASESTRING}
-
-    def __init__(self, graphName=None, graphUrn=None, createdAt=None):
-        self.graphName = graphName
-        self.graphUrn = graphUrn
-        self.createdAt = createdAt
-
-
-class GetWorkflowResponse(BaseModel):
-    allowedAttr = {'name': BASESTRING, 'graphUrn': BASESTRING, 'createdAt': BASESTRING, 'definition': object,
-                   'description': BASESTRING}
-
-    def __init__(self, name=None, graphUrn=None, createdAt=None, definition=None, description=None):
-        self.name = name
-        self.graphUrn = graphUrn
-        self.createdAt = createdAt
-        self.definition = definition
-        self.description = description
-
-
-class UpdateWorkflowResponse(BaseModel):
-    allowedAttr = {'graphName': BASESTRING, 'graphUrn': BASESTRING, 'lastModified': BASESTRING}
-
-    def __init__(self, graphName=None, graphUrn=None, lastModified=None):
-        self.graphName = graphName
-        self.graphUrn = graphUrn
-        self.lastModified = lastModified
-
-
-class ListWorkflowResponse(BaseModel):
-    allowedAttr = {'count': int, 'graphs': list, 'nextStart': int, 'isTruncated': bool}
-
-    def __init__(self, count=None, graphs=None, nextStart=None, isTruncated=None):
-        self.count = count
-        self.graphs = graphs
-        self.nextStart = nextStart
-        self.isTruncated = isTruncated
-
-
-class AsyncAPIStartWorkflowResponse(BaseModel):
-    allowedAttr = {'executionUrn': BASESTRING, 'startedAt': BASESTRING, 'executionName': BASESTRING}
-
-    def __init__(self, executionUrn=None, startedAt=None, executionName=None):
-        self.executionUrn = executionUrn
-        self.startedAt = startedAt
-        self.executionName = executionName
-
-
-class ListWorkflowExecutionResponse(BaseModel):
-    allowedAttr = {'count': int, 'nextMarker': BASESTRING, 'isTruncated': bool, 'executions': list}
-
-    def __init__(self, count=None, nextMarker=None, isTruncated=None, executions=None):
-        self.count = count
-        self.nextMarker = nextMarker
-        self.isTruncated = isTruncated
-        self.executions = executions
-
-
-class GetWorkflowExecutionResponse(BaseModel):
-    allowedAttr = {'executionInfo': object}
-
-    def __init__(self, executionInfo=None):
-        self.executionInfo = executionInfo
-
-
-class RestoreFailedWorkflowExecutionResponse(BaseModel):
-    allowedAttr = {'executionUrn': BASESTRING, 'restoredAt': BASESTRING, 'executionName': BASESTRING}
-
-    def __init__(self, executionUrn=None, restoredAt=None, executionName=None):
-        self.executionUrn = executionUrn
-        self.restoredAt = restoredAt
-        self.executionName = executionName
-
-
-class GetTriggerPolicyResponse(BaseModel):
-    allowedAttr = {'rules': list}
-
-    def __init__(self, rules=None):
-        self.rules = rules
-
-
-# end workflow related
-# end workflow related
-# end workflow related
-
-# begin virtual bucket related
-# begin virtual bucket related
-# begin virtual bucket related
-
-class BucketAliasModel(BaseModel):
-    allowedAttr = {'alias': BASESTRING, 'bucket1': BASESTRING, 'bucket2': BASESTRING, 'creationDate': BASESTRING}
-
-    def __init__(self, alias=None, bucket1=None, bucket2=None, creationDate=None):
-        self.alias = alias
-        self.bucket1 = bucket1
-        self.bucket2 = bucket2
-        self.creationDate = creationDate
-
-
-class ListBucketAliasModel(BaseModel):
-    allowedAttr = {'owner': BASESTRING, 'bucketAlias': list}
-
-    def __init__(self, owner=None, bucketAlias=None):
-        self.owner = owner
-        self.bucketAlias = bucketAlias
-
-# end virtual bucket related
-# end virtual bucket related
-# end virtual bucket related
+#!/usr/bin/python
+# -*- coding:utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+import time
+from obs.const import LONG, BASESTRING
+from obs import util
+from obs import progress
+
+__all__ = [
+    'BaseModel',
+    'GetResult',
+    'CompletePart',
+    'Permission',
+    'StorageClass',
+    'EventType',
+    'RestoreTier',
+    'Group',
+    'Grantee',
+    'Grant',
+    'ExtensionGrant',
+    'Owner',
+    'Initiator',
+    'ACL',
+    'Bucket',
+    'CommonPrefix',
+    'Condition',
+    'Content',
+    'DateTime',
+    'SseHeader',
+    'SseCHeader',
+    'SseKmsHeader',
+    'CopyObjectHeader',
+    'SetObjectMetadataHeader',
+    'CorsRule',
+    'CreateBucketHeader',
+    'ErrorDocument',
+    'IndexDocument',
+    'Expiration',
+    'NoncurrentVersionExpiration',
+    'AbortIncompleteMultipartUpload',
+    'GetObjectHeader',
+    'HeadPermission',
+    'Lifecycle',
+    'Notification',
+    'TopicConfiguration',
+    'FunctionGraphConfiguration',
+    'FilterRule',
+    'Replication',
+    'ReplicationRule',
+    'ObjectDeleteMarker',
+    'ObjectVersionHead',
+    'ObjectVersion',
+    'Options',
+    'Policy',
+    'PutObjectHeader',
+    'AppendObjectHeader',
+    'AppendObjectContent',
+    'RedirectAllRequestTo',
+    'Redirect',
+    'RoutingRule',
+    'Tag',
+    'TagInfo',
+    'Transition',
+    'Part',
+    'NoncurrentVersionTransition',
+    'Rule',
+    'Upload',
+    'Versions',
+    'Object',
+    'WebsiteConfiguration',
+    'Logging',
+    'ObjectVersions',
+    'CompleteMultipartUploadRequest',
+    'CompleteMultipartUploadResponse',
+    'CopyObjectResponse',
+    'CopyPartResponse',
+    'DeleteObjectResponse',
+    'DeleteObjectsRequest',
+    'DeleteObjectsResponse',
+    'ErrorResult',
+    'DeleteObjectResult',
+    'ListMultipartUploadsRequest',
+    'ListPartsResponse',
+    'GetBucketMetadataResponse',
+    'GetBucketQuotaResponse',
+    'GetBucketStorageInfoResponse',
+    'GetBucketStoragePolicyResponse',
+    'GetObjectMetadataResponse',
+    'SetObjectMetadataResponse',
+    'GetObjectRequest',
+    'InitiateMultipartUploadResponse',
+    'LifecycleResponse',
+    'ListBucketsResponse',
+    'ListMultipartUploadsResponse',
+    'ListObjectsResponse',
+    'LocationResponse',
+    'OptionsResponse',
+    'PutContentResponse',
+    'AppendObjectResponse',
+    'UploadPartResponse',
+    'ResponseWrapper',
+    'ObjectStream',
+    'GetBucketEncryptionResponse',
+    'UploadFileHeader',
+    'GetBucketRequestPaymentResponse',
+    'Payer',
+    'ExtensionHeader',
+    'FetchStatus',
+    'FetchPolicy',
+    '_FetchJob',
+    'FetchJobResponse',
+    'SetBucketFetchJobResponse',
+    'GetBucketFetchJobResponse',
+    'CreateWorkflowTemplateResponse',
+    'GetWorkflowTemplateResponse',
+    'ListWorkflowTemplateResponse',
+    'CreateWorkflowResponse',
+    'GetWorkflowResponse',
+    'UpdateWorkflowResponse',
+    'ListWorkflowResponse',
+    'AsyncAPIStartWorkflowResponse',
+    'ListWorkflowExecutionResponse',
+    'GetWorkflowExecutionResponse',
+    'RestoreFailedWorkflowExecutionResponse',
+    'GetTriggerPolicyResponse',
+    'BucketAliasModel',
+    'ListBucketAliasModel'
+]
+
+
+class BaseModel(dict):
+    def __init__(self, **kwargs):
+        super(BaseModel, self).__init__(**kwargs)
+
+    def __getattr__(self, key):
+        if key == 'allowedAttr':
+            return {}
+        key = key[:1].lower() + key[1:] if key is not None else ''
+        if key in self.allowedAttr:
+            return self.get(key)
+        return None
+
+    def __setattr__(self, key, value):
+        key = key[:1].lower() + key[1:] if key is not None else ''
+        if key in self.allowedAttr:
+            if util.verify_attr_type(value, self.allowedAttr[key]):
+                self[key] = value
+
+    def __delattr__(self, key):
+        key = key[:1].lower() + key[1:] if key is not None else ''
+        if key in self.allowedAttr and key in self:
+            del self[key]
+
+
+class GetResult(BaseModel):
+    allowedAttr = {'status': int, 'reason': BASESTRING, 'errorCode': BASESTRING, 'errorMessage': BASESTRING,
+                   'body': object, 'requestId': BASESTRING, 'hostId': BASESTRING, 'resource': BASESTRING,
+                   'header': list,
+                   'indicator': BASESTRING}
+
+    def __init__(self, code=None, message=None, status=None, reason=None, body=None, requestId=None, hostId=None,
+                 resource=None, header=None, indicator=None):
+        self.status = status
+        self.reason = reason
+        self.errorCode = code
+        self.errorMessage = message
+        self.body = body
+        self.requestId = requestId
+        self.hostId = hostId
+        self.resource = resource
+        self.header = header
+        self.indicator = indicator
+
+
+class CompletePart(BaseModel):
+    allowedAttr = {'partNum': int, 'etag': BASESTRING}
+
+    def __init__(self, partNum=None, etag=None):
+        self.partNum = partNum
+        self.etag = etag
+
+
+class AvailableZone(object):
+    MULTI_AZ = '3az'
+
+
+class Permission(object):
+    READ = 'READ'
+    WRITE = 'WRITE'
+    READ_ACP = 'READ_ACP'
+    WRITE_ACP = 'WRITE_ACP'
+    FULL_CONTROL = 'FULL_CONTROL'
+
+
+class Group(object):
+    ALL_USERS = 'Everyone'
+    AUTHENTICATED_USERS = 'AuthenticatedUsers'
+    LOG_DELIVERY = 'LogDelivery'
+
+
+class HeadPermission(object):
+    PRIVATE = 'private'
+    PUBLIC_READ = 'public-read'
+    PUBLIC_READ_WRITE = 'public-read-write'
+    PUBLIC_READ_DELIVERED = 'public-read-delivered'
+    PUBLIC_READ_WRITE_DELIVERED = 'public-read-write-delivered'
+    AUTHENTICATED_READ = 'authenticated-read'
+    BUCKET_OWNER_READ = 'bucket-owner-read'
+    BUCKET_OWNER_FULL_CONTROL = 'bucket-owner-full-control'
+    LOG_DELIVERY_WRITE = 'log-delivery-write'
+
+
+class StorageClass(object):
+    STANDARD = 'STANDARD'
+    WARM = 'WARM'
+    COLD = 'COLD'
+
+
+class RestoreTier(object):
+    EXPEDITED = 'Expedited'
+    STANDARD = 'STANDARD'
+    BULK = 'Bulk'
+
+
+class EventType(object):
+    OBJECT_CREATED_ALL = 'ObjectCreated:*'
+    OBJECT_CREATED_PUT = 'ObjectCreated:Put'
+    OBJECT_CREATED_POST = 'ObjectCreated:Post'
+    OBJECT_CREATED_COPY = 'ObjectCreated:Copy'
+    OBJECT_CREATED_COMPLETE_MULTIPART_UPLOAD = 'ObjectCreated:CompleteMultipartUpload'
+    OBJECT_REMOVED_ALL = 'ObjectRemoved:*'
+    OBJECT_REMOVED_DELETE = 'ObjectRemoved:Delete'
+    OBJECT_REMOVED_DELETE_MARKER_CREATED = 'ObjectRemoved:DeleteMarkerCreated'
+
+
+class Grantee(BaseModel):
+    allowedAttr = {'grantee_id': BASESTRING, 'grantee_name': BASESTRING, 'group': BASESTRING}
+
+    def __init__(self, grantee_id=None, grantee_name=None, group=None):
+        self.grantee_id = grantee_id
+        self.grantee_name = grantee_name
+        self.group = group
+
+
+class Grant(BaseModel):
+    allowedAttr = {'grantee': Grantee, 'permission': BASESTRING, 'delivered': [bool, BASESTRING]}
+
+    def __init__(self, grantee=None, permission=None, delivered=None):
+        self.grantee = grantee
+        self.permission = permission
+        self.delivered = delivered
+
+
+class Owner(BaseModel):
+    allowedAttr = {'owner_id': BASESTRING, 'owner_name': BASESTRING}
+
+    def __init__(self, owner_id=None, owner_name=None):
+        self.owner_id = owner_id
+        self.owner_name = owner_name
+
+
+class Initiator(BaseModel):
+    allowedAttr = {'id': BASESTRING, 'name': BASESTRING}
+
+    def __init__(self, id=None, name=None):
+        self.id = id
+        self.name = name
+
+
+class ACL(BaseModel):
+    allowedAttr = {'owner': Owner, 'grants': list, 'delivered': [bool, BASESTRING]}
+
+    def __init__(self, owner=None, grants=None, delivered=None):
+        self.owner = owner
+        self.grants = grants
+        self.delivered = delivered
+
+    def add_grant(self, grant):
+        if self.grants is None:
+            self.grants = []
+        if isinstance(grant, Grant):
+            self.grants.append(grant)
+
+
+class Bucket(BaseModel):
+    allowedAttr = {'name': BASESTRING, 'create_date': BASESTRING, 'location': BASESTRING, "bucket_type": BASESTRING}
+
+    def __init__(self, name=None, create_date=None, location=None, bucket_type=None):
+        self.name = name
+        self.create_date = create_date
+        self.location = location
+        self.bucket_type = bucket_type
+
+
+class CommonPrefix(BaseModel):
+    allowedAttr = {'prefix': BASESTRING}
+
+    def __init__(self, prefix=None):
+        self.prefix = prefix
+
+
+class Condition(BaseModel):
+    allowedAttr = {'keyPrefixEquals': BASESTRING, 'httpErrorCodeReturnedEquals': int}
+
+    def __init__(self, keyPrefixEquals=None, httpErrorCodeReturnedEquals=None):
+        self.keyPrefixEquals = keyPrefixEquals
+        self.httpErrorCodeReturnedEquals = httpErrorCodeReturnedEquals
+
+
+class Content(BaseModel):
+    allowedAttr = {'key': BASESTRING, 'lastModified': BASESTRING, 'etag': BASESTRING,
+                   'size': LONG, 'owner': Owner, 'storageClass': BASESTRING, 'isAppendable': bool}
+
+    def __init__(self, key=None, lastModified=None, etag=None, size=None, owner=None, storageClass=None,
+                 isAppendable=None):
+        self.key = key
+        self.lastModified = lastModified
+        self.etag = etag
+        self.size = size
+        self.owner = owner
+        self.storageClass = storageClass
+        self.isAppendable = isAppendable
+
+    def __str__(self):
+        return self.key
+
+
+class DateTime(BaseModel):
+    allowedAttr = {'year': int, 'month': int, 'day': int, 'hour': int, 'min': int, 'sec': int}
+
+    def __init__(self, year, month, day, hour=0, min=0, sec=0):
+        self.year = year
+        self.month = month
+        self.day = day
+        self.hour = hour
+        self.min = min
+        self.sec = sec
+
+    def ToUTTime(self):
+        strTime = '%04d-%02d-%02dT%02d:%02d:%02d.000Z' % (
+            self.year, self.month, self.day, self.hour, self.min, self.sec)
+        return strTime
+
+    def ToGMTTime(self):
+        strTime = (self.year, self.month, self.day, self.hour, self.min, self.sec, 0, 0, 0)
+        gmt_time = time.gmtime(time.mktime(strTime) - time.timezone)
+        return time.strftime('%a, %d %b %Y %H:%M:%S GMT', gmt_time)
+
+    def ToUTMidTime(self):
+        strTime = '%04d-%02d-%02dT00:00:00.000Z' % (self.year, self.month, self.day)
+        return strTime
+
+    @staticmethod
+    def UTCToLocal(strUTC):
+        if strUTC is None:
+            return None
+
+        date_format = '%Y-%m-%dT%H:%M:%S.%fZ'
+        CST_FORMAT = '%Y/%m/%d %H:%M:%S'
+        try:
+            gmt_time = time.strptime(strUTC, date_format)
+
+            cst_time = time.localtime(time.mktime(gmt_time) - time.timezone)
+            dt = time.strftime(CST_FORMAT, cst_time)
+
+            return dt
+        except Exception:
+            return strUTC
+
+    @staticmethod
+    def UTCToLocalMid(strUTC):
+        if strUTC is None:
+            return None
+
+        date_format = '%Y-%m-%dT%H:%M:%S.%fZ'
+        CST_FORMAT = '%Y/%m/%d 00:00:00'
+        try:
+            gmt_time = time.strptime(util.to_string(strUTC), date_format)
+
+            cst_time = time.localtime(time.mktime(gmt_time) - time.timezone)
+            dt = time.strftime(CST_FORMAT, cst_time)
+            return dt
+        except Exception:
+            return strUTC
+
+
+class SseHeader(BaseModel):
+    allowedAttr = {'encryption': BASESTRING, 'key': BASESTRING}
+
+
+class SseCHeader(SseHeader):
+    @staticmethod
+    def getInstance(key, encryption='AES256'):
+        return SseCHeader(encryption=encryption, key=key)
+
+
+class SseKmsHeader(SseHeader):
+    @staticmethod
+    def getInstance(key=None, encryption='kms'):
+        return SseKmsHeader(encryption=encryption, key=key)
+
+
+class CopyObjectHeader(BaseModel):
+    allowedAttr = {'acl': BASESTRING, 'directive': BASESTRING, 'if_match': BASESTRING,
+                   'if_none_match': BASESTRING, 'if_modified_since': [BASESTRING, DateTime],
+                   'if_unmodified_since': [BASESTRING, DateTime], 'location': BASESTRING,
+                   'destSseHeader': SseHeader, 'sourceSseHeader': SseHeader, 'cacheControl': BASESTRING,
+                   'contentDisposition': BASESTRING,
+                   'contentEncoding': BASESTRING, 'contentLanguage': BASESTRING, 'contentType': BASESTRING,
+                   'expires': BASESTRING,
+                   'storageClass': BASESTRING, 'successActionRedirect': BASESTRING, 'extensionGrants': list}
+
+    def __init__(self, acl=None, directive=None, if_match=None, if_none_match=None, if_modified_since=None,
+                 if_unmodified_since=None, location=None, destSseHeader=None, sourceSseHeader=None,
+                 cacheControl=None, contentDisposition=None, contentEncoding=None, contentLanguage=None,
+                 contentType=None, expires=None, storageClass=None, successActionRedirect=None, extensionGrants=None):
+        self.acl = acl
+        self.directive = directive
+        self.if_match = if_match
+        self.if_none_match = if_none_match
+        self.if_modified_since = if_modified_since
+        self.if_unmodified_since = if_unmodified_since
+        self.location = location
+        self.destSseHeader = destSseHeader
+        self.sourceSseHeader = sourceSseHeader
+        self.cacheControl = cacheControl
+        self.contentDisposition = contentDisposition
+        self.contentEncoding = contentEncoding
+        self.contentLanguage = contentLanguage
+        self.contentType = contentType
+        self.expires = expires
+        self.storageClass = storageClass
+        self.successActionRedirect = successActionRedirect
+        self.extensionGrants = extensionGrants
+
+
+class SetObjectMetadataHeader(BaseModel):
+    allowedAttr = {'removeUnset': bool, 'cacheControl': BASESTRING, 'contentDisposition': BASESTRING,
+                   'contentEncoding': BASESTRING, 'contentLanguage': BASESTRING, 'contentType': BASESTRING,
+                   'expires': BASESTRING,
+                   'storageClass': BASESTRING, 'location': BASESTRING}
+
+    def __init__(self, removeUnset=False, location=None, cacheControl=None, contentDisposition=None,
+                 contentEncoding=None, contentLanguage=None, contentType=None, expires=None, storageClass=None):
+        self.removeUnset = removeUnset
+        self.location = location
+        self.cacheControl = cacheControl
+        self.contentDisposition = contentDisposition
+        self.contentEncoding = contentEncoding
+        self.contentLanguage = contentLanguage
+        self.contentType = contentType
+        self.expires = expires
+        self.storageClass = storageClass
+
+class RenameFileHeader(BaseModel,object):
+    allowedAttr = {'objectKey': BASESTRING, 'newObjectKey': BASESTRING}
+
+    def __init__(self, objectKey=None, newObjectKey=None):
+        super(RenameFileHeader, self).__init__()
+        self.objectKey = objectKey
+        self.newObjectKey = newObjectKey
+
+
+class CorsRule(BaseModel):
+    allowedAttr = {'id': BASESTRING, 'allowedMethod': list, 'allowedOrigin': list,
+                   'allowedHeader': list, 'maxAgeSecond': [int, BASESTRING], 'exposeHeader': list}
+
+    def __init__(self, id=None, allowedMethod=None, allowedOrigin=None, allowedHeader=None, maxAgeSecond=None,
+                 exposeHeader=None):
+        self.id = id
+        self.allowedMethod = allowedMethod
+        self.allowedOrigin = allowedOrigin
+        self.allowedHeader = allowedHeader
+        self.maxAgeSecond = maxAgeSecond
+        self.exposeHeader = exposeHeader
+
+
+class CreateBucketHeader(BaseModel):
+    allowedAttr = {'aclControl': BASESTRING, 'storageClass': BASESTRING, 'extensionGrants': list,
+                   'availableZone': BASESTRING, 'epid': BASESTRING, "isPFS": bool, "redundancy": BASESTRING,
+                   "isFusionAllowUpgrade": bool, "isFusionAllowAlternative": bool}
+
+    def __init__(self, aclControl=None, storageClass=None, extensionGrants=None,
+                 availableZone=None, epid=None, isPFS=False, redundancy=None, 
+                 isFusionAllowUpgrade=None, isFusionAllowAlternative=None):
+        """
+        Headers that can be carried during bucket creation
+        :param aclControl: ACL policy of a bucket
+        :param storageClass: Specifies the default storage class of a bucket. The value can be "STANDARD" (Standard),
+               "WARM" (Infrequent Access), and "COLD" (Archive). The Standard storage class is used by default.
+        :param extensionGrants: Extended permission list that can be specified during bucket creation.
+        :param availableZone: AZ type that can be specified during bucket creation. A single AZ is used by default.
+               You can also use "3az".
+        :param epid: Enterprise project ID. Users who have enabled the enterprise project function can obtain this ID
+               from the enterprise project management service.
+        :param isPFS: Specifies whether to create a parallel file system.
+        """
+        self.aclControl = aclControl
+        self.storageClass = storageClass
+        self.extensionGrants = extensionGrants
+        self.availableZone = availableZone
+        self.epid = epid
+        self.isPFS = isPFS
+        self.redundancy = redundancy
+        self.isFusionAllowUpgrade = isFusionAllowUpgrade
+        self.isFusionAllowAlternative = isFusionAllowAlternative
+
+class ExtensionGrant(BaseModel):
+    allowedAttr = {'permission': BASESTRING, 'granteeId': BASESTRING}
+
+    def __init__(self, granteeId=None, permission=None):
+        self.granteeId = granteeId
+        self.permission = permission
+
+
+class ErrorDocument(BaseModel):
+    allowedAttr = {'key': BASESTRING}
+
+    def __init__(self, key=None):
+        self.key = key
+
+
+class IndexDocument(BaseModel):
+    allowedAttr = {'suffix': BASESTRING}
+
+    def __init__(self, suffix=None):
+        self.suffix = suffix
+
+
+class Expiration(BaseModel):
+    allowedAttr = {'date': [BASESTRING, DateTime], 'days': int}
+
+    def __init__(self, date=None, days=None):
+        self.date = date
+        self.days = days
+
+
+class NoncurrentVersionExpiration(BaseModel):
+    allowedAttr = {'noncurrentDays': int}
+
+    def __init__(self, noncurrentDays=None):
+        self.noncurrentDays = noncurrentDays
+
+
+class GetObjectHeader(BaseModel):
+    allowedAttr = {'range': BASESTRING, 'if_modified_since': [BASESTRING, DateTime],
+                   'if_unmodified_since': [BASESTRING, DateTime], 'if_match': BASESTRING, 'if_none_match': BASESTRING,
+                   'origin': BASESTRING, 'requestHeaders': BASESTRING, 'sseHeader': SseHeader}
+
+    def __init__(self, range=None, if_modified_since=None, if_unmodified_since=None, if_match=None, if_none_match=None,
+                 origin=None,
+                 requestHeaders=None, sseHeader=None):
+        self.range = range
+        self.if_modified_since = if_modified_since
+        self.if_unmodified_since = if_unmodified_since
+        self.if_match = if_match
+        self.if_none_match = if_none_match
+        self.origin = origin
+        self.requestHeaders = requestHeaders
+        self.sseHeader = sseHeader
+
+
+class Lifecycle(BaseModel):
+    allowedAttr = {'rule': list}
+
+    def __init__(self, rule=None):
+        self.rule = rule
+
+
+class Replication(BaseModel):
+    allowedAttr = {'replicationRules': list, 'agency': BASESTRING}
+
+    def __init__(self, replicationRules=None, agency=None):
+        self.replicationRules = replicationRules
+        self.agency = agency
+
+
+class ReplicationRule(BaseModel):
+    allowedAttr = {'id': BASESTRING, 'prefix': BASESTRING, 'status': BASESTRING, 'bucket': BASESTRING,
+                   'storageClass': BASESTRING, 'deleteData': BASESTRING, 'historicalObjectReplication': BASESTRING}
+
+    def __init__(self, id=None, prefix=None, status=None, bucket=None, storageClass=None, deleteData=None,
+                 historicalObjectReplication=None):
+        self.id = id
+        self.prefix = prefix
+        self.status = status
+        self.bucket = bucket
+        self.storageClass = storageClass
+        self.deleteData = deleteData
+        self.historicalObjectReplication = historicalObjectReplication
+
+
+class Notification(BaseModel):
+    allowedAttr = {'topicConfigurations': list, 'functionGraphConfigurations': list}
+
+    def __init__(self, topicConfigurations=None, functionGraphConfigurations=None):
+        self.topicConfigurations = topicConfigurations
+        self.functionGraphConfigurations = functionGraphConfigurations
+
+
+class TopicConfiguration(BaseModel):
+    allowedAttr = {'id': BASESTRING, 'topic': BASESTRING, 'events': list, 'filterRules': list}
+
+    def __init__(self, id=None, topic=None, events=None, filterRules=None):
+        self.id = id
+        self.topic = topic
+        self.events = events
+        self.filterRules = filterRules
+
+
+class FunctionGraphConfiguration(BaseModel):
+    allowedAttr = {'id': BASESTRING, 'functionGraph': BASESTRING, 'events': list, 'filterRules': list}
+
+    def __init__(self, id=None, functionGraph=None, events=None, filterRules=None):
+        self.id = id
+        self.functionGraph = functionGraph
+        self.events = events
+        self.filterRules = filterRules
+
+
+class FilterRule(BaseModel):
+    allowedAttr = {'name': BASESTRING, 'value': BASESTRING}
+
+    def __init__(self, name=None, value=None):
+        self.name = name
+        self.value = value
+
+
+class ObjectDeleteMarker(BaseModel):
+    allowedAttr = {'key': BASESTRING, 'versionId': BASESTRING, 'isLatest': bool, 'lastModified': BASESTRING,
+                   'owner': Owner}
+
+    def __init__(self, key=None, versionId=None, isLatest=None, lastModified=None, owner=None):
+        self.key = key
+        self.versionId = versionId
+        self.isLatest = isLatest
+        self.lastModified = lastModified
+        self.owner = owner
+
+
+class ObjectVersionHead(BaseModel):
+    allowedAttr = {'name': BASESTRING, 'location': BASESTRING, 'prefix': BASESTRING, 'delimiter': BASESTRING,
+                   'keyMarker': BASESTRING,
+                   'versionIdMarker': BASESTRING, 'nextKeyMarker': BASESTRING, 'nextVersionIdMarker': BASESTRING,
+                   'maxKeys': int, 'isTruncated': bool, "encoding_type": BASESTRING}
+
+    def __init__(self, name=None, location=None, prefix=None, delimiter=None, keyMarker=None, versionIdMarker=None,
+                 nextKeyMarker=None, nextVersionIdMarker=None, maxKeys=None, isTruncated=None, encoding_type=None):
+        self.name = name
+        self.location = location
+        self.prefix = prefix
+        self.delimiter = delimiter
+        self.keyMarker = keyMarker
+        self.versionIdMarker = versionIdMarker
+        self.nextKeyMarker = nextKeyMarker
+        self.nextVersionIdMarker = nextVersionIdMarker
+        self.maxKeys = maxKeys
+        self.isTruncated = isTruncated
+        self.encoding_type = encoding_type
+
+
+class ObjectVersion(BaseModel):
+    allowedAttr = {'key': BASESTRING, 'versionId': BASESTRING, 'isLatest': bool, 'lastModified': BASESTRING,
+                   'etag': BASESTRING, 'size': LONG, 'owner': Owner, 'storageClass': BASESTRING, 'isAppendable': bool}
+
+    def __init__(self, key=None, versionId=None, isLatest=None, lastModified=None, etag=None,
+                 size=None, owner=None, storageClass=None, isAppendable=None):
+        self.key = key
+        self.versionId = versionId
+        self.isLatest = isLatest
+        self.lastModified = lastModified
+        self.etag = etag
+        self.size = size
+        self.owner = owner
+        self.storageClass = storageClass
+        self.isAppendable = isAppendable
+
+
+class Options(BaseModel):
+    allowedAttr = {'origin': BASESTRING, 'accessControlRequestMethods': list, 'accessControlRequestHeaders': list}
+
+    def __init__(self, origin=None, accessControlRequestMethods=None, accessControlRequestHeaders=None):
+        self.origin = origin
+        self.accessControlRequestMethods = accessControlRequestMethods
+        self.accessControlRequestHeaders = accessControlRequestHeaders
+
+
+class Policy(BaseModel):
+    allowedAttr = {'policyJSON': BASESTRING}
+
+    def __init__(self, policyJSON=None):
+        self.policyJSON = policyJSON
+
+
+class PutObjectHeader(BaseModel):
+    allowedAttr = {'md5': BASESTRING, 'acl': BASESTRING, 'location': BASESTRING,
+                   'contentType': BASESTRING, 'sseHeader': SseHeader, 'contentLength': [int, LONG, BASESTRING],
+                   'storageClass': BASESTRING, 'successActionRedirect': BASESTRING, 'expires': int,
+                   'extensionGrants': list, "sha256": BASESTRING}
+
+    def __init__(self, md5=None, acl=None, location=None, contentType=None, sseHeader=None, contentLength=None,
+                 storageClass=None, successActionRedirect=None, expires=None, extensionGrants=None, sha256=None):
+        self.md5 = md5
+        self.sha256 = sha256
+        self.acl = acl
+        self.location = location
+        self.contentType = contentType
+        self.sseHeader = sseHeader
+        self.contentLength = contentLength
+        self.storageClass = storageClass
+        self.successActionRedirect = successActionRedirect
+        self.expires = expires
+        self.extensionGrants = extensionGrants
+
+
+AppendObjectHeader = PutObjectHeader
+
+
+class UploadFileHeader(BaseModel):
+    allowedAttr = {'acl': BASESTRING, 'websiteRedirectLocation': BASESTRING, 'contentType': BASESTRING,
+                   'sseHeader': SseHeader, 'storageClass': BASESTRING,
+                   'successActionRedirect': BASESTRING, 'expires': int, 'extensionGrants': list}
+
+    def __init__(self, acl=None, websiteRedirectLocation=None, contentType=None, sseHeader=None,
+                 storageClass=None, successActionRedirect=None, expires=None, extensionGrants=None):
+        self.acl = acl
+        self.websiteRedirectLocation = websiteRedirectLocation
+        self.contentType = contentType
+        self.sseHeader = sseHeader
+        self.storageClass = storageClass
+        self.successActionRedirect = successActionRedirect
+        self.expires = expires
+        self.extensionGrants = extensionGrants
+
+
+class AppendObjectContent(BaseModel):
+    allowedAttr = {'content': [object], 'position': [LONG, int, BASESTRING], 'offset': [LONG, int, BASESTRING],
+                   'isFile': bool}
+
+    def __init__(self, content=None, position=None, offset=None, isFile=False):
+        self.content = content
+        self.position = position
+        self.offset = offset
+        self.isFile = isFile
+
+
+class RedirectAllRequestTo(BaseModel):
+    allowedAttr = {'hostName': BASESTRING, 'protocol': BASESTRING}
+
+    def __init__(self, hostName=None, protocol=None):
+        self.hostName = hostName
+        self.protocol = protocol
+
+
+class Redirect(BaseModel):
+    allowedAttr = {'protocol': BASESTRING, 'hostName': BASESTRING, 'replaceKeyPrefixWith': BASESTRING,
+                   'replaceKeyWith': BASESTRING, 'httpRedirectCode': int}
+
+    def __init__(self, protocol=None, hostName=None, replaceKeyPrefixWith=None, replaceKeyWith=None,
+                 httpRedirectCode=None):
+        self.protocol = protocol
+        self.hostName = hostName
+        self.replaceKeyPrefixWith = replaceKeyPrefixWith
+        self.replaceKeyWith = replaceKeyWith
+        self.httpRedirectCode = httpRedirectCode
+
+
+class RoutingRule(BaseModel):
+    allowedAttr = {'condition': Condition, 'redirect': Redirect}
+
+    def __init__(self, condition=None, redirect=None):
+        self.condition = condition
+        self.redirect = redirect
+
+
+class Tag(BaseModel):
+    allowedAttr = {'key': BASESTRING, 'value': BASESTRING}
+
+    def __init__(self, key=None, value=None):
+        self.key = key
+        self.value = value
+
+
+class TagInfo(BaseModel):
+    allowedAttr = {'tagSet': list}
+
+    def __init__(self, tagSet=None):
+        self.tagSet = tagSet
+
+    def addTag(self, key, value):
+        if self.tagSet is None:
+            self.tagSet = []
+        self.tagSet.append(Tag(key=key, value=value))
+        return self
+
+
+class Transition(BaseModel):
+    allowedAttr = {'date': [BASESTRING, DateTime], 'days': int, 'storageClass': BASESTRING}
+
+    def __init__(self, storageClass=None, date=None, days=None):
+        self.storageClass = storageClass
+        self.date = date
+        self.days = days
+
+
+class Part(BaseModel):
+    allowedAttr = {'partNumber': int, 'lastModified': BASESTRING, 'etag': BASESTRING, 'size': LONG}
+
+    def __init__(self, partNumber=None, lastModified=None, etag=None, size=None):
+        self.partNumber = partNumber
+        self.lastModified = lastModified
+        self.etag = etag
+        self.size = size
+
+
+class NoncurrentVersionTransition(BaseModel):
+    allowedAttr = {'noncurrentDays': int, 'storageClass': BASESTRING}
+
+    def __init__(self, storageClass=None, noncurrentDays=None):
+        self.noncurrentDays = noncurrentDays
+        self.storageClass = storageClass
+
+
+class AbortIncompleteMultipartUpload(BaseModel):
+    allowedAttr = {'daysAfterInitiation': int}
+
+    def __init__(self, daysAfterInitiation=None):
+        super(AbortIncompleteMultipartUpload, self).__init__()
+        self.daysAfterInitiation = daysAfterInitiation
+
+
+class Rule(BaseModel):
+    allowedAttr = {'id': BASESTRING, 'prefix': BASESTRING, 'status': BASESTRING, 'expiration': Expiration,
+                   'noncurrentVersionExpiration': NoncurrentVersionExpiration,
+                   'transition': [Transition, list], 'noncurrentVersionTransition': [NoncurrentVersionTransition, list],
+                   'abortIncompleteMultipartUpload': AbortIncompleteMultipartUpload}
+
+    def __init__(self, id=None, prefix=None, status=None, expiration=None, noncurrentVersionExpiration=None,
+                 transition=None, noncurrentVersionTransition=None, abortIncompleteMultipartUpload=None):
+        self.id = id
+        self.prefix = prefix
+        self.status = status
+        self.expiration = expiration
+        self.noncurrentVersionExpiration = noncurrentVersionExpiration
+        self.transition = transition
+        self.noncurrentVersionTransition = noncurrentVersionTransition
+        self.abortIncompleteMultipartUpload = abortIncompleteMultipartUpload
+
+
+class Upload(BaseModel):
+    allowedAttr = {'key': BASESTRING, 'uploadId': BASESTRING, 'initiator': Initiator,
+                   'owner': Owner, 'storageClass': BASESTRING, 'initiated': BASESTRING}
+
+    def __init__(self, key=None, uploadId=None, initiator=None, owner=None, storageClass=None, initiated=None):
+        self.key = key
+        self.uploadId = uploadId
+        self.initiator = initiator
+        self.owner = owner
+        self.storageClass = storageClass
+        self.initiated = initiated
+
+
+class Versions(BaseModel):
+    allowedAttr = {'prefix': BASESTRING, 'key_marker': BASESTRING, 'max_keys': [int, BASESTRING],
+                   'delimiter': BASESTRING, 'version_id_marker': BASESTRING, 'encoding_type': BASESTRING}
+
+    def __init__(self, prefix=None, key_marker=None, max_keys=None, delimiter=None, version_id_marker=None,
+                 encoding_type=None):
+        self.prefix = prefix
+        self.key_marker = key_marker
+        self.max_keys = max_keys
+        self.delimiter = delimiter
+        self.version_id_marker = version_id_marker
+        self.encoding_type = encoding_type
+
+
+class Object(BaseModel):
+    allowedAttr = {'key': BASESTRING, 'versionId': BASESTRING}
+
+    def __init__(self, key=None, versionId=None):
+        self.key = key
+        self.versionId = versionId
+
+
+class WebsiteConfiguration(BaseModel):
+    allowedAttr = {'redirectAllRequestTo': RedirectAllRequestTo, 'indexDocument': IndexDocument,
+                   'errorDocument': ErrorDocument, 'routingRules': list}
+
+    def __init__(self, redirectAllRequestTo=None,
+                 indexDocument=None,
+                 errorDocument=None,
+                 routingRules=None):
+        self.redirectAllRequestTo = redirectAllRequestTo
+        self.indexDocument = indexDocument
+        self.errorDocument = errorDocument
+        self.routingRules = routingRules
+
+
+class Logging(BaseModel):
+    allowedAttr = {'targetBucket': BASESTRING, 'targetPrefix': BASESTRING, 'targetGrants': list, 'agency': BASESTRING}
+
+    def __init__(self, targetBucket=None, targetPrefix=None, targetGrants=None, agency=None):
+        self.targetBucket = targetBucket
+        self.targetPrefix = targetPrefix
+        self.targetGrants = targetGrants
+        self.agency = agency
+
+    def add_grant(self, grant):
+        if self.targetGrants is None:
+            self.targetGrants = []
+        if isinstance(grant, Grant):
+            self.targetGrants.append(grant)
+
+
+class ObjectVersions(BaseModel):
+    allowedAttr = {'head': ObjectVersionHead, 'versions': list, 'markers': list, 'commonPrefixs': list}
+
+    def __init__(self, head=None, versions=None, markers=None, commonPrefixs=None):
+        self.head = head
+        self.versions = versions
+        self.markers = markers
+        self.commonPrefixs = commonPrefixs
+
+
+class CompleteMultipartUploadRequest(BaseModel):
+    allowedAttr = {'parts': list}
+
+    def __init__(self, parts=None):
+        self.parts = parts
+
+    def add_part(self, part):
+        if self.parts is None:
+            self.parts = []
+        if isinstance(part, CompletePart):
+            self.parts.append(part)
+
+
+class CompleteMultipartUploadResponse(BaseModel):
+    allowedAttr = {'location': BASESTRING, 'bucket': BASESTRING, "encoding_type": BASESTRING,
+                   'key': BASESTRING, 'etag': BASESTRING, 'versionId': BASESTRING, 'sseKms': BASESTRING,
+                   'sseKmsKey': BASESTRING, 'sseC': BASESTRING, 'sseCKeyMd5': BASESTRING, 'objectUrl': BASESTRING}
+
+    def __init__(self, location=None, bucket=None, key=None, etag=None,
+                 versionId=None, sseKms=None, sseKmsKey=None, sseC=None,
+                 sseCKeyMd5=None, objectUrl=None, encoding_type=None):
+        self.location = location
+        self.bucket = bucket
+        self.key = key
+        self.etag = etag
+        self.versionId = versionId
+        self.sseKms = sseKms
+        self.sseKmsKey = sseKmsKey
+        self.sseC = sseC
+        self.sseCKeyMd5 = sseCKeyMd5
+        self.objectUrl = objectUrl
+        self.encoding_type = encoding_type
+
+
+class CopyObjectResponse(BaseModel):
+    allowedAttr = {'lastModified': BASESTRING, 'etag': BASESTRING, 'copySourceVersionId': BASESTRING,
+                   'versionId': BASESTRING,
+                   'sseKms': BASESTRING, 'sseKmsKey': BASESTRING, 'sseC': BASESTRING, 'sseCKeyMd5': BASESTRING}
+
+    def __init__(self, lastModified=None, etag=None, copySourceVersionId=None, versionId=None, sseKms=None,
+                 sseKmsKey=None, sseC=None, sseCKeyMd5=None):
+        self.lastModified = lastModified
+        self.etag = etag
+        self.copySourceVersionId = copySourceVersionId
+        self.versionId = versionId
+        self.sseKms = sseKms
+        self.sseKmsKey = sseKmsKey
+        self.sseC = sseC
+        self.sseCKeyMd5 = sseCKeyMd5
+
+
+class CopyPartResponse(BaseModel):
+    allowedAttr = {'lastModified': BASESTRING, 'etag': BASESTRING, 'modifiedDate': BASESTRING,
+                   'sseKms': BASESTRING, 'sseKmsKey': BASESTRING, 'sseC': BASESTRING, 'sseCKeyMd5': BASESTRING}
+
+    def __init__(self, lastModified=None, etag=None, modifiedDate=None, sseKms=None, sseKmsKey=None, sseC=None,
+                 sseCKeyMd5=None):
+        self.lastModified = lastModified
+        self.etag = etag
+        self.modifiedDate = modifiedDate
+        self.sseKms = sseKms
+        self.sseKmsKey = sseKmsKey
+        self.sseC = sseC
+        self.sseCKeyMd5 = sseCKeyMd5
+
+
+class DeleteObjectResponse(BaseModel):
+    allowedAttr = {'deleteMarker': bool, 'versionId': BASESTRING}
+
+    def __init__(self, deleteMarker=None, versionId=None):
+        self.deleteMarker = deleteMarker
+        self.versionId = versionId
+
+
+class DeleteObjectsRequest(BaseModel):
+    allowedAttr = {'quiet': bool, 'objects': list, "encoding_type": BASESTRING}
+
+    def __init__(self, quiet=None, objects=None, encoding_type=None):
+        self.quiet = quiet
+        self.objects = objects
+        self.encoding_type = encoding_type
+
+    def add_object(self, object):
+        if self.objects is None:
+            self.objects = []
+        if isinstance(object, Object):
+            self.objects.append(object)
+
+
+class DeleteObjectsResponse(BaseModel):
+    allowedAttr = {'deleted': list, 'error': list, "encoding_type": BASESTRING}
+
+    def __init__(self, deleted=None, error=None, encoding_type=None):
+        self.deleted = deleted
+        self.error = error
+        self.encoding_type = encoding_type
+
+
+class ErrorResult(BaseModel):
+    allowedAttr = {'key': BASESTRING, 'versionId': BASESTRING, 'code': BASESTRING, 'message': BASESTRING}
+
+    def __init__(self, key=None, versionId=None, code=None, message=None):
+        self.key = key
+        self.versionId = versionId
+        self.code = code
+        self.message = message
+
+
+class DeleteObjectResult(BaseModel):
+    allowedAttr = {'key': BASESTRING, 'versionId': BASESTRING, 'deleteMarker': bool,
+                   'deleteMarkerVersionId': BASESTRING}
+
+    def __init__(self, key=None, versionId=None, deleteMarker=None, deleteMarkerVersionId=None):
+        self.key = key
+        self.versionId = versionId
+        self.deleteMarker = deleteMarker
+        self.deleteMarkerVersionId = deleteMarkerVersionId
+
+
+class ListMultipartUploadsRequest(BaseModel):
+    allowedAttr = {'delimiter': BASESTRING, 'prefix': BASESTRING, 'max_uploads': [int, BASESTRING],
+                   'key_marker': BASESTRING, 'upload_id_marker': BASESTRING}
+
+    def __init__(self, delimiter=None, prefix=None, max_uploads=None, key_marker=None, upload_id_marker=None):
+        self.delimiter = delimiter
+        self.prefix = prefix
+        self.max_uploads = max_uploads
+        self.key_marker = key_marker
+        self.upload_id_marker = upload_id_marker
+
+
+class ListPartsResponse(BaseModel):
+    allowedAttr = {'bucketName': BASESTRING, 'objectKey': BASESTRING, 'uploadId': BASESTRING, 'initiator': Initiator,
+                   'owner': Owner, 'storageClass': BASESTRING, 'partNumberMarker': int, 'nextPartNumberMarker': int,
+                   'maxParts': int, "encoding_type": BASESTRING,
+                   'isTruncated': bool, 'parts': list}
+
+    def __init__(self, bucketName=None, objectKey=None, uploadId=None, initiator=None, owner=None,
+                 storageClass=None, partNumberMarker=None, nextPartNumberMarker=None, maxParts=None, isTruncated=None,
+                 parts=None, encoding_type=None):
+        self.bucketName = bucketName
+        self.objectKey = objectKey
+        self.uploadId = uploadId
+        self.initiator = initiator
+        self.owner = owner
+        self.storageClass = storageClass
+        self.partNumberMarker = partNumberMarker
+        self.nextPartNumberMarker = nextPartNumberMarker
+        self.maxParts = maxParts
+        self.isTruncated = isTruncated
+        self.parts = parts
+        self.encoding_type = encoding_type
+
+
+class GetBucketMetadataResponse(BaseModel):
+    allowedAttr = {'storageClass': BASESTRING, 'accessContorlAllowOrigin': BASESTRING, 
+                   'accessContorlAllowHeaders': BASESTRING,
+                   'accessContorlAllowMethods': BASESTRING,
+                   'accessContorlExposeHeaders': BASESTRING,
+                   'accessContorlMaxAge': int, 'location': BASESTRING, 'obsVersion': BASESTRING,
+                   'availableZone': BASESTRING, 'epid': BASESTRING, 'redundancy': BASESTRING}
+
+    def __init__(self, storageClass=None, accessContorlAllowOrigin=None, accessContorlAllowHeaders=None,
+                 accessContorlAllowMethods=None, accessContorlExposeHeaders=None, accessContorlMaxAge=None,
+                 location=None, obsVersion=None, availableZone=None, epid=None, redundancy=None):
+        self.storageClass = storageClass
+        self.accessContorlAllowOrigin = accessContorlAllowOrigin
+        self.accessContorlAllowHeaders = accessContorlAllowHeaders
+        self.accessContorlAllowMethods = accessContorlAllowMethods
+        self.accessContorlExposeHeaders = accessContorlExposeHeaders
+        self.accessContorlMaxAge = accessContorlMaxAge
+        self.location = location
+        self.obsVersion = obsVersion
+        self.availableZone = availableZone
+        self.epid = epid
+        self.redundancy = redundancy
+
+
+class GetBucketQuotaResponse(BaseModel):
+    allowedAttr = {'quota': LONG}
+
+    def __init__(self, quota=None):
+        self.quota = quota
+
+
+class GetBucketStorageInfoResponse(BaseModel):
+    allowedAttr = {'size': LONG, 'objectNumber': int, 'standardSize': LONG, 'standardObjectNumber': int, 'warmSize': LONG,
+                   'warmObjectNumber': int, 'coldSize': LONG, 'coldObjectNumber': int, 'deepArchiveSize': LONG, 'deepArchiveObjectNumber': int,
+                   'highPerformanceSize': LONG, 'highPerformanceObjectNumber': int, 'standard_IASize': LONG, 'standard_IAObjectNumber': int, 'glacierObjectNumber': LONG}
+
+    def __init__(self, size=None, objectNumber=None, standardSize=None, standardObjectNumber=None, warmSize=None,
+                 warmObjectNumber=None, coldSize=None, coldObjectNumber=None, deepArchiveSize=None, deepArchiveObjectNumber=None,
+                 highPerformanceSize=None, highPerformanceObjectNumber=None, standard_IASize=None, standard_IAObjectNumber=None, glacierSize=None, glacierObjectNumber=None):
+        self.size = size
+        self.objectNumber = objectNumber
+        self.standardSize = standardSize
+        self.standardObjectNumber = standardObjectNumber
+        self.warmSize = warmSize
+        self.warmObjectNumber = warmObjectNumber
+        self.coldSize = coldSize
+        self.coldObjectNumber = coldObjectNumber
+        self.deepArchiveSize = deepArchiveSize
+        self.deepArchiveObjectNumber = deepArchiveObjectNumber
+        self.highPerformanceSize = highPerformanceSize
+        self.highPerformanceObjectNumber = highPerformanceObjectNumber
+        self.standard_IASize = standard_IASize
+        self.standard_IAObjectNumber = standard_IAObjectNumber
+        self.glacierSize = glacierSize
+        self.glacierObjectNumber = glacierObjectNumber
+
+class GetBucketEncryptionResponse(BaseModel):
+    allowedAttr = {'encryption': BASESTRING, 'key': BASESTRING}
+
+    def __init__(self, encryption=None, key=None):
+        self.encryption = encryption
+        self.key = key
+
+
+class GetBucketStoragePolicyResponse(BaseModel):
+    allowedAttr = {'storageClass': BASESTRING}
+
+    def __init__(self, storageClass=None):
+        self.storageClass = storageClass
+
+
+class GetObjectMetadataResponse(BaseModel):
+    allowedAttr = {'storageClass': BASESTRING, 'accessContorlAllowOrigin': BASESTRING,
+                   'accessContorlAllowHeaders': BASESTRING, 'accessContorlAllowMethods': BASESTRING,
+                   'accessContorlExposeHeaders': BASESTRING, 'accessContorlMaxAge': int,
+                   'contentLength': LONG, 'contentType': BASESTRING, 'websiteRedirectLocation': BASESTRING,
+                   'lastModified': BASESTRING, 'etag': BASESTRING, 'versionId': BASESTRING,
+                   'restore': BASESTRING, 'expiration': BASESTRING, 'sseKms': BASESTRING,
+                   'sseKmsKey': BASESTRING, 'sseC': BASESTRING, 'sseCKeyMd5': BASESTRING, 'isAppendable': bool,
+                   'nextPosition': LONG}
+
+    def __init__(self, storageClass=None, accessContorlAllowOrigin=None, accessContorlAllowHeaders=None,
+                 accessContorlAllowMethods=None, accessContorlExposeHeaders=None, accessContorlMaxAge=None,
+                 contentLength=None,
+                 contentType=None, websiteRedirectLocation=None, lastModified=None, etag=None, versionId=None,
+                 restore=None, expiration=None, sseKms=None, sseKmsKey=None, sseC=None, sseCKeyMd5=None,
+                 isAppendable=None, nextPosition=None):
+        self.storageClass = storageClass
+        self.accessContorlAllowOrigin = accessContorlAllowOrigin
+        self.accessContorlAllowHeaders = accessContorlAllowHeaders
+        self.accessContorlAllowMethods = accessContorlAllowMethods
+        self.accessContorlExposeHeaders = accessContorlExposeHeaders
+        self.accessContorlMaxAge = accessContorlMaxAge
+        self.contentLength = contentLength
+        self.contentType = contentType
+
+        self.websiteRedirectLocation = websiteRedirectLocation
+        self.lastModified = lastModified
+        self.etag = etag
+        self.versionId = versionId
+        self.restore = restore
+        self.expiration = expiration
+        self.sseKms = sseKms
+        self.sseKmsKey = sseKmsKey
+        self.sseC = sseC
+        self.sseCKeyMd5 = sseCKeyMd5
+        self.isAppendable = isAppendable
+        self.nextPosition = nextPosition
+
+
+SetObjectMetadataResponse = GetObjectMetadataResponse
+
+
+class GetObjectRequest(BaseModel):
+    allowedAttr = {'content_type': BASESTRING, 'content_language': BASESTRING,
+                   'expires': BASESTRING, 'cache_control': BASESTRING, 'content_disposition': BASESTRING,
+                   'content_encoding': BASESTRING, 'versionId': BASESTRING, 'imageProcess': BASESTRING}
+
+    def __init__(self, content_type=None, content_language=None, expires=None, cache_control=None,
+                 content_disposition=None,
+                 content_encoding=None, versionId=None, imageProcess=None):
+        self.content_type = content_type
+        self.content_language = content_language
+        self.expires = expires
+        self.cache_control = cache_control
+        self.content_disposition = content_disposition
+        self.content_encoding = content_encoding
+        self.versionId = versionId
+        self.imageProcess = imageProcess
+
+
+class InitiateMultipartUploadResponse(BaseModel):
+    allowedAttr = {'bucketName': BASESTRING, 'objectKey': BASESTRING, 'uploadId': BASESTRING, 'sseKms': BASESTRING,
+                   'sseKmsKey': BASESTRING, 'sseC': BASESTRING, 'sseCKeyMd5': BASESTRING, "encoding_type": BASESTRING}
+
+    def __init__(self, bucketName=None, objectKey=None, uploadId=None, encoding_type=None):
+        self.bucketName = bucketName
+        self.objectKey = objectKey
+        self.uploadId = uploadId
+        self.encoding_type = encoding_type
+
+
+class LifecycleResponse(BaseModel):
+    allowedAttr = {'lifecycleConfig': Lifecycle}
+
+    def __init__(self, lifecycleConfig=None):
+        self.lifecycleConfig = lifecycleConfig
+
+
+class ListBucketsResponse(BaseModel):
+    allowedAttr = {'buckets': list, 'owner': Owner, 'maxKeys': int, 'marker': BASESTRING, 'isTruncated': bool, 'nextMarker': BASESTRING}
+
+    def __init__(self, buckets=None, owner=None, maxKeys=None, marker=None, isTruncated=None, nextMarker=None):
+        self.buckets = buckets
+        self.owner = owner
+        self.maxKeys = maxKeys
+        self.marker = marker
+        self.isTruncated = isTruncated
+        self.nextMarker = nextMarker
+
+class ListMultipartUploadsResponse(BaseModel):
+    allowedAttr = {'bucket': BASESTRING, 'keyMarker': BASESTRING, 'uploadIdMarker': BASESTRING,
+                   'nextKeyMarker': BASESTRING, 'nextUploadIdMarker': BASESTRING, 'maxUploads': int,
+                   'isTruncated': bool, 'prefix': BASESTRING, 'delimiter': BASESTRING, 'upload': list,
+                   'commonPrefixs': list, "encoding_type": BASESTRING}
+
+    def __init__(self, bucket=None, keyMarker=None, uploadIdMarker=None, nextKeyMarker=None, nextUploadIdMarker=None,
+                 maxUploads=None, isTruncated=None, prefix=None, delimiter=None, upload=None, commonPrefixs=None,
+                 encoding_type=None):
+        self.bucket = bucket
+        self.keyMarker = keyMarker
+        self.uploadIdMarker = uploadIdMarker
+        self.nextKeyMarker = nextKeyMarker
+        self.nextUploadIdMarker = nextUploadIdMarker
+        self.maxUploads = maxUploads
+        self.isTruncated = isTruncated
+        self.prefix = prefix
+
+        self.delimiter = delimiter
+        self.upload = upload
+        self.commonPrefixs = commonPrefixs
+        self.encoding_type = encoding_type
+
+
+class ListObjectsResponse(BaseModel):
+    allowedAttr = {'name': BASESTRING, 'location': BASESTRING, 'prefix': BASESTRING, 'marker': BASESTRING,
+                   'delimiter': BASESTRING, 'commonPrefixs': list, 'encoding_type': BASESTRING,
+                   'max_keys': int, 'is_truncated': bool, 'next_marker': BASESTRING, 'contents': list}
+
+    def __init__(self, name=None, location=None, prefix=None, marker=None, delimiter=None, max_keys=None,
+                 is_truncated=None, next_marker=None, contents=None, commonPrefixs=None, encoding_type=None):
+        self.name = name
+        self.location = location
+        self.prefix = prefix
+        self.marker = marker
+        self.delimiter = delimiter
+        self.max_keys = max_keys
+        self.is_truncated = is_truncated
+        self.next_marker = next_marker
+        self.contents = contents
+        self.commonPrefixs = commonPrefixs
+        self.encoding_type = encoding_type
+
+
+class LocationResponse(BaseModel):
+    allowedAttr = {'location': BASESTRING}
+
+    def __init__(self, location=None):
+        self.location = location
+
+
+class OptionsResponse(BaseModel):
+    allowedAttr = {'accessContorlAllowOrigin': BASESTRING, 'accessContorlAllowHeaders': BASESTRING,
+                   'accessContorlAllowMethods': BASESTRING,
+                   'accessContorlExposeHeaders': BASESTRING, 'accessContorlMaxAge': int}
+
+    def __init__(self, accessContorlAllowOrigin=None, accessContorlAllowHeaders=None, accessContorlAllowMethods=None,
+                 accessContorlExposeHeaders=None, accessContorlMaxAge=None):
+        self.accessContorlAllowOrigin = accessContorlAllowOrigin
+        self.accessContorlAllowHeaders = accessContorlAllowHeaders
+        self.accessContorlAllowMethods = accessContorlAllowMethods
+        self.accessContorlExposeHeaders = accessContorlExposeHeaders
+        self.accessContorlMaxAge = accessContorlMaxAge
+
+
+class PutContentResponse(BaseModel):
+    allowedAttr = {'storageClass': BASESTRING, 'etag': BASESTRING, 'versionId': BASESTRING,
+                   'sseKms': BASESTRING, 'sseKmsKey': BASESTRING, 'sseC': BASESTRING, 'sseCKeyMd5': BASESTRING,
+                   'objectUrl': BASESTRING}
+
+    def __init__(self, storageClass=None, etag=None, versionId=None, sseKms=None, sseKmsKey=None,
+                 sseC=None, sseCKeyMd5=None, objectUrl=None):
+        self.storageClass = storageClass
+        self.etag = etag
+        self.versionId = versionId
+        self.sseKms = sseKms
+        self.sseKmsKey = sseKmsKey
+        self.sseC = sseC
+        self.sseCKeyMd5 = sseCKeyMd5
+        self.objectUrl = objectUrl
+
+
+class AppendObjectResponse(BaseModel):
+    allowedAttr = {'storageClass': BASESTRING, 'etag': BASESTRING, 'nextPosition': LONG,
+                   'sseKms': BASESTRING, 'sseKmsKey': BASESTRING, 'sseC': BASESTRING, 'sseCKeyMd5': BASESTRING,
+                   'objectUrl': BASESTRING}
+
+    def __init__(self, storageClass=None, etag=None, nextPosition=None, sseKms=None, sseKmsKey=None,
+                 sseC=None, sseCKeyMd5=None, objectUrl=None):
+        self.storageClass = storageClass
+        self.etag = etag
+        self.nextPosition = nextPosition
+        self.sseKms = sseKms
+        self.sseKmsKey = sseKmsKey
+        self.sseC = sseC
+        self.sseCKeyMd5 = sseCKeyMd5
+        self.objectUrl = objectUrl
+
+
+class UploadPartResponse(BaseModel):
+    allowedAttr = {'etag': BASESTRING, 'sseKms': BASESTRING, 'sseKmsKey': BASESTRING, 'sseC': BASESTRING,
+                   'sseCKeyMd5': BASESTRING}
+
+    def __init__(self, etag=None, sseKms=None, sseKmsKey=None, sseC=None, sseCKeyMd5=None):
+        self.etag = etag
+        self.sseKms = sseKms
+        self.sseKmsKey = sseKmsKey
+        self.sseC = sseC
+        self.sseCKeyMd5 = sseCKeyMd5
+
+
+class GetBucketRequestPaymentResponse(BaseModel):
+    allowedAttr = {'payer': BASESTRING}
+
+    def __init__(self, payer=None):
+        self.payer = payer
+
+
+class Payer(object):
+    BUCKET_OWNER_PAYER = "BucketOwner"
+    REQUESTER_PAYER = "Requester"
+    REQUESTER = "requester"
+
+
+class ResponseWrapper(object):
+    def __init__(self, conn, result, connHolder, contentLength=None, notifier=None):
+        self.conn = conn
+        self.result = result
+        self.connHolder = connHolder
+        self.contentLength = contentLength
+        self.read_count = 0
+        self.notifier = notifier
+        if self.notifier is None:
+            self.notifier = progress.NONE_NOTIFIER
+
+    def __getattr__(self, name):
+        if name == 'read' and self.result:
+            def _read(*args, **kwargs):
+                chunk = self.result.read(*args, **kwargs)
+                if not chunk:
+                    if self.contentLength is not None and self.contentLength != self.read_count:
+                        raise Exception(
+                            'premature end of Content-Length delimiter message body (expected:' + util.to_string(
+                                self.contentLength) + '; received:' + util.to_string(self.read_count) + ')')
+                else:
+                    newReadCount = len(chunk)
+                    if newReadCount > 0:
+                        self.notifier.send(newReadCount)
+                    self.read_count += newReadCount
+                return chunk
+
+            return _read
+
+        return getattr(self.result, name) if self.result else None
+
+    def close(self):
+        self.notifier.end()
+        if self.conn:
+            util.do_close(self.result, self.conn, self.connHolder)
+
+
+class ObjectStream(BaseModel):
+    allowedAttr = {'response': ResponseWrapper, 'buffer': object, 'size': LONG, 'url': BASESTRING, 'deleteMarker': bool,
+                   'storageClass': BASESTRING, 'accessContorlAllowOrigin': BASESTRING,
+                   'accessContorlAllowHeaders': BASESTRING, 'accessContorlAllowMethods': BASESTRING,
+                   'accessContorlExposeHeaders': BASESTRING, 'accessContorlMaxAge': int,
+                   'contentLength': LONG, 'cacheControl': BASESTRING, 'contentDisposition': BASESTRING,
+                   'contentEncoding': BASESTRING, 'contentLanguage': BASESTRING,
+                   'contentType': BASESTRING, 'expires': BASESTRING, 'websiteRedirectLocation': BASESTRING,
+                   'lastModified': BASESTRING, 'etag': BASESTRING, 'versionId': BASESTRING,
+                   'restore': BASESTRING, 'expiration': BASESTRING, 'sseKms': BASESTRING,
+                   'sseKmsKey': BASESTRING, 'sseC': BASESTRING, 'sseCKeyMd5': BASESTRING}
+
+    def __init__(self, response=None, buffer=None, size=None, url=None, deleteMarker=None, storageClass=None,
+                 accessContorlAllowOrigin=None, accessContorlAllowHeaders=None, accessContorlAllowMethods=None,
+                 accessContorlExposeHeaders=None, accessContorlMaxAge=None, contentLength=None, cacheControl=None,
+                 contentDisposition=None, contentEncoding=None, contentLanguage=None, contentType=None, expires=None,
+                 websiteRedirectLocation=None, lastModified=None, etag=None, versionId=None, restore=None,
+                 expiration=None, sseKms=None, sseKmsKey=None, sseC=None, sseCKeyMd5=None):
+        self.response = response
+        self.buffer = buffer
+        self.size = size
+        self.url = url
+        self.deleteMarker = deleteMarker
+        self.storageClass = storageClass
+        self.accessContorlAllowOrigin = accessContorlAllowOrigin
+        self.accessContorlAllowHeaders = accessContorlAllowHeaders
+        self.accessContorlAllowMethods = accessContorlAllowMethods
+        self.accessContorlExposeHeaders = accessContorlExposeHeaders
+        self.accessContorlMaxAge = accessContorlMaxAge
+        self.contentLength = contentLength
+        self.cacheControl = cacheControl
+        self.contentDisposition = contentDisposition
+        self.contentEncoding = contentEncoding
+        self.contentLanguage = contentLanguage
+        self.contentType = contentType
+        self.expires = expires
+        self.websiteRedirectLocation = websiteRedirectLocation
+        self.lastModified = lastModified
+        self.etag = etag
+        self.versionId = versionId
+        self.restore = restore
+        self.expiration = expiration
+        self.sseKms = sseKms
+        self.sseKmsKey = sseKmsKey
+        self.sseC = sseC
+        self.sseCKeyMd5 = sseCKeyMd5
+
+
+class ExtensionHeader(BaseModel):
+    allowedAttr = {'requesterPayer': BASESTRING, 'locationClusterGroupId': BASESTRING}
+
+    def __init__(self, requesterPayer=None, locationClusterGroupId=None):
+        self.requesterPayer = requesterPayer
+        self.locationClusterGroupId = locationClusterGroupId
+
+
+# OEF Model
+class FetchStatus(object):
+    OPEN = "open"
+    CLOSED = "closed"
+
+
+class FetchPolicy(BaseModel):
+    allowedAttr = {'status': BASESTRING, 'agency': BASESTRING}
+
+    def __init__(self, status=None, agency=None):
+        self.status = status
+        self.agency = agency
+
+
+class _FetchJob(BaseModel):
+    allowedAttr = {'url': BASESTRING, 'host': BASESTRING, 'bucket': BASESTRING, 'key': BASESTRING, 'md5': BASESTRING,
+                   'callbackurl': BASESTRING, 'callbackbody': BASESTRING, 'callbackbodytype': BASESTRING,
+                   'callbackhost': BASESTRING, 'file_type': BASESTRING, 'ignore_same_key': bool, 'objectheaders': dict,
+                   'etag': BASESTRING, 'trustname': BASESTRING}
+
+    def __init__(self, url=None, host=None, bucket=None, key=None, md5=None, callBackUrl=None,
+                 callBackBody=None, callBackBodyType=None, callBackHost=None, fileType=None,
+                 ignoreSameKey=False, objectHeaders=None, etag=None, trustName=None):
+        self.url = url
+        self.host = host
+        self.bucket = bucket
+        self.key = key
+        self.md5 = md5
+        self.callbackurl = callBackUrl
+        self.callbackbody = callBackBody
+        self.callbackbodytype = callBackBodyType
+        self.callbackhost = callBackHost
+        self.file_type = fileType
+        self.ignore_same_key = ignoreSameKey
+        self.objectheaders = objectHeaders
+        self.etag = etag
+        self.trustname = trustName
+
+
+class SetBucketFetchJobResponse(BaseModel):
+    allowedAttr = {"id": BASESTRING, "wait": int}
+
+    def __init__(self, id=None, wait=None):
+        self.id = id
+        self.wait = wait
+
+
+class FetchJobResponse(BaseModel):
+    allowedAttr = {'url': BASESTRING, 'host': BASESTRING, 'bucket': BASESTRING, 'key': BASESTRING, 'md5': BASESTRING,
+                   'callBackUrl': BASESTRING, 'callBackBody': BASESTRING, 'callBackBodyType': BASESTRING,
+                   'callBackHost': BASESTRING, 'fileType': BASESTRING, 'ignoreSameKey': bool}
+
+    def __init__(self, url=None, host=None, bucket=None, key=None, md5=None, callBackUrl=None,
+                 callBackBody=None, callBackBodyType=None, callBackHost=None, fileType=None,
+                 ignoreSameKey=False):
+        self.url = url
+        self.host = host
+        self.bucket = bucket
+        self.key = key
+        self.md5 = md5
+        self.callBackUrl = callBackUrl
+        self.callBackBody = callBackBody
+        self.callBackBodyType = callBackBodyType
+        self.callBackHost = callBackHost
+        self.fileType = fileType
+        self.ignoreSameKey = ignoreSameKey
+
+
+class GetBucketFetchJobResponse(BaseModel):
+    allowedAttr = {"code": BASESTRING, "err": BASESTRING, "status": BASESTRING, "job": FetchJobResponse}
+
+    def __init__(self, code=None, status=None, job=None, err=None):
+        self.code = code
+        self.status = status
+        self.job = job
+        self.err = err
+
+
+# begin workflow related
+# begin workflow related
+# begin workflow related
+
+class CreateWorkflowTemplateResponse(BaseModel):
+    allowedAttr = {'templateName': BASESTRING}
+
+    def __init__(self, templateName=None):
+        self.templateName = templateName
+
+
+class GetWorkflowTemplateResponse(BaseModel):
+    allowedAttr = {'templateName': BASESTRING, 'description': BASESTRING, 'states': list, 'inputs': list,
+                   'tags': list, 'createTime': BASESTRING, 'lastModifyTime': BASESTRING}
+
+    def __init__(self, templateName=None, description=None, states=None, inputs=None, tags=None, createTime=None,
+                 lastModifyTime=None):
+        self.templateName = templateName
+        self.description = description
+        self.states = states
+        self.inputs = inputs
+        self.tags = tags
+        self.createTime = createTime
+        self.lastModifyTime = lastModifyTime
+
+
+class ListWorkflowTemplateResponse(BaseModel):
+    allowedAttr = {'count': int, 'templates': list, 'nextStart': int, 'isTruncated': bool}
+
+    def __init__(self, count=None, templates=None, nextStart=None, isTruncated=None):
+        self.count = count
+        self.templates = templates
+        self.nextStart = nextStart
+        self.isTruncated = isTruncated
+
+
+class CreateWorkflowResponse(BaseModel):
+    allowedAttr = {'graphName': BASESTRING, 'graphUrn': BASESTRING, 'createdAt': BASESTRING}
+
+    def __init__(self, graphName=None, graphUrn=None, createdAt=None):
+        self.graphName = graphName
+        self.graphUrn = graphUrn
+        self.createdAt = createdAt
+
+
+class GetWorkflowResponse(BaseModel):
+    allowedAttr = {'name': BASESTRING, 'graphUrn': BASESTRING, 'createdAt': BASESTRING, 'definition': object,
+                   'description': BASESTRING}
+
+    def __init__(self, name=None, graphUrn=None, createdAt=None, definition=None, description=None):
+        self.name = name
+        self.graphUrn = graphUrn
+        self.createdAt = createdAt
+        self.definition = definition
+        self.description = description
+
+
+class UpdateWorkflowResponse(BaseModel):
+    allowedAttr = {'graphName': BASESTRING, 'graphUrn': BASESTRING, 'lastModified': BASESTRING}
+
+    def __init__(self, graphName=None, graphUrn=None, lastModified=None):
+        self.graphName = graphName
+        self.graphUrn = graphUrn
+        self.lastModified = lastModified
+
+
+class ListWorkflowResponse(BaseModel):
+    allowedAttr = {'count': int, 'graphs': list, 'nextStart': int, 'isTruncated': bool}
+
+    def __init__(self, count=None, graphs=None, nextStart=None, isTruncated=None):
+        self.count = count
+        self.graphs = graphs
+        self.nextStart = nextStart
+        self.isTruncated = isTruncated
+
+
+class AsyncAPIStartWorkflowResponse(BaseModel):
+    allowedAttr = {'executionUrn': BASESTRING, 'startedAt': BASESTRING, 'executionName': BASESTRING}
+
+    def __init__(self, executionUrn=None, startedAt=None, executionName=None):
+        self.executionUrn = executionUrn
+        self.startedAt = startedAt
+        self.executionName = executionName
+
+
+class ListWorkflowExecutionResponse(BaseModel):
+    allowedAttr = {'count': int, 'nextMarker': BASESTRING, 'isTruncated': bool, 'executions': list}
+
+    def __init__(self, count=None, nextMarker=None, isTruncated=None, executions=None):
+        self.count = count
+        self.nextMarker = nextMarker
+        self.isTruncated = isTruncated
+        self.executions = executions
+
+
+class GetWorkflowExecutionResponse(BaseModel):
+    allowedAttr = {'executionInfo': object}
+
+    def __init__(self, executionInfo=None):
+        self.executionInfo = executionInfo
+
+
+class RestoreFailedWorkflowExecutionResponse(BaseModel):
+    allowedAttr = {'executionUrn': BASESTRING, 'restoredAt': BASESTRING, 'executionName': BASESTRING}
+
+    def __init__(self, executionUrn=None, restoredAt=None, executionName=None):
+        self.executionUrn = executionUrn
+        self.restoredAt = restoredAt
+        self.executionName = executionName
+
+
+class GetTriggerPolicyResponse(BaseModel):
+    allowedAttr = {'rules': list}
+
+    def __init__(self, rules=None):
+        self.rules = rules
+
+
+# end workflow related
+# end workflow related
+# end workflow related
+
+# begin virtual bucket related
+# begin virtual bucket related
+# begin virtual bucket related
+
+class BucketAliasModel(BaseModel):
+    allowedAttr = {'alias': BASESTRING, 'bucket1': BASESTRING, 'bucket2': BASESTRING, 'creationDate': BASESTRING}
+
+    def __init__(self, alias=None, bucket1=None, bucket2=None, creationDate=None):
+        self.alias = alias
+        self.bucket1 = bucket1
+        self.bucket2 = bucket2
+        self.creationDate = creationDate
+
+
+class ListBucketAliasModel(BaseModel):
+    allowedAttr = {'owner': BASESTRING, 'bucketAlias': list}
+
+    def __init__(self, owner=None, bucketAlias=None):
+        self.owner = owner
+        self.bucketAlias = bucketAlias
+
+# end virtual bucket related
+# end virtual bucket related
+# end virtual bucket related
```

### Comparing `esdk-obs-python-3.23.9.1/obs/obs_cipher_suite.py` & `esdk-obs-python-3.24.3/obs/obs_cipher_suite.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,345 +1,358 @@
-# coding:utf-8
-import binascii
-import hashlib
-import os
-import secrets
-
-from Crypto.Cipher import AES, PKCS1_OAEP
-from Crypto.PublicKey import RSA
-from Crypto.Util import Counter
-from Crypto.Util.number import bytes_to_long
-
-from obs import const, util
-
-
-class CipherGenerator(object):
-    def __init__(self, need_sha256=False):
-        self.need_sha256 = need_sha256
-        self.crypto_mod = "CipherGenerator"
-        self.master_key_sha256 = ""
-
-    def new(self, readable):
-        pass
-
-    @staticmethod
-    def gen_random_key(key_length):
-        return secrets.token_bytes(key_length)
-
-    def get_crypto_info_from_headers(self, header_dict):
-        key_list = [i for i in header_dict.keys()]
-        for key in key_list:
-            if key.startswith("x-obs-meta"):
-                header_dict[key.replace("x-obs-meta-", "")] = header_dict.pop(key)
-        key_list = [i for i in header_dict.keys()]
-        for key in key_list:
-            if key.startswith("x-amz-meta"):
-                header_dict[key.replace("x-amz-meta-", "")] = header_dict.pop(key)
-        if "encrypted-algorithm" not in header_dict:
-            raise Exception("Crypto mod is not in object's metadata")
-        header_dict["crypto_mod"] = header_dict.pop("encrypted-algorithm")
-        if header_dict["crypto_mod"] != self.crypto_mod:
-            raise Exception("Object's crypto mod is not equals cipher-generator's, "
-                            "please change a different cipher-generator")
-        return header_dict
-
-    def check_record(self, record, crypto_info):
-        return record["crypto_mod"] == crypto_info["crypto_mod"] \
-               and record["master_key_sha256"] == self.master_key_sha256
-
-
-class OBSCipher(object):
-    def __init__(self, readable, is_decrypt=False, need_sha256=False):
-        self._file = readable
-        self.sha256 = hashlib.sha256()
-        self.encrypted_sha256 = hashlib.sha256()
-        self.crypto_mod = "EncryptedObject"
-        self.is_decrypt = is_decrypt
-        self.read_count = 0
-        self.need_sha256 = need_sha256
-        if self.is_decrypt:
-            self.read = self.decrypt
-            self.original_response = self._file
-            self.status = self.original_response.status
-            self.reason = self.original_response.reason
-        else:
-            self.read = self.encrypt
-            self.original_response = None
-            self.status = None
-            self.reason = None
-
-    def decrypt(self, n=const.READ_ONCE_LENGTH):
-        pass
-
-    def encrypt(self, n=const.READ_ONCE_LENGTH):
-        pass
-
-    def gen_need_metadata_and_headers(self, metadata, headers=None):
-        if self.need_sha256:
-            metadata["plaintext-sha256"], metadata["encrypted-sha256"], metadata[
-                "plaintext-content-length"] = self.calculate_sha256()
-            if headers is not None:
-                headers.sha256 = metadata["encrypted-sha256"]
-        metadata["encrypted-algorithm"] = self.crypto_mod
-        return metadata
-
-    def calculate_sha256(self, read_length=None):
-        return self.sha256.hexdigest(), self.encrypted_sha256.hexdigest(), self.read_count
-
-    def get_content_length(self):
-        current_pointer = self._file.tell()
-        self._file.seek(0, 2)
-        total_length = self._file.tell()
-        self._file.seek(current_pointer)
-        return total_length
-
-    def getheader(self, key, default_value=None):
-        if not self.is_decrypt:
-            return None
-        return self.original_response.getheader(key, default_value)
-
-    def getheaders(self):
-        if not self.is_decrypt:
-            return None
-        return self.original_response.getheaders()
-
-    def gen_need_record(self, record):
-        record["crypto_mod"] = self.crypto_mod
-        return record
-
-    def crypto_info(self):
-        return self.safe_crypto_info()
-
-    def safe_crypto_info(self):
-        return {"crypto_mod": self.crypto_mod}
-
-    def close(self):
-        if hasattr(self._file, 'close') and callable(self._file.close):
-            self._file.close()
-
-    def __str__(self):
-        return "EncryptedObject"
-
-
-class CTRCipherGenerator(CipherGenerator):
-    def __init__(self, crypto_key, master_key_info=None, crypto_iv=None, *args, **kwargs):
-        super(CTRCipherGenerator, self).__init__(*args, **kwargs)
-        self.crypto_key = util.covert_string_to_bytes(crypto_key)
-        self.crypto_iv = util.covert_string_to_bytes(crypto_iv)
-        self.crypto_mod = "AES256-Ctr/iv_base64/NoPadding"
-        self.master_key_sha256 = hashlib.sha256(self.crypto_key).hexdigest()
-        self.master_key_info = "" if master_key_info is None else master_key_info
-
-    def new(self, readable, is_decrypt=False, crypto_info=None):
-        if crypto_info is not None:
-            iv = binascii.a2b_base64(crypto_info["crypto_iv"])
-            return OBSCtrCipher(readable, self.crypto_key, self.master_key_info, self.master_key_sha256,
-                                iv, is_decrypt, self.need_sha256)
-        if self.crypto_iv is None:
-            return OBSCtrCipher(readable, self.crypto_key, self.master_key_info, self.master_key_sha256,
-                                self.gen_random_key(16), is_decrypt, self.need_sha256)
-        return OBSCtrCipher(readable, self.crypto_key, self.master_key_info, self.master_key_sha256,
-                            self.crypto_iv, is_decrypt, self.need_sha256)
-
-    def get_crypto_info_from_headers(self, header_dict):
-        header_dict = super(CTRCipherGenerator, self).get_crypto_info_from_headers(header_dict)
-        if "encrypted-start" not in header_dict:
-            raise Exception("Encryption info is not in metadata")
-        header_dict["crypto_iv"] = header_dict.pop("encrypted-start")
-        if self.crypto_iv is not None and header_dict["crypto_iv"] != self.crypto_iv:
-            raise Exception("Crypto_iv is different between local and server")
-        if "master-key-info" in header_dict:
-            header_dict["master_key_info"] = header_dict.pop("master-key-info")
-        return header_dict
-
-    def check_download_record(self, record, crypto_info):
-        return super(CTRCipherGenerator, self).check_record(record, crypto_info) \
-               and record["master_key_sha256"] == crypto_info["master_key_sha256"] \
-               and record["crypto_iv"] == crypto_info["crypto_iv"]
-
-    def check_upload_record(self, record, crypto_info):
-        is_iv_match = binascii.a2b_base64(record["crypto_iv"]) == self.crypto_iv if self.crypto_iv else True
-        return super(CTRCipherGenerator, self).check_record(record, crypto_info) \
-               and is_iv_match \
-               and record["master_key_info"] == crypto_info["master_key_info"] \
-               and record["master_key_sha256"] == crypto_info["master_key_sha256"]
-
-
-class OBSCtrCipher(OBSCipher):
-    def __init__(self, readable, crypto_key, master_key_info, master_key_sha256,
-                 crypto_iv=None, is_decrypt=False, need_sha256=False):
-        super(OBSCtrCipher, self).__init__(readable, is_decrypt, need_sha256)
-        self.master_key_sha256 = master_key_sha256
-        ctr = Counter.new(128, initial_value=bytes_to_long(crypto_iv))
-        self.crypto_iv = crypto_iv
-        self.crypto_mod = "AES256-Ctr/iv_base64/NoPadding"
-        if (const.IS_PYTHON2 and isinstance(crypto_key, unicode)) \
-                or (not const.IS_PYTHON2 and isinstance(crypto_key, str)):
-            crypto_key = crypto_key.encode("UTF-8")
-        self.crypto_key = crypto_key
-        self.master_key_info = master_key_info
-        self.aes = AES.new(crypto_key, mode=AES.MODE_CTR, counter=ctr)
-
-    def encrypt(self, n=const.READ_ONCE_LENGTH):
-        chunk = self._file.read(n)
-        if not isinstance(chunk, bytes):
-            # todo 这个说明是否合适
-            raise Exception("Only support bytes for encrypt, please open your stream with 'rb' mode")
-        encrypted_chunk = self.aes.encrypt(chunk)
-        return encrypted_chunk
-
-    def decrypt(self, n=const.READ_ONCE_LENGTH):
-        return self.aes.decrypt(self.original_response.read(n))
-
-    def gen_need_metadata_and_headers(self, metadata, headers=None):
-        metadata["encrypted-start"] = binascii.b2a_base64(self.crypto_iv).strip().decode("UTF-8")
-        metadata["master-key-info"] = self.master_key_info
-        return super(OBSCtrCipher, self).gen_need_metadata_and_headers(metadata, headers)
-
-    def calculate_sha256(self, total_read_length=None):
-        current_pointer = self._file.tell()
-        current_read_length = 0
-        while True:
-            if total_read_length is not None and total_read_length - current_read_length > const.READ_ONCE_LENGTH:
-                read_size = total_read_length - current_read_length
-            else:
-                read_size = const.READ_ONCE_LENGTH
-            chunk = self._file.read(read_size)
-            if not chunk or (total_read_length is not None and current_read_length == total_read_length):
-                self.seek(current_pointer)
-                return self.sha256.hexdigest(), self.encrypted_sha256.hexdigest(), self.read_count
-            if not isinstance(chunk, bytes):
-                # todo 这个说明是否合适
-                raise Exception("Only support bytes for encrypt, please open your stream with 'rb' mode")
-            self.sha256.update(chunk)
-            encrypted_chunk = self.aes.encrypt(chunk)
-            self.encrypted_sha256.update(encrypted_chunk)
-            self.read_count += len(chunk)
-            current_read_length += read_size
-
-    def seek(self, offset, whence=0):
-        if whence == 1:
-            current_pointer = self._file.tell()
-        elif whence == 2:
-            self._file.seek(0, 2)
-            current_pointer = self._file.tell()
-        else:
-            current_pointer = 0
-        self.seek_iv(offset + current_pointer)
-        self._file.seek(offset + current_pointer)
-
-    def seek_iv(self, offset):
-        now_iv = bytes_to_long(self.crypto_iv) + int(offset / 16)
-        new_ctr = Counter.new(128, initial_value=now_iv)
-        self.aes = AES.new(self.crypto_key, mode=AES.MODE_CTR, counter=new_ctr)
-        if self.is_decrypt:
-            self.aes.decrypt(b"1" * (offset % 16))
-        else:
-            self.aes.encrypt(b"1" * (offset % 16))
-
-    def gen_need_record(self, record):
-        record["crypto_iv"] = binascii.b2a_base64(self.crypto_iv).strip().decode("UTF-8")
-        record["master_key_info"] = self.master_key_info
-        record["master_key_sha256"] = self.master_key_sha256
-        return super(OBSCtrCipher, self).gen_need_record(record)
-
-    def safe_crypto_info(self):
-        crypto_info = super(OBSCtrCipher, self).safe_crypto_info()
-        crypto_info["crypto_iv"] = binascii.b2a_base64(self.crypto_iv).strip().decode("UTF-8")
-        crypto_info["master_key_info"] = self.master_key_info
-        crypto_info["master_key_sha256"] = self.master_key_sha256
-        return crypto_info
-
-    def __str__(self):
-        return "OBSCtrCipher Encrypted Object start at " + binascii.b2a_base64(self.crypto_iv).strip().decode("UTF-8")
-
-
-class CtrRSACipherGenerator(CipherGenerator):
-    def __init__(self, master_crypto_key_path, master_key_info=None, *args, **kwargs):
-        super(CtrRSACipherGenerator, self).__init__(*args, **kwargs)
-        with open(master_crypto_key_path, "rb") as f:
-            key = f.read()
-            self.master_key_sha256 = hashlib.sha256(key).hexdigest()
-            self.master_crypto_key = RSA.importKey(key)
-        self.rsa = PKCS1_OAEP.new(self.master_crypto_key)
-        self.crypto_mod = "AES256-Ctr/RSA-Object-Key/NoPadding"
-        self.master_key_info = "" if master_key_info is None else master_key_info
-
-    def new(self, readable, is_decrypt=False, crypto_info=None):
-        if crypto_info is not None:
-            iv = binascii.a2b_base64(crypto_info["crypto_iv"])
-            if "object_encryption_key" in crypto_info:
-                object_encryption_key = binascii.a2b_base64(crypto_info["object_encryption_key"])
-            else:
-                object_encryption_key = self.decrypt_object_encryption_key(crypto_info["encrypted_object_key"])
-                if object_encryption_key == 0:
-                    raise Exception("Wrong private key, could not decrypt object encryption key")
-            return OBSCtrRSACipher(readable, object_encryption_key, crypto_info["encrypted_object_key"],
-                                   self.master_key_info, self.master_key_sha256, iv, is_decrypt, self.need_sha256)
-        random_key = self.gen_random_key(32)
-        random_iv = self.gen_random_key(16)
-        return OBSCtrRSACipher(readable, random_key, self.encrypt_object_encryption_key(random_key),
-                               self.master_key_info,
-                               self.master_key_sha256, random_iv, is_decrypt, self.need_sha256)
-
-    def encrypt_object_encryption_key(self, key_str):
-        return binascii.b2a_base64(self.rsa.encrypt(key_str)).strip().decode("UTF-8")
-
-    def decrypt_object_encryption_key(self, key_str):
-        return self.rsa.decrypt(binascii.a2b_base64(key_str))
-
-    def get_crypto_info_from_headers(self, header_dict):
-        header_dict = super(CtrRSACipherGenerator, self).get_crypto_info_from_headers(header_dict)
-        if "encrypted-object-key" not in header_dict:
-            raise Exception("Encryption info is not in metadata")
-        header_dict["encrypted_object_key"] = header_dict.pop("encrypted-object-key")
-        header_dict["crypto_iv"] = header_dict.pop("encrypted-start")
-        if "master-key-info" in header_dict:
-            header_dict["master_key_info"] = header_dict.pop("master-key-info")
-        return header_dict
-
-    def check_download_record(self, record, crypto_info):
-        return super(CtrRSACipherGenerator, self).check_record(record, crypto_info) \
-               and record["master_key_sha256"] == crypto_info["master_key_sha256"] \
-               and record["crypto_iv"] == crypto_info["crypto_iv"] \
-               and record["encrypted_object_key"] == crypto_info["encrypted_object_key"]
-
-    def check_upload_record(self, record, crypto_info):
-        return super(CtrRSACipherGenerator, self).check_record(record, crypto_info) \
-               and record["master_key_info"] == crypto_info["master_key_info"] \
-               and record["master_key_sha256"] == crypto_info["master_key_sha256"]
-
-
-class OBSCtrRSACipher(OBSCtrCipher):
-    def __init__(self, readable, crypto_key, encrypted_object_key, master_key_info, master_key_sha256,
-                 crypto_iv=None, is_decrypt=False, need_sha256=False):
-        super(OBSCtrRSACipher, self).__init__(readable, crypto_key, master_key_info, master_key_sha256, crypto_iv,
-                                              is_decrypt, need_sha256)
-        self.encrypted_object_key = encrypted_object_key
-        self.crypto_mod = "AES256-Ctr/RSA-Object-Key/NoPadding"
-        self.master_key_info = master_key_info
-
-    def gen_need_metadata_and_headers(self, metadata, headers=None):
-        metadata["encrypted-object-key"] = self.encrypted_object_key
-        return super(OBSCtrRSACipher, self).gen_need_metadata_and_headers(metadata, headers)
-
-    def gen_need_record(self, record):
-        record["encrypted_object_key"] = self.encrypted_object_key
-        record["master_key_sha256"] = self.master_key_sha256
-        record["object_encryption_key"] = binascii.b2a_base64(self.crypto_key).strip().decode("UTF-8")
-        return super(OBSCtrRSACipher, self).gen_need_record(record)
-
-    def crypto_info(self):
-        crypto_info = self.safe_crypto_info()
-        crypto_info["object_encryption_key"] = binascii.b2a_base64(self.crypto_key).strip().decode("UTF-8")
-        return crypto_info
-
-    def safe_crypto_info(self):
-        crypto_info = super(OBSCtrRSACipher, self).safe_crypto_info()
-        crypto_info["encrypted_object_key"] = self.encrypted_object_key
-        crypto_info["master_key_info"] = self.master_key_info
-        crypto_info["master_key_sha256"] = self.master_key_sha256
-        return crypto_info
-
-    def __str__(self):
-        return "OBSCtrRSACipher Encrypted Object start at " \
-               + binascii.b2a_base64(self.crypto_iv).strip().decode("UTF-8")
+#!/usr/bin/python
+# -*- coding:utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+import binascii
+import hashlib
+import os
+import secrets
+
+from Crypto.Cipher import AES, PKCS1_OAEP
+from Crypto.PublicKey import RSA
+from Crypto.Util import Counter
+from Crypto.Util.number import bytes_to_long
+
+from obs import const, util
+
+
+class CipherGenerator(object):
+    def __init__(self, need_sha256=False):
+        self.need_sha256 = need_sha256
+        self.crypto_mod = "CipherGenerator"
+        self.master_key_sha256 = ""
+
+    def new(self, readable):
+        pass
+
+    @staticmethod
+    def gen_random_key(key_length):
+        return secrets.token_bytes(key_length)
+
+    def get_crypto_info_from_headers(self, header_dict):
+        key_list = [i for i in header_dict.keys()]
+        for key in key_list:
+            if key.startswith("x-obs-meta"):
+                header_dict[key.replace("x-obs-meta-", "")] = header_dict.pop(key)
+        key_list = [i for i in header_dict.keys()]
+        for key in key_list:
+            if key.startswith("x-amz-meta"):
+                header_dict[key.replace("x-amz-meta-", "")] = header_dict.pop(key)
+        if "encrypted-algorithm" not in header_dict:
+            raise Exception("Crypto mod is not in object's metadata")
+        header_dict["crypto_mod"] = header_dict.pop("encrypted-algorithm")
+        if header_dict["crypto_mod"] != self.crypto_mod:
+            raise Exception("Object's crypto mod is not equals cipher-generator's, "
+                            "please change a different cipher-generator")
+        return header_dict
+
+    def check_record(self, record, crypto_info):
+        return record["crypto_mod"] == crypto_info["crypto_mod"] \
+               and record["master_key_sha256"] == self.master_key_sha256
+
+
+class OBSCipher(object):
+    def __init__(self, readable, is_decrypt=False, need_sha256=False):
+        self._file = readable
+        self.sha256 = hashlib.sha256()
+        self.encrypted_sha256 = hashlib.sha256()
+        self.crypto_mod = "EncryptedObject"
+        self.is_decrypt = is_decrypt
+        self.read_count = 0
+        self.need_sha256 = need_sha256
+        if self.is_decrypt:
+            self.read = self.decrypt
+            self.original_response = self._file
+            self.status = self.original_response.status
+            self.reason = self.original_response.reason
+        else:
+            self.read = self.encrypt
+            self.original_response = None
+            self.status = None
+            self.reason = None
+
+    def decrypt(self, n=const.READ_ONCE_LENGTH):
+        pass
+
+    def encrypt(self, n=const.READ_ONCE_LENGTH):
+        pass
+
+    def gen_need_metadata_and_headers(self, metadata, headers=None):
+        if self.need_sha256:
+            metadata["plaintext-sha256"], metadata["encrypted-sha256"], metadata[
+                "plaintext-content-length"] = self.calculate_sha256()
+            if headers is not None:
+                headers.sha256 = metadata["encrypted-sha256"]
+        metadata["encrypted-algorithm"] = self.crypto_mod
+        return metadata
+
+    def calculate_sha256(self, read_length=None):
+        return self.sha256.hexdigest(), self.encrypted_sha256.hexdigest(), self.read_count
+
+    def get_content_length(self):
+        current_pointer = self._file.tell()
+        self._file.seek(0, 2)
+        total_length = self._file.tell()
+        self._file.seek(current_pointer)
+        return total_length
+
+    def getheader(self, key, default_value=None):
+        if not self.is_decrypt:
+            return None
+        return self.original_response.getheader(key, default_value)
+
+    def getheaders(self):
+        if not self.is_decrypt:
+            return None
+        return self.original_response.getheaders()
+
+    def gen_need_record(self, record):
+        record["crypto_mod"] = self.crypto_mod
+        return record
+
+    def crypto_info(self):
+        return self.safe_crypto_info()
+
+    def safe_crypto_info(self):
+        return {"crypto_mod": self.crypto_mod}
+
+    def close(self):
+        if hasattr(self._file, 'close') and callable(self._file.close):
+            self._file.close()
+
+    def __str__(self):
+        return "EncryptedObject"
+
+
+class CTRCipherGenerator(CipherGenerator):
+    def __init__(self, crypto_key, master_key_info=None, crypto_iv=None, *args, **kwargs):
+        super(CTRCipherGenerator, self).__init__(*args, **kwargs)
+        self.crypto_key = util.covert_string_to_bytes(crypto_key)
+        self.crypto_iv = util.covert_string_to_bytes(crypto_iv)
+        self.crypto_mod = "AES256-Ctr/iv_base64/NoPadding"
+        self.master_key_sha256 = hashlib.sha256(self.crypto_key).hexdigest()
+        self.master_key_info = "" if master_key_info is None else master_key_info
+
+    def new(self, readable, is_decrypt=False, crypto_info=None):
+        if crypto_info is not None:
+            iv = binascii.a2b_base64(crypto_info["crypto_iv"])
+            return OBSCtrCipher(readable, self.crypto_key, self.master_key_info, self.master_key_sha256,
+                                iv, is_decrypt, self.need_sha256)
+        if self.crypto_iv is None:
+            return OBSCtrCipher(readable, self.crypto_key, self.master_key_info, self.master_key_sha256,
+                                self.gen_random_key(16), is_decrypt, self.need_sha256)
+        return OBSCtrCipher(readable, self.crypto_key, self.master_key_info, self.master_key_sha256,
+                            self.crypto_iv, is_decrypt, self.need_sha256)
+
+    def get_crypto_info_from_headers(self, header_dict):
+        header_dict = super(CTRCipherGenerator, self).get_crypto_info_from_headers(header_dict)
+        if "encrypted-start" not in header_dict:
+            raise Exception("Encryption info is not in metadata")
+        header_dict["crypto_iv"] = header_dict.pop("encrypted-start")
+        if self.crypto_iv is not None and header_dict["crypto_iv"] != self.crypto_iv:
+            raise Exception("Crypto_iv is different between local and server")
+        if "master-key-info" in header_dict:
+            header_dict["master_key_info"] = header_dict.pop("master-key-info")
+        return header_dict
+
+    def check_download_record(self, record, crypto_info):
+        return super(CTRCipherGenerator, self).check_record(record, crypto_info) \
+               and record["master_key_sha256"] == crypto_info["master_key_sha256"] \
+               and record["crypto_iv"] == crypto_info["crypto_iv"]
+
+    def check_upload_record(self, record, crypto_info):
+        is_iv_match = binascii.a2b_base64(record["crypto_iv"]) == self.crypto_iv if self.crypto_iv else True
+        return super(CTRCipherGenerator, self).check_record(record, crypto_info) \
+               and is_iv_match \
+               and record["master_key_info"] == crypto_info["master_key_info"] \
+               and record["master_key_sha256"] == crypto_info["master_key_sha256"]
+
+
+class OBSCtrCipher(OBSCipher):
+    def __init__(self, readable, crypto_key, master_key_info, master_key_sha256,
+                 crypto_iv=None, is_decrypt=False, need_sha256=False):
+        super(OBSCtrCipher, self).__init__(readable, is_decrypt, need_sha256)
+        self.master_key_sha256 = master_key_sha256
+        ctr = Counter.new(128, initial_value=bytes_to_long(crypto_iv))
+        self.crypto_iv = crypto_iv
+        self.crypto_mod = "AES256-Ctr/iv_base64/NoPadding"
+        if (const.IS_PYTHON2 and isinstance(crypto_key, unicode)) \
+                or (not const.IS_PYTHON2 and isinstance(crypto_key, str)):
+            crypto_key = crypto_key.encode("UTF-8")
+        self.crypto_key = crypto_key
+        self.master_key_info = master_key_info
+        self.aes = AES.new(crypto_key, mode=AES.MODE_CTR, counter=ctr)
+
+    def encrypt(self, n=const.READ_ONCE_LENGTH):
+        chunk = self._file.read(n)
+        if not isinstance(chunk, bytes):
+            # todo 这个说明是否合适
+            raise Exception("Only support bytes for encrypt, please open your stream with 'rb' mode")
+        encrypted_chunk = self.aes.encrypt(chunk)
+        return encrypted_chunk
+
+    def decrypt(self, n=const.READ_ONCE_LENGTH):
+        return self.aes.decrypt(self.original_response.read(n))
+
+    def gen_need_metadata_and_headers(self, metadata, headers=None):
+        metadata["encrypted-start"] = binascii.b2a_base64(self.crypto_iv).strip().decode("UTF-8")
+        metadata["master-key-info"] = self.master_key_info
+        return super(OBSCtrCipher, self).gen_need_metadata_and_headers(metadata, headers)
+
+    def calculate_sha256(self, total_read_length=None):
+        current_pointer = self._file.tell()
+        current_read_length = 0
+        while True:
+            if total_read_length is not None and total_read_length - current_read_length > const.READ_ONCE_LENGTH:
+                read_size = total_read_length - current_read_length
+            else:
+                read_size = const.READ_ONCE_LENGTH
+            chunk = self._file.read(read_size)
+            if not chunk or (total_read_length is not None and current_read_length == total_read_length):
+                self.seek(current_pointer)
+                return self.sha256.hexdigest(), self.encrypted_sha256.hexdigest(), self.read_count
+            if not isinstance(chunk, bytes):
+                # todo 这个说明是否合适
+                raise Exception("Only support bytes for encrypt, please open your stream with 'rb' mode")
+            self.sha256.update(chunk)
+            encrypted_chunk = self.aes.encrypt(chunk)
+            self.encrypted_sha256.update(encrypted_chunk)
+            self.read_count += len(chunk)
+            current_read_length += read_size
+
+    def seek(self, offset, whence=0):
+        if whence == 1:
+            current_pointer = self._file.tell()
+        elif whence == 2:
+            self._file.seek(0, 2)
+            current_pointer = self._file.tell()
+        else:
+            current_pointer = 0
+        self.seek_iv(offset + current_pointer)
+        self._file.seek(offset + current_pointer)
+
+    def seek_iv(self, offset):
+        now_iv = bytes_to_long(self.crypto_iv) + int(offset / 16)
+        new_ctr = Counter.new(128, initial_value=now_iv)
+        self.aes = AES.new(self.crypto_key, mode=AES.MODE_CTR, counter=new_ctr)
+        if self.is_decrypt:
+            self.aes.decrypt(b"1" * (offset % 16))
+        else:
+            self.aes.encrypt(b"1" * (offset % 16))
+
+    def gen_need_record(self, record):
+        record["crypto_iv"] = binascii.b2a_base64(self.crypto_iv).strip().decode("UTF-8")
+        record["master_key_info"] = self.master_key_info
+        record["master_key_sha256"] = self.master_key_sha256
+        return super(OBSCtrCipher, self).gen_need_record(record)
+
+    def safe_crypto_info(self):
+        crypto_info = super(OBSCtrCipher, self).safe_crypto_info()
+        crypto_info["crypto_iv"] = binascii.b2a_base64(self.crypto_iv).strip().decode("UTF-8")
+        crypto_info["master_key_info"] = self.master_key_info
+        crypto_info["master_key_sha256"] = self.master_key_sha256
+        return crypto_info
+
+    def __str__(self):
+        return "OBSCtrCipher Encrypted Object start at " + binascii.b2a_base64(self.crypto_iv).strip().decode("UTF-8")
+
+
+class CtrRSACipherGenerator(CipherGenerator):
+    def __init__(self, master_crypto_key_path, master_key_info=None, *args, **kwargs):
+        super(CtrRSACipherGenerator, self).__init__(*args, **kwargs)
+        with open(master_crypto_key_path, "rb") as f:
+            key = f.read()
+            self.master_key_sha256 = hashlib.sha256(key).hexdigest()
+            self.master_crypto_key = RSA.importKey(key)
+        self.rsa = PKCS1_OAEP.new(self.master_crypto_key)
+        self.crypto_mod = "AES256-Ctr/RSA-Object-Key/NoPadding"
+        self.master_key_info = "" if master_key_info is None else master_key_info
+
+    def new(self, readable, is_decrypt=False, crypto_info=None):
+        if crypto_info is not None:
+            iv = binascii.a2b_base64(crypto_info["crypto_iv"])
+            if "object_encryption_key" in crypto_info:
+                object_encryption_key = binascii.a2b_base64(crypto_info["object_encryption_key"])
+            else:
+                object_encryption_key = self.decrypt_object_encryption_key(crypto_info["encrypted_object_key"])
+                if object_encryption_key == 0:
+                    raise Exception("Wrong private key, could not decrypt object encryption key")
+            return OBSCtrRSACipher(readable, object_encryption_key, crypto_info["encrypted_object_key"],
+                                   self.master_key_info, self.master_key_sha256, iv, is_decrypt, self.need_sha256)
+        random_key = self.gen_random_key(32)
+        random_iv = self.gen_random_key(16)
+        return OBSCtrRSACipher(readable, random_key, self.encrypt_object_encryption_key(random_key),
+                               self.master_key_info,
+                               self.master_key_sha256, random_iv, is_decrypt, self.need_sha256)
+
+    def encrypt_object_encryption_key(self, key_str):
+        return binascii.b2a_base64(self.rsa.encrypt(key_str)).strip().decode("UTF-8")
+
+    def decrypt_object_encryption_key(self, key_str):
+        return self.rsa.decrypt(binascii.a2b_base64(key_str))
+
+    def get_crypto_info_from_headers(self, header_dict):
+        header_dict = super(CtrRSACipherGenerator, self).get_crypto_info_from_headers(header_dict)
+        if "encrypted-object-key" not in header_dict:
+            raise Exception("Encryption info is not in metadata")
+        header_dict["encrypted_object_key"] = header_dict.pop("encrypted-object-key")
+        header_dict["crypto_iv"] = header_dict.pop("encrypted-start")
+        if "master-key-info" in header_dict:
+            header_dict["master_key_info"] = header_dict.pop("master-key-info")
+        return header_dict
+
+    def check_download_record(self, record, crypto_info):
+        return super(CtrRSACipherGenerator, self).check_record(record, crypto_info) \
+               and record["master_key_sha256"] == crypto_info["master_key_sha256"] \
+               and record["crypto_iv"] == crypto_info["crypto_iv"] \
+               and record["encrypted_object_key"] == crypto_info["encrypted_object_key"]
+
+    def check_upload_record(self, record, crypto_info):
+        return super(CtrRSACipherGenerator, self).check_record(record, crypto_info) \
+               and record["master_key_info"] == crypto_info["master_key_info"] \
+               and record["master_key_sha256"] == crypto_info["master_key_sha256"]
+
+
+class OBSCtrRSACipher(OBSCtrCipher):
+    def __init__(self, readable, crypto_key, encrypted_object_key, master_key_info, master_key_sha256,
+                 crypto_iv=None, is_decrypt=False, need_sha256=False):
+        super(OBSCtrRSACipher, self).__init__(readable, crypto_key, master_key_info, master_key_sha256, crypto_iv,
+                                              is_decrypt, need_sha256)
+        self.encrypted_object_key = encrypted_object_key
+        self.crypto_mod = "AES256-Ctr/RSA-Object-Key/NoPadding"
+        self.master_key_info = master_key_info
+
+    def gen_need_metadata_and_headers(self, metadata, headers=None):
+        metadata["encrypted-object-key"] = self.encrypted_object_key
+        return super(OBSCtrRSACipher, self).gen_need_metadata_and_headers(metadata, headers)
+
+    def gen_need_record(self, record):
+        record["encrypted_object_key"] = self.encrypted_object_key
+        record["master_key_sha256"] = self.master_key_sha256
+        record["object_encryption_key"] = binascii.b2a_base64(self.crypto_key).strip().decode("UTF-8")
+        return super(OBSCtrRSACipher, self).gen_need_record(record)
+
+    def crypto_info(self):
+        crypto_info = self.safe_crypto_info()
+        crypto_info["object_encryption_key"] = binascii.b2a_base64(self.crypto_key).strip().decode("UTF-8")
+        return crypto_info
+
+    def safe_crypto_info(self):
+        crypto_info = super(OBSCtrRSACipher, self).safe_crypto_info()
+        crypto_info["encrypted_object_key"] = self.encrypted_object_key
+        crypto_info["master_key_info"] = self.master_key_info
+        crypto_info["master_key_sha256"] = self.master_key_sha256
+        return crypto_info
+
+    def __str__(self):
+        return "OBSCtrRSACipher Encrypted Object start at " \
+               + binascii.b2a_base64(self.crypto_iv).strip().decode("UTF-8")
```

### Comparing `esdk-obs-python-3.23.9.1/obs/progress.py` & `esdk-obs-python-3.24.3/obs/progress.py`

 * *Ordering differences only*

 * *Files 25% similar despite different names*

```diff
@@ -1,83 +1,83 @@
-#!/usr/bin/python
-# -*- coding:utf-8 -*-
-# Copyright 2019 Huawei Technologies Co.,Ltd.
-# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
-# this file except in compliance with the License.  You may obtain a copy of the
-# License at
-
-# http://www.apache.org/licenses/LICENSE-2.0
-
-# Unless required by applicable law or agreed to in writing, software distributed
-# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
-# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
-# specific language governing permissions and limitations under the License.
-
-import time
-import threading
-from obs import const
-
-if const.IS_PYTHON2:
-    import Queue as queue
-else:
-    import queue
-
-
-class ProgressNotifier(object):
-
-    def __init__(self, callback=None, totalAmount=0, interval=102400):
-        self.callback = callback
-        if self.callback is None or not callable(self.callback):
-            raise Exception('Invalid callback')
-        self.totalAmount = totalAmount
-        self.interval = interval
-        self._transferredAmount = const.LONG(0)
-        self._newlyTransferredAmount = const.LONG(0)
-        self._queue = queue.Queue()
-        self._startCheckpoint = None
-
-    def _run(self):
-        while True:
-            data = self._queue.get()
-            if data is None:
-                self._queue = None
-                break
-            self._transferredAmount += data
-            self._newlyTransferredAmount += data
-            if self._newlyTransferredAmount >= self.interval and (
-                    self._transferredAmount < self.totalAmount or self.totalAmount <= 0):
-                self._newlyTransferredAmount = 0
-                self.callback(*self._calculate())
-
-    def start(self):
-        now = time.time()
-        self._startCheckpoint = now
-        t = threading.Thread(target=(self._run))
-        t.daemon = True
-        t.start()
-
-    def _calculate(self):
-        totalSeconds = time.time() - self._startCheckpoint
-        return self._transferredAmount, self.totalAmount, totalSeconds if totalSeconds > 0 else 0.001
-
-    def send(self, data):
-        if isinstance(data, (const.LONG, int)):
-            self._queue.put(data)
-
-    def end(self):
-        self._queue.put(None)
-        self.callback(*self._calculate())
-        self.callback = None
-
-
-class NoneNotifier(object):
-    def send(self, data):
-        pass
-
-    def start(self):
-        pass
-
-    def end(self):
-        pass
-
-
-NONE_NOTIFIER = NoneNotifier()
+#!/usr/bin/python
+# -*- coding:utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+import time
+import threading
+from obs import const
+
+if const.IS_PYTHON2:
+    import Queue as queue
+else:
+    import queue
+
+
+class ProgressNotifier(object):
+
+    def __init__(self, callback=None, totalAmount=0, interval=102400):
+        self.callback = callback
+        if self.callback is None or not callable(self.callback):
+            raise Exception('Invalid callback')
+        self.totalAmount = totalAmount
+        self.interval = interval
+        self._transferredAmount = const.LONG(0)
+        self._newlyTransferredAmount = const.LONG(0)
+        self._queue = queue.Queue()
+        self._startCheckpoint = None
+
+    def _run(self):
+        while True:
+            data = self._queue.get()
+            if data is None:
+                self._queue = None
+                break
+            self._transferredAmount += data
+            self._newlyTransferredAmount += data
+            if self._newlyTransferredAmount >= self.interval and (
+                    self._transferredAmount < self.totalAmount or self.totalAmount <= 0):
+                self._newlyTransferredAmount = 0
+                self.callback(*self._calculate())
+
+    def start(self):
+        now = time.time()
+        self._startCheckpoint = now
+        t = threading.Thread(target=(self._run))
+        t.daemon = True
+        t.start()
+
+    def _calculate(self):
+        totalSeconds = time.time() - self._startCheckpoint
+        return self._transferredAmount, self.totalAmount, totalSeconds if totalSeconds > 0 else 0.001
+
+    def send(self, data):
+        if isinstance(data, (const.LONG, int)):
+            self._queue.put(data)
+
+    def end(self):
+        self._queue.put(None)
+        self.callback(*self._calculate())
+        self.callback = None
+
+
+class NoneNotifier(object):
+    def send(self, data):
+        pass
+
+    def start(self):
+        pass
+
+    def end(self):
+        pass
+
+
+NONE_NOTIFIER = NoneNotifier()
```

### Comparing `esdk-obs-python-3.23.9.1/obs/searchmethod.py` & `esdk-obs-python-3.24.3/obs/searchmethod.py`

 * *Ordering differences only*

 * *Files 23% similar despite different names*

```diff
@@ -1,41 +1,41 @@
-#!/usr/bin/python
-# -*- coding:utf-8 -*-
-# Copyright 2019 Huawei Technologies Co.,Ltd.
-# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
-# this file except in compliance with the License.  You may obtain a copy of the
-# License at
-
-# http://www.apache.org/licenses/LICENSE-2.0
-
-# Unless required by applicable law or agreed to in writing, software distributed
-# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
-# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
-# specific language governing permissions and limitations under the License.
-
-from obs.loadtoken import NoneTokenException
-
-
-def get_token(security_providers, name='OBS_DEFAULT'):
-    if name == 'OBS_DEFAULT':
-        for method in security_providers:
-            try:
-                value = method.search()
-            except Exception:
-                print("Method search Error")
-            else:
-                return {'accessKey': value.get('accessKey'),
-                        'secretKey': value.get('secretKey'),
-                        'securityToken': value.get('securityToken')}
-        raise NoneTokenException('get token failed')
-
-    for method in security_providers:
-        if getattr(method, '__name__') == name:
-            try:
-                value = method.search()
-            except Exception:
-                raise
-            else:
-                return {'accessKey': value.get('accessKey'),
-                        'secretKey': value.get('secretKey'),
-                        'securityToken': value.get('securityToken')}
-    raise ValueError('No such method: ' + name)
+#!/usr/bin/python
+# -*- coding:utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+from obs.loadtoken import NoneTokenException
+
+
+def get_token(security_providers, name='OBS_DEFAULT'):
+    if name == 'OBS_DEFAULT':
+        for method in security_providers:
+            try:
+                value = method.search()
+            except Exception:
+                print("Method search Error")
+            else:
+                return {'accessKey': value.get('accessKey'),
+                        'secretKey': value.get('secretKey'),
+                        'securityToken': value.get('securityToken')}
+        raise NoneTokenException('get token failed')
+
+    for method in security_providers:
+        if getattr(method, '__name__') == name:
+            try:
+                value = method.search()
+            except Exception:
+                raise
+            else:
+                return {'accessKey': value.get('accessKey'),
+                        'secretKey': value.get('secretKey'),
+                        'securityToken': value.get('securityToken')}
+    raise ValueError('No such method: ' + name)
```

### Comparing `esdk-obs-python-3.23.9.1/obs/transfer.py` & `esdk-obs-python-3.24.3/obs/transfer.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,799 +1,800 @@
-#!/usr/bin/python
-# -*- coding:utf-8 -*-
-# Copyright 2019 Huawei Technologies Co.,Ltd.
-# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
-# this file except in compliance with the License.  You may obtain a copy of the
-# License at
-
-# http://www.apache.org/licenses/LICENSE-2.0
-
-import functools
-import json
-# Unless required by applicable law or agreed to in writing, software distributed
-# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
-# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
-# specific language governing permissions and limitations under the License.
-import math
-import operator
-import os
-import stat
-import sys
-import threading
-import traceback
-
-from obs import const, progress, util
-from obs.ilog import DEBUG, ERROR, INFO
-from obs.model import BaseModel, CompleteMultipartUploadRequest, CompletePart, GetObjectHeader, GetObjectRequest, \
-    UploadFileHeader
-
-if const.IS_PYTHON2:
-    import Queue as queue
-else:
-    import queue
-
-
-def _resume_upload(bucketName, objectKey, uploadFile, partSize, taskNum, enableCheckPoint, checkPointFile, checkSum,
-                   metadata, progressCallback, obsClient, headers, extensionHeaders=None, encoding_type=None):
-    upload_operation = uploadOperation(util.to_string(bucketName), util.to_string(objectKey),
-                                       util.to_string(uploadFile), partSize, taskNum, enableCheckPoint,
-                                       util.to_string(checkPointFile), checkSum, metadata, progressCallback, obsClient,
-                                       headers, extensionHeaders=extensionHeaders, encoding_type=encoding_type)
-    return upload_operation._upload()
-
-
-def _resume_download(bucketName, objectKey, downloadFile, partSize, taskNum, enableCheckPoint, checkPointFile,
-                     header, versionId, progressCallback, obsClient, imageProcess=None,
-                     notifier=progress.NONE_NOTIFIER, extensionHeaders=None):
-    down_operation = downloadOperation(util.to_string(bucketName), util.to_string(objectKey),
-                                       util.to_string(downloadFile), partSize, taskNum, enableCheckPoint,
-                                       util.to_string(checkPointFile),
-                                       header, versionId, progressCallback, obsClient, imageProcess, notifier,
-                                       extensionHeaders=extensionHeaders)
-
-    return _resume_download_with_operation(down_operation)
-
-
-def _resume_download_with_operation(down_operation):
-    if down_operation.size == 0:
-        down_operation._delete_record()
-        down_operation._delete_tmp_file()
-
-        modes = stat.S_IWUSR | stat.S_IRUSR
-        flags = os.O_RDWR | os.O_TRUNC | os.O_CREAT
-        with os.fdopen(os.open(down_operation.fileName, flags, modes), 'wb'):
-            pass
-        if down_operation.progressCallback is not None and callable(down_operation.progressCallback):
-            down_operation.progressCallback(0, 0, 0)
-        return down_operation._metadata_resp
-    return down_operation._download()
-
-
-class Operation(object):
-    def __init__(self, bucketName, objectKey, fileName, partSize, taskNum, enableCheckPoint, checkPointFile,
-                 progressCallback, obsClient, notifier=progress.NONE_NOTIFIER):
-        self.bucketName = bucketName
-        self.objectKey = objectKey
-        self.fileName = util.safe_trans_to_gb2312(fileName)
-        self.partSize = partSize
-        self.taskNum = taskNum
-        self.enableCheckPoint = enableCheckPoint
-        self.checkPointFile = util.safe_trans_to_gb2312(checkPointFile)
-        self.progressCallback = progressCallback
-        self.notifier = notifier
-        self.obsClient = obsClient
-        self._lock = threading.Lock()
-        self._abortLock = threading.Lock()
-        self._abort = False
-        self._record = None
-        self._exception = None
-
-    def _is_abort(self):
-        with self._abortLock:
-            return self._abort
-
-    def _do_abort(self, error):
-        with self._abortLock:
-            self._abort = True
-            if self._exception is None:
-                self._exception = error
-
-    def _get_record(self):
-        self.obsClient.log_client.log(INFO, 'load checkpoint file...')
-        if os.path.exists(self.checkPointFile):
-            try:
-                with open(self.checkPointFile, 'r') as f:
-                    content = json.load(f)
-                    return _parse_string(content)
-            except ValueError:
-                pass
-        return None
-
-    def _delete_record(self):
-        if os.path.exists(self.checkPointFile):
-            os.remove(self.checkPointFile)
-            self.obsClient.log_client.log(INFO,
-                                          'delete checkpoint file success. path is:{0}'.format(self.checkPointFile))
-
-    def _write_record(self, record):
-        modes = stat.S_IWUSR | stat.S_IRUSR
-        flags = os.O_RDWR | os.O_TRUNC | os.O_CREAT
-        with os.fdopen(os.open(self.checkPointFile, flags, modes), 'w') as f:
-            json.dump(record, f)
-            self.obsClient.log_client.log(INFO,
-                                          'write checkpoint file success. file path is {0}'.format(self.checkPointFile))
-
-
-class uploadOperation(Operation):
-    def __init__(self, bucketName, objectKey, uploadFile, partSize, taskNum, enableCheckPoint, checkPointFile,
-                 checkSum, metadata, progressCallback, obsClient, headers, extensionHeaders=None, encoding_type=None):
-        if enableCheckPoint and not checkPointFile:
-            checkPointFile = uploadFile + '.upload_record'
-        super(uploadOperation, self).__init__(bucketName, objectKey, uploadFile, partSize, taskNum, enableCheckPoint,
-                                              checkPointFile, progressCallback, obsClient)
-        self.checkSum = checkSum
-        self.metadata = metadata
-        self.headers = headers
-        self.extensionHeaders = extensionHeaders
-        self.encoding_type = encoding_type
-
-        try:
-            self.size = os.path.getsize(self.fileName)
-            self.lastModified = os.path.getmtime(self.fileName)
-        except Exception as e:
-            self._delete_record()
-            self.obsClient.log_client.log(ERROR,
-                                          'something is happened when obtain uploadFile information. Please check')
-            raise e
-        self.total_parts = 0
-        self.reset_partSize()
-        self._record = {'bucketName': self.bucketName, 'objectKey': self.objectKey, 'uploadFile': self.fileName,
-                        'partEtags': []}
-        resp = self.obsClient.headBucket(self.bucketName, extensionHeaders=extensionHeaders)
-        if resp.status > 300:
-            raise Exception('head bucket {0} failed. Please check. Status:{1}.'.format(self.bucketName, resp.status))
-
-    def reset_partSize(self):
-        if self.partSize < const.DEFAULT_MINIMUM_SIZE:
-            self.partSize = const.DEFAULT_MINIMUM_SIZE
-        elif self.partSize > const.DEFAULT_MAXIMUM_SIZE:
-            self.partSize = const.DEFAULT_MAXIMUM_SIZE
-        else:
-            self.partSize = util.to_int(self.partSize)
-        if self.taskNum <= 0:
-            self.taskNum = 1
-        else:
-            self.taskNum = int(math.ceil(self.taskNum))
-            try:
-                self.total_parts = int(self.size / self.partSize)
-            except ZeroDivisionError:
-                print("You can't divide by 0!")
-        if self.total_parts >= 10000:
-            self.partSize = int(self.size / 10000) if self.size % 10000 == 0 else int(self.size / 10000) + 1
-            try:
-                self.total_parts = int(self.size / self.partSize)
-            except ZeroDivisionError:
-                print("You can't divide by 0!")
-        if self.size % self.partSize != 0:
-            self.total_parts += 1
-
-    def _upload(self):
-        if self.headers is None:
-            self.headers = UploadFileHeader()
-
-        if self.enableCheckPoint:
-            self._load()
-
-        if "uploadId" not in self._record:
-            self._prepare()
-
-        unfinished_upload_parts = []
-        sent_bytes = const.LONG(0)
-        for p in self._record['uploadParts']:
-            if not p['isCompleted']:
-                unfinished_upload_parts.append(p)
-            else:
-                sent_bytes += p['length']
-
-        if self.progressCallback is not None:
-            self.notifier = progress.ProgressNotifier(self.progressCallback, self.size)
-            self.notifier.start()
-
-        try:
-            if len(unfinished_upload_parts) > 0:
-
-                if (self.size - sent_bytes) > 0:
-                    self.notifier.send(sent_bytes)
-
-                thread_pools = _ThreadPool(functools.partial(self._produce, upload_parts=unfinished_upload_parts),
-                                           [self._consume] * self.taskNum)
-                thread_pools.run()
-
-                if self._abort:
-                    self.obsClient.abortMultipartUpload(self.bucketName, self.objectKey, self._record['uploadId'],
-                                                        extensionHeaders=self.extensionHeaders)
-                    self.obsClient.log_client.log(
-                        ERROR,
-                        'the code from server is 4**, please check space, permission and so on.'
-                    )
-                    self._delete_record()
-                    if self._exception is not None:
-                        raise Exception(self._exception)
-
-                for p in self._record['uploadParts']:
-                    if not p['isCompleted']:
-                        if not self.enableCheckPoint:
-                            self.obsClient.abortMultipartUpload(self.bucketName, self.objectKey,
-                                                                self._record['uploadId'],
-                                                                extensionHeaders=self.extensionHeaders)
-                        raise Exception('some parts are failed when upload. Please try again')
-
-            part_Etags = []
-            for part in self._record['partEtags']:
-                part_Etags.append(CompletePart(partNum=part['partNum'], etag=part['etag']))
-                self.obsClient.log_client.log(INFO, 'Completing to upload multi_parts')
-            resp = self.obsClient.completeMultipartUpload(self.bucketName, self.objectKey, self._record['uploadId'],
-                                                          CompleteMultipartUploadRequest(part_Etags),
-                                                          extensionHeaders=self.extensionHeaders,
-                                                          encoding_type=self.encoding_type)
-            self._upload_handle_response(resp)
-            return resp
-        finally:
-            self.notifier.end()
-
-    def _upload_handle_response(self, resp):
-        if resp.status < 300:
-            if self.enableCheckPoint:
-                self._delete_record()
-        else:
-            if not self.enableCheckPoint:
-                self.obsClient.abortMultipartUpload(self.bucketName, self.objectKey, self._record['uploadId'],
-                                                    extensionHeaders=self.extensionHeaders)
-                self.obsClient.log_client.log(
-                    ERROR,
-                    'something is wrong when complete multipart.ErrorCode:{0}. ErrorMessage:{1}'.format(
-                        resp.errorCode, resp.errorMessage))
-            else:
-                if 300 < resp.status < 500:
-                    self.obsClient.abortMultipartUpload(self.bucketName, self.objectKey, self._record['uploadId'],
-                                                        extensionHeaders=self.extensionHeaders)
-                    self.obsClient.log_client.log(
-                        ERROR,
-                        'something is wrong when complete multipart.ErrorCode:{0}. ErrorMessage:{1}'.format(
-                            resp.errorCode, resp.errorMessage))
-                    self._delete_record()
-
-    def _load(self):
-        self._record = self._get_record()
-        if self._record and not (self._type_check(self._record) and self._check_upload_record(self._record)):
-            if self._record['bucketName'] and self._record['objectKey'] and self._record['uploadId'] is not None:
-                self.obsClient.abortMultipartUpload(self._record['bucketName'], self._record['objectKey'],
-                                                    self._record['uploadId'], extensionHeaders=self.extensionHeaders)
-            self.obsClient.log_client.log(ERROR, 'checkpointFile is invalid')
-            self._delete_record()
-            self._record = None
-        if self._record is None:
-            self._record = {'bucketName': self.bucketName, 'objectKey': self.objectKey, 'uploadFile': self.fileName,
-                            'partEtags': []}
-
-    def _type_check(self, record):
-        try:
-            for key in ('bucketName', 'objectKey', 'uploadId', 'uploadFile'):
-                if not isinstance(record[key], str):
-                    self.obsClient.log_client.log(
-                        ERROR,
-                        '{0} is not a string type. {1} belong to {2}'.format(key, record[key], record[key].__class__)
-                    )
-                    return False
-            if not isinstance(record['fileStatus'], list):
-                self.obsClient.log_client.log(ERROR, 'fileStatus is not a list.It is {0} type'.format(
-                    record['fileStatus'].__class__))
-                return False
-            if not isinstance(record['uploadParts'], list):
-                self.obsClient.log_client.log(ERROR, 'uploadParts is not a list.It is {0} type'.format(
-                    record['uploadParts'].__class__))
-                return False
-            if not isinstance(record['partEtags'], list):
-                self.obsClient.log_client.log(ERROR, 'partEtags is not a dict.It is {0} type'.format(
-                    record['partEtags'].__class__))
-                return False
-        except KeyError as e:
-            self.obsClient.log_client.log(INFO, 'Key is not found:{0}'.format(e.args))
-            return False
-        return True
-
-    def _check_upload_record(self, record):
-        if not ((record['bucketName'] == self.bucketName) and (record['objectKey'] == self.objectKey) and (
-                record['uploadFile'] == self.fileName)):
-            self.obsClient.log_client.log(INFO,
-                                          'the bucketName or objectKey or uploadFile was changed. clear the record')
-            return False
-        if record['uploadId'] is None:
-            self.obsClient.log_client.log(INFO,
-                                          '{0} (uploadId) not exist, clear the record.'.format(record['upload_id']))
-            return False
-
-        if record['fileStatus'][0] != self.size or record['fileStatus'][1] != self.lastModified:
-            self.obsClient.log_client.log(INFO, '{0} was changed, clear the record.'.format(self.fileName))
-            return False
-        if self.checkSum and len(record['fileStatus']) >= 3:
-            checkSum = util.base64_encode(
-                util.sha256_file_encode_by_size_offset(file_path=self.fileName, size=self.size, offset=0))
-            if record['fileStatus'][2] and record['fileStatus'][2] != checkSum:
-                self.obsClient.log_client.log(INFO, '{0} content was changed, clear the record.'.format(self.fileName))
-                return False
-        return True
-
-    def _slice_file(self):
-        uploadParts = []
-
-        if self.total_parts == 0:
-            part = Part(util.to_long(1), util.to_long(0), util.to_long(0), False)
-            uploadParts.append(part)
-        else:
-            offset = 0
-            for i in range(1, self.total_parts + 1, 1):
-                part = Part(util.to_long(i), util.to_long(offset), util.to_long(self.partSize), False)
-                offset += self.partSize
-                uploadParts.append(part)
-
-            if self.size % self.partSize != 0:
-                uploadParts[self.total_parts - 1].length = util.to_long(self.size % self.partSize)
-
-        return uploadParts
-
-    def get_init_upload_result(self):
-        return self.obsClient.initiateMultipartUpload(self.bucketName, self.objectKey, metadata=self.metadata,
-                                                      acl=self.headers.acl,
-                                                      storageClass=self.headers.storageClass,
-                                                      websiteRedirectLocation=self.headers.websiteRedirectLocation,
-                                                      contentType=self.headers.contentType,
-                                                      sseHeader=self.headers.sseHeader, expires=self.headers.expires,
-                                                      extensionGrants=self.headers.extensionGrants,
-                                                      extensionHeaders=self.extensionHeaders,
-                                                      encoding_type=self.encoding_type)
-
-    def _prepare(self):
-        fileStatus = [self.size, self.lastModified]
-        if self.checkSum:
-            fileStatus.append(util.base64_encode(util.sha256_file_encode_by_size_offset(self.fileName, self.size, 0)))
-
-        resp = self.get_init_upload_result()
-
-        if resp.status > 300:
-            raise Exception('initiateMultipartUpload failed. ErrorCode:{0}. ErrorMessage:{1}'.format(resp.errorCode,
-                                                                                                     resp.errorMessage))
-        uploadId = resp.body.uploadId
-        self._record["uploadParts"] = self._slice_file()
-        self._record["uploadId"] = uploadId
-        self._record["fileStatus"] = fileStatus
-        self.obsClient.log_client.log(INFO, 'prepare new upload task success. uploadId = {0}'.format(uploadId))
-        if self.enableCheckPoint:
-            self._write_record(self._record)
-
-    @staticmethod
-    def _produce(ThreadPool, upload_parts):
-        for part in upload_parts:
-            ThreadPool.put(part)
-
-    def _consume(self, ThreadPool):
-        while ThreadPool.ok():
-            part = ThreadPool.get()
-            if part is None:
-                break
-            self._upload_part(part)
-
-    def _upload_part(self, part):
-        if not self._is_abort():
-            try:
-                resp = self.get_upload_part_resp(part)
-                if resp.status < 300:
-                    self._record['uploadParts'][part['partNumber'] - 1]['isCompleted'] = True
-                    self._record['partEtags'].append(CompletePart(util.to_int(part['partNumber']), resp.body.etag))
-                    if self.enableCheckPoint:
-                        with self._lock:
-                            self._write_record(self._record)
-                else:
-                    if 300 < resp.status < 500:
-                        self._do_abort('errorCode:{0}, errorMessage:{1}'.format(resp.errorCode, resp.errorMessage))
-                    self.obsClient.log_client.log(
-                        ERROR,
-                        'response from server is something wrong. ErrorCode:{0}, ErrorMessage:{1}'.format(
-                            resp.errorCode, resp.errorMessage))
-            except Exception as e:
-                self.obsClient.log_client.log(DEBUG, 'upload part %s error, %s' % (part['partNumber'], e))
-                self.obsClient.log_client.log(ERROR, traceback.format_exc())
-
-    def get_upload_part_resp(self, part):
-        return self.obsClient._uploadPartWithNotifier(self.bucketName, self.objectKey, part['partNumber'],
-                                                      self._record['uploadId'], self.fileName,
-                                                      isFile=True, partSize=part['length'],
-                                                      offset=part['offset'], notifier=self.notifier,
-                                                      extensionHeaders=self.extensionHeaders,
-                                                      sseHeader=self.headers.sseHeader)
-
-
-class downloadOperation(Operation):
-    def __init__(self, bucketName, objectKey, downloadFile, partSize, taskNum, enableCheckPoint, checkPointFile,
-                 header, versionId, progressCallback, obsClient, imageProcess=None, notifier=progress.NONE_NOTIFIER,
-                 extensionHeaders=None):
-        if enableCheckPoint and not checkPointFile:
-            checkPointFile = downloadFile + '.download_record'
-        super(downloadOperation, self).__init__(bucketName, objectKey, downloadFile, partSize, taskNum,
-                                                enableCheckPoint,
-                                                checkPointFile, progressCallback, obsClient, notifier)
-        self.header = header
-        self.versionId = versionId
-        self.imageProcess = imageProcess
-        self.extensionHeaders = extensionHeaders
-        self._record = {'bucketName': self.bucketName, 'objectKey': self.objectKey, 'versionId': self.versionId,
-                        'downloadFile': self.fileName, 'imageProcess': self.imageProcess}
-
-        parent_dir = os.path.dirname(self.fileName)
-        if not os.path.exists(parent_dir):
-            os.makedirs(parent_dir)
-
-        self._tmp_file = self.fileName + '.tmp'
-        metadata_resp = self.obsClient.getObjectMetadata(self.bucketName, self.objectKey, self.versionId,
-                                                         extensionHeaders=self.extensionHeaders,
-                                                         sseHeader=self.header.sseHeader, origin=self.header.origin,
-                                                         requestHeaders=self.header.requestHeaders)
-        if metadata_resp.status < 300:
-            self.lastModified = metadata_resp.body.lastModified
-            self.size = metadata_resp.body.contentLength \
-                if metadata_resp.body.contentLength is not None and metadata_resp.body.contentLength >= 0 else 0
-        else:
-            if 400 <= metadata_resp.status < 500:
-                self._delete_record()
-                self._delete_tmp_file()
-            self.obsClient.log_client.log(
-                ERROR,
-                'there are something wrong when touch the object {0}. ErrorCode:{1}, ErrorMessage:{2}'.format(
-                    self.objectKey, metadata_resp.errorCode, metadata_resp.errorMessage))
-            raise Exception(
-                'there are something wrong when touch the object {0}. ErrorCode:{1}, ErrorMessage:{2}'.format(
-                    self.objectKey, metadata_resp.status, metadata_resp.errorMessage))
-        self._metadata_resp = metadata_resp
-
-    def _delete_tmp_file(self):
-        if os.path.exists(self._tmp_file):
-            os.remove(self._tmp_file)
-
-    def _do_rename(self):
-        try:
-            modes = stat.S_IWUSR | stat.S_IRUSR
-            flags = os.O_RDWR | os.O_TRUNC | os.O_CREAT
-            with os.fdopen(os.open(self.fileName, flags, modes), 'wb') as wf:
-                with open(self._tmp_file, 'rb') as rf:
-                    while True:
-                        chunk = rf.read(const.READ_ONCE_LENGTH)
-                        if not chunk:
-                            break
-                        wf.write(chunk)
-            if self.enableCheckPoint:
-                self._delete_record()
-            self._delete_tmp_file()
-            return 1
-        except Exception:
-            return 0
-
-    def _download(self):
-        inner_notifier = False
-
-        if self.enableCheckPoint:
-            self._load()
-
-        if "downloadParts" not in self._record:
-            self._prepare()
-
-        sent_bytes, unfinished_down_parts = self._download_prepare()
-
-        try:
-            if len(unfinished_down_parts) > 0:
-                if (self.size - sent_bytes) > 0:
-                    if self.progressCallback is not None:
-                        self.notifier = progress.ProgressNotifier(self.progressCallback, self.size)
-                        inner_notifier = True
-                        self.notifier.start()
-                    self.notifier.send(sent_bytes)
-
-                thread_pools = _ThreadPool(functools.partial(self._produce, download_parts=unfinished_down_parts),
-                                           [self._consume] * self.taskNum)
-                thread_pools.run()
-
-                if self._abort:
-                    self._delete_record()
-                    self._delete_tmp_file()
-                    if self._exception is not None:
-                        raise Exception(self._exception)
-
-                for p in self._record['downloadParts']:
-                    if not p['isCompleted']:
-                        raise Exception('some parts are failed when download. Please try again')
-
-            try:
-                os.rename(self._tmp_file, self.fileName)
-                if self.enableCheckPoint:
-                    self._delete_record()
-                self.obsClient.log_client.log(INFO, 'download success.')
-                return self._metadata_resp
-            except Exception as e:
-                if self._do_rename():
-                    self.obsClient.log_client.log(INFO, 'download success.')
-                    return self._metadata_resp
-                if not self.enableCheckPoint:
-                    self._delete_tmp_file()
-                self.obsClient.log_client.log(
-                    INFO,
-                    'Rename failed. The reason maybe:[the {0} exists, not a file path, not permission]. Please check.')
-                raise e
-        finally:
-            if inner_notifier:
-                self.notifier.end()
-
-    def _download_prepare(self):
-        sent_bytes = 0
-        unfinished_down_parts = []
-        for part in self._record['downloadParts']:
-            if not part['isCompleted']:
-                unfinished_down_parts.append(part)
-            else:
-                sent_bytes += (part['length'] - part['offset']) + 1
-        return sent_bytes, unfinished_down_parts
-
-    def _load(self):
-        self._record = self._get_record()
-        if self._record is not None and not (
-                self._type_record(self._record) and self._check_download_record(self._record)):
-            self._delete_record()
-            self._delete_tmp_file()
-            self._record = None
-        if self._record is None:
-            self._record = {'bucketName': self.bucketName, 'objectKey': self.objectKey, 'versionId': self.versionId,
-                            'downloadFile': self.fileName, 'imageProcess': self.imageProcess}
-
-    def _prepare(self):
-        object_status = [self.objectKey, self.size, self.lastModified, self.versionId, self.imageProcess]
-        modes = stat.S_IWUSR | stat.S_IRUSR
-        flags = os.O_RDWR | os.O_TRUNC | os.O_CREAT
-        with os.fdopen(os.open(_to_unicode(self._tmp_file), flags, modes), 'wb') as f:
-            if self.size > 0:
-                f.seek(self.size - 1, 0)
-            f.write('b' if const.IS_PYTHON2 else 'b'.encode('UTF-8'))
-
-        tmp_file_status = [os.path.getsize(self._tmp_file), os.path.getmtime(self._tmp_file)]
-        self._record["downloadParts"] = self._split_object()
-        self._record["objectStatus"] = object_status
-        self._record["tmpFileStatus"] = tmp_file_status
-        self.obsClient.log_client.log(INFO, 'prepare new download task success.')
-        if self.enableCheckPoint:
-            self._write_record(self._record)
-
-    def _type_record(self, record):
-        try:
-            for key in ('bucketName', 'objectKey', 'versionId', 'downloadFile', 'imageProcess'):
-                if key == 'versionId' and record['versionId'] is None:
-                    continue
-                if key == 'imageProcess' and record['imageProcess'] is None:
-                    continue
-                if not isinstance(record[key], str):
-                    self.obsClient.log_client.log(
-                        ERROR,
-                        '{0} is not a string type. {1} belong to {2}'.format(key, record[key], record[key].__class__)
-                    )
-                    return False
-            if not isinstance(record['downloadParts'], list):
-                self.obsClient.log_client.log(ERROR, 'downloadParts is not a list.It is {0} type'.format(
-                    record['downloadParts'].__class__))
-                return False
-            if not isinstance(record['objectStatus'], list):
-                self.obsClient.log_client.log(ERROR, 'objectStatus is not a list.It is {0} type'.format(
-                    record['objectStatus'].__class__))
-                return False
-            if not isinstance(record['tmpFileStatus'], list):
-                self.obsClient.log_client.log(ERROR, 'tmpFileStatus is not a dict.It is {0} type'.format(
-                    record['tmpFileStatus'].__class__))
-                return False
-        except KeyError as e:
-            self.obsClient.log_client.log(INFO, 'Key is not found:{0}'.format(e.args))
-            return False
-        return True
-
-    def _check_download_record(self, record):
-        if not operator.eq([record['bucketName'], record['objectKey'], record['versionId'], record['downloadFile'],
-                            record['imageProcess']],
-                           [self.bucketName, self.objectKey, self.versionId, self.fileName, self.imageProcess]):
-            return False
-        if not operator.eq(record['objectStatus'],
-                           [self.objectKey, self.size, self.lastModified, self.versionId, self.imageProcess]):
-            return False
-        if record['tmpFileStatus'][0] != self.size:
-            return False
-        return True
-
-    def _split_object(self):
-        downloadParts = []
-        try:
-            num_counts = int(self.size / self.partSize)
-        except ZeroDivisionError:
-            print("You can't divide by 0!")
-        if num_counts >= 10000:
-            self.partSize = int(self.size / 10000) if self.size % 10000 == 0 else int(self.size / 10000) + 1
-            try:
-                num_counts = int(self.size / self.partSize)
-            except ZeroDivisionError:
-                print("You can't divide by 0!")
-        if self.size % self.partSize != 0:
-            num_counts += 1
-        start = 0
-        for i in range(1, num_counts + 1):
-            end = start + util.to_long(self.partSize) if i != num_counts else util.to_long(self.size)
-            part = Part(util.to_long(i), util.to_long(start), end - 1, False)
-            start += self.partSize
-            downloadParts.append(part)
-        return downloadParts
-
-    @staticmethod
-    def _produce(ThreadPool, download_parts):
-        for part in download_parts:
-            ThreadPool.put(part)
-
-    def _consume(self, ThreadPool):
-        while ThreadPool.ok():
-            part = ThreadPool.get()
-            if part is None:
-                break
-            self._download_part(part)
-
-    @staticmethod
-    def _copy_get_object_header(src_header):
-        get_object_header = GetObjectHeader()
-        get_object_header.sseHeader = src_header.sseHeader
-        get_object_header.if_match = src_header.if_match
-        get_object_header.if_none_match = src_header.if_none_match
-        get_object_header.if_modified_since = src_header.if_modified_since
-        get_object_header.if_unmodified_since = src_header.if_unmodified_since
-        return get_object_header
-
-    def _download_part(self, part):
-        get_object_request = GetObjectRequest(versionId=self.versionId, imageProcess=self.imageProcess)
-        get_object_header = self._copy_get_object_header(self.header)
-        get_object_header.range = util.to_string(part['offset']) + '-' + util.to_string(part['length'])
-        if not self._is_abort():
-            # todo 检视 response 的作用与 part_response 的重构
-            response = None
-            try:
-                resp = self.obsClient.getObject(bucketName=self.bucketName, objectKey=self.objectKey,
-                                                getObjectRequest=get_object_request,
-                                                headers=get_object_header, notifier=self.notifier,
-                                                extensionHeaders=self.extensionHeaders)
-                if resp.status < 300:
-                    part_response = resp.body.response
-                    self._download_part_write(part_response, part)
-                    self._record['downloadParts'][part['partNumber'] - 1]['isCompleted'] = True
-                    if self.enableCheckPoint:
-                        with self._lock:
-                            self._write_record(self._record)
-                else:
-                    if 300 < resp.status < 500:
-                        self._do_abort('errorCode:{0}, errorMessage:{1}'.format(resp.errorCode, resp.errorMessage))
-                    self._exception += (
-                        'response from server is something wrong. ErrorCode:{0}, ErrorMessage:{1}\n'.format(
-                            resp.errorCode, resp.errorMessage))
-                    self.obsClient.log_client.log(
-                        ERROR,
-                        'response from server is something wrong. ErrorCode:{0}, ErrorMessage:{1}'.format(
-                            resp.errorCode, resp.errorMessage))
-            except Exception as e:
-                self.obsClient.log_client.log(DEBUG, 'download part %s error, %s' % (part['partNumber'], e))
-                self.obsClient.log_client.log(ERROR, traceback.format_exc())
-            finally:
-                if response is not None:
-                    part_response.close()
-
-    def _download_part_write(self, response, part):
-        chunk_size = const.READ_ONCE_LENGTH
-        if response is not None:
-            with open(_to_unicode(self._tmp_file), 'rb+') as fs:
-                fs.seek(part['offset'], 0)
-                while True:
-                    chunk = response.read(chunk_size)
-                    if not chunk:
-                        break
-                    fs.write(chunk)
-
-
-class Part(BaseModel):
-    allowedAttr = {'partNumber': const.LONG, 'offset': const.LONG, 'length': const.LONG, 'isCompleted': bool}
-
-    def __init__(self, partNumber, offset, length, isCompleted=False):
-        self.partNumber = partNumber
-        self.offset = offset
-        self.length = length
-        self.isCompleted = isCompleted
-
-
-def _parse_string(content):
-    if const.IS_PYTHON2:
-        if isinstance(content, dict):
-            return dict([(_parse_string(key), _parse_string(value)) for key, value in content.items()])
-        elif isinstance(content, list):
-            return [_parse_string(element) for element in content]
-        elif isinstance(content, const.UNICODE):
-            return content.encode('UTF-8')
-    return content
-
-
-def _to_unicode(data):
-    if isinstance(data, bytes):
-        return data.decode('UTF-8')
-    return data
-
-
-class _ThreadPool(object):
-    def __init__(self, producer, consumers):
-        self._producer = producer
-        self._consumers = consumers
-        self._lock = threading.Lock()
-        self._queue = queue.Queue()
-
-        self._threads_consumer = []
-        self._threads_producer = []
-        self._threading_thread = threading.Thread
-        self._exc_info = None
-        self._exc_stack = None
-
-    def run(self):
-        self._add_and_run(self._threading_thread(target=self._producer_start), self._threads_producer)
-        for thread in self._threads_producer:
-            thread.join()
-        for consumer in self._consumers:
-            self._add_and_run(self._threading_thread(target=self._consumer_start, args=(consumer,)),
-                              self._threads_consumer)
-
-        for thread in self._threads_consumer:
-            thread.join()
-
-        if self._exc_info:
-            raise self._exc_info[1]
-
-    def put(self, task):
-        if task is not None:
-            self._queue.put(task)
-
-    def get(self):
-        return self._queue.get()
-
-    def ok(self):
-        with self._lock:
-            return self._exc_info is None
-
-    @staticmethod
-    def _add_and_run(thread, pool):
-        thread.daemon = True
-        thread.start()
-        pool.append(thread)
-
-    def _producer_start(self):
-        try:
-            self._producer(self)
-        except Exception:
-            with self._lock:
-                if self._exc_info is None:
-                    self._exc_info = sys.exc_info()
-                    self._exc_stack = traceback.format_exc()
-        finally:
-            self._put_end()
-
-    def _consumer_start(self, consumer):
-        try:
-            consumer(self)
-        except Exception:
-            with self._lock:
-                if self._exc_info is None:
-                    self._exc_info = sys.exc_info()
-                    self._exc_stack = traceback.format_exc()
-
-    def _put_end(self):
-        length = len(self._consumers)
-        for _ in range(length):
-            self._queue.put(None)
+#!/usr/bin/python
+# -*- coding:utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+import functools
+import json
+import math
+import operator
+import os
+import stat
+import sys
+import threading
+import traceback
+
+from obs import const, progress, util
+from obs.ilog import DEBUG, ERROR, INFO
+from obs.model import BaseModel, CompleteMultipartUploadRequest, CompletePart, GetObjectHeader, GetObjectRequest, \
+    UploadFileHeader
+
+if const.IS_PYTHON2:
+    import Queue as queue
+else:
+    import queue
+
+
+def _resume_upload(bucketName, objectKey, uploadFile, partSize, taskNum, enableCheckPoint, checkPointFile, checkSum,
+                   metadata, progressCallback, obsClient, headers, extensionHeaders=None, encoding_type=None):
+    upload_operation = uploadOperation(util.to_string(bucketName), util.to_string(objectKey),
+                                       util.to_string(uploadFile), partSize, taskNum, enableCheckPoint,
+                                       util.to_string(checkPointFile), checkSum, metadata, progressCallback, obsClient,
+                                       headers, extensionHeaders=extensionHeaders, encoding_type=encoding_type)
+    return upload_operation._upload()
+
+
+def _resume_download(bucketName, objectKey, downloadFile, partSize, taskNum, enableCheckPoint, checkPointFile,
+                     header, versionId, progressCallback, obsClient, imageProcess=None,
+                     notifier=progress.NONE_NOTIFIER, extensionHeaders=None):
+    down_operation = downloadOperation(util.to_string(bucketName), util.to_string(objectKey),
+                                       util.to_string(downloadFile), partSize, taskNum, enableCheckPoint,
+                                       util.to_string(checkPointFile),
+                                       header, versionId, progressCallback, obsClient, imageProcess, notifier,
+                                       extensionHeaders=extensionHeaders)
+
+    return _resume_download_with_operation(down_operation)
+
+
+def _resume_download_with_operation(down_operation):
+    if down_operation.size == 0:
+        down_operation._delete_record()
+        down_operation._delete_tmp_file()
+
+        modes = stat.S_IWUSR | stat.S_IRUSR
+        flags = os.O_RDWR | os.O_TRUNC | os.O_CREAT
+        with os.fdopen(os.open(down_operation.fileName, flags, modes), 'wb'):
+            pass
+        if down_operation.progressCallback is not None and callable(down_operation.progressCallback):
+            down_operation.progressCallback(0, 0, 0)
+        return down_operation._metadata_resp
+    return down_operation._download()
+
+
+class Operation(object):
+    def __init__(self, bucketName, objectKey, fileName, partSize, taskNum, enableCheckPoint, checkPointFile,
+                 progressCallback, obsClient, notifier=progress.NONE_NOTIFIER):
+        self.bucketName = bucketName
+        self.objectKey = objectKey
+        self.fileName = util.safe_trans_to_gb2312(fileName)
+        self.partSize = partSize
+        self.taskNum = taskNum
+        self.enableCheckPoint = enableCheckPoint
+        self.checkPointFile = util.safe_trans_to_gb2312(checkPointFile)
+        self.progressCallback = progressCallback
+        self.notifier = notifier
+        self.obsClient = obsClient
+        self._lock = threading.Lock()
+        self._abortLock = threading.Lock()
+        self._abort = False
+        self._record = None
+        self._exception = None
+
+    def _is_abort(self):
+        with self._abortLock:
+            return self._abort
+
+    def _do_abort(self, error):
+        with self._abortLock:
+            self._abort = True
+            if self._exception is None:
+                self._exception = error
+
+    def _get_record(self):
+        self.obsClient.log_client.log(INFO, 'load checkpoint file...')
+        if os.path.exists(self.checkPointFile):
+            try:
+                with open(self.checkPointFile, 'r') as f:
+                    content = json.load(f)
+                    return _parse_string(content)
+            except ValueError:
+                pass
+        return None
+
+    def _delete_record(self):
+        if os.path.exists(self.checkPointFile):
+            os.remove(self.checkPointFile)
+            self.obsClient.log_client.log(INFO,
+                                          'delete checkpoint file success. path is:{0}'.format(self.checkPointFile))
+
+    def _write_record(self, record):
+        modes = stat.S_IWUSR | stat.S_IRUSR
+        flags = os.O_RDWR | os.O_TRUNC | os.O_CREAT
+        with os.fdopen(os.open(self.checkPointFile, flags, modes), 'w') as f:
+            json.dump(record, f)
+            self.obsClient.log_client.log(INFO,
+                                          'write checkpoint file success. file path is {0}'.format(self.checkPointFile))
+
+
+class uploadOperation(Operation):
+    def __init__(self, bucketName, objectKey, uploadFile, partSize, taskNum, enableCheckPoint, checkPointFile,
+                 checkSum, metadata, progressCallback, obsClient, headers, extensionHeaders=None, encoding_type=None):
+        if enableCheckPoint and not checkPointFile:
+            checkPointFile = uploadFile + '.upload_record'
+        super(uploadOperation, self).__init__(bucketName, objectKey, uploadFile, partSize, taskNum, enableCheckPoint,
+                                              checkPointFile, progressCallback, obsClient)
+        self.checkSum = checkSum
+        self.metadata = metadata
+        self.headers = headers
+        self.extensionHeaders = extensionHeaders
+        self.encoding_type = encoding_type
+
+        try:
+            self.size = os.path.getsize(self.fileName)
+            self.lastModified = os.path.getmtime(self.fileName)
+        except Exception as e:
+            self._delete_record()
+            self.obsClient.log_client.log(ERROR,
+                                          'something is happened when obtain uploadFile information. Please check')
+            raise e
+        self.total_parts = 0
+        self.reset_partSize()
+        self._record = {'bucketName': self.bucketName, 'objectKey': self.objectKey, 'uploadFile': self.fileName,
+                        'partEtags': []}
+        resp = self.obsClient.headBucket(self.bucketName, extensionHeaders=extensionHeaders)
+        if resp.status > 300:
+            raise Exception('head bucket {0} failed. Please check. Status:{1}.'.format(self.bucketName, resp.status))
+
+    def reset_partSize(self):
+        if self.partSize < const.DEFAULT_MINIMUM_SIZE:
+            self.partSize = const.DEFAULT_MINIMUM_SIZE
+        elif self.partSize > const.DEFAULT_MAXIMUM_SIZE:
+            self.partSize = const.DEFAULT_MAXIMUM_SIZE
+        else:
+            self.partSize = util.to_int(self.partSize)
+        if self.taskNum <= 0:
+            self.taskNum = 1
+        else:
+            self.taskNum = int(math.ceil(self.taskNum))
+            try:
+                self.total_parts = int(self.size / self.partSize)
+            except ZeroDivisionError:
+                print("You can't divide by 0!")
+        if self.total_parts >= 10000:
+            self.partSize = int(self.size / 10000) if self.size % 10000 == 0 else int(self.size / 10000) + 1
+            try:
+                self.total_parts = int(self.size / self.partSize)
+            except ZeroDivisionError:
+                print("You can't divide by 0!")
+        if self.size % self.partSize != 0:
+            self.total_parts += 1
+
+    def _upload(self):
+        if self.headers is None:
+            self.headers = UploadFileHeader()
+
+        if self.enableCheckPoint:
+            self._load()
+
+        if "uploadId" not in self._record:
+            self._prepare()
+
+        unfinished_upload_parts = []
+        sent_bytes = const.LONG(0)
+        for p in self._record['uploadParts']:
+            if not p['isCompleted']:
+                unfinished_upload_parts.append(p)
+            else:
+                sent_bytes += p['length']
+
+        if self.progressCallback is not None:
+            self.notifier = progress.ProgressNotifier(self.progressCallback, self.size)
+            self.notifier.start()
+
+        try:
+            if len(unfinished_upload_parts) > 0:
+
+                if (self.size - sent_bytes) > 0:
+                    self.notifier.send(sent_bytes)
+
+                thread_pools = _ThreadPool(functools.partial(self._produce, upload_parts=unfinished_upload_parts),
+                                           [self._consume] * self.taskNum)
+                thread_pools.run()
+
+                if self._abort:
+                    self.obsClient.abortMultipartUpload(self.bucketName, self.objectKey, self._record['uploadId'],
+                                                        extensionHeaders=self.extensionHeaders)
+                    self.obsClient.log_client.log(
+                        ERROR,
+                        'the code from server is 4**, please check space, permission and so on.'
+                    )
+                    self._delete_record()
+                    if self._exception is not None:
+                        raise Exception(self._exception)
+
+                for p in self._record['uploadParts']:
+                    if not p['isCompleted']:
+                        if not self.enableCheckPoint:
+                            self.obsClient.abortMultipartUpload(self.bucketName, self.objectKey,
+                                                                self._record['uploadId'],
+                                                                extensionHeaders=self.extensionHeaders)
+                        raise Exception('some parts are failed when upload. Please try again')
+
+            part_Etags = []
+            for part in self._record['partEtags']:
+                part_Etags.append(CompletePart(partNum=part['partNum'], etag=part['etag']))
+                self.obsClient.log_client.log(INFO, 'Completing to upload multi_parts')
+            resp = self.obsClient.completeMultipartUpload(self.bucketName, self.objectKey, self._record['uploadId'],
+                                                          CompleteMultipartUploadRequest(part_Etags),
+                                                          extensionHeaders=self.extensionHeaders,
+                                                          encoding_type=self.encoding_type)
+            self._upload_handle_response(resp)
+            return resp
+        finally:
+            self.notifier.end()
+
+    def _upload_handle_response(self, resp):
+        if resp.status < 300:
+            if self.enableCheckPoint:
+                self._delete_record()
+        else:
+            if not self.enableCheckPoint:
+                self.obsClient.abortMultipartUpload(self.bucketName, self.objectKey, self._record['uploadId'],
+                                                    extensionHeaders=self.extensionHeaders)
+                self.obsClient.log_client.log(
+                    ERROR,
+                    'something is wrong when complete multipart.ErrorCode:{0}. ErrorMessage:{1}'.format(
+                        resp.errorCode, resp.errorMessage))
+            else:
+                if 300 < resp.status < 500:
+                    self.obsClient.abortMultipartUpload(self.bucketName, self.objectKey, self._record['uploadId'],
+                                                        extensionHeaders=self.extensionHeaders)
+                    self.obsClient.log_client.log(
+                        ERROR,
+                        'something is wrong when complete multipart.ErrorCode:{0}. ErrorMessage:{1}'.format(
+                            resp.errorCode, resp.errorMessage))
+                    self._delete_record()
+
+    def _load(self):
+        self._record = self._get_record()
+        if self._record and not (self._type_check(self._record) and self._check_upload_record(self._record)):
+            if self._record['bucketName'] and self._record['objectKey'] and self._record['uploadId'] is not None:
+                self.obsClient.abortMultipartUpload(self._record['bucketName'], self._record['objectKey'],
+                                                    self._record['uploadId'], extensionHeaders=self.extensionHeaders)
+            self.obsClient.log_client.log(ERROR, 'checkpointFile is invalid')
+            self._delete_record()
+            self._record = None
+        if self._record is None:
+            self._record = {'bucketName': self.bucketName, 'objectKey': self.objectKey, 'uploadFile': self.fileName,
+                            'partEtags': []}
+
+    def _type_check(self, record):
+        try:
+            for key in ('bucketName', 'objectKey', 'uploadId', 'uploadFile'):
+                if not isinstance(record[key], str):
+                    self.obsClient.log_client.log(
+                        ERROR,
+                        '{0} is not a string type. {1} belong to {2}'.format(key, record[key], record[key].__class__)
+                    )
+                    return False
+            if not isinstance(record['fileStatus'], list):
+                self.obsClient.log_client.log(ERROR, 'fileStatus is not a list.It is {0} type'.format(
+                    record['fileStatus'].__class__))
+                return False
+            if not isinstance(record['uploadParts'], list):
+                self.obsClient.log_client.log(ERROR, 'uploadParts is not a list.It is {0} type'.format(
+                    record['uploadParts'].__class__))
+                return False
+            if not isinstance(record['partEtags'], list):
+                self.obsClient.log_client.log(ERROR, 'partEtags is not a dict.It is {0} type'.format(
+                    record['partEtags'].__class__))
+                return False
+        except KeyError as e:
+            self.obsClient.log_client.log(INFO, 'Key is not found:{0}'.format(e.args))
+            return False
+        return True
+
+    def _check_upload_record(self, record):
+        if not ((record['bucketName'] == self.bucketName) and (record['objectKey'] == self.objectKey) and (
+                record['uploadFile'] == self.fileName)):
+            self.obsClient.log_client.log(INFO,
+                                          'the bucketName or objectKey or uploadFile was changed. clear the record')
+            return False
+        if record['uploadId'] is None:
+            self.obsClient.log_client.log(INFO,
+                                          '{0} (uploadId) not exist, clear the record.'.format(record['upload_id']))
+            return False
+
+        if record['fileStatus'][0] != self.size or record['fileStatus'][1] != self.lastModified:
+            self.obsClient.log_client.log(INFO, '{0} was changed, clear the record.'.format(self.fileName))
+            return False
+        if self.checkSum and len(record['fileStatus']) >= 3:
+            checkSum = util.base64_encode(
+                util.sha256_file_encode_by_size_offset(file_path=self.fileName, size=self.size, offset=0))
+            if record['fileStatus'][2] and record['fileStatus'][2] != checkSum:
+                self.obsClient.log_client.log(INFO, '{0} content was changed, clear the record.'.format(self.fileName))
+                return False
+        return True
+
+    def _slice_file(self):
+        uploadParts = []
+
+        if self.total_parts == 0:
+            part = Part(util.to_long(1), util.to_long(0), util.to_long(0), False)
+            uploadParts.append(part)
+        else:
+            offset = 0
+            for i in range(1, self.total_parts + 1, 1):
+                part = Part(util.to_long(i), util.to_long(offset), util.to_long(self.partSize), False)
+                offset += self.partSize
+                uploadParts.append(part)
+
+            if self.size % self.partSize != 0:
+                uploadParts[self.total_parts - 1].length = util.to_long(self.size % self.partSize)
+
+        return uploadParts
+
+    def get_init_upload_result(self):
+        return self.obsClient.initiateMultipartUpload(self.bucketName, self.objectKey, metadata=self.metadata,
+                                                      acl=self.headers.acl,
+                                                      storageClass=self.headers.storageClass,
+                                                      websiteRedirectLocation=self.headers.websiteRedirectLocation,
+                                                      contentType=self.headers.contentType,
+                                                      sseHeader=self.headers.sseHeader, expires=self.headers.expires,
+                                                      extensionGrants=self.headers.extensionGrants,
+                                                      extensionHeaders=self.extensionHeaders,
+                                                      encoding_type=self.encoding_type)
+
+    def _prepare(self):
+        fileStatus = [self.size, self.lastModified]
+        if self.checkSum:
+            fileStatus.append(util.base64_encode(util.sha256_file_encode_by_size_offset(self.fileName, self.size, 0)))
+
+        resp = self.get_init_upload_result()
+
+        if resp.status > 300:
+            raise Exception('initiateMultipartUpload failed. ErrorCode:{0}. ErrorMessage:{1}'.format(resp.errorCode,
+                                                                                                     resp.errorMessage))
+        uploadId = resp.body.uploadId
+        self._record["uploadParts"] = self._slice_file()
+        self._record["uploadId"] = uploadId
+        self._record["fileStatus"] = fileStatus
+        self.obsClient.log_client.log(INFO, 'prepare new upload task success. uploadId = {0}'.format(uploadId))
+        if self.enableCheckPoint:
+            self._write_record(self._record)
+
+    @staticmethod
+    def _produce(ThreadPool, upload_parts):
+        for part in upload_parts:
+            ThreadPool.put(part)
+
+    def _consume(self, ThreadPool):
+        while ThreadPool.ok():
+            part = ThreadPool.get()
+            if part is None:
+                break
+            self._upload_part(part)
+
+    def _upload_part(self, part):
+        if not self._is_abort():
+            try:
+                resp = self.get_upload_part_resp(part)
+                if resp.status < 300:
+                    self._record['uploadParts'][part['partNumber'] - 1]['isCompleted'] = True
+                    self._record['partEtags'].append(CompletePart(util.to_int(part['partNumber']), resp.body.etag))
+                    if self.enableCheckPoint:
+                        with self._lock:
+                            self._write_record(self._record)
+                else:
+                    if 300 < resp.status < 500:
+                        self._do_abort('errorCode:{0}, errorMessage:{1}'.format(resp.errorCode, resp.errorMessage))
+                    self.obsClient.log_client.log(
+                        ERROR,
+                        'response from server is something wrong. ErrorCode:{0}, ErrorMessage:{1}'.format(
+                            resp.errorCode, resp.errorMessage))
+            except Exception as e:
+                self.obsClient.log_client.log(DEBUG, 'upload part %s error, %s' % (part['partNumber'], e))
+                self.obsClient.log_client.log(ERROR, traceback.format_exc())
+
+    def get_upload_part_resp(self, part):
+        return self.obsClient._uploadPartWithNotifier(self.bucketName, self.objectKey, part['partNumber'],
+                                                      self._record['uploadId'], self.fileName,
+                                                      isFile=True, partSize=part['length'],
+                                                      offset=part['offset'], notifier=self.notifier,
+                                                      extensionHeaders=self.extensionHeaders,
+                                                      sseHeader=self.headers.sseHeader)
+
+
+class downloadOperation(Operation):
+    def __init__(self, bucketName, objectKey, downloadFile, partSize, taskNum, enableCheckPoint, checkPointFile,
+                 header, versionId, progressCallback, obsClient, imageProcess=None, notifier=progress.NONE_NOTIFIER,
+                 extensionHeaders=None):
+        if enableCheckPoint and not checkPointFile:
+            checkPointFile = downloadFile + '.download_record'
+        super(downloadOperation, self).__init__(bucketName, objectKey, downloadFile, partSize, taskNum,
+                                                enableCheckPoint,
+                                                checkPointFile, progressCallback, obsClient, notifier)
+        self.header = header
+        self.versionId = versionId
+        self.imageProcess = imageProcess
+        self.extensionHeaders = extensionHeaders
+        self._record = {'bucketName': self.bucketName, 'objectKey': self.objectKey, 'versionId': self.versionId,
+                        'downloadFile': self.fileName, 'imageProcess': self.imageProcess}
+
+        parent_dir = os.path.dirname(self.fileName)
+        if not os.path.exists(parent_dir):
+            os.makedirs(parent_dir)
+
+        self._tmp_file = self.fileName + '.tmp'
+        metadata_resp = self.obsClient.getObjectMetadata(self.bucketName, self.objectKey, self.versionId,
+                                                         extensionHeaders=self.extensionHeaders,
+                                                         sseHeader=self.header.sseHeader, origin=self.header.origin,
+                                                         requestHeaders=self.header.requestHeaders)
+        if metadata_resp.status < 300:
+            self.lastModified = metadata_resp.body.lastModified
+            self.size = metadata_resp.body.contentLength \
+                if metadata_resp.body.contentLength is not None and metadata_resp.body.contentLength >= 0 else 0
+        else:
+            if 400 <= metadata_resp.status < 500:
+                self._delete_record()
+                self._delete_tmp_file()
+            self.obsClient.log_client.log(
+                ERROR,
+                'there are something wrong when touch the object {0}. ErrorCode:{1}, ErrorMessage:{2}'.format(
+                    self.objectKey, metadata_resp.errorCode, metadata_resp.errorMessage))
+            raise Exception(
+                'there are something wrong when touch the object {0}. ErrorCode:{1}, ErrorMessage:{2}'.format(
+                    self.objectKey, metadata_resp.status, metadata_resp.errorMessage))
+        self._metadata_resp = metadata_resp
+
+    def _delete_tmp_file(self):
+        if os.path.exists(self._tmp_file):
+            os.remove(self._tmp_file)
+
+    def _do_rename(self):
+        try:
+            modes = stat.S_IWUSR | stat.S_IRUSR
+            flags = os.O_RDWR | os.O_TRUNC | os.O_CREAT
+            with os.fdopen(os.open(self.fileName, flags, modes), 'wb') as wf:
+                with open(self._tmp_file, 'rb') as rf:
+                    while True:
+                        chunk = rf.read(const.READ_ONCE_LENGTH)
+                        if not chunk:
+                            break
+                        wf.write(chunk)
+            if self.enableCheckPoint:
+                self._delete_record()
+            self._delete_tmp_file()
+            return 1
+        except Exception:
+            return 0
+
+    def _download(self):
+        inner_notifier = False
+
+        if self.enableCheckPoint:
+            self._load()
+
+        if "downloadParts" not in self._record:
+            self._prepare()
+
+        sent_bytes, unfinished_down_parts = self._download_prepare()
+
+        try:
+            if len(unfinished_down_parts) > 0:
+                if (self.size - sent_bytes) > 0:
+                    if self.progressCallback is not None:
+                        self.notifier = progress.ProgressNotifier(self.progressCallback, self.size)
+                        inner_notifier = True
+                        self.notifier.start()
+                    self.notifier.send(sent_bytes)
+
+                thread_pools = _ThreadPool(functools.partial(self._produce, download_parts=unfinished_down_parts),
+                                           [self._consume] * self.taskNum)
+                thread_pools.run()
+
+                if self._abort:
+                    self._delete_record()
+                    self._delete_tmp_file()
+                    if self._exception is not None:
+                        raise Exception(self._exception)
+
+                for p in self._record['downloadParts']:
+                    if not p['isCompleted']:
+                        raise Exception('some parts are failed when download. Please try again')
+
+            try:
+                os.rename(self._tmp_file, self.fileName)
+                if self.enableCheckPoint:
+                    self._delete_record()
+                self.obsClient.log_client.log(INFO, 'download success.')
+                return self._metadata_resp
+            except Exception as e:
+                if self._do_rename():
+                    self.obsClient.log_client.log(INFO, 'download success.')
+                    return self._metadata_resp
+                if not self.enableCheckPoint:
+                    self._delete_tmp_file()
+                self.obsClient.log_client.log(
+                    INFO,
+                    'Rename failed. The reason maybe:[the {0} exists, not a file path, not permission]. Please check.')
+                raise e
+        finally:
+            if inner_notifier:
+                self.notifier.end()
+
+    def _download_prepare(self):
+        sent_bytes = 0
+        unfinished_down_parts = []
+        for part in self._record['downloadParts']:
+            if not part['isCompleted']:
+                unfinished_down_parts.append(part)
+            else:
+                sent_bytes += (part['length'] - part['offset']) + 1
+        return sent_bytes, unfinished_down_parts
+
+    def _load(self):
+        self._record = self._get_record()
+        if self._record is not None and not (
+                self._type_record(self._record) and self._check_download_record(self._record)):
+            self._delete_record()
+            self._delete_tmp_file()
+            self._record = None
+        if self._record is None:
+            self._record = {'bucketName': self.bucketName, 'objectKey': self.objectKey, 'versionId': self.versionId,
+                            'downloadFile': self.fileName, 'imageProcess': self.imageProcess}
+
+    def _prepare(self):
+        object_status = [self.objectKey, self.size, self.lastModified, self.versionId, self.imageProcess]
+        modes = stat.S_IWUSR | stat.S_IRUSR
+        flags = os.O_RDWR | os.O_TRUNC | os.O_CREAT
+        with os.fdopen(os.open(_to_unicode(self._tmp_file), flags, modes), 'wb') as f:
+            if self.size > 0:
+                f.seek(self.size - 1, 0)
+            f.write('b' if const.IS_PYTHON2 else 'b'.encode('UTF-8'))
+
+        tmp_file_status = [os.path.getsize(self._tmp_file), os.path.getmtime(self._tmp_file)]
+        self._record["downloadParts"] = self._split_object()
+        self._record["objectStatus"] = object_status
+        self._record["tmpFileStatus"] = tmp_file_status
+        self.obsClient.log_client.log(INFO, 'prepare new download task success.')
+        if self.enableCheckPoint:
+            self._write_record(self._record)
+
+    def _type_record(self, record):
+        try:
+            for key in ('bucketName', 'objectKey', 'versionId', 'downloadFile', 'imageProcess'):
+                if key == 'versionId' and record['versionId'] is None:
+                    continue
+                if key == 'imageProcess' and record['imageProcess'] is None:
+                    continue
+                if not isinstance(record[key], str):
+                    self.obsClient.log_client.log(
+                        ERROR,
+                        '{0} is not a string type. {1} belong to {2}'.format(key, record[key], record[key].__class__)
+                    )
+                    return False
+            if not isinstance(record['downloadParts'], list):
+                self.obsClient.log_client.log(ERROR, 'downloadParts is not a list.It is {0} type'.format(
+                    record['downloadParts'].__class__))
+                return False
+            if not isinstance(record['objectStatus'], list):
+                self.obsClient.log_client.log(ERROR, 'objectStatus is not a list.It is {0} type'.format(
+                    record['objectStatus'].__class__))
+                return False
+            if not isinstance(record['tmpFileStatus'], list):
+                self.obsClient.log_client.log(ERROR, 'tmpFileStatus is not a dict.It is {0} type'.format(
+                    record['tmpFileStatus'].__class__))
+                return False
+        except KeyError as e:
+            self.obsClient.log_client.log(INFO, 'Key is not found:{0}'.format(e.args))
+            return False
+        return True
+
+    def _check_download_record(self, record):
+        if not operator.eq([record['bucketName'], record['objectKey'], record['versionId'], record['downloadFile'],
+                            record['imageProcess']],
+                           [self.bucketName, self.objectKey, self.versionId, self.fileName, self.imageProcess]):
+            return False
+        if not operator.eq(record['objectStatus'],
+                           [self.objectKey, self.size, self.lastModified, self.versionId, self.imageProcess]):
+            return False
+        if record['tmpFileStatus'][0] != self.size:
+            return False
+        return True
+
+    def _split_object(self):
+        downloadParts = []
+        try:
+            num_counts = int(self.size / self.partSize)
+        except ZeroDivisionError:
+            print("You can't divide by 0!")
+        if num_counts >= 10000:
+            self.partSize = int(self.size / 10000) if self.size % 10000 == 0 else int(self.size / 10000) + 1
+            try:
+                num_counts = int(self.size / self.partSize)
+            except ZeroDivisionError:
+                print("You can't divide by 0!")
+        if self.size % self.partSize != 0:
+            num_counts += 1
+        start = 0
+        for i in range(1, num_counts + 1):
+            end = start + util.to_long(self.partSize) if i != num_counts else util.to_long(self.size)
+            part = Part(util.to_long(i), util.to_long(start), end - 1, False)
+            start += self.partSize
+            downloadParts.append(part)
+        return downloadParts
+
+    @staticmethod
+    def _produce(ThreadPool, download_parts):
+        for part in download_parts:
+            ThreadPool.put(part)
+
+    def _consume(self, ThreadPool):
+        while ThreadPool.ok():
+            part = ThreadPool.get()
+            if part is None:
+                break
+            self._download_part(part)
+
+    @staticmethod
+    def _copy_get_object_header(src_header):
+        get_object_header = GetObjectHeader()
+        get_object_header.sseHeader = src_header.sseHeader
+        get_object_header.if_match = src_header.if_match
+        get_object_header.if_none_match = src_header.if_none_match
+        get_object_header.if_modified_since = src_header.if_modified_since
+        get_object_header.if_unmodified_since = src_header.if_unmodified_since
+        return get_object_header
+
+    def _download_part(self, part):
+        get_object_request = GetObjectRequest(versionId=self.versionId, imageProcess=self.imageProcess)
+        get_object_header = self._copy_get_object_header(self.header)
+        get_object_header.range = util.to_string(part['offset']) + '-' + util.to_string(part['length'])
+        if not self._is_abort():
+            # todo 检视 response 的作用与 part_response 的重构
+            response = None
+            try:
+                resp = self.obsClient.getObject(bucketName=self.bucketName, objectKey=self.objectKey,
+                                                getObjectRequest=get_object_request,
+                                                headers=get_object_header, notifier=self.notifier,
+                                                extensionHeaders=self.extensionHeaders)
+                if resp.status < 300:
+                    part_response = resp.body.response
+                    self._download_part_write(part_response, part)
+                    self._record['downloadParts'][part['partNumber'] - 1]['isCompleted'] = True
+                    if self.enableCheckPoint:
+                        with self._lock:
+                            self._write_record(self._record)
+                else:
+                    if 300 < resp.status < 500:
+                        self._do_abort('errorCode:{0}, errorMessage:{1}'.format(resp.errorCode, resp.errorMessage))
+                    self._exception += (
+                        'response from server is something wrong. ErrorCode:{0}, ErrorMessage:{1}\n'.format(
+                            resp.errorCode, resp.errorMessage))
+                    self.obsClient.log_client.log(
+                        ERROR,
+                        'response from server is something wrong. ErrorCode:{0}, ErrorMessage:{1}'.format(
+                            resp.errorCode, resp.errorMessage))
+            except Exception as e:
+                self.obsClient.log_client.log(DEBUG, 'download part %s error, %s' % (part['partNumber'], e))
+                self.obsClient.log_client.log(ERROR, traceback.format_exc())
+            finally:
+                if response is not None:
+                    part_response.close()
+
+    def _download_part_write(self, response, part):
+        chunk_size = const.READ_ONCE_LENGTH
+        if response is not None:
+            with open(_to_unicode(self._tmp_file), 'rb+') as fs:
+                fs.seek(part['offset'], 0)
+                while True:
+                    chunk = response.read(chunk_size)
+                    if not chunk:
+                        break
+                    fs.write(chunk)
+
+
+class Part(BaseModel):
+    allowedAttr = {'partNumber': const.LONG, 'offset': const.LONG, 'length': const.LONG, 'isCompleted': bool}
+
+    def __init__(self, partNumber, offset, length, isCompleted=False):
+        self.partNumber = partNumber
+        self.offset = offset
+        self.length = length
+        self.isCompleted = isCompleted
+
+
+def _parse_string(content):
+    if const.IS_PYTHON2:
+        if isinstance(content, dict):
+            return dict([(_parse_string(key), _parse_string(value)) for key, value in content.items()])
+        elif isinstance(content, list):
+            return [_parse_string(element) for element in content]
+        elif isinstance(content, const.UNICODE):
+            return content.encode('UTF-8')
+    return content
+
+
+def _to_unicode(data):
+    if isinstance(data, bytes):
+        return data.decode('UTF-8')
+    return data
+
+
+class _ThreadPool(object):
+    def __init__(self, producer, consumers):
+        self._producer = producer
+        self._consumers = consumers
+        self._lock = threading.Lock()
+        self._queue = queue.Queue()
+
+        self._threads_consumer = []
+        self._threads_producer = []
+        self._threading_thread = threading.Thread
+        self._exc_info = None
+        self._exc_stack = None
+
+    def run(self):
+        self._add_and_run(self._threading_thread(target=self._producer_start), self._threads_producer)
+        for thread in self._threads_producer:
+            thread.join()
+        for consumer in self._consumers:
+            self._add_and_run(self._threading_thread(target=self._consumer_start, args=(consumer,)),
+                              self._threads_consumer)
+
+        for thread in self._threads_consumer:
+            thread.join()
+
+        if self._exc_info:
+            raise self._exc_info[1]
+
+    def put(self, task):
+        if task is not None:
+            self._queue.put(task)
+
+    def get(self):
+        return self._queue.get()
+
+    def ok(self):
+        with self._lock:
+            return self._exc_info is None
+
+    @staticmethod
+    def _add_and_run(thread, pool):
+        thread.daemon = True
+        thread.start()
+        pool.append(thread)
+
+    def _producer_start(self):
+        try:
+            self._producer(self)
+        except Exception:
+            with self._lock:
+                if self._exc_info is None:
+                    self._exc_info = sys.exc_info()
+                    self._exc_stack = traceback.format_exc()
+        finally:
+            self._put_end()
+
+    def _consumer_start(self, consumer):
+        try:
+            consumer(self)
+        except Exception:
+            with self._lock:
+                if self._exc_info is None:
+                    self._exc_info = sys.exc_info()
+                    self._exc_stack = traceback.format_exc()
+
+    def _put_end(self):
+        length = len(self._consumers)
+        for _ in range(length):
+            self._queue.put(None)
```

### Comparing `esdk-obs-python-3.23.9.1/obs/util.py` & `esdk-obs-python-3.24.3/obs/util.py`

 * *Ordering differences only*

 * *Files 22% similar despite different names*

```diff
@@ -1,432 +1,432 @@
-#!/usr/bin/python
-# -*- coding:utf-8 -*-
-# Copyright 2019 Huawei Technologies Co.,Ltd.
-# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
-# this file except in compliance with the License.  You may obtain a copy of the
-# License at
-
-# http://www.apache.org/licenses/LICENSE-2.0
-
-# Unless required by applicable law or agreed to in writing, software distributed
-# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
-# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
-# specific language governing permissions and limitations under the License.
-
-import base64
-import hashlib
-import json
-import re
-
-from obs import const, progress
-
-if const.IS_PYTHON2:
-    import urllib
-else:
-    import urllib.parse as urllib
-from obs.ilog import INFO, ERROR
-
-
-def to_bool(item):
-    try:
-        return True if item is not None and str(item).lower() == 'true' else False
-    except Exception:
-        return None
-
-
-def to_int(item):
-    try:
-        return int(item)
-    except Exception:
-        return None
-
-
-def to_long(item):
-    try:
-        return const.LONG(item)
-    except Exception:
-        return None
-
-
-def to_float(item):
-    try:
-        return float(item)
-    except Exception:
-        return None
-
-
-def to_string(item):
-    try:
-        return str(item) if item is not None else ''
-    except Exception:
-        return ''
-
-
-def is_valid(item):
-    return item is not None and item.strip() != ''
-
-
-class RequestFormat(object):
-
-    @staticmethod
-    def get_path_format():
-        return PathFormat()
-
-    @staticmethod
-    def get_sub_domain_format():
-        return SubdomainFormat()
-
-    @classmethod
-    def convert_path_string(cls, path_args, allowdNames=None):
-        e = ''
-        if isinstance(path_args, dict):
-            e1 = '?'
-            e2 = '&'
-            for path_key, path_value in path_args.items():
-                flag = True
-                if allowdNames is not None and path_key not in allowdNames:
-                    flag = False
-                if flag:
-                    path_key = encode_item(path_key, '/')
-                    if path_value is None:
-                        e1 += path_key + '&'
-                        continue
-                    e2 += path_key + '=' + encode_item(path_value, '/') + '&'
-            e = (e1 + e2).replace('&&', '&').replace('?&', '?')[:-1]
-        return e
-
-    def get_endpoint(self, server, port, bucket):
-        return
-
-    def get_path_base(self, bucket, key):
-        return
-
-    def get_url(self, bucket, key, path_args):
-        return
-
-
-class PathFormat(RequestFormat):
-
-    @staticmethod
-    def get_server(server, bucket):
-        return server
-
-    def get_path_base(self, bucket, key):
-        if bucket:
-            return '/' + bucket + '/' + encode_object_key(key) if key else '/' + bucket
-        return '/' + encode_object_key(key) if key else '/'
-
-    def get_endpoint(self, server, port, bucket):
-        if port == 80 or port == 443:
-            return server
-        return server + ':' + str(port)
-
-    def get_url(self, bucket, key, path_args):
-        path_base = self.get_path_base(bucket, key)
-        path_arguments = self.convert_path_string(path_args)
-        return path_base + path_arguments
-
-    def get_full_url(self, is_secure, server, port, bucket, key, path_args):
-        url = 'https://' if is_secure else 'http://'
-        url += self.get_endpoint(server, port, bucket)
-        url += self.get_url(bucket, key, path_args)
-        return url
-
-
-class SubdomainFormat(RequestFormat):
-
-    @staticmethod
-    def get_server(server, bucket):
-        return bucket + '.' + server if bucket else server
-
-    def get_path_base(self, bucket, key):
-        if key is None:
-            return '/'
-        return '/' + encode_object_key(key)
-
-    def get_endpoint(self, server, port, bucket):
-        if port == 80 or port == 443:
-            return self.get_server(server, bucket)
-        return self.get_server(server, bucket) + ':' + str(port)
-
-    def get_url(self, bucket, key, path_args):
-        url = self.convert_path_string(path_args)
-        return self.get_path_base(bucket, key) + url
-
-    def get_full_url(self, is_secure, server, port, bucket, key, path_args):
-        url = 'https://' if is_secure else 'http://'
-        url += self.get_endpoint(server, port, bucket)
-        url += self.get_url(bucket, key, path_args)
-        return url
-
-
-class delegate(object):
-    def __init__(self, conn):
-        self.conn = conn
-
-    def send(self, data, final=False, stream_id=None):
-        self.conn.send(data)
-
-
-def conn_delegate(conn):
-    return delegate(conn)
-
-
-def get_readable_entity(readable, chunk_size=const.READ_ONCE_LENGTH, notifier=None, auto_close=True):
-    if notifier is None:
-        notifier = progress.NONE_NOTIFIER
-
-    def entity(conn):
-        try:
-            while True:
-                chunk = readable.read(chunk_size)
-                if not chunk:
-                    conn.send('0\r\n\r\n' if const.IS_PYTHON2 else '0\r\n\r\n'.encode('UTF-8'), final=True)
-                    break
-                newReadCount = len(chunk)
-                if newReadCount > 0:
-                    notifier.send(newReadCount)
-                hex_chunk = hex(len(chunk))[2:]
-                conn.send(hex_chunk if const.IS_PYTHON2 else hex_chunk.encode('UTF-8'))
-                conn.send('\r\n' if const.IS_PYTHON2 else '\r\n'.encode('UTF-8'))
-                conn.send(chunk)
-                conn.send('\r\n' if const.IS_PYTHON2 else '\r\n'.encode('UTF-8'))
-        finally:
-            if hasattr(readable, 'close') and callable(readable.close) and auto_close:
-                readable.close()
-
-    return entity
-
-
-def get_readable_entity_by_total_count(readable, totalCount, chunk_size=const.READ_ONCE_LENGTH, notifier=None,
-                                       auto_close=True):
-    return get_entity_for_send_with_total_count(totalCount=totalCount, chunk_size=chunk_size, notifier=notifier, auto_close=auto_close, read_able=readable)
-
-
-def get_file_entity_by_total_count(file_path, totalCount, chunk_size=const.READ_ONCE_LENGTH, notifier=None):
-    return get_entity_for_send_with_total_count(file_path, totalCount, None, chunk_size, notifier)
-
-
-def get_entity_for_send_with_total_count(file_path=None, totalCount=None, offset=None, chunk_size=const.READ_ONCE_LENGTH,
-                                         notifier=None, auto_close=True, read_able=None):
-    if notifier is None:
-        notifier = progress.NONE_NOTIFIER
-    def entity(conn):
-        readCount = 0
-        if file_path:
-            readable = open(file_path, "rb")
-            if offset:
-                readable.seek(offset)
-        else:
-            readable = read_able
-        try:
-            while True:
-                if totalCount is None or totalCount - readCount >= chunk_size:
-                    readCountOnce = chunk_size
-                else:
-                    readCountOnce = totalCount - readCount
-                chunk = readable.read(readCountOnce)
-                newReadCount = len(chunk)
-                if newReadCount > 0:
-                    notifier.send(newReadCount)
-                readCount += newReadCount
-                if (totalCount is not None and readCount >= totalCount) or (totalCount is not None and not chunk):
-                    conn.send(chunk, final=True)
-                    break
-                conn.send(chunk)
-        finally:
-            if hasattr(readable, 'close') and callable(readable.close) and auto_close:
-                readable.close()
-
-    return entity
-
-
-def get_file_entity_by_offset_partsize(file_path, offset, totalCount, chunk_size=const.READ_ONCE_LENGTH, notifier=None):
-    return get_entity_for_send_with_total_count(file_path, totalCount, offset, chunk_size, notifier)
-
-
-def is_ipaddress(item):
-    return re.match(const.IPv4_REGEX, item)
-
-
-def md5_encode(unencoded):
-    m = hashlib.md5()
-    unencoded = unencoded if const.IS_PYTHON2 else (
-        unencoded.encode('UTF-8') if not isinstance(unencoded, bytes) else unencoded)
-    m.update(unencoded)
-    return m.digest()
-
-
-def covert_string_to_bytes(str_object):
-    if not const.IS_PYTHON2:
-        if isinstance(str_object, str):
-            return str_object.encode("UTF-8")
-    return str_object
-
-
-def base64_encode(unencoded):
-    unencoded = unencoded if const.IS_PYTHON2 else (
-        unencoded.encode('UTF-8') if not isinstance(unencoded, bytes) else unencoded)
-    encode_str = base64.b64encode(unencoded, altchars=None)
-    return encode_str if const.IS_PYTHON2 else encode_str.decode('UTF-8')
-
-
-def encode_object_key(key):
-    return encode_item(key, '/~')
-
-
-def encode_item(item, safe='/'):
-    return urllib.quote(to_string(item), safe)
-
-
-def decode_item(item):
-    return urllib.unquote(item)
-
-
-def safe_trans_to_utf8(item):
-    if not const.IS_PYTHON2:
-        return item
-    if item is not None:
-        item = safe_encode(item)
-        try:
-            return item.decode('GB2312').encode('UTF-8')
-        except Exception:
-            return item
-    return None
-
-
-def safe_trans_to_gb2312(item):
-    if not const.IS_PYTHON2:
-        return item
-    if item is not None:
-        item = safe_encode(item)
-        try:
-            return item.decode('UTF-8').encode('GB2312')
-        except Exception:
-            return item
-    return None
-
-
-def safe_decode(item):
-    if not const.IS_PYTHON2:
-        return item
-    if isinstance(item, str):
-        try:
-            item = item.decode('UTF-8')
-        except Exception:
-            try:
-                item = item.decode('GB2312')
-            except Exception:
-                item = None
-    return item
-
-
-def safe_encode(item):
-    if not const.IS_PYTHON2:
-        return item
-    if isinstance(item, const.UNICODE):
-        try:
-            item = item.encode('UTF-8')
-        except UnicodeDecodeError:
-            try:
-                item = item.encode('GB2312')
-            except Exception:
-                item = None
-    return item
-
-
-def md5_file_encode_by_size_offset(file_path=None, size=None, offset=None, chuckSize=None):
-    if file_path is not None and size is not None and offset is not None:
-        m = hashlib.md5()
-        with open(file_path, 'rb') as fp:
-            CHUNK_SIZE = const.READ_ONCE_LENGTH if chuckSize is None else chuckSize
-            fp.seek(offset)
-            read_count = 0
-            while read_count < size:
-                read_size = CHUNK_SIZE if size - read_count >= CHUNK_SIZE else size - read_count
-                data = fp.read(read_size)
-                read_count_once = len(data)
-                if read_count_once <= 0:
-                    break
-                m.update(data)
-                read_count += read_count_once
-        return m.digest()
-
-def sha256_file_encode_by_size_offset(file_path=None, size=None, offset=None, chuckSize=None):
-    if file_path is not None and size is not None and offset is not None:
-        m = hashlib.sha256()
-        with open(file_path, 'rb') as fp:
-            CHUNK_SIZE = const.READ_ONCE_LENGTH if chuckSize is None else chuckSize
-            fp.seek(offset)
-            read_count = 0
-            while read_count < size:
-                read_size = CHUNK_SIZE if size - read_count >= CHUNK_SIZE else size - read_count
-                data = fp.read(read_size)
-                read_count_once = len(data)
-                if read_count_once <= 0:
-                    break
-                m.update(data)
-                read_count += read_count_once
-        return m.digest()
-
-
-def do_close(result, conn, connHolder, log_client=None):
-    if not result:
-        close_conn(conn, log_client)
-    elif result.getheader('connection', '').lower() == 'close':
-        if log_client:
-            log_client.log(INFO, 'server inform to close connection')
-        close_conn(conn, log_client)
-    elif to_int(result.status) >= 500 or connHolder is None:
-        close_conn(conn, log_client)
-    elif hasattr(conn, '_clear') and conn._clear:
-        close_conn(conn, log_client)
-    else:
-        if connHolder is not None:
-            try:
-                connHolder['connSet'].put_nowait(conn)
-            except Exception:
-                close_conn(conn, log_client)
-
-
-def close_conn(conn, log_client=None):
-    try:
-        if conn:
-            conn.close()
-    except Exception as ex:
-        if log_client:
-            log_client.log(ERROR, ex)
-
-
-SKIP_VERIFY_ATTR_TYPE = False
-
-
-def verify_attr_type(value, allowedAttrType):
-    if SKIP_VERIFY_ATTR_TYPE:
-        return True
-    if isinstance(allowedAttrType, list):
-        for t in allowedAttrType:
-            if isinstance(value, t):
-                return True
-        return False
-    return isinstance(value, allowedAttrType)
-
-
-def lazyCallback(*args, **kwargs):
-    pass
-
-
-def jsonLoadsForPy2(json_text):
-    return _byteify(json.loads(json_text, object_hook=_byteify), ignore_dicts=True)
-
-
-def _byteify(data, ignore_dicts=False):
-    if isinstance(data, const.UNICODE):
-        return data.encode('utf-8')
-    if isinstance(data, list):
-        return [_byteify(item, ignore_dicts=True) for item in data]
-    if isinstance(data, dict) and not ignore_dicts:
-        return {
-            _byteify(key, ignore_dicts=True): _byteify(value, ignore_dicts=True)
-            for key, value in data.iteritems()
-        }
-    return data
+#!/usr/bin/python
+# -*- coding:utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+import base64
+import hashlib
+import json
+import re
+
+from obs import const, progress
+
+if const.IS_PYTHON2:
+    import urllib
+else:
+    import urllib.parse as urllib
+from obs.ilog import INFO, ERROR
+
+
+def to_bool(item):
+    try:
+        return True if item is not None and str(item).lower() == 'true' else False
+    except Exception:
+        return None
+
+
+def to_int(item):
+    try:
+        return int(item)
+    except Exception:
+        return None
+
+
+def to_long(item):
+    try:
+        return const.LONG(item)
+    except Exception:
+        return None
+
+
+def to_float(item):
+    try:
+        return float(item)
+    except Exception:
+        return None
+
+
+def to_string(item):
+    try:
+        return str(item) if item is not None else ''
+    except Exception:
+        return ''
+
+
+def is_valid(item):
+    return item is not None and item.strip() != ''
+
+
+class RequestFormat(object):
+
+    @staticmethod
+    def get_path_format():
+        return PathFormat()
+
+    @staticmethod
+    def get_sub_domain_format():
+        return SubdomainFormat()
+
+    @classmethod
+    def convert_path_string(cls, path_args, allowdNames=None):
+        e = ''
+        if isinstance(path_args, dict):
+            e1 = '?'
+            e2 = '&'
+            for path_key, path_value in path_args.items():
+                flag = True
+                if allowdNames is not None and path_key not in allowdNames:
+                    flag = False
+                if flag:
+                    path_key = encode_item(path_key, '/')
+                    if path_value is None:
+                        e1 += path_key + '&'
+                        continue
+                    e2 += path_key + '=' + encode_item(path_value, '/') + '&'
+            e = (e1 + e2).replace('&&', '&').replace('?&', '?')[:-1]
+        return e
+
+    def get_endpoint(self, server, port, bucket):
+        return
+
+    def get_path_base(self, bucket, key):
+        return
+
+    def get_url(self, bucket, key, path_args):
+        return
+
+
+class PathFormat(RequestFormat):
+
+    @staticmethod
+    def get_server(server, bucket):
+        return server
+
+    def get_path_base(self, bucket, key):
+        if bucket:
+            return '/' + bucket + '/' + encode_object_key(key) if key else '/' + bucket
+        return '/' + encode_object_key(key) if key else '/'
+
+    def get_endpoint(self, server, port, bucket):
+        if port == 80 or port == 443:
+            return server
+        return server + ':' + str(port)
+
+    def get_url(self, bucket, key, path_args):
+        path_base = self.get_path_base(bucket, key)
+        path_arguments = self.convert_path_string(path_args)
+        return path_base + path_arguments
+
+    def get_full_url(self, is_secure, server, port, bucket, key, path_args):
+        url = 'https://' if is_secure else 'http://'
+        url += self.get_endpoint(server, port, bucket)
+        url += self.get_url(bucket, key, path_args)
+        return url
+
+
+class SubdomainFormat(RequestFormat):
+
+    @staticmethod
+    def get_server(server, bucket):
+        return bucket + '.' + server if bucket else server
+
+    def get_path_base(self, bucket, key):
+        if key is None:
+            return '/'
+        return '/' + encode_object_key(key)
+
+    def get_endpoint(self, server, port, bucket):
+        if port == 80 or port == 443:
+            return self.get_server(server, bucket)
+        return self.get_server(server, bucket) + ':' + str(port)
+
+    def get_url(self, bucket, key, path_args):
+        url = self.convert_path_string(path_args)
+        return self.get_path_base(bucket, key) + url
+
+    def get_full_url(self, is_secure, server, port, bucket, key, path_args):
+        url = 'https://' if is_secure else 'http://'
+        url += self.get_endpoint(server, port, bucket)
+        url += self.get_url(bucket, key, path_args)
+        return url
+
+
+class delegate(object):
+    def __init__(self, conn):
+        self.conn = conn
+
+    def send(self, data, final=False, stream_id=None):
+        self.conn.send(data)
+
+
+def conn_delegate(conn):
+    return delegate(conn)
+
+
+def get_readable_entity(readable, chunk_size=const.READ_ONCE_LENGTH, notifier=None, auto_close=True):
+    if notifier is None:
+        notifier = progress.NONE_NOTIFIER
+
+    def entity(conn):
+        try:
+            while True:
+                chunk = readable.read(chunk_size)
+                if not chunk:
+                    conn.send('0\r\n\r\n' if const.IS_PYTHON2 else '0\r\n\r\n'.encode('UTF-8'), final=True)
+                    break
+                newReadCount = len(chunk)
+                if newReadCount > 0:
+                    notifier.send(newReadCount)
+                hex_chunk = hex(len(chunk))[2:]
+                conn.send(hex_chunk if const.IS_PYTHON2 else hex_chunk.encode('UTF-8'))
+                conn.send('\r\n' if const.IS_PYTHON2 else '\r\n'.encode('UTF-8'))
+                conn.send(chunk)
+                conn.send('\r\n' if const.IS_PYTHON2 else '\r\n'.encode('UTF-8'))
+        finally:
+            if hasattr(readable, 'close') and callable(readable.close) and auto_close:
+                readable.close()
+
+    return entity
+
+
+def get_readable_entity_by_total_count(readable, totalCount, chunk_size=const.READ_ONCE_LENGTH, notifier=None,
+                                       auto_close=True):
+    return get_entity_for_send_with_total_count(totalCount=totalCount, chunk_size=chunk_size, notifier=notifier, auto_close=auto_close, read_able=readable)
+
+
+def get_file_entity_by_total_count(file_path, totalCount, chunk_size=const.READ_ONCE_LENGTH, notifier=None):
+    return get_entity_for_send_with_total_count(file_path, totalCount, None, chunk_size, notifier)
+
+
+def get_entity_for_send_with_total_count(file_path=None, totalCount=None, offset=None, chunk_size=const.READ_ONCE_LENGTH,
+                                         notifier=None, auto_close=True, read_able=None):
+    if notifier is None:
+        notifier = progress.NONE_NOTIFIER
+    def entity(conn):
+        readCount = 0
+        if file_path:
+            readable = open(file_path, "rb")
+            if offset:
+                readable.seek(offset)
+        else:
+            readable = read_able
+        try:
+            while True:
+                if totalCount is None or totalCount - readCount >= chunk_size:
+                    readCountOnce = chunk_size
+                else:
+                    readCountOnce = totalCount - readCount
+                chunk = readable.read(readCountOnce)
+                newReadCount = len(chunk)
+                if newReadCount > 0:
+                    notifier.send(newReadCount)
+                readCount += newReadCount
+                if (totalCount is not None and readCount >= totalCount) or (totalCount is not None and not chunk):
+                    conn.send(chunk, final=True)
+                    break
+                conn.send(chunk)
+        finally:
+            if hasattr(readable, 'close') and callable(readable.close) and auto_close:
+                readable.close()
+
+    return entity
+
+
+def get_file_entity_by_offset_partsize(file_path, offset, totalCount, chunk_size=const.READ_ONCE_LENGTH, notifier=None):
+    return get_entity_for_send_with_total_count(file_path, totalCount, offset, chunk_size, notifier)
+
+
+def is_ipaddress(item):
+    return re.match(const.IPv4_REGEX, item)
+
+
+def md5_encode(unencoded):
+    m = hashlib.md5()
+    unencoded = unencoded if const.IS_PYTHON2 else (
+        unencoded.encode('UTF-8') if not isinstance(unencoded, bytes) else unencoded)
+    m.update(unencoded)
+    return m.digest()
+
+
+def covert_string_to_bytes(str_object):
+    if not const.IS_PYTHON2:
+        if isinstance(str_object, str):
+            return str_object.encode("UTF-8")
+    return str_object
+
+
+def base64_encode(unencoded):
+    unencoded = unencoded if const.IS_PYTHON2 else (
+        unencoded.encode('UTF-8') if not isinstance(unencoded, bytes) else unencoded)
+    encode_str = base64.b64encode(unencoded, altchars=None)
+    return encode_str if const.IS_PYTHON2 else encode_str.decode('UTF-8')
+
+
+def encode_object_key(key):
+    return encode_item(key, '/~')
+
+
+def encode_item(item, safe='/'):
+    return urllib.quote(to_string(item), safe)
+
+
+def decode_item(item):
+    return urllib.unquote(item)
+
+
+def safe_trans_to_utf8(item):
+    if not const.IS_PYTHON2:
+        return item
+    if item is not None:
+        item = safe_encode(item)
+        try:
+            return item.decode('GB2312').encode('UTF-8')
+        except Exception:
+            return item
+    return None
+
+
+def safe_trans_to_gb2312(item):
+    if not const.IS_PYTHON2:
+        return item
+    if item is not None:
+        item = safe_encode(item)
+        try:
+            return item.decode('UTF-8').encode('GB2312')
+        except Exception:
+            return item
+    return None
+
+
+def safe_decode(item):
+    if not const.IS_PYTHON2:
+        return item
+    if isinstance(item, str):
+        try:
+            item = item.decode('UTF-8')
+        except Exception:
+            try:
+                item = item.decode('GB2312')
+            except Exception:
+                item = None
+    return item
+
+
+def safe_encode(item):
+    if not const.IS_PYTHON2:
+        return item
+    if isinstance(item, const.UNICODE):
+        try:
+            item = item.encode('UTF-8')
+        except UnicodeDecodeError:
+            try:
+                item = item.encode('GB2312')
+            except Exception:
+                item = None
+    return item
+
+
+def md5_file_encode_by_size_offset(file_path=None, size=None, offset=None, chuckSize=None):
+    if file_path is not None and size is not None and offset is not None:
+        m = hashlib.md5()
+        with open(file_path, 'rb') as fp:
+            CHUNK_SIZE = const.READ_ONCE_LENGTH if chuckSize is None else chuckSize
+            fp.seek(offset)
+            read_count = 0
+            while read_count < size:
+                read_size = CHUNK_SIZE if size - read_count >= CHUNK_SIZE else size - read_count
+                data = fp.read(read_size)
+                read_count_once = len(data)
+                if read_count_once <= 0:
+                    break
+                m.update(data)
+                read_count += read_count_once
+        return m.digest()
+
+def sha256_file_encode_by_size_offset(file_path=None, size=None, offset=None, chuckSize=None):
+    if file_path is not None and size is not None and offset is not None:
+        m = hashlib.sha256()
+        with open(file_path, 'rb') as fp:
+            CHUNK_SIZE = const.READ_ONCE_LENGTH if chuckSize is None else chuckSize
+            fp.seek(offset)
+            read_count = 0
+            while read_count < size:
+                read_size = CHUNK_SIZE if size - read_count >= CHUNK_SIZE else size - read_count
+                data = fp.read(read_size)
+                read_count_once = len(data)
+                if read_count_once <= 0:
+                    break
+                m.update(data)
+                read_count += read_count_once
+        return m.digest()
+
+
+def do_close(result, conn, connHolder, log_client=None):
+    if not result:
+        close_conn(conn, log_client)
+    elif result.getheader('connection', '').lower() == 'close':
+        if log_client:
+            log_client.log(INFO, 'server inform to close connection')
+        close_conn(conn, log_client)
+    elif to_int(result.status) >= 500 or connHolder is None:
+        close_conn(conn, log_client)
+    elif hasattr(conn, '_clear') and conn._clear:
+        close_conn(conn, log_client)
+    else:
+        if connHolder is not None:
+            try:
+                connHolder['connSet'].put_nowait(conn)
+            except Exception:
+                close_conn(conn, log_client)
+
+
+def close_conn(conn, log_client=None):
+    try:
+        if conn:
+            conn.close()
+    except Exception as ex:
+        if log_client:
+            log_client.log(ERROR, ex)
+
+
+SKIP_VERIFY_ATTR_TYPE = False
+
+
+def verify_attr_type(value, allowedAttrType):
+    if SKIP_VERIFY_ATTR_TYPE:
+        return True
+    if isinstance(allowedAttrType, list):
+        for t in allowedAttrType:
+            if isinstance(value, t):
+                return True
+        return False
+    return isinstance(value, allowedAttrType)
+
+
+def lazyCallback(*args, **kwargs):
+    pass
+
+
+def jsonLoadsForPy2(json_text):
+    return _byteify(json.loads(json_text, object_hook=_byteify), ignore_dicts=True)
+
+
+def _byteify(data, ignore_dicts=False):
+    if isinstance(data, const.UNICODE):
+        return data.encode('utf-8')
+    if isinstance(data, list):
+        return [_byteify(item, ignore_dicts=True) for item in data]
+    if isinstance(data, dict) and not ignore_dicts:
+        return {
+            _byteify(key, ignore_dicts=True): _byteify(value, ignore_dicts=True)
+            for key, value in data.iteritems()
+        }
+    return data
```

### Comparing `esdk-obs-python-3.23.9.1/obs/workflow.py` & `esdk-obs-python-3.24.3/obs/workflow.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,423 +1,424 @@
-# -*- coding:utf-8 -*-
-# Copyright 2019 Huawei Technologies Co.,Ltd.
-# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
-# this file except in compliance with the License.  You may obtain a copy of the
-# License at
-
-# http://www.apache.org/licenses/LICENSE-2.0
-
-# Unless required by applicable law or agreed to in writing, software distributed
-# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
-# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
-# specific language governing permissions and limitations under the License.
-
-
-from __future__ import absolute_import
-import traceback
-import threading
-import functools
-import json
-import time
-from obs import const
-from obs.client import _BasicClient
-from obs.ilog import INFO
-from obs.util import jsonLoadsForPy2
-
-
-def combine(*args):
-    return '/'.join(args)
-
-
-def prepareHeader():
-    return {const.CONTENT_TYPE_HEADER: const.MIME_TYPES.get('json')}
-
-
-def prepareJson(kwargs, pop=None):
-    kwargs.pop('self')
-    if bool(kwargs):
-        if bool(pop):
-            for p in list(pop):
-                kwargs.pop(p)
-        if not bool(kwargs):
-            return None
-        return json.dumps(kwargs, ensure_ascii=False)
-    else:
-        return None
-
-
-def _resultFilter(result, executionState):
-    for e in result[::-1]:
-        if e.get('execution_state') != executionState:
-            result.remove(e)
-    return result
-
-
-def _listWorkflowExecutionMethodName(isJsonResult, defaultMethodName):
-    return 'ListWorkflowExecutionResponse' if not isJsonResult else defaultMethodName
-
-
-def _listWorkflowExecutionCount(isJsonResult, body):
-    return body.count if not isJsonResult else body.get('count')
-
-
-def _listWorkflowExecutionBody(isJsonResult, isPy2, body):
-    if isJsonResult:
-        body = jsonLoadsForPy2(body) if isPy2 else json.loads(body)
-    return body
-
-
-def _listWorkflowExecutionResult(isJsonResult, body):
-    return list(body.executions) if not isJsonResult else list(body.get('executions'))
-
-
-def _listWorkflowExecutionIsTruncated(isJsonResult, body):
-    return body.isTruncated if not isJsonResult else body.get('is_truncated')
-
-
-def _listWorkflowExecutionNextMarker(isTruncated, isJsonResult, body):
-    if isTruncated:
-        nextMarker = body.nextMarker if not isJsonResult else body.get('next_marker')
-    else:
-        nextMarker = None
-    return nextMarker
-
-
-def _listWorkflowExecutionPathArgs(graphName, nextMarker, limit, executionType):
-    pathArgs = {'x-workflow-graph-name': graphName}
-    if nextMarker:
-        pathArgs['x-workflow-next-marker'] = nextMarker
-    if limit:
-        if limit > 1000:
-            raise Exception('Invalid parameter: limit')
-        pathArgs['x-workflow-limit'] = limit
-    if executionType:
-        pathArgs['x-workflow-execution-type'] = executionType
-    return pathArgs
-
-
-def _listWorkflowExecutionResp(isJsonResult, resp, result, isTruncated, nextMarker):
-    if isJsonResult:
-        resp.body = {
-            'count': len(result),
-            'is_truncated': isTruncated,
-            'executions': result
-        }
-        if isTruncated:
-            resp.body['next_marker'] = nextMarker
-        else:
-            if resp.body.get('next_marker') is not None:
-                del resp.body['next_marker']
-        resp.body = json.dumps(resp.body)
-    else:
-        resp.body.count = len(result)
-        resp.body.executions = result
-        resp.body.isTruncated = isTruncated
-        if isTruncated:
-            resp.body.nextMarker = nextMarker
-        else:
-            if resp.body.nextMarker is not None:
-                del resp.body.nextMarker
-
-    return resp
-
-
-def entrance(func):
-    @functools.wraps(func)
-    def wrapper(*args, **kwargs):
-        start = time.time()
-        workflowClient = args[0] if isinstance(args[0], WorkflowClient) else None
-        try:
-            return func(*args, **kwargs)
-        except Exception as e:
-            if workflowClient:
-                workflowClient.log_client.log(INFO, traceback.format_exc())
-            raise e
-        finally:
-            if workflowClient:
-                workflowClient.log_client.log(INFO,
-                                              '%s cost %s ms' % (func.__name__, int((time.time() - start) * 1000)))
-
-    return wrapper
-
-
-class WorkflowClient(_BasicClient):
-    _instance_lock = threading.Lock()
-    _instance = None
-
-    def __new__(cls, *args, **kwargs):
-        if cls._instance is None:
-            with cls._instance_lock:
-                if cls._instance is None:
-                    cls._instance = object.__new__(cls)
-        return cls._instance
-
-    def __init__(self, isJsonResult=False, *args, **kwargs):
-        if kwargs.get('path_style') or kwargs.get('is_signature_negotiation'):
-            raise Exception('Path style or signature negotiation does not support custom settings for workflow client.')
-        super(WorkflowClient, self).__init__(client_mode='workflow', *args, **kwargs)
-        self.__resource = 'v2/'
-        self.__isJsonResult = isJsonResult
-        self.__defaultMethodName = 'GetJsonResponse'
-
-    # begin workflow api
-    # begin workflow api
-    # begin workflow api
-
-    @entrance
-    def createWorkflowTemplate(self, templateName, description=None, states=None, inputs=None, tags=None):
-        return self._make_post_request(
-            entity=prepareJson(locals(), ['templateName']),
-            bucketName=None,
-            objectKey=self.__resource + combine(const.WORKFLOW_TEMPLATES, templateName),
-            headers=prepareHeader(),
-            methodName='CreateWorkflowTemplateResponse' if not self.__isJsonResult else self.__defaultMethodName
-        )
-
-    @entrance
-    def getWorkflowTemplate(self, templateName):
-        return self._make_get_request(
-            bucketName=None,
-            objectKey=self.__resource + combine(const.WORKFLOW_TEMPLATES, templateName),
-            headers=prepareHeader(),
-            methodName='GetWorkflowTemplateResponse' if not self.__isJsonResult else self.__defaultMethodName
-        )
-
-    @entrance
-    def deleteWorkflowTemplate(self, templateName):
-        return self._make_delete_request(
-            bucketName=None,
-            objectKey=self.__resource + combine(const.WORKFLOW_TEMPLATES, templateName),
-            headers=prepareHeader(),
-            methodName=self.__defaultMethodName
-        )
-
-    @entrance
-    def listWorkflowTemplate(self, templateNamePrefix=None, start=None, limit=None):
-        pathArgs = {'x-workflow-prefix': None}
-        if start:
-            pathArgs['x-workflow-start'] = start
-        if limit:
-            pathArgs['x-workflow-limit'] = limit
-
-        return self._make_get_request(
-            bucketName=None,
-            objectKey=self.__resource + combine(const.WORKFLOW_TEMPLATES,
-                                                templateNamePrefix if templateNamePrefix is not None else ''),
-            pathArgs=pathArgs,
-            headers=prepareHeader(),
-            methodName='ListWorkflowTemplateResponse' if not self.__isJsonResult else self.__defaultMethodName
-        )
-
-    @entrance
-    def createWorkflow(self, templateName, graphName, agency, description=None, parameters=None):
-        return self._make_post_request(
-            entity=prepareJson(locals(), ['templateName', 'graphName']),
-            bucketName=None,
-            objectKey=self.__resource + combine(const.WORKFLOWS, graphName),
-            pathArgs={'x-workflow-template-name': templateName},
-            headers=prepareHeader(),
-            methodName='CreateWorkflowResponse' if not self.__isJsonResult else self.__defaultMethodName
-        )
-
-    @entrance
-    def getWorkflow(self, graphName):
-        return self._make_get_request(
-            bucketName=None,
-            objectKey=self.__resource + combine(const.WORKFLOWS, graphName),
-            headers=prepareHeader(),
-            methodName='GetWorkflowResponse' if not self.__isJsonResult else self.__defaultMethodName
-        )
-
-    @entrance
-    def deleteWorkflow(self, graphName):
-        return self._make_delete_request(
-            bucketName=None,
-            objectKey=self.__resource + combine(const.WORKFLOWS, graphName),
-            headers=prepareHeader(),
-            methodName=self.__defaultMethodName
-        )
-
-    @entrance
-    def updateWorkflow(self, graphName, parameters=None, description=None):
-        return self._make_put_request(
-            entity=prepareJson(locals(), ['graphName']),
-            bucketName=None,
-            objectKey=self.__resource + combine(const.WORKFLOWS, graphName),
-            headers=prepareHeader(),
-            methodName='UpdateWorkflowResponse' if not self.__isJsonResult else self.__defaultMethodName
-        )
-
-    @entrance
-    def listWorkflow(self, graphNamePrefix=None, start=None, limit=None):
-        pathArgs = {'x-workflow-prefix': None}
-        if start:
-            pathArgs['x-workflow-start'] = start
-        if limit:
-            pathArgs['x-workflow-limit'] = limit
-
-        return self._make_get_request(
-            bucketName=None,
-            objectKey=self.__resource + combine(const.WORKFLOWS,
-                                                graphNamePrefix if graphNamePrefix is not None else ''),
-            pathArgs=pathArgs,
-            headers=prepareHeader(),
-            methodName='ListWorkflowResponse' if not self.__isJsonResult else self.__defaultMethodName
-        )
-
-    @entrance
-    def asyncAPIStartWorkflow(self, graphName, bucket, object, inputs=None):
-        return self._make_post_request(
-            entity=prepareJson(locals(), ['graphName']),
-            bucketName=None,
-            objectKey=self.__resource + combine(const.WORKFLOWS, graphName),
-            headers=prepareHeader(),
-            methodName='AsyncAPIStartWorkflowResponse' if not self.__isJsonResult else self.__defaultMethodName
-        )
-
-    @entrance
-    def listWorkflowExecution(self, graphName, executionType=None, nextMarker=None, limit=None, executionState=None):
-        pathArgs = _listWorkflowExecutionPathArgs(graphName, nextMarker, limit, executionType)
-        if executionState:
-            if executionState not in ['RUNNING', 'SUCCESS', 'FAILED']:
-                raise Exception('Invalid parameter: execution state')
-
-            resp = self._make_get_request(
-                bucketName=None,
-                objectKey=self.__resource + const.WORKFLOW_EXECUTIONS,
-                pathArgs=pathArgs,
-                headers=prepareHeader(),
-                methodName=_listWorkflowExecutionMethodName(self.__isJsonResult, self.__defaultMethodName)
-            )
-            if resp.status > 300:
-                return resp
-
-            body = _listWorkflowExecutionBody(self.__isJsonResult, const.IS_PYTHON2, resp.body)
-
-            count = _listWorkflowExecutionCount(self.__isJsonResult, body)
-
-            if count == 0:
-                return resp
-
-            result = _listWorkflowExecutionResult(self.__isJsonResult, body)
-            isTruncated = _listWorkflowExecutionIsTruncated(self.__isJsonResult, body)
-            nextMarker = _listWorkflowExecutionNextMarker(isTruncated, self.__isJsonResult, body)
-
-            result = _resultFilter(result, executionState)
-
-            if len(result) == limit:
-                return resp
-            else:
-                while len(result) < limit and isTruncated:
-                    pathArgs['x-workflow-next-marker'] = nextMarker
-                    tempResp = self._make_get_request(
-                        bucketName=None,
-                        objectKey=self.__resource + const.WORKFLOW_EXECUTIONS,
-                        pathArgs=pathArgs,
-                        headers=prepareHeader(),
-                        methodName=_listWorkflowExecutionMethodName(self.__isJsonResult, self.__defaultMethodName)
-                    )
-                    if tempResp.status > 300:
-                        return tempResp
-
-                    body = _listWorkflowExecutionBody(self.__isJsonResult, const.IS_PYTHON2, tempResp.body)
-
-                    count = _listWorkflowExecutionCount(self.__isJsonResult, body)
-                    if count == 0:
-                        return tempResp
-
-                    tempResult = _listWorkflowExecutionResult(self.__isJsonResult, body)
-
-                    tempResult = _resultFilter(tempResult, executionState)
-
-                    result.extend(tempResult)
-
-                    if len(result) > limit:
-                        result = result[0:limit]
-
-                    isTruncated = _listWorkflowExecutionIsTruncated(self.__isJsonResult, body)
-                    nextMarker = _listWorkflowExecutionNextMarker(isTruncated, self.__isJsonResult, body)
-
-            return _listWorkflowExecutionResp(self.__isJsonResult, resp, result, isTruncated, nextMarker)
-        else:
-            return self._make_get_request(
-                bucketName=None,
-                objectKey=self.__resource + const.WORKFLOW_EXECUTIONS,
-                pathArgs=pathArgs,
-                headers=prepareHeader(),
-                methodName=_listWorkflowExecutionMethodName(self.__isJsonResult, self.__defaultMethodName)
-            )
-
-    @entrance
-    def getWorkflowExecution(self, executionName, graphName):
-        pathArgs = {
-            'x-workflow-graph-name': graphName
-        }
-
-        return self._make_get_request(
-            bucketName=None,
-            objectKey=self.__resource + combine(const.WORKFLOW_EXECUTIONS, executionName),
-            pathArgs=pathArgs,
-            headers=prepareHeader(),
-            methodName='GetWorkflowExecutionResponse' if not self.__isJsonResult else self.__defaultMethodName
-        )
-
-    @entrance
-    def restoreFailedWorkflowExecution(self, executionName, graphName):
-        pathArgs = {
-            'x-workflow-graph-name': graphName
-        }
-
-        return self._make_put_request(
-            bucketName=None,
-            objectKey=self.__resource + combine(const.WORKFLOW_EXECUTIONS, executionName),
-            pathArgs=pathArgs,
-            headers=prepareHeader(),
-            methodName='RestoreFailedWorkflowExecutionResponse' if not self.__isJsonResult else self.__defaultMethodName
-        )
-
-    @entrance
-    def putTriggerPolicy(self, bucketName, rules):
-        pathArgs = {
-            const.WORKFLOW_TRIGGERPOLICY: None
-        }
-
-        return self._make_put_request(
-            entity=prepareJson(locals(), ['bucketName']),
-            bucketName=bucketName,
-            objectKey=None,
-            pathArgs=pathArgs,
-            headers=prepareHeader(),
-            methodName=self.__defaultMethodName
-        )
-
-    @entrance
-    def getTriggerPolicy(self, bucketName):
-        pathArgs = {
-            const.WORKFLOW_TRIGGERPOLICY: None
-        }
-
-        return self._make_get_request(
-            bucketName=bucketName,
-            objectKey=None,
-            pathArgs=pathArgs,
-            headers=prepareHeader(),
-            methodName='GetTriggerPolicyResponse' if not self.__isJsonResult else self.__defaultMethodName
-        )
-
-    @entrance
-    def deleteTriggerPolicy(self, bucketName):
-        pathArgs = {
-            const.WORKFLOW_TRIGGERPOLICY: None
-        }
-
-        return self._make_delete_request(
-            bucketName=bucketName,
-            objectKey=None,
-            pathArgs=pathArgs,
-            headers=prepareHeader(),
-            methodName=self.__defaultMethodName
-        )
-
-    # end workflow api
-    # end workflow api
-    # end workflow api
+#!/usr/bin/python
+# -*- coding:utf-8 -*-
+# Copyright 2019 Huawei Technologies Co.,Ltd.
+# Licensed under the Apache License, Version 2.0 (the "License"); you may not use
+# this file except in compliance with the License.  You may obtain a copy of the
+# License at
+
+# http://www.apache.org/licenses/LICENSE-2.0
+
+# Unless required by applicable law or agreed to in writing, software distributed
+# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
+# CONDITIONS OF ANY KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations under the License.
+
+
+from __future__ import absolute_import
+import traceback
+import threading
+import functools
+import json
+import time
+from obs import const
+from obs.client import _BasicClient
+from obs.ilog import INFO
+from obs.util import jsonLoadsForPy2
+
+
+def combine(*args):
+    return '/'.join(args)
+
+
+def prepareHeader():
+    return {const.CONTENT_TYPE_HEADER: const.MIME_TYPES.get('json')}
+
+
+def prepareJson(kwargs, pop=None):
+    kwargs.pop('self')
+    if bool(kwargs):
+        if bool(pop):
+            for p in list(pop):
+                kwargs.pop(p)
+        if not bool(kwargs):
+            return None
+        return json.dumps(kwargs, ensure_ascii=False)
+    else:
+        return None
+
+
+def _resultFilter(result, executionState):
+    for e in result[::-1]:
+        if e.get('execution_state') != executionState:
+            result.remove(e)
+    return result
+
+
+def _listWorkflowExecutionMethodName(isJsonResult, defaultMethodName):
+    return 'ListWorkflowExecutionResponse' if not isJsonResult else defaultMethodName
+
+
+def _listWorkflowExecutionCount(isJsonResult, body):
+    return body.count if not isJsonResult else body.get('count')
+
+
+def _listWorkflowExecutionBody(isJsonResult, isPy2, body):
+    if isJsonResult:
+        body = jsonLoadsForPy2(body) if isPy2 else json.loads(body)
+    return body
+
+
+def _listWorkflowExecutionResult(isJsonResult, body):
+    return list(body.executions) if not isJsonResult else list(body.get('executions'))
+
+
+def _listWorkflowExecutionIsTruncated(isJsonResult, body):
+    return body.isTruncated if not isJsonResult else body.get('is_truncated')
+
+
+def _listWorkflowExecutionNextMarker(isTruncated, isJsonResult, body):
+    if isTruncated:
+        nextMarker = body.nextMarker if not isJsonResult else body.get('next_marker')
+    else:
+        nextMarker = None
+    return nextMarker
+
+
+def _listWorkflowExecutionPathArgs(graphName, nextMarker, limit, executionType):
+    pathArgs = {'x-workflow-graph-name': graphName}
+    if nextMarker:
+        pathArgs['x-workflow-next-marker'] = nextMarker
+    if limit:
+        if limit > 1000:
+            raise Exception('Invalid parameter: limit')
+        pathArgs['x-workflow-limit'] = limit
+    if executionType:
+        pathArgs['x-workflow-execution-type'] = executionType
+    return pathArgs
+
+
+def _listWorkflowExecutionResp(isJsonResult, resp, result, isTruncated, nextMarker):
+    if isJsonResult:
+        resp.body = {
+            'count': len(result),
+            'is_truncated': isTruncated,
+            'executions': result
+        }
+        if isTruncated:
+            resp.body['next_marker'] = nextMarker
+        else:
+            if resp.body.get('next_marker') is not None:
+                del resp.body['next_marker']
+        resp.body = json.dumps(resp.body)
+    else:
+        resp.body.count = len(result)
+        resp.body.executions = result
+        resp.body.isTruncated = isTruncated
+        if isTruncated:
+            resp.body.nextMarker = nextMarker
+        else:
+            if resp.body.nextMarker is not None:
+                del resp.body.nextMarker
+
+    return resp
+
+
+def entrance(func):
+    @functools.wraps(func)
+    def wrapper(*args, **kwargs):
+        start = time.time()
+        workflowClient = args[0] if isinstance(args[0], WorkflowClient) else None
+        try:
+            return func(*args, **kwargs)
+        except Exception as e:
+            if workflowClient:
+                workflowClient.log_client.log(INFO, traceback.format_exc())
+            raise e
+        finally:
+            if workflowClient:
+                workflowClient.log_client.log(INFO,
+                                              '%s cost %s ms' % (func.__name__, int((time.time() - start) * 1000)))
+
+    return wrapper
+
+
+class WorkflowClient(_BasicClient):
+    _instance_lock = threading.Lock()
+    _instance = None
+
+    def __new__(cls, *args, **kwargs):
+        if cls._instance is None:
+            with cls._instance_lock:
+                if cls._instance is None:
+                    cls._instance = object.__new__(cls)
+        return cls._instance
+
+    def __init__(self, isJsonResult=False, *args, **kwargs):
+        if kwargs.get('path_style') or kwargs.get('is_signature_negotiation'):
+            raise Exception('Path style or signature negotiation does not support custom settings for workflow client.')
+        super(WorkflowClient, self).__init__(client_mode='workflow', *args, **kwargs)
+        self.__resource = 'v2/'
+        self.__isJsonResult = isJsonResult
+        self.__defaultMethodName = 'GetJsonResponse'
+
+    # begin workflow api
+    # begin workflow api
+    # begin workflow api
+
+    @entrance
+    def createWorkflowTemplate(self, templateName, description=None, states=None, inputs=None, tags=None):
+        return self._make_post_request(
+            entity=prepareJson(locals(), ['templateName']),
+            bucketName=None,
+            objectKey=self.__resource + combine(const.WORKFLOW_TEMPLATES, templateName),
+            headers=prepareHeader(),
+            methodName='CreateWorkflowTemplateResponse' if not self.__isJsonResult else self.__defaultMethodName
+        )
+
+    @entrance
+    def getWorkflowTemplate(self, templateName):
+        return self._make_get_request(
+            bucketName=None,
+            objectKey=self.__resource + combine(const.WORKFLOW_TEMPLATES, templateName),
+            headers=prepareHeader(),
+            methodName='GetWorkflowTemplateResponse' if not self.__isJsonResult else self.__defaultMethodName
+        )
+
+    @entrance
+    def deleteWorkflowTemplate(self, templateName):
+        return self._make_delete_request(
+            bucketName=None,
+            objectKey=self.__resource + combine(const.WORKFLOW_TEMPLATES, templateName),
+            headers=prepareHeader(),
+            methodName=self.__defaultMethodName
+        )
+
+    @entrance
+    def listWorkflowTemplate(self, templateNamePrefix=None, start=None, limit=None):
+        pathArgs = {'x-workflow-prefix': None}
+        if start:
+            pathArgs['x-workflow-start'] = start
+        if limit:
+            pathArgs['x-workflow-limit'] = limit
+
+        return self._make_get_request(
+            bucketName=None,
+            objectKey=self.__resource + combine(const.WORKFLOW_TEMPLATES,
+                                                templateNamePrefix if templateNamePrefix is not None else ''),
+            pathArgs=pathArgs,
+            headers=prepareHeader(),
+            methodName='ListWorkflowTemplateResponse' if not self.__isJsonResult else self.__defaultMethodName
+        )
+
+    @entrance
+    def createWorkflow(self, templateName, graphName, agency, description=None, parameters=None):
+        return self._make_post_request(
+            entity=prepareJson(locals(), ['templateName', 'graphName']),
+            bucketName=None,
+            objectKey=self.__resource + combine(const.WORKFLOWS, graphName),
+            pathArgs={'x-workflow-template-name': templateName},
+            headers=prepareHeader(),
+            methodName='CreateWorkflowResponse' if not self.__isJsonResult else self.__defaultMethodName
+        )
+
+    @entrance
+    def getWorkflow(self, graphName):
+        return self._make_get_request(
+            bucketName=None,
+            objectKey=self.__resource + combine(const.WORKFLOWS, graphName),
+            headers=prepareHeader(),
+            methodName='GetWorkflowResponse' if not self.__isJsonResult else self.__defaultMethodName
+        )
+
+    @entrance
+    def deleteWorkflow(self, graphName):
+        return self._make_delete_request(
+            bucketName=None,
+            objectKey=self.__resource + combine(const.WORKFLOWS, graphName),
+            headers=prepareHeader(),
+            methodName=self.__defaultMethodName
+        )
+
+    @entrance
+    def updateWorkflow(self, graphName, parameters=None, description=None):
+        return self._make_put_request(
+            entity=prepareJson(locals(), ['graphName']),
+            bucketName=None,
+            objectKey=self.__resource + combine(const.WORKFLOWS, graphName),
+            headers=prepareHeader(),
+            methodName='UpdateWorkflowResponse' if not self.__isJsonResult else self.__defaultMethodName
+        )
+
+    @entrance
+    def listWorkflow(self, graphNamePrefix=None, start=None, limit=None):
+        pathArgs = {'x-workflow-prefix': None}
+        if start:
+            pathArgs['x-workflow-start'] = start
+        if limit:
+            pathArgs['x-workflow-limit'] = limit
+
+        return self._make_get_request(
+            bucketName=None,
+            objectKey=self.__resource + combine(const.WORKFLOWS,
+                                                graphNamePrefix if graphNamePrefix is not None else ''),
+            pathArgs=pathArgs,
+            headers=prepareHeader(),
+            methodName='ListWorkflowResponse' if not self.__isJsonResult else self.__defaultMethodName
+        )
+
+    @entrance
+    def asyncAPIStartWorkflow(self, graphName, bucket, object, inputs=None):
+        return self._make_post_request(
+            entity=prepareJson(locals(), ['graphName']),
+            bucketName=None,
+            objectKey=self.__resource + combine(const.WORKFLOWS, graphName),
+            headers=prepareHeader(),
+            methodName='AsyncAPIStartWorkflowResponse' if not self.__isJsonResult else self.__defaultMethodName
+        )
+
+    @entrance
+    def listWorkflowExecution(self, graphName, executionType=None, nextMarker=None, limit=None, executionState=None):
+        pathArgs = _listWorkflowExecutionPathArgs(graphName, nextMarker, limit, executionType)
+        if executionState:
+            if executionState not in ['RUNNING', 'SUCCESS', 'FAILED']:
+                raise Exception('Invalid parameter: execution state')
+
+            resp = self._make_get_request(
+                bucketName=None,
+                objectKey=self.__resource + const.WORKFLOW_EXECUTIONS,
+                pathArgs=pathArgs,
+                headers=prepareHeader(),
+                methodName=_listWorkflowExecutionMethodName(self.__isJsonResult, self.__defaultMethodName)
+            )
+            if resp.status > 300:
+                return resp
+
+            body = _listWorkflowExecutionBody(self.__isJsonResult, const.IS_PYTHON2, resp.body)
+
+            count = _listWorkflowExecutionCount(self.__isJsonResult, body)
+
+            if count == 0:
+                return resp
+
+            result = _listWorkflowExecutionResult(self.__isJsonResult, body)
+            isTruncated = _listWorkflowExecutionIsTruncated(self.__isJsonResult, body)
+            nextMarker = _listWorkflowExecutionNextMarker(isTruncated, self.__isJsonResult, body)
+
+            result = _resultFilter(result, executionState)
+
+            if len(result) == limit:
+                return resp
+            else:
+                while len(result) < limit and isTruncated:
+                    pathArgs['x-workflow-next-marker'] = nextMarker
+                    tempResp = self._make_get_request(
+                        bucketName=None,
+                        objectKey=self.__resource + const.WORKFLOW_EXECUTIONS,
+                        pathArgs=pathArgs,
+                        headers=prepareHeader(),
+                        methodName=_listWorkflowExecutionMethodName(self.__isJsonResult, self.__defaultMethodName)
+                    )
+                    if tempResp.status > 300:
+                        return tempResp
+
+                    body = _listWorkflowExecutionBody(self.__isJsonResult, const.IS_PYTHON2, tempResp.body)
+
+                    count = _listWorkflowExecutionCount(self.__isJsonResult, body)
+                    if count == 0:
+                        return tempResp
+
+                    tempResult = _listWorkflowExecutionResult(self.__isJsonResult, body)
+
+                    tempResult = _resultFilter(tempResult, executionState)
+
+                    result.extend(tempResult)
+
+                    if len(result) > limit:
+                        result = result[0:limit]
+
+                    isTruncated = _listWorkflowExecutionIsTruncated(self.__isJsonResult, body)
+                    nextMarker = _listWorkflowExecutionNextMarker(isTruncated, self.__isJsonResult, body)
+
+            return _listWorkflowExecutionResp(self.__isJsonResult, resp, result, isTruncated, nextMarker)
+        else:
+            return self._make_get_request(
+                bucketName=None,
+                objectKey=self.__resource + const.WORKFLOW_EXECUTIONS,
+                pathArgs=pathArgs,
+                headers=prepareHeader(),
+                methodName=_listWorkflowExecutionMethodName(self.__isJsonResult, self.__defaultMethodName)
+            )
+
+    @entrance
+    def getWorkflowExecution(self, executionName, graphName):
+        pathArgs = {
+            'x-workflow-graph-name': graphName
+        }
+
+        return self._make_get_request(
+            bucketName=None,
+            objectKey=self.__resource + combine(const.WORKFLOW_EXECUTIONS, executionName),
+            pathArgs=pathArgs,
+            headers=prepareHeader(),
+            methodName='GetWorkflowExecutionResponse' if not self.__isJsonResult else self.__defaultMethodName
+        )
+
+    @entrance
+    def restoreFailedWorkflowExecution(self, executionName, graphName):
+        pathArgs = {
+            'x-workflow-graph-name': graphName
+        }
+
+        return self._make_put_request(
+            bucketName=None,
+            objectKey=self.__resource + combine(const.WORKFLOW_EXECUTIONS, executionName),
+            pathArgs=pathArgs,
+            headers=prepareHeader(),
+            methodName='RestoreFailedWorkflowExecutionResponse' if not self.__isJsonResult else self.__defaultMethodName
+        )
+
+    @entrance
+    def putTriggerPolicy(self, bucketName, rules):
+        pathArgs = {
+            const.WORKFLOW_TRIGGERPOLICY: None
+        }
+
+        return self._make_put_request(
+            entity=prepareJson(locals(), ['bucketName']),
+            bucketName=bucketName,
+            objectKey=None,
+            pathArgs=pathArgs,
+            headers=prepareHeader(),
+            methodName=self.__defaultMethodName
+        )
+
+    @entrance
+    def getTriggerPolicy(self, bucketName):
+        pathArgs = {
+            const.WORKFLOW_TRIGGERPOLICY: None
+        }
+
+        return self._make_get_request(
+            bucketName=bucketName,
+            objectKey=None,
+            pathArgs=pathArgs,
+            headers=prepareHeader(),
+            methodName='GetTriggerPolicyResponse' if not self.__isJsonResult else self.__defaultMethodName
+        )
+
+    @entrance
+    def deleteTriggerPolicy(self, bucketName):
+        pathArgs = {
+            const.WORKFLOW_TRIGGERPOLICY: None
+        }
+
+        return self._make_delete_request(
+            bucketName=bucketName,
+            objectKey=None,
+            pathArgs=pathArgs,
+            headers=prepareHeader(),
+            methodName=self.__defaultMethodName
+        )
+
+    # end workflow api
+    # end workflow api
+    # end workflow api
```

### Comparing `esdk-obs-python-3.23.9.1/setup.py` & `esdk-obs-python-3.24.3/setup.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,7 +1,8 @@
+#!/usr/bin/python
 # -*- coding:utf-8 -*-
 # Copyright 2019 Huawei Technologies Co.,Ltd.
 # Licensed under the Apache License, Version 2.0 (the "License"); you may not use
 # this file except in compliance with the License.  You may obtain a copy of the
 # License at
 
 # http://www.apache.org/licenses/LICENSE-2.0
@@ -17,20 +18,20 @@
 # use 'python setup.py install' to install to the python Lib directly
 
 
 from setuptools import setup, find_packages
 
 setup(
     name='esdk-obs-python',
-    version='3.23.9.1',
+    version='3.24.3',
     packages=find_packages(exclude=['tests']),
     zip_safe=False,
     description='OBS Python SDK',
     long_description='OBS Python SDK',
     license='Apache-2.0',
     keywords=('obs', 'python'),
     install_requires=[
-        'pycryptodome==3.10.1'
+        'pycryptodome >= 3.10.1'
     ],
     platforms='Independant',
     url='',
 )
```

